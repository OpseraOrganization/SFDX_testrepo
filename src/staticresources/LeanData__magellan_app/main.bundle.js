
//# sourceURL=magellan/main.bundle.js
!function(e){var t={};function __webpack_require__(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}__webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.i=function(e){return e},__webpack_require__.d=function(e,t,i){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=244)}([function(e,t,i){e.exports=function(){const e=i(1)();return Backbone.View.extend({className:"line-graph-div",tagName:"div",template:_.template(i(273)),initialize:function(e){this.params=e.params,this.cardInfo=e.cardInfo,this.legendInfo=e.legendInfo,this.graphLines=e.graphLines,this.render()},render:function(){const e=this.template({});return this.$el.html(e),this.setCardAndLegendInfo(this.cardInfo,this.legendInfo),this.setGraphLines(this.graphLines),this.initGraph(),this},events:{mousemove:"lineGraphMouseMove",mouseleave:"lineGraphMouseLeave",click:"lineGraphMouseClick"},setCardAndLegendInfo:function(t,i){let n={cardInfo:t,legendInfo:i};this.dataCards=new e(n),this.$el.find(".line-graph-info-container").html(this.dataCards.$el)},updateCardInfo:function(e){this.dataCards.model.set("cardInfo",e),this.dataCards.model.trigger("change:model")},setGraphLines:function(e){this.graphLines=e},createAndSetGraphLine:function(e,t,i,n,a){const o=[{date:new Date(e),count:i},{date:new Date(t),count:i}];0===a.length&&(a=o);const l={licensedUsersLine:{class:"tertiary-line",data:o,z_index:1},userCountLine:{class:"primary-line",data:n,displayPoint:'<rect class="point" x="-2.5" y="-2.5" width="5" height="5"/>',displayHover:'<circle cx="0" cy="0" r="10"/><text x="0" y="0" text-anchor="middle" alignment-baseline="mathematical"></text>',hover_radius:20,onHover:function(e,t){t.childNodes[1].innerHTML=e.count}.bind(this),click_radius:20,onClick:function(e){this.trigger("dataPoint:selected",e)}.bind(this),z_index:2},selection:{class:"point-selection",displayPoint:function(e,t,i){return'<line x1="0" y1="0" x2="0" y2="'+e.graphHeight+'"/><circle cx="0" cy="0" r="10" class="outer-circle"/><circle cx="0" cy="0" r="9" class="inner-circle"/><text x="0" y="0" text-anchor="middle" alignment-baseline="mathematical">'+i.count+"</text>"},data:a,z_index:3}};this.setGraphLines(l)},updateGraph:function(){_.isEmpty(this.graphLines)||this.drawLines(this.graphLines)},initGraph:function(){this.params.tick_format_x=this.params.tick_format_x||function(e){return e},this.params.tick_format_y=this.params.tick_format_y||function(e){return e},this.gridSize={width:this.params.width-this.params.margin_left-this.params.margin_right,height:this.params.height-this.params.margin_top-this.params.margin_bottom},this.lines={},this.curLineId=0;const e=d3.select(this.el);e.style("width",this.params.width+"px").style("height",this.params.height+"px");const t=e.append("svg").classed("line-graph",!0).attr("width",this.params.width+"px").attr("height",this.params.height+"px");t.append("clipPath").attr("id","gridClip").append("rect").attr("x",0).attr("y",-5).attr("width",this.gridSize.width).attr("height",this.gridSize.height+7),this.graphGroup=t.append("g").attr("width",this.params.width-this.params.margin_left).attr("height",this.params.height-this.params.margin_top).attr("transform","translate("+this.params.margin_left+","+this.params.margin_top+")"),this.xAxis=d3.scaleTime().range([0,this.gridSize.width]),this.yAxis=d3.scaleLinear().range([this.gridSize.height,0]),this.graphGroup.append("g").classed("x-axis",!0).attr("transform","translate(0,"+this.gridSize.height+")").call(d3.axisBottom(this.xAxis).tickFormat(this.params.tick_format_x).tickSizeInner(15).tickSizeOuter(0)),this.graphGroup.append("g").classed("y-axis",!0).call(d3.axisLeft(this.yAxis).tickFormat(this.params.tick_format_y).tickSizeInner(-this.gridSize.width).tickSizeOuter(0)),this.graphGroup.append("g").classed("lines",!0),this.startMouseEvents()},getTransitionDuration:function(){return this.params.transition_time},setTransitionDuration:function(e){this.params.transition_time=e},lineGraphMouseLeave:function(){this.graphGroup.selectAll(".line-group .hover").style("visibility","hidden")},lineGraphMouseMove:function(e){if(!this.mouseEnabled)return;const t=e.offsetX-this.params.margin_left,i=e.offsetY-this.params.margin_top,n=this.chooseClosestPoint({x:t,y:i},"hover");if(n){const e=n.lineParams,t=n.point,i=n.pointLoc,a=this.graphGroup.select("g.line-"+e.svgId+" .hover");a.attr("transform","translate("+i.__x+", "+i.__y+")"),d3.selectAll(".line-group .hover").each(function(){this==a.node()?(d3.select(this).style("visibility",""),this.parentNode.appendChild(this)):d3.select(this).style("visibility","hidden")}),e.onHover&&e.onHover(t,a.node())}else d3.selectAll(".line-group .hover").style("visibility","hidden")},lineGraphMouseClick:function(e){if(!this.mouseEnabled)return;e.offsetX,this.params.margin_left,e.offsetY,this.params.margin_top;const t=this.chooseClosestPoint({x:e.offsetX-this.params.margin_left,y:e.offsetY-this.params.margin_top},"click");if(t){const e=t.lineParams,i=t.point;t.pointLoc;e.onClick&&e.onClick(i)}},startMouseEvents:function(){this.mouseEnabled=!0},stopMouseEvents:function(){this.mouseEnabled=!1,this.lineGraphMouseLeave()},drawLines:function(e){e=Object.assign({},e),Object.keys(e).forEach(function(t){if(e[t].id=t,"string"==typeof e[t].displayPoint&&(e[t].displayPoint=function(){return this}.bind(e[t].displayPoint)),"string"==typeof e[t].displayHover&&(e[t].displayHover=function(){return this}.bind(e[t].displayHover)),t in this.lines){const i=e[t].data;e[t]=Object.assign({},this.lines[t],{data:i})}}.bind(this));const t=this.lines;this.lines=e,this.scaleAxes();const i=this.graphGroup.select(".lines").selectAll("g.line-group").data(Object.keys(this.lines),function(e){return e});this.animateAddLines(i),this.animateRemoveLines(i,t);const n=Object.keys(this.lines);n.map(function(e){this.animateUpdateLine(this.lines[e],!1)}.bind(this)),n.sort(function(e,t){let i=this.lines[e].z_index,n=this.lines[t].z_index;return i||(i=0),n||(n=0),i<n?-1:i>n?1:0}.bind(this));for(let e=0;e<n.length;e++){const t=d3.select(".line-"+this.lines[n[e]].svgId).node();t&&t.parentNode.appendChild(t)}this.stopMouseEvents();const a=Date.now();this.animationTimestamp=a,setTimeout(function(){this.animationTimestamp==a&&this.startMouseEvents()}.bind(this),this.params.transition_time)},scaleAxes:function(){const e=Object.keys(this.lines).reduce(function(e,t){return Array.prototype.push.apply(e,this.lines[t].data),e}.bind(this),[]),t=d3.extent(e,this.params.get_data_x),i=void 0!=this.params.x_axis_lbound?this.params.x_axis_lbound:d3.interpolate(t[0],t[1])(-.03),n=void 0!=this.params.x_axis_ubound?this.params.x_axis_ubound:d3.interpolate(t[0],t[1])(1.03);this.xAxis.domain([i,n]);let a=this.xAxis.ticks(),o=t[0],l=Math.abs(a[0].valueOf()-a[1].valueOf()),s=[];for(let e=0;e<a.length;e++){let t=new Date(l*e+o.getTime());s.push(t)}l/24192e5>=1&&(s=a).unshift(o);let r=e[Object.keys(e).length-1].date;s[s.length-1].valueOf()-r.valueOf()<0&&1728e5==l&&s.push(r);let d=d3.extent(e,this.params.get_data_y);0===d[0]&&0===d[1]&&(d[1]=1);const c=void 0!=this.params.y_axis_lbound?this.params.y_axis_lbound:d3.interpolate(d[0],d[1])(-.03),u=void 0!=this.params.y_axis_ubound?this.params.y_axis_ubound:d3.interpolate(d[0],d[1])(1.03);this.yAxis.domain([c,u]),this.graphGroup.select(".x-axis").transition().duration(this.params.transition_time).call(d3.axisBottom(this.xAxis).tickFormat(this.params.tick_format_x).tickSizeInner(15).tickSizeOuter(0).tickValues(s)),this.graphGroup.select(".y-axis").transition().duration(this.params.transition_time).call(d3.axisLeft(this.yAxis).tickFormat(this.params.tick_format_y).tickSizeInner(-this.gridSize.width).tickSizeOuter(0))},animateAddLines:function(e){const t=e.enter().append("g").attr("clip-path","url(#gridClip)").attr("class",function(e){const t=this.lines[e];return t.svgId=this.curLineId++,"line-group "+this.lines[e].class+" line-"+t.svgId}.bind(this));t.append("path").attr("class",function(e){return"line"}).style("opacity",0).attr("d",function(e){const t=this.lines[e],i=this.xAxis(this.params.get_data_x(t.data[0])),n=this.xAxis(this.params.get_data_x(t.data[t.data.length-1]));return t.points=[{__x:i,__y:this.gridSize.height},{__x:n,__y:this.gridSize.height}],this.pointsToPathD(t.points)}.bind(this));const i=this.lines,n=this;t.each(function(e,t,a){i[e].displayHover&&d3.select(this).append("g").classed("hover",!0).style("visibility","hidden").html(i[e].displayHover(n.getDimensions()))})},animateRemoveLines:function(e,t){e.exit().each(function(e){const i=t[e],n=i.points[0].__x,a=i.points[i.points.length-1].__x,o=this.gridSize.height;this.animateUpdateLine(i,!0,[{__x:n,__y:o},{__x:a,__y:o}])}.bind(this))},animateUpdateLine:function(e,t,i){const n=e.points;i=i||this.dataToPoints(e.data);const a=d3.extent(n,function(e){return e.__x}),o=d3.extent(i,function(e){return e.__x}),l=n.map(function(e){return(e.__x-a[0])/(a[1]-a[0])}),s=i.map(function(e){return(e.__x-o[0])/(o[1]-o[0])});let r=l.concat(s);r.sort();let d=[r[0]];for(let e=1;e<r.length;e++)r[e-1]!=r[e]&&d.push(r[e]);r=d;const c=[],u=[],p=d3.bisector(function(e){return e.__x}).left;for(let e=0;e<r.length;e++){const t=this.pointInterpolate(n,(1-r[e])*a[0]+r[e]*a[1],p);c.push(t);const l=this.pointInterpolate(i,(1-r[e])*o[0]+r[e]*o[1],p);u.push(l)}const h=d3.interpolate(c,u),g=this.graphGroup.select("g.line-"+e.svgId);g.selectAll("g.point").each(function(e,t,n){const l=d3.select(n[t]),s=Number(l.attr("transform").split(/[(,)]/)[1]);if(!s)return;let r=(s-a[0])/(a[1]-a[0]);const d=this.pointInterpolate(i,(1-r)*o[0]+r*o[1],p);l.transition().duration(this.params.transition_time).style("opacity",0).attr("transform","translate("+d.__x+", "+d.__y+")").remove()}.bind(this));const m=g.select(".line").transition().duration(this.params.transition_time).style("opacity",1).attrTween("d",function(){return function(t){let a;return a=0==t?n:1==t?i:h(t),e.points=a,this.pointsToPathD(a)}.bind(this)}.bind(this));return t?m.style("opacity",0).on("end",function(){this.graphGroup.select("g.line-"+e.svgId).style("opacity",0).remove()}.bind(this)):(m.on("end",()=>e.points=i),i.map(function(t,i){let l=(t.__x-o[0])/(o[1]-o[0]);const s=this.pointInterpolate(n,(1-l)*a[0]+l*a[1],p);e.displayPoint&&g.append("g").classed("point",!0).attr("transform","translate("+s.__x+", "+s.__y+")").html(e.displayPoint(this.getDimensions({x:t.__x,y:t.__y}),e.id,e.data[i])).style("opacity",0).transition().duration(this.params.transition_time).style("opacity",1).attr("transform","translate("+t.__x+", "+t.__y+")")}.bind(this))),m},pointInterpolate:function(e,t,i){const n=i(e,t);if(n<=0)return e[0];if(n>=e.length)return e[e.length-1];const a=e[n-1].__x,o=(t-a)/(e[n].__x-a);return{__x:e[n-1].__x*(1-o)+e[n].__x*o,__y:e[n-1].__y*(1-o)+e[n].__y*o}},dataToPoints:function(e){return e.map(function(e){return{__x:this.xAxis(this.params.get_data_x(e)),__y:this.yAxis(this.params.get_data_y(e))}}.bind(this))},pointsToPathD:d3.line().x(function(e){return e.__x}).y(function(e){return e.__y}),chooseClosestPoint:function(e,t){if(e.x<0||e.x>this.gridSize.width||e.y<0||e.y>this.gridSize.height)return;const i=Object.keys(this.lines).map(e=>this.lines[e]).filter(function(e){return void 0!=e[t+"_radius"]});if(i.length<=0)return;let n,a,o,l;for(let s=0;s<i.length;s++){const r=i[s],d=Math.pow(r[t+"_radius"],2),c=this.dataToPoints(r.data);for(let t=0;t<c.length;t++){const i=Math.pow(c[t].__x-e.x,2)+Math.pow(c[t].__y-e.y,2);if(i<=d){let e=void 0==n;if(!e){if(i>l)continue;i<l&&(e=!0)}if(!e){if(n.z_index>r.z_index)continue;n.z_index<r.z_index&&(e=!0)}if(!e&&n.id<=r.id)continue;n=r,a=r.data[t],o=c[t],l=i}}}return n?{lineParams:n,point:a,pointLoc:o}:void 0},getDimensions:function(e,t){let i={graphWidth:this.gridSize.width,graphHeight:this.gridSize.height};return e&&Object.assign(i,{pointLeft:e.x,pointTop:e.y}),t&&Object.assign(i,{mouseLeft:t.x,mouseTop:t.y}),i}})}},function(e,t,i){e.exports=function(){const e=i(71)();return Backbone.View.extend({template:_.template(i(259)),initialize:function(e){this.initializeModel(e),this.listenTo(this.model,"change:model",this.render),this.render()},initializeModel:function(t){this.model=new e,this.model.set("cardInfo",t.cardInfo),this.model.set("legendInfo",t.legendInfo)},render:function(){const e=this.template({model:this.model.toJSON(),cardInfo:this.model.get("cardInfo"),legendInfo:this.model.get("legendInfo")});return this.$el.html(e),this}})}},function(e,t){const i={a2o:{title:"Perform Account-Based Marketing and Sales.",body:"Match accounts with opportunities to assign all accounts to the right rep. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request/"},o2o:{title:"Perform Account-Based Marketing and Sales.",body:"Match opportunities with other opportunities on the same account to assign all opportunities to the right rep. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request/"},o2c:{title:"Perform Account-Based Marketing and Sales.",body:"Match opportunities with contacts to assign all opportunities to the right rep. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request/"},l2a:{title:"Perform Account-Based Marketing and Sales.",body:"Match leads with accounts to so that the rep associated with the account can contact them. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request/"},l2l:{title:"Perform Account-Based Marketing and Sales.",body:"Match leads with other leads from the same company to assign all leads to the same rep. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request/"},l2o:{title:"Match a Lead to an Active Opportunity.",body:"Match leads to existing opportunities so you can assign leads to reps who are actively working opportunities. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request"},duplicate:{title:"Perform Account-Based Marketing and Sales.",body:"Check whether there is a duplicate lead record. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request/"},duplicateContact:{title:"Perform Account-Based Marketing and Sales.",body:"Check whether your lead is already a contact in your database. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request/"},routeToMatchedAccount:{title:"Perform Account-Based Marketing and Sales.",body:"Assign ownership to the rep who already owns the matched account. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request/"},routeToMatchedLead:{title:"Perform Account-Based Marketing and Sales.",body:"Assign ownership to the rep who is already engaged with other leads from the same company. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request/"},routeToMatchedOpportunity:{title:"Perform Account-Based Marketing and Sales.",body:"Assign ownership to the rep who already owns the opportunity. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request/"},routeToMatchedContact:{title:"Perform Account-Based Marketing and Sales.",body:"Assign ownership to the rep who already owns the matched contact. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request/"},createAccount:{title:"Looking to Create Accounts in Your Routing Flow?",body:"Support your account-based strategy by creating accounts for high priority leads where an account doesn’t exist. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request"},createOpportunity:{title:"Looking to Create Opportunities in Your Routing Flow?",body:"Support your account-based strategy by creating opportunities for high priority leads where an opportunity doesn’t exist. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request"},merge:{title:"Perform Account-Based Marketing and Sales.",body:"Check your database for duplicates of your lead. If a duplicate is found, you can merge them. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request"},mergeContact:{title:"Perform Account-Based Marketing and Sales.",body:"Check your database for duplicates of the contact associated with your lead. If a duplicate is found, the lead will be converted to a contact and the contacts will be merged. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request"},c2c:{title:"Perform Account-Based Marketing and Sales.",body:"Match contacts with other contacts on the same account to assign all contacts to the same rep. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request"},c2o:{title:"Perform Account-Based Marketing and Sales.",body:"Match contacts with opportunities to assign all contacts to the same rep. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request"},sendNotification:{title:"Get Notified About Important Buying Signals.",body:"Alert sales reps and account executives when there are important buying signals or a high priority lead becomes engaged. Contact your LeanData team to learn more.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request"},outreach:{title:"Initiate Actions in Outreach directly from LeanData",body:"Expedite speed to lead, respond, and engage by automating your entire technology flow with your LeanData. Contact your LeanData team to learn more about automatically adding Prospects to Sequences and updating Prospect Sequence States.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request"},salesloft:{title:"Initiate Actions in SalesLoft directly from LeanData",body:"Expedite speed to lead, respond, and engage by automating your entire technology flow with your LeanData. Contact your LeanData team to learn more about automatically adding and removing People from Cadences.",action:"Request a Demo",location:"//www.leandatainc.com/demo-request"}},n={"Magellan.Models.MatchNodes.Lead2Lead":i.l2l,"Magellan.Models.MatchNodes.Lead2Account":i.l2a,"Magellan.Models.MatchNodes.Lead2Opportunity":i.l2o,"Magellan.Models.MatchNodes.Duplicate":i.duplicate,"Magellan.Models.MatchNodes.DuplicateContact":i.duplicateContact,"Magellan.Models.TrueFalseNodes.Lead2Lead":i.l2l,"Magellan.Models.TrueFalseNodes.Lead2Account":i.l2a,"Magellan.Models.TrueFalseNodes.Lead2Opportunity":i.l2o,"Magellan.Models.TrueFalseNodes.Duplicate":i.duplicate,"Magellan.Models.TrueFalseNodes.DuplicateContact":i.duplicateContact,"Magellan.Models.BranchNodes.Lead2Lead":i.l2l,"Magellan.Models.BranchNodes.Lead2Account":i.l2a,"Magellan.Models.BranchNodes.Lead2Opportunity":i.l2o,"Magellan.Models.BranchNodes.Duplicate":i.duplicate,"Magellan.Models.BranchNodes.DuplicateContact":i.duplicateContact,"Magellan.Models.AssignOwnerLead":i.routeToMatchedLead,"Magellan.Models.AssignOwnerAccount":i.routeToMatchedAccount,"Magellan.Models.AssignOwnerOpportunity":i.routeToMatchedOpportunity,"Magellan.Models.CreateAccount":i.createAccount,"Magellan.Models.CreateOpportunity":i.createOpportunity,"Magellan.Models.Merge":i.merge,"Magellan.Models.MergeContact":i.mergeContact,"Magellan.Models.LeadSendNotification":i.sendNotification,"Magellan.Models.OutreachAddToSequence":i.outreach,"Magellan.Models.SalesloftAddToCadence":i.salesloft,"Magellan.Models.ContactMatchNode.Contact2Contact":i.c2c,"Magellan.Models.ContactMatchNode.Contact2Opportunity":i.c2o,"Magellan.Models.ContactTrueFalseNode.Contact2Contact":i.c2c,"Magellan.Models.ContactTrueFalseNode.Contact2Opportunity":i.c2o,"Magellan.Models.ContactBranchNode.Contact2Contact":i.c2c,"Magellan.Models.ContactBranchNode.Contact2Opportunity":i.c2o,"Magellan.Models.ContactCreateOpportunity":i.createOpportunity,"Magellan.Models.ContactCreateTask":i.createTask,"Magellan.Models.ContactRouteToContact":i.routeToMatchedContact,"Magellan.Models.ContactRouteToAccount":i.routeToMatchedAccount,"Magellan.Models.ContactRouteToOpportunity":i.routeToMatchedOpportunity,"Magellan.Models.ContactSendNotification":i.sendNotification,"Magellan.Models.ContactOutreachAddToSequence":i.outreach,"Magellan.Models.ContactSalesloftAddToCadence":i.salesloft,"Magellan.Models.AccountMatchNode.Account2Opportunity":i.a2o,"Magellan.Models.AccountTrueFalseNode.Account2Opportunity":i.a2o,"Magellan.Models.AccountBranchNode.Account2Opportunity":i.a2o,"Magellan.Models.AccountSendNotification":i.sendNotification,"Magellan.Models.AccountOpportunityRouting":i.routeToMatchedOpportunity,"Magellan.Models.AccountRouteToTerritory":i.routeToTerritory,"Magellan.Models.AccountCreateOpportunity":i.createOpportunity,"Magellan.Models.OpportunityMatchNode.Opportunity2Contact":i.o2c,"Magellan.Models.OpportunityMatchNode.Opportunity2Opportunity":i.o2o,"Magellan.Models.OpportunityTrueFalseNode.Opportunity2Contact":i.o2c,"Magellan.Models.OpportunityTrueFalseNode.Opportunity2Opportunity":i.o2o,"Magellan.Models.OpportunityBranchNode.Opportunity2Contact":i.o2c,"Magellan.Models.OpportunityBranchNode.Opportunity2Opportunity":i.o2o,"Magellan.Models.OpportunityRouteToOpportunity":i.routeToMatchedOpportunity,"Magellan.Models.OpportunityRouteToAccount":i.routeToMatchedAccount,"Magellan.Models.OpportunityRouteToContact":i.routeToMatchedContact,"Magellan.Models.OpportunityCreateOpportunity":i.createOpportunity,"Magellan.Models.OpportunitySendNotification":i.sendNotification,outreach:i.outreach,salesloft:i.salesloft};e.exports=n},function(e,t,i){function generateHourOptions(e,t){var i=t[0],n=t[1],a=[];_.each(_.range(24),function(e){hrStr=String(e).padStart(2,"0"),_.each(_.range(0,60,30),function(t){minStr=String(t).padStart(2,"0"),0===e&&0===t||a.push(hrStr+":"+minStr)})}),a.unshift("00:01"),a.push("23:59");var o=[];return a.forEach(function(t){t===e?o.push("<div data-data='"+t+"' selected>"+Magellan.Util.convertTo12Hr(t)+"</div>"):i&&t<i||n&&t>n?o.push("<div disabled>"+Magellan.Util.convertTo12Hr(t)+"</div>"):o.push("<div data-data='"+t+"'>"+Magellan.Util.convertTo12Hr(t)+"</div>")}),o.join("")}e.exports=function(){return Backbone.View.extend({template:_.template(i(314)),initialize:function(e){this.parentView=e.parentView,this.isNewCreation,Magellan.Models.roundRobinSchedulesData&&(this.collection=Magellan.Models.roundRobinSchedulesData.getCollection("workingHours")),e.Id?(this.model=this.collection.get(e.Id),this.affectedPools=Magellan.Models.roundRobinSchedulesData.get("scheduleToPoolMap")[this.model.get("Id")]||[],this.isNewCreation=!1):(this.model=new Magellan.Models.RoundRobinSchedulesHours,this.affectedPools=[],this.isNewCreation=!0),this.model.on("change",this.handleModelChange,this),this.inlineMode=e.inlineMode||!1,this.readOnly=!1,this.showHoursOnly=!1,this.inlineMode&&this.model.set("Is_Template__c",!1)},events:{"click .hour-creator-button.cancel":"handleExitCreatorClick","click .hour-creator-button.save":"handleSaveButtonClick","click .hour-creator-button.revert":"handleRevertButtonClick","click .add-hours-btn:not(.disabled)":"handleAddHoursClick","change .day-dropdown":"handleDayDropdownChange","click .hour-range-delete":"handleDeleteHoursClick","click .selected-time":"handleSelectedTimeClick","click .time-dropdown-container div":"handleTimeOptionClick",click:"handleBodyClick","change .hourInput":"handleHourChange","change #name-field":"handleNameChange","change #description-field":"handleDescriptionChange","change .save-as-template-checkbox":"handleSaveAsTemplateCheckboxChange","click .ld-tab":"handleTabClick","nestedTypeaheadSelector:select #timezone-dropdown":"handleTimezoneChange"},handleTabClick:function(e){var t=$(e.target);this.$(".tab-content").hide(),t.hasClass("editor")&&this.$(".tab-content.editor").show(),t.hasClass("pools")&&(this.$(".tab-content.pools").show(),this.tableView.render())},handleSaveAsTemplateCheckboxChange:function(e){this.model.set("Is_Template__c",$(e.target).is(":checked")),this.render()},handleModelChange:function(e){var t=this.model.checkHasChanged();Magellan.Navigation.promptAreYouSure=t,this.$el.find(".dirty-bar .hour-creator-button.revert").toggleClass("disabled",!t),this.$el.find(".dirty-bar .hour-creator-button.save").toggleClass("disabled",!t),this.$el.removeClass("show-errors")},handleSaveButtonClick:function(e){var t=this.affectedPools,i=t.length,n=t.map(function(e){return e.attributes.Grouping_Name__c}).join(", ");i>0?new Magellan.Views.ConfirmationModal({header:i+" pools will be affected",message:"The following pools will be affected by this change: ",footer:n,onConfirmed:this.attemptSave.bind(this)}).open():this.attemptSave()},attemptSave:function(){var e=this;if(this.model.allDaysAreValid()&&!_.isEmpty(this.model.get("Name"))&&!_.isEmpty(this.model.get("Timezone__c"))){Magellan.Navigation.promptAreYouSure=!1;var t=Magellan.Controllers.GUI.appWaitingScreen.show("Saving Data...");this.model.saveToServer().then(function(t){return e.collection.refreshData()}).then(function(i){e.parentView.switchTab("working-hours"),t.resolve()})}else this.$el.addClass("show-errors")},handleNameChange:function(e){var t=$(e.target),i=t.val();t.toggleClass("input-invalid",_.isEmpty(i)),this.model.set({Name:i})},handleDescriptionChange:function(e){var t=$(e.target).val();this.model.set({Description__c:t})},handleRevertButtonClick:function(){var e=this;requestModalResponse("confirm-revert").then(function(){e.model.revert(),e.render()})},handleExitCreatorClick:function(){var e=this;this.model.checkHasChanged()?requestModalResponse("dirty").then(function(){e.model.revert(),e.parentView.switchTab("working-hours")}):this.parentView.switchTab("working-hours")},handleBodyClick:function(e){$(".time-dropdown-container").hide(),this.$el.find(".selected-time").removeClass("active")},handleSelectedTimeClick:function(e){e.stopPropagation();var t=$(e.target),i=t.children(".time-dropdown-container");$(".time-dropdown-container").not(i).hide(),t.toggleClass("active"),i.toggle(),this.delegateEvents();var n=i.children(":not([disabled])").first();n.offset()&&i.scrollTop(n.offset().top-i.offset().top+i.scrollTop())},handleDayDropdownChange:function(e){e.stopPropagation();var t=this.getCoordsFromEvent(e),i=$(e.target).val();"no-routing"===i?this.model.resetDay(t.row):"all-day"===i?this.model.makeDayFullDay(t.row):"custom"===i&&(this.model.resetDay(t.row),this.model.addHoursToDay(t.row)),this.render()},handleTimeOptionClick:function(e){e.stopPropagation();var t=$(e.target).data("data"),i=this.getCoordsFromEvent(e);this.model.changeHour(i.row,i.col,i.side,t),this.render(),this.$el.find(".empty-input").first().click()},handleAddHoursClick:function(e){e.stopPropagation();var t=this.getCoordsFromEvent(e);this.model.addHoursToDay(t.row),this.render(),this.$el.find(".empty-input").first().click()},handleDeleteHoursClick:function(e){var t=this.getCoordsFromEvent(e);this.model.deleteHours(t.row,t.col),this.render()},handleHourChange:function(e){var t=this.getCoordsFromEvent(e),i=e.target.value;this.model.changeHour(t.row,t.col,t.side,i),this.render()},handleTimezoneChange:function(e,t){this.model.set({Timezone__c:t.selection[0].id})},getCoordsFromEvent:function(e){return{row:$(e.target).closest("tr").data("row"),col:$(e.target).closest(".hour-range-container").data("col"),side:$(e.target).closest(".hourInput").data("side")}},sideloadData:function(e,t){var i;this.readOnly="readonly-template"===t||"readonly-show-default"===t,this.showHoursOnly="readonly-show-default"===t,i="readonly-show-default"===t?{sunday:[["00:00","23:59"]],monday:[["00:00","23:59"]],tuesday:[["00:00","23:59"]],wednesday:[["00:00","23:59"]],thursday:[["00:00","23:59"]],friday:[["00:00","23:59"]],saturday:[["00:00","23:59"]]}:e.Schedule_Data__c?JSON.parse(e.Schedule_Data__c.replace(/&quot;/g,'"')):_.cloneDeep(this.model.defaultSchedule_Data__c),this.model.set({Id:e.Id,id:e.Id,Name:e.Name?e.Id.startsWith(e.Name)?"":e.Name:"",Timezone__c:e.Timezone__c||"",Schedule_Data__c:i,Is_Template__c:e.Is_Template__c||!1,Description__c:e.Description__c||"This is the default working hours setting. Pools using this setting will receive records 24 hours/day, 7 days a week"}),this.model.originalAttributes=_.cloneDeep(this.model.attributes),this.render()},render:function(){return function drawTemplate(){var e=this.template({Name:this.model.get("Name"),Description__c:this.model.get("Description__c"),model:this.model,Schedule_Data__c:this.model.get("Schedule_Data__c"),Is_Template__c:this.model.get("Is_Template__c"),generateHourOptions,convertTo12Hr:Magellan.Util.convertTo12Hr,hasChanged:this.model.checkHasChanged(),inlineMode:this.inlineMode,readOnly:this.readOnly,showHoursOnly:this.showHoursOnly,Timezone__c:this.model.get("Timezone__c")||"",isNewCreation:this.isNewCreation});this.$el.html(e)}.call(this),function initializeTimezoneDropdown(){var e=Magellan.Util.Timezones.createTimezoneTypeahead(this.model.get("Timezone__c"));this.$el.find("#timezone-dropdown").html(e.$el)}.call(this),function initializeTooltip(){Magellan.Util.initializeTooltip(this.$el.find(".working-hour-name-tooltip.ld-tooltip-hint"),{title:"Working Hours",body:"Apply a set of Working Hours to a pool to indicate when the Members of this pool are available for routing. Records that reach this pool outside of these hours will follow the 'Not Available for Routing' path in routing graphs, allowing for contingency planning."}),Magellan.Util.initializeTooltip(this.$el.find(".save-as-template-checkbox.ld-tooltip-hint"),{title:"Save As Template",body:"Saving this new set of Working Hours as a template will make it available in the Schedules page. From there, you can apply it to other pools that have the same hours."})}.call(this),this.tableView=function initializeTable(){var e=[{name:"Pool Name",getter:function(e){return e.attributes.Grouping_Name__c}},{name:"Pool Type",getter:function(e){return e.attributes.Pool_Type__c&&"live"===e.attributes.Pool_Type__c?"Live":"Standard"}},{name:"Object Type",getter:function(e){return e.attributes.Object_Type__c||""}},{name:"No. of Members",getter:function(e){return e.memberCount||""}},{name:"Pool Managers",getter:function(e){return Magellan.Util.CreateUserListOverflow(e,160)}}],t=this.affectedPools.map(function(t){return e.map(function(e){return e.getter(t)})}),i=new Magellan.Views.LDTable({columns:e,data:t,isInlineEditorEnabled:!1,datatableOptions:{bFilter:!1,language:{emptyTable:"No pools to display.",searchPlaceholder:"Search Pools"},order:[[1,"desc"]],columnDefs:[]}});return this.$(".pool-table-container").html(i.render().$el),i}.call(this),this}})}},function(e,t){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),Magellan.Models.RoundRobinSchedulesHours=Backbone.Model.extend({initialize:function(e,t){this.defaultSchedule_Data__c={sunday:[],monday:[],tuesday:[],wednesday:[],thursday:[],friday:[],saturday:[]},e||(e={Id:null,id:null,Name:"",Description__c:"",Timezone__c:null,Schedule_Type__c:"workingHours",Schedule_Data__c:_.cloneDeep(this.defaultSchedule_Data__c),Is_Template__c:!0},this.set(e)),this.set("id",e.Id),this.originalAttributes=_.cloneDeep(e)},resetDay:function(e){this.get("Schedule_Data__c")[e]=[],this.trigger("change",this,{})},makeDayFullDay:function(e){this.get("Schedule_Data__c")[e]=[["00:00","23:59"]],this.trigger("change",this,{})},addHoursToDay:function(e){this.trigger("change",this,{});this.get("Schedule_Data__c")[e].push([null,null]),this.sortDay(e)},deleteHours:function(e,t){this.get("Schedule_Data__c")[e].splice(t,1),this.trigger("change",this,{})},changeHour:function(e,t,i,n){this.trigger("change",this,{});var a="start"===i?0:1;this.get("Schedule_Data__c")[e][t][a]=n,this.sortDay(e)},sortDay:function(e){this.get("Schedule_Data__c")[e].sort(function(e,t){return null===e[0]?1:null===t[0]?-1:e[0].replace(":","")-t[0].replace(":","")})},getDropdownBounds:function(e,t,i){var n=_.flatten(this.get("Schedule_Data__c")[e]),a=2*t+("start"===i?0:1);return[n[a-1]||n[a-2]||null,n[a+1]||n[a+2]||null]},dayIsValid:function(e){return _.reduce(this.get("Schedule_Data__c")[e],function(e,t){var i=null!==t[0]&&null!==t[1];return e&&i},!0)},allDaysAreValid:function(){var e=!0;return _.each(this.get("Schedule_Data__c"),function(t,i){e=e&&this.dayIsValid(i)},this),e},saveToServer:function(){var e=this,t=$.Deferred(),i={attributes:{}};_.each(["Id","Name","Timezone__c","Description__c","Schedule_Data__c","Schedule_Type__c","Is_Template__c"],function(t){i.attributes[t]=e.get(t)}),null===i.attributes.Id&&delete i.attributes.Id,i.attributes.Schedule_Data__c=JSON.stringify(i.attributes.Schedule_Data__c);var n=JSON.stringify(i);return Magellan.Services.FlowBuilder.upsertRoundRobinScheduleSettings(n).then(function(i){if(Magellan.Models.roundRobinScheduleData){var n=Magellan.Models.roundRobinSchedulesData.getCollection("workingHours");n.contains(e)||n.add(e)}t.resolve(i.Id)}),t},checkHasChanged:function(){return!(_.isEqual(this.attributes.Name,this.originalAttributes.Name)&&_.isEqual(this.attributes.Schedule_Data__c,this.originalAttributes.Schedule_Data__c)&&_.isEqual(this.attributes.Timezone__c,this.originalAttributes.Timezone__c)&&_.isEqual(this.attributes.Description__c,this.originalAttributes.Description__c))},revert:function(){this.attributes=_.cloneDeep(this.originalAttributes)}}),Magellan.Models.RoundRobinSchedulesHoursCollection=Backbone.Collection.extend({model:Magellan.Models.RoundRobinSchedulesHours,initialize:function(){},removeModelById:function(e){var t=this,i=$.Deferred(),n=this.get(e),a=JSON.stringify({settingsToDelete:[e]});return Magellan.Services.FlowBuilder.deleteRoundRobinScheduleSettings(a).then(function(e){"Success"===e?(t.remove(n),i.resolve()):i.reject()}),i},populateWithRemoteData:function(e){this.reset(null);for(var t=e.filter(function(e){return"workingHours"===e.type}),i=0;i<t.length;i++)t[i].attributes.Schedule_Data__c&&(t[i].attributes.Schedule_Data__c=JSON.parse(t[i].attributes.Schedule_Data__c.replace(/&quot;/g,'"'))),this.add(new Magellan.Models.RoundRobinSchedulesHours(t[i].attributes))},refreshData:function(){var e=this,t=$.Deferred();return Magellan.Services.FlowBuilder.getRoundRobinScheduleSettings().then(function(i){e.populateWithRemoteData(i),t.resolve()})}})}},function(e,t){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),Magellan.Models.TerritoryGeo=Backbone.Model.extend({initialize:function(e,t){if(t.isNewTerritory){(e={Id:""})[ns+"Owner__c"]="",e[ns+"PostalCode__c"]="",e[ns+"City__c"]="",e[ns+"State__c"]="",e[ns+"Country__c"]="",e[ns+"Custom_Field__c"]="",e.Territory_Name=""}else{var i=t.rawTerritoryGeo;(e={}).Id=i.Id||"",e[ns+"Owner__c"]=i[ns+"LD_Territory__r"][ns+"Owner__c"]||"",e[ns+"PostalCode__c"]=i[ns+"PostalCode__c"]||"",e[ns+"City__c"]=i[ns+"City__c"]||"",e[ns+"State__c"]=i[ns+"State__c"]||"",e[ns+"Country__c"]=i[ns+"Country__c"]||"",e[ns+"Custom_Field__c"]=i[ns+"Custom_Field__c"]||"",e.Territory_Name=i[ns+"LD_Territory__r"][ns+"Name__c"]||""}this.set(e),this.originalAttributes=_.clone(e),this.collection=t.collection,this.rawTerritoryGeo=i,this.on("change",this.onChange),this.on("remove",this.onRemove)},fieldsChanged:function(){var e=this;return _.reduce(this.attributes,function(t,i,n){return _.isEqual(i,e.originalAttributes[n])?t:t.concat(n)},[])},hasChanged:function(){return this.fieldsChanged().length>0},getValidationStatus:function(){var e=[],t=[];return this.collection.checkIfDuplicate(this)&&(e.push(ns+"PostalCode__c",ns+"City__c",ns+"State__c",ns+"Country__c",ns+"Custom_Field__c"),t.push("Duplicate Territory")),this.isUnsetOrEmpty("Territory_Name")&&(e.push("Territory_Name"),t.push("Territory Name required")),this.isUnsetOrEmpty(ns+"Owner__c")&&(e.push(ns+"Owner__c"),t.push("Owner required")),this.isUnsetOrEmpty(ns+"PostalCode__c")&&this.isUnsetOrEmpty(ns+"City__c")&&this.isUnsetOrEmpty(ns+"State__c")&&this.isUnsetOrEmpty(ns+"Country__c")&&this.isUnsetOrEmpty(ns+"Custom_Field__c")&&(e.push(ns+"PostalCode__c",ns+"City__c",ns+"State__c",ns+"Country__c",ns+"Custom_Field__c"),t.push("Missing geographical data")),this.isUnsetOrEmpty(ns+"Country__c")&&!this.isUnsetOrEmpty(ns+"PostalCode__c")&&(e.push(ns+"Country__c"),t.push("Country must be included with postal code")),this.isUnsetOrEmpty(ns+"Country__c")&&!this.isUnsetOrEmpty(ns+"City__c")&&(e.push(ns+"Country__c"),t.push("Country must be included with city")),["us","usa","united states"].includes(this.get(ns+"Country__c").toLowerCase())&&!this.isUnsetOrEmpty(ns+"City__c")&&this.isUnsetOrEmpty(ns+"State__c")&&(e.push(ns+"State__c"),t.push("State required")),!this.isUnsetOrEmpty(ns+"State__c")&&this.isUnsetOrEmpty(ns+"Country__c")&&(e.push(ns+"Country__c"),t.push("Country must be included with state")),{invalidFields:e,errorMessages:t}},isValid:function(){return 0===this.getValidationStatus().invalidFields.length},isUnsetOrEmpty:function(e){var t=this.get(e);return void 0===t||null===t||""===t.trim()},onChange:function(){this.hasChanged()?this.collection.modelsToChange.add(this):this.collection.modelsToChange.delete(this),this.isValid()?this.collection.invalidModels.delete(this):this.collection.invalidModels.add(this)},onRemove:function(){this.collection.invalidModels.delete(this),this.collection.modelsToChange.delete(this)}}),Magellan.Models.TerritoryGeos=Backbone.Collection.extend({model:Magellan.Models.TerritoryGeo,initialize:function(e,t){void 0!==t&&"segmentName"in t||console.error("The TerritoryGeos collection requires segmentName to be set."),this.segmentName=t.segmentName,this.modelsToChange=new Set,this.modelsToDelete=new Set,this.invalidModels=new Set},fetchRemoteData:function(){var e=$.Deferred(),t=this,i=new $.Deferred,n=!(-1===this.segmentName.lastIndexOf(" - Draft")),a=n?this.segmentName.substring(0,this.segmentName.lastIndexOf(" - Draft")):this.segmentName,o=(Magellan.Services.FlowBuilder.getTerritorySegments().then(function(e){var o=_.find(e.territorySegments,function(e){return e[ns+"Name__c"]===a})[ns+"Version__c"];n&&o++,Magellan.Models.TerritoryGeos.fetchGeoList(a,o).then(function(e){var n=[];e.forEach(function(e){var i={rawTerritoryGeo:e,collection:t};n.push(new Magellan.Models.TerritoryGeo(null,i))}),t.reset(n),i.resolve()})}),Magellan.Services.FlowBuilder.getAllOwnerDataRemote("",!1).then(function(e){var i=JSON.parse(e.owners);t.ownerIdToNameMap=JSON.parse(e["name map"]),t.dropdownOwnerList=[];for(var n=0;n<i.length;n++)null==i[n][ns+"Grouping_Name__c"]?t.dropdownOwnerList.push({label:i[n].Name,value:i[n].Id}):t.dropdownOwnerList.push({label:i[n][ns+"Grouping_Name__c"],value:i[n].Id}),t.dropdownOwnerList=_.sortBy(t.dropdownOwnerList,function(e){return e.label.toLowerCase()})}));return $.when(i,o).done(function(){hideLoadingOverlay(),e.resolve()}),e},checkIfDuplicate:function(e){var t=[],i=[ns+"PostalCode__c",ns+"City__c",ns+"State__c",ns+"Country__c",ns+"Custom_Field__c"];return this.models.forEach(function(n){if(n!==e){var a=!0;i.forEach(function(t){n.get(t).toLowerCase()!==e.get(t).toLowerCase()&&(a=!1)}),a&&t.push(n)}}),t.length>0},submitChanges:function(){var e=this.segmentName,t=[],i=[],n=[];return this.modelsToChange.forEach(function(e){var n=[e.get(ns+"Custom_Field__c"),e.get(ns+"PostalCode__c"),e.get(ns+"City__c"),e.get(ns+"State__c"),e.get(ns+"Country__c")].join("!LD");t.push(n);var a=[e.get("Id"),e.get("Territory_Name"),e.get(ns+"Owner__c")].join("!LD");i.push(a)}),this.modelsToDelete.forEach(function(e){n.push(e.get("Id"))}),Magellan.Services.FlowBuilder.upsertTerritoryGeos(e,t,i,n)}},{fetchGeoList:function(e,t){var i=new $.Deferred,n=5001,a=new RecordsFetcher({columns:["Id",ns+"PostalCode__c",ns+"City__c",ns+"State__c",ns+"Country__c",ns+"Custom_Field__c",ns+"LD_Territory__c",ns+"LD_Territory__r."+ns+"Name__c",ns+"LD_Territory__r."+ns+"Owner__c"],"sobject type":ns+"LD_Territory_Geo__c",conditions:[ns+"LD_Territory__r."+ns+"Territory_Segment__r."+ns+"Name__c='"+e.replace("'","\\'")+"'",ns+"Version__c="+t],"has paginate behavior":!0,"has first pagination":!0,"has last pagination":!0,"page size":n});return a.getFirstPage().then(function(){downloadedGeos=a.currentRecords,0!==a.currentRecords.length&&function concatOtherPageIfAny(){a.isOnLastPage()||a.currentRecords.length!==n?i.resolve(downloadedGeos):a.getNextPage().then(function(){downloadedGeos=downloadedGeos.concat(a.currentRecords),concatOtherPageIfAny()})}()}),i}})}},function(e,t){e.exports='<div id=metrics-detail-wrapper> <div id=outcome-tabs-wrapper> <div id=success-pill class="status-pill active"> SUCCESSES </div> <div id=failure-pill class=status-pill> FAILURES </div> <div id=ownership-distribution-pill class=status-pill> OWNERSHIP <br>DISTRIBUTION </div> <div id=territory-distribution-pill class=status-pill> TERRITORY <br>DISTRIBUTION </div> </div> <div id=daterange-inputs> <div class=input-title>Date Range</div> <div> <input id=logs-datepick-start type=text /> <label class=dg_date-label for=logs-datepick-start></label> to <input id=logs-datepick-end type=text /> <label class=dg_date-label for=logs-datepick-end></label> </div> </div> <div class=type-filter-dropdown> <div class=input-title>Type</div> <div> <select id=metric-type-select> <option value=all>All</option> <option value=new <%if(statType === \'new\'){%> selected=selected <%}%> >New</option> <option value=updated <%if(statType === \'updated\'){%> selected=selected <%}%>>Updated</option> </select> </div> </div> <div id=placeholder-dropdown-div class=detail-filter-dropdown></div> <div id=next-node-filter-dropdown class=detail-filter-dropdown> <div class="multiselect tab-specific-filter for-next-node-type"> <div class=selectBox id=next-node-select-box> <select> <option>Filter By Failure Type</option> </select> <div class=overSelect></div> </div> <div id=next-node-checkboxes class=filter-checkboxes> </div> </div> </div> <div id=outcome-filter-dropdown class=detail-filter-dropdown> <div class="multiselect tab-specific-filter for-ownership-distribution"> <div class=selectBox id=owner-select-box> <select> <option>Filter By Owner</option> </select> <div class=overSelect></div> </div> <div id=owner-checkboxes class=filter-checkboxes></div> </div> </div> <div id=outcome-wrapper> <div class=dg_inner-wrapper-header-legacy> <div class="title title-left"><%= isEdge ? \'Edge\' : \'Action\'%></div> <div class="title title-separator">/</div> <div class="title title-right"><%= title %></div> </div> <div id=limit-message>Showing last 2000 entries</div> <div id=outcome-table-wrapper></div> </div> </div> '},function(e,t){e.exports='<table id=metrics-detail-table> <thead id=metrics-detail-head> <tr> <% _.each(columnLayout, function(col) { %> <th> <%= (col[0] === \'Post-Owner\' && title === \'Convert Lead\') ? (col[0] + \' (Contact)\') : col[0]  %> </th> <% }); %> </tr> </thead> <tbody id=metrics-detail-body> </tbody> </table> <div class=pagination-wrapper> <span data-direction=first class="pagination-item pagination-first">First</span> <span data-direction=previous class="pagination-item pagination-back">Previous</span> <span data-direction=next class="pagination-item pagination-next">Next</span> <span data-direction=last class="pagination-item pagination-last">Last</span> </div> '},function(e,t){e.exports='<% _.each(columnLayout, function(col, i) { %> <% if (i === 0) { %> <td><%- col[2](log) %></td> <% } else { %> <td> <% if (col[1](log)) { %> <a href="<%- col[1](log) %>" target=_blank><%- col[2](log, idToNameMap) %></a> <% } else { %> <%- col[2](log, idToNameMap) %> <% } %> </td> <% } %> <% }); %>'},function(e,t){e.exports='<div id=action-node-custom-interface-partial class=node-partial data-node-type=action-custom-interface data-form-title="Action – Custom Interface"> <div id=main-div> <% if(Object.keys(customInterfaceNodesAndEdges).length === 0) { %> <div class=header-font>Custom Parameter</div> <div>Enter the parameter to be used with this Custom Interface node.</div> <div class=custom-interface-parameter-column> <textarea class="custom-interface-parameter width-fill" rows=1 style=overflow:hidden;word-wrap:break-word;height:22px><%= customParameter %></textarea> </div> <% } else { %> <div class="header-font header-spacing">Node Type</div> <div id=customInterfaceNodeDropdown class=customInterfaceNodeTypeahead style="margin:0 300px 0 0"></div> <% } %> <div class=section-wrapper-spacing></div> </div> <div id=advanced-settings-wrapper></div> </div>'},function(e,t,i){e.exports=function(e){var t=new(i(67)())({model:new(i(66)())({allData:e,history:e.history,hasActiveJobs:e.hasActiveJobs,oneBatchOn:e.oneBatchOn,emailList:e.emailList})});$(".dg_inner-wrapper").html(t.render().$el)}},function(e,t,i){e.exports=function(e){var t=new(i(70)())({model:new(i(69)())({history:e})});$(".dg_inner-wrapper").html(t.render().$el)}},function(e,t,i){e.exports=function(){var e=i(258);return Magellan.Views.ConfirmationModal=Backbone.View.extend({_promise:null,_templatePromise:null,header:"Confirmation Dialog",message:"Are you sure?",footer:"",container:"#magellan-modals",template:_.template(e),events:{"click .cancel-button":"_cancel","click .confirm-button":"_confirm","click .modal":"handleOutsideClick"},initialize:function(e){this._promise=$.Deferred(),this.container=e.container||this.container,"function"==typeof e.onConfirmed&&this._promise.then(e.onConfirmed),"function"==typeof e.onCancelled&&this._promise.fail(e.onCancelled),this._promise.always(this.close.bind(this)),this.header=e.header||this.header,this.message=e.message||this.message,this.footer=e.footer||this.footer,this.primaryButtonText=e.primaryButtonText||"Confirm",this.hideSecondaryButton=e.hideSecondaryButton||!1,this.secondaryButtonText=e.secondaryButtonText||"Cancel",this.render()},_cancel:function(e){this._promise.reject(e)},_confirm:function(e){this._promise.resolve(e)},handleOutsideClick:function(e){e.target===e.currentTarget&&(this.hideSecondaryButton?this._confirm(e):this._cancel(e))},render:function(){return this.$el.html(this.template({header:this.header,message:this.message,footer:this.footer,primaryButtonText:this.primaryButtonText,hideSecondaryButton:this.hideSecondaryButton,secondaryButtonText:this.secondaryButtonText})),$(this.container).append(this.$el),this},open:function(){this.$el.find(".modal").modal({show:!0,backdrop:"static"})},close:function(){var e=this;return this.$el.find(".modal").on("hidden.bs.modal",function(){e.remove()}),this.$el.find(".modal").modal("hide"),this},onConfirmed:function(e){if("function"!=typeof e)throw"ConfirmationModal Error: confirmation callback must be a function.";return this._promise.then(e),this},onCancelled:function(e){if("function"!=typeof e)throw"ConfirmationModal Error: cancellation callback must be a function.";return this._promise.fail(e),this}})}},function(e,t,i){e.exports=function(){Magellan.Models.EmailRecipientSelector=i(73)(),Magellan.Views.EmailRecipientSelector=i(74)()}},function(e,t,i){e.exports=function(){Magellan.Models.EmailTemplateSelector=i(75)(),Magellan.Views.EmailTemplateSelector=i(76)()}},function(e,t,i){e.exports=function(){Magellan.Views.ErrorBanner=Backbone.View.extend({template:_.template(i(263)),initialize:function(e){this.primaryText=e.primaryText||"",this.secondaryText=e.secondaryText||"",this.container=e.container||"#error-banner-wrapper",this.hideCloseButton=e.hideCloseButton||!1,this.$container=$(this.container)},events:{"click .error-banner-close-btn":"hide"},show:function(e,t){this.primaryText=e||this.primaryText,this.secondaryText=t||this.secondaryText,this.setElement(this.$container).render(),this.$container.css("display","flex")},hide:function(e){return this.$container.hide(),this.remove(),this},render:function(){var e=this.template({primaryText:this.primaryText,secondaryText:this.secondaryText,hideCloseButton:this.hideCloseButton});return this.$el.html(e),this}})}},function(e,t,i){e.exports=function(){var e=i(264),t=Magellan.Models.GraphSettingsMenu=Backbone.Model.extend({localStorageKey:"GraphSettingsMenuModelAttributes",defaults:{checkboxItems:[{name:"enableGridlines",label:"Enable Gridlines",value:!1},{name:"createThumbnail",label:"Create Thumbnail on Save",value:!0}]},loadFromLocal:function(){var e=JSON.parse(localStorage.getItem(this.localStorageKey)||null);e&&this.set(e)},saveLocal:function(){localStorage.setItem(this.localStorageKey,JSON.stringify(this.attributes))},getSetting:function(e){var t=null;for(var i in this.attributes){for(var n=this.attributes[i],a=0,o=n.length;a<o;a++){var l=n[a];if(l.name==e){t=l;break}}if(null!==t)break}return t}});Magellan.Views.GraphSettingsMenu=Backbone.View.extend({onChangeCallback:null,initialize:function(e){var i=this;e=e||{},this.model=this.model||new t,this.onChangeCallback="function"==typeof e.onChange?e.onChange:function(){},$("body").on("click",function(e){i.$el.find(".graph-settings-menu").trigger("toggle",!1)}),this.$el.on("click",function(e){e.stopPropagation()})},events:{"click .graph-settings-menu-button":"_toggleButtonClicked","change .checkboxSetting":"_checkboxSettingChanged","toggle .graph-settings-menu":"toggleMenu","click #export-png-button":"prepareDownload"},template:_.template(e),render:function(){return this.model.loadFromLocal(),this.$el.html(this.template(this.model.attributes)),this},prepareDownload(){this.$el.find("#export-png-button").text("Preparing"),this.$el.find("#export-png-button").toggleClass("disabled",!0),_.defer(this.exportPNG.bind(this))},exportPNG(){Date.now();!function(e,t){(t=t||{}).type="image/png";var i,n=function(e,t){var i=joint.util.normalizeSides(t.padding);t.width&&t.height&&(i.left+i.right>=t.width&&(i.left=i.right=0),i.top+i.bottom>=t.height&&(i.top=i.bottom=0));var n=g.rect({x:-i.left,y:-i.top,width:i.left+i.right,height:i.top+i.bottom});if(t.width&&t.height){var a=e.width+i.left+i.right,o=e.height+i.top+i.bottom;n.scale(a/t.width,o/t.height)}return g.Rect(e).moveAndExpand(n)}(V.transformRect(paper.getContentBBox(),paper.matrix().inverse()),t),a=function(e,t){return{width:(e.width||1)*t,height:(e.height||1)*t}}(t.width&&t.height?t:n,function(e){var t=1;if(!_.isUndefined(e)&&(t=parseFloat(e),!_.isFinite(t)||0===t))throw new Error("dia.Paper: invalid raster size ("+e+")");return t}(t.size)),o=new Image;o.onload=function(){var n,l,s;function createCanvas(){(s=document.createElement("canvas")).width=a.width,s.height=a.height,(l=s.getContext("2d")).fillStyle=t.backgroundColor||"white",l.fillRect(0,0,a.width,a.height)}function readCanvas(){n=s.toDataURL(t.type,t.quality),e(n),s.svg&&_.isFunction(s.svg.stop)&&_.defer(s.svg.stop)}createCanvas();try{l.drawImage(o,0,0,a.width,a.height),readCanvas()}catch(e){if("undefined"==typeof canvg)return void console.error("Canvas tainted. Canvg library required.");createCanvas();var r={ignoreDimensions:!0,ignoreClear:!0,ignoreMouse:!0,ignoreAnimation:!0,offsetX:0,offsetY:0,useCORS:!0};canvg(s,i,_.extend(r,{forceRedraw:_.once(function(){return!0}),renderCallback:function(){try{readCanvas()}catch(e){i=function replaceSVGImagesWithSVGEmbedded(e){return e.replace(/\<image[^>]*>/g,function(e){var t=e.match(/href="([^"]*)"/)[1];if("data:image/svg+xml"===t.substr(0,"data:image/svg+xml".length)){var i=atob(t.substr(t.indexOf(",")+1));return i.substr(i.indexOf("<svg"))}return e})}(i),createCanvas(),canvg(s,i,_.extend(r,{renderCallback:readCanvas}))}}}))}},function(e,t){t=t||{},paper.trigger("beforeexport",t);var i=t.area?t.area:V.transformRect(paper.getContentBBox(),paper.matrix().inverse()),n=paper.svg.cloneNode(!0);n.removeAttribute("style"),t.preserveDimensions&&V(n).attr({width:i.width,height:i.height}),V(n).findOne(".joint-viewport").removeAttr("transform"),V(n).attr("viewBox",i.x+" "+i.y+" "+i.width+" "+i.height);for(var a=document.styleSheets.length,o=[],l=a-1;l>=0;l--)o[l]=document.styleSheets[l],document.styleSheets[l].disabled=!0;var s={};$(paper.svg).find("*").each(function(e){var t=window.getComputedStyle(this,null),i={};_.each(t,function(e){i[e]=t.getPropertyValue(e)}),s[e]=i}),a!=document.styleSheets.length&&_.each(o,function(e,t){document.styleSheets[t]=e});for(var r=0;r<a;r++)document.styleSheets[r].disabled=!1;var d={};$(paper.svg).find("*").each(function(e){var t=window.getComputedStyle(this,null),i=s[e],n={};_.each(t,function(e){t.getPropertyValue(e)!==i[e]&&(n[e]=t.getPropertyValue(e))}),d[e]=n});var c=[];$(n).find("*").each(function(e){$(this).css(d[e]),"image"!==this.tagName.toLowerCase()||["paste","copy","edit","delete"].includes($(this).attr("action"))||c.push(this)});var u=c.length,p=c.length;function serialize(){return(new XMLSerializer).serializeToString(n).replace(/&nbsp;/g," ")}if(paper.trigger("afterexport",t),!t.convertImagesToDataUris||!c.length)return e(serialize());!function convertImages(e){$("#export-png-button").text(Math.floor((u-p)/u*100)+"%"),p--;var t=V(c.shift());if(!t)return e();var i=t.attr("xlink:href")||t.attr("href");joint.util.imageToDataUri(i,function(i,n){t.attr("xlink:href",n),convertImages(e)})}(function(){e(serialize())})}(function(e){i=e=e.replace('width="100%"','width="'+a.width+'"').replace('height="100%"','height="'+a.height+'"'),o.src="data:image/svg+xml,"+encodeURIComponent(e)},{convertImagesToDataUris:!0,area:n})}(function(e){var t=$("#graph-name").val()+".png";download(e,t,"image/png"),$("#export-png-button").text("Export Graph as Image (.png)"),$("#export-png-button").toggleClass("disabled",!1)})},toggleMenu:function(e,t){j$(e.target).is(this.$el.find(".graph-settings-menu"))?j$(".graph-settings-menu").toggleClass("open",t):j$(e.target).closest(".graph-settings-menu").toggleClass("open",t)},onChange:function(e){this.onChangeCallback=e},_toggleButtonClicked:function(e,t){this.toggleMenu(e,t)},_checkboxSettingChanged:function(e){var t=$(e.target).prop("name"),i=this.model.get("checkboxItems").find(function(e){return e.name===t});i.value=$(e.target).is(":checked"),this._settingChanged(i,e)},_settingChanged:function(e,t){this.onChangeCallback(e,t),this.model.saveLocal()}})}},function(e,t,i){e.exports=function(){var e=i(265);j$(document).on("mouseup",function(){j$(".ld-dropdown.open").toggleClass("open",!1)});$.fn.LDDropdown=function(e){if("val"===e)return this.magellanLDDropdown instanceof Magellan.Views.LDDropdown?this.magellanLDDropdown.val():null;if("LDDropdown"===e)return this.magellanLDDropdown||null;var t=new Magellan.Views.LDDropdown(e);return j$(this).html(t.$el),this.magellanLDDropdown=t,j$(this)};var t=Magellan.Models.LDDropdown=Backbone.Model.extend({defaults:{value:null,options:null,required:!1},isValid:function(){var e=!0;if(!1===this.get("required"))return e;var t=this.get("value");return(_.isNull(t)||_.isUndefined(t)||""===t||this.get("options").indexOf(t)<0)&&(e=!1),e}});return Magellan.Views.LDDropdown=Backbone.View.extend({tagName:"div",optionTemplate:_.template("<span><%=option%></span>"),customOptionTemplate:null,customValues:null,template:_.template(e),bloodhound:null,datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,enableSearch:!1,menuAlignClass:"",placeholder:null,onChangeCallback:null,initialize:function(e){if(this.model=new t,_.isUndefined(e)||(this.model.set("value",_.isUndefined(e.value)?null:e.value),this.model.set("options",e.options||[]),this.model.set("required",!0===e.required),this.model.set("customValues",e.customValues||{}),this.model.set("preferredOptions",e.preferredOptions||[]),this.model.set("hidePreferredOptions",!0===e.hidePreferredOptions),"string"==typeof e.optionTemplate?this.customOptionTemplate=_.template(e.optionTemplate):this.customOptionTemplate=e.optionTemplate||null,this.queryTokenizer=e.queryTokenizer||this.queryTokenizer,this.datumTokenizer=e.datumTokenizer||this.datumTokenizer,this.enableSearch=_.isBoolean(e.enableSearch)?e.enableSearch:this.model.get("options").length>=10,this.menuAlignClass=e.alignMenuRight?"pull-right":"",this.placeholder="string"==typeof e.placeholder&&e.placeholder?e.placeholder:"Select One",this.onChangeCallback="function"==typeof e.onChange?e.onChange:_.noop,this.enableSearch&&this._initBloodhound(this.model.get("options")),this.isValid=_.isFunction(e.isValid)?e.isValid:this.model.isValid.bind(this.model)),e&&e.size)switch(e.size){case"large":this.$el.attr("class","ld-dropdown ld-dropdown-large");break;case"xtra-small":this.$el.attr("class","ld-dropdown ld-dropdown-xtra-small");break;default:this.$el.attr("class","ld-dropdown ld-dropdown-small")}else this.$el.attr("class","ld-dropdown ld-dropdown-small");this.render(),this.listenTo(this.model,"change",this._handleModelChange)},_initBloodhound:function(e){this.bloodhound=new Bloodhound({local:e,queryTokenizer:this.queryTokenizer,datumTokenizer:this.datumTokenizer}),this.bloodhound.initialize().then(this._search.bind(this,this.$(".ld-dropdown-search-filter-input").val()))},events:{"click .ld-dropdown-search-filter-container":function(e){e.preventDefault(),e.stopPropagation()},"click .ld-dropdown-option-list-item":"selectOption","mouseup .ld-dropdown-search-filter-input":function(e){e.stopPropagation()},"keyup .ld-dropdown-search-filter-input":"_searchInputChanged","mouseup .ld-dropdown-toggle":function(e){e.stopPropagation();var t=$(e.target).closest(".ld-dropdown");$(".ld-dropdown.open").not(t).toggleClass("open",!1),t.toggleClass("open").find(".ld-dropdown-toggle").focus(),this.enableSearch&&this.$(".ld-dropdown-search-filter-input").focus()},"mouseup .ld-dropdown":function(e){e.stopPropagation()}},render:function(){var e=this.template(this);return this.$el.html(e),this._renderSelectList(),this._renderSelectedValue(),this.$(".ld-dropdown-search-filter-container").toggleClass("hidden",!1===this.enableSearch),this},selectOption:function(e){var t=$(e.target);$(e.target).is(".ld-dropdown-option-list-item")||(t=$(e.target).closest(".ld-dropdown-option-list-item"));var i=t.find(".ld-dropdown-option").data("model-index"),n=this.model.get("options")[i];this.model.set("value",n),this.$(".ld-dropdown-option-list-item.selected").toggleClass("selected",!1),t.toggleClass("selected",!0)},val:function(){return this.model.get("value")},validate:function(){var e=this.isValid();return this.$el.toggleClass("input-invalid",!e),e},_handleModelChange:function(){this._renderSelectedValue(),this.$el.trigger("LDDropdown:change",this),this.onChangeCallback(this.val(),this)},_getOptionItemMarkup:function(e){var t="";return"function"==typeof this.customOptionTemplate?t=this.customOptionTemplate(e):"object"==typeof e&&!1===_.isNull(e)?(console.warn("LDDropdown: option an item is an object, but no custom template was provided (optionTemplate)"),t=this.optionTemplate({option:JSON.stringify(e)})):t="boolean"==typeof e?this.optionTemplate({option:_.capitalize(e+"")}):this.optionTemplate({option:(_.isNull(e)||_.isUndefined(e)?"":e)+""}),t},_renderSelectedValue:function(){var e=this.model.get("value"),t=this.placeholder;(!_.isEmpty(e)||_.isBoolean(e)||_.isNumber(e))&&(t=this._getOptionItemMarkup(e)),this.$(".ld-dropdown-value").html(t),this.$(".ld-dropdown-value").prop("title",$("<div>").html(t).text()),this.validate()},_renderSelectList:function(){var e="";this.$(".dropdown-menu .ld-dropdown-option-list-item").remove();var t={},i=this.model.get("preferredOptions"),n=this.model.get("hidePreferredOptions"),a=function(e,t,a){var o=i.includes(e);return _.template('<li class="ld-dropdown-option-list-item <%=selected%> <%=hiddenClass%>"><div class="ld-dropdown-option" data-model-index="<%=modelIndex%>"><%=renderedOptionTemplate%></div></li>')({renderedOptionTemplate:this._getOptionItemMarkup(e),modelIndex:t,selected:e===this.model.get("value")?"selected":"",hiddenClass:n&&o&&!a?"hidden":""})}.bind(this),o=0;_.each(this.model.get("options"),function(n,l){e+=a(n,l,!1),n==i[o]&&(t[o]=l,o++)},this);var l="";_.each(i,function(e,i){l+=a(e,t[i],!0)}),_.isEmpty(l)||(e=l+'<li class="separator preferred-section-separator" style="border-bottom: 1px solid #CCC;"></li>'+e),this.$(".dropdown-menu").append(e);var s=this.$(".preferred-section-separator").index();s>-1&&this.$(".dropdown-menu li").slice(0,s).each(function(){$(this).hasClass("ld-dropdown-option-list-item")&&$(this).toggleClass("is-preferred-option",!0)})},_searchInputChanged:_.debounce(function(e){var t=$(e.currentTarget).val();t?this._search(t):this.$(".ld-dropdown-option-list-item").show()},300),_search:function(e){this.bloodhound.search(e,this._filterByItems.bind(this))},_filterByItems:function(e){var t=this.model.get("options");e.length!==t.length?(this.$(".dropdown-menu .ld-dropdown-option-list-item").hide(),_.each(e,function(e){var i=t.indexOf(e);this.$(".dropdown-menu .ld-dropdown-option-list-item:not(.is-preferred-option)").eq(i).show()},this)):this.$(".dropdown-menu .ld-dropdown-option-list-item").show()}})}},function(e,t,i){e.exports=function(){var e=i(266),t=Magellan.Views.LDInput=Backbone.View.extend({inputEl:null,labelEl:null,errorEl:null,validate:null,className:"ld-input-container",tagName:"span",_isEditing:!1,events:{"change .ld-input":"update","blur .ld-input":function(){this.isValid()&&this.viewMode()},"click .ld-input-label":"editMode","keyup .ld-input":"_onTyping","LDInput:validate .ld-input":"isValid","LDInput:edit .ld-input":"editMode","LDInput:view .ld-input":"viewMode"},initialize:function(e){_.isUndefined(e)||(e.inputEl&&(this.inputEl=e.inputEl),e.validate&&(this.validate=e.validate),this.showError=!_.isBoolean(e.showError)||e.showError,this._isEditing="edit"===e.mode||!1),$("#paper").off(),$("#paper").on("click",function(){this.viewMode()}.bind(this)),this.render()},template:_.template(e),render:function(){return this.$el.html(this.template({editIconURL:resourceURL+"/images/Edit_Icon_Unselected_50x50.png"})),null!==this.inputEl?(this.$(".ld-input").replaceWith(this.inputEl),this.inputEl.toggleClass("ld-input",!0)):this.inputEl=this.$(".ld-input"),this.labelEl=this.$(".ld-input-label"),this.labelEl.find(".label-text").text(this.inputEl.val()),this.errorEl=this.$(".ld-input-error"),this._isEditing?this.editMode():this.viewMode(),this.update(),this},editMode:function(){this._isEditing=!0,this.$el.toggleClass("ld-input-mode-edit",this._isEditing).toggleClass("ld-input-mode-view",!1),this.inputEl.focus()},viewMode:function(){this._isEditing=!1,this.$el.toggleClass("ld-input-mode-view",!0).toggleClass("ld-input-mode-edit",this._isEditing)},isValid:function(){var e=this.validate(this.inputEl.val());return _.isEmpty(e)?(this.inputEl.toggleClass("input-invalid",!1),this.errorEl.html(""),this.inputEl.trigger("LDInput:isValid",this.inputEl.val()),this.$el.prop("title",""),!0):(this.inputEl.toggleClass("input-invalid",!0),this.showError?this.errorEl.html(e):this.$el.prop("title",e),this.inputEl.trigger("LDInput:isInvalid"),!1)},update:function(){return this.labelEl.find(".label-text").text(this.inputEl.val()),this.inputEl.trigger("LDInput:updated",this.inputEl.val()),this.isValid()},_onTyping:function(e){13==e.keyCode&&(this.update()?this.viewMode():this.editMode()),_.isUndefined(this._debouncedIsValid)&&(this._debouncedIsValid=_.debounce(this.isValid.bind(this),50)),this._debouncedIsValid()}});$.fn.LDInput=function(e){if(e&&!_.isUndefined(e.defaultValue)&&$(this).val(e.defaultValue),"string"==typeof e)switch(e){case"validate":$(this).trigger("LDInput:validate");break;case"edit":$(this).trigger("LDInput:edit");break;case"view":$(this).trigger("LDInput:view")}else if($(this).hasClass("ld-input"))(e=e||{}).mode&&"edit"===e.mode?$(this).trigger("LDInput:edit"):$(this).trigger("LDInput:view"),$(this).trigger("change");else{(e=e||{}).inputEl=$(this);var i=$("<span></span>");$(this).replaceWith(i);var n=new t(e);i.replaceWith(n.$el)}return $(this)}}},function(e,t,i){e.exports=function(){var e=window.Magellan=window.Magellan||e||{};e.Util=e.Util||{},e.Util.MultiSelectDropdownMap=e.Util.MultiSelectDropdownMap||{},$(window).click(function(t){t.stopPropagation();var i=$(t.target);if(0===i.parents(".multiselect-dropdown").length&&!i.hasClass("multiselect-dropdown")){var n=$(".multiselect-dropdown.open");if(n.toggleClass("open",!1),n.length>0){var a=n.parent(),o=e.Util.MultiSelectDropdownMap[a[0].className];if(o){var l=o._getSelectedItems(!0);o.onCloseCallback(l.string,l.object)}}}}),$.fn.MultiSelectDropdown=function(t){var i=$(this)[0].className;if("MultiSelectDropdown"===t)return e.Util.MultiSelectDropdownMap[i]||null;var n=new e.Views.MultiSelectDropdown(t);return $(this).html(n.$el),e.Util.MultiSelectDropdownMap[i]=n,n};var t=Backbone.Model.extend({defaults:{options:[]}});e.Views.MultiSelectDropdown=Backbone.View.extend({tagName:"div",template:_.template(i(267)),optionTemplate:_.template(i(268)),initialize:function(e){e=e||{},this.model=new t({options:e.options||[]}),this.dropdownType=e.dropdownType||"items",this.placeholder=e.placeholder||"Select "+this.dropdownType,this.allSelectedPlaceholder="All "+this.dropdownType+" selected",this.selectAll=e.selectAll||!1,this.labelPropertyName=e.customLabelProperty||"label",this.valuePropertyName=e.customValueProperty||"value",this.generatePlaceholder="function"==typeof e.generatePlaceholder?e.generatePlaceholder:null,this.onChangeCallback="function"==typeof e.onChange?e.onChange:_.noop,this.onCloseCallback="function"==typeof e.onClose?e.onClose:_.noop,this.size=e.size&&"large"===e.size?"large":"small",this.checkboxClass="cb-container-"+this.size,this.$el.attr("class","multiselect-dropdown multiselect-dropdown-"+this.size),this.listenTo(this,"setToggleCheckboxState",this.setToggleCheckboxState),this.render()},events:{"mouseup .multiselect-dropdown-option-list-item":"selectOption","mouseup .multiselect-toggle-all-list-item":"toggleAllOptions",mouseup:"toggleDropdown"},toggleDropdown:function(e){e.stopPropagation();var t=$(e.target),i=t.closest(".multiselect-dropdown"),n=i.hasClass("open");if(0===t.parents(".multiselect-dropdown-menu").length&&!t.hasClass("multiselect-dropdown-menu")&&($(".multiselect-dropdown.open").not(i).toggleClass("open",!1),i.toggleClass("open").find(".multiselect-dropdown-toggle").focus(),n)){var a=this._getSelectedItems(!0);this.onCloseCallback(a.string,a.object),this.trigger("MultiSelectDropdown:close",a.string,a.object,this)}},toggleAllOptions:function(e){var t=$(e.currentTarget).find('input[type="checkbox"]'),i=this.$el.find('.multiselect-dropdown-option-list-item input[type="checkbox"]');t.prop("checked",!t.is(":checked")),i.prop("checked",t.is(":checked"));var n=this._getSelectedItems(!0),a=n.string.length,o=this.model.get("options").length;_.isNull(this.generatePlaceholder)?this.$el.find(".placeholder-text").text(t.is(":checked")?this.allSelectedPlaceholder:this.placeholder):this.$el.find(".placeholder-text").html(this.generatePlaceholder(null,n.string,n.object,o,this.dropdownType)),this.$el.find(".toggleText").text(t.is(":checked")?"Deselect All":"Select All"),this.onChangeCallback(null,n.string,n.object,o),this.trigger("MultiSelectDropdown:select",null,n.string,n.object,o,this),this.trigger("setToggleCheckboxState",a===o,a,o)},setToggleCheckboxState:function(e,t,i){this.$el.find('.multiselect-toggle-all-list-item input[type="checkbox"]').prop("checked",e),this.$el.find(".toggleText").text(e?"Deselect All":"Select All")},selectOption:function(e){var t=$(e.currentTarget).find('input[type="checkbox"]');t.prop("checked",!t.is(":checked"));var i=t.data("value"),n=this._getSelectedItems(!0),a=n.string.length,o=this.model.get("options").length;_.isNull(this.generatePlaceholder)?a===o?this.$el.find(".placeholder-text").text(this.allSelectedPlaceholder):a>0?this.$el.find(".placeholder-text").text(a+" of "+o+" "+this.dropdownType+" selected"):this.$el.find(".placeholder-text").text(this.placeholder):this.$el.find(".placeholder-text").html(this.generatePlaceholder(null,n.string,n.object,o,this.dropdownType)),this.onChangeCallback(i,n.string,n.object,o),this.trigger("MultiSelectDropdown:select",i,n.string,n.object,o,this),this.trigger("setToggleCheckboxState",a===o,a,o)},_getSelectedItems:function(e){var t=[],i=[],n=this.$el.find("."+this.checkboxClass+' input[type="checkbox"]:checked');return _.each(Array.prototype.slice.apply(n),function(e){var n=$(e).data();if(!_.isEmpty(n)){var a={};a[this.labelPropertyName]=n.label,a[this.valuePropertyName]=n.value,i.push(a),t.push(a[this.valuePropertyName])}},this),e?{object:i,string:t}:t},_updateSelectList:function(e){this.model.set("options",e||[]),this._renderSelectList()},_renderSelectList:function(){var e=this.model.get("options"),t="";this.$el.find(".multiselect-dropdown-option-list-item").remove(),_.each(e,function(e){var i=this.optionTemplate({label:e[this.labelPropertyName],value:e[this.valuePropertyName],checkboxClass:this.checkboxClass});t+=i},this),e.length>0?(this.$el.find(".multiselect-toggle-all-list-item").show(),this.$el.find(".multiselect-dropdown-menu").append(t),this.$el.find("."+this.checkboxClass+' input[type="checkbox"]').prop("checked",this.selectAll),this.$el.find(".toggleText").text(this.selectAll?"Deselect All":"Select All")):this.$el.find(".multiselect-toggle-all-list-item").hide();var i=this._getSelectedItems(!0),n=(i.string.length,this.model.get("options").length);_.isNull(this.generatePlaceholder)?e.length>0?this.$el.find(".placeholder-text").text(this.selectAll?this.allSelectedPlaceholder:this.placeholder):this.$el.find(".placeholder-text").text("No "+this.dropdownType+" to select"):this.$el.find(".placeholder-text").html(this.generatePlaceholder(null,i.string,i.object,n,this.dropdownType)),setTimeout(this._setDropdownWidth.bind(this))},_setDropdownWidth:function(){var e=this.$el.find(".multiselect-dropdown-menu"),t=this.$el.width(),i=e.width();i>t?this.$el.css({width:i+2}):e.css({width:t+32})},render:function(){var e=this.template({placeholder:this.placeholder,allSelectedPlaceholder:this.allSelectedPlaceholder,selectAll:this.selectAll,checkboxClass:this.checkboxClass});return this.$el.html(e),this._renderSelectList(),this}})}},function(e,t,i){e.exports=function(){const e=i(269),t=Backbone.View.extend({template:_.template(e),events:{"change input":"onSelect"},onSelect:function(e){e.currentTarget.checked&&this.onSelectCallback(this.value,e)},initialize:function(e){this.label=e.label,this.name=e.name,this.checked=e.checked,this.value=e.value,this.onSelectCallback=e.onSelectCallback,this.render()},render:function(){this.$el.html(this.template({label:this.label,name:this.name,checked:this.checked,value:this.value}))}});$.fn.LDRadioButton=function(e){const i=new t(e);return $(this).html(i.$el),i}}},function(e,t,i){e.exports=function(){var e=i(270);return Magellan.Views.LDSelectableList=Backbone.View.extend({tagName:"div",className:"ld-selectable-list-component",selected:null,template:_.template(e),listItemContentTemplate:_.template("<span><%=item%></span>"),_originalSelected:null,initialize:function(e){this.model=new(Backbone.Model.extend({validate:_.isFunction(e.validate)?e.validate:_.noop}))({data:e.data||[]}),this._originalSelected=e.selected||null,this.header=e.header||null,_.isFunction(e.itemTemplate)?this.listItemContentTemplate=e.itemTemplate:_.isString(e.itemTemplate)&&!_.isEmpty(e.itemTemplate)&&(this.listItemContentTemplate=_.template(e.itemTemplate)),_.isFunction(e.notFoundTemplate)?this.notFoundTemplate=e.notFoundTemplate:_.isString(e.notFoundTemplate)&&!_.isEmpty(e.notFoundTemplate)&&(this.notFoundTemplate=_.template(e.notFoundTemplate)),this.listenTo(this.model,"change:data",this.render),this.listenTo(this.model,"change:selected",this._handleModelSelectedChange)},events:{"click .ld-selectable-list-item":"_handleListItemClick"},render:function(){var e=this.template({model:this.model,header:this.header,itemContentTemplate:this.listItemContentTemplate});return this.$el.html(e),this.setSelected(this.model.get("selected")||this._originalSelected),this},setSelected:function(e){e=e||null,this.model.set("selected",e),this.validate()},validate:function(){var e="";this.model.isValid()||(e=this.model.validationError),this.$(".error-message").html(e)},_setActiveListItem:function(e){if(this.$(".ld-selectable-list-item.active").removeClass("active"),!(e<0)){this.$(".ld-selectable-list-item").eq(e).toggleClass("active",!0);var t=this.model.get("data")[e];this.setSelected(t)}},_handleModelSelectedChange:function(){var e=this.model.get("selected"),t=this.model.get("data").indexOf(e);this._setActiveListItem(t),_.isNull(e)||_.isUndefined(e)?this.$(".selected").html('<em class="text-muted">None</em>'):t<0?this.$(".selected").html(this.notFoundTemplate({notFound:this._originalSelected||""})):this.$(".selected").html(this.listItemContentTemplate(this.model.get("selected")))},_handleListItemClick:function(e){var t=this.$(".ld-selectable-list-item").index(e.currentTarget);this._setActiveListItem(t)}})}},function(e,t,i){e.exports=function(){Magellan.Views.LDTable=Backbone.View.extend({events:{"click .edit-button":"handleEditButtonClick","click .cancel-button":"handleCancelButtonClick","click .save-button":"handleSaveButtonClick","click .delete-button":"handleDeleteButtonClick"},handleDeleteButtonClick:function(e){var t=$(e.target).closest("tr"),i=this.table.row(t).data();this.table.row(t).remove().draw(),this.trigger("delete",i)},clear:function(){this.table.clear().draw()},handleCancelButtonClick:function(e){var t=$(e.target).closest("tr");this.$el.find(".edit-button").show(),$(".disable-while-row-edit").removeClass("disabled-by-edit"),t.removeClass("editing");var i=this.table.row(t);this.columns.map(function(e,t){return e.editor.getValue()});0!==this.currentRowData.filter(function(e){return""!==e&&!_.isNull(e)&&!_.isUndefined(e)}).length?i.data(this.currentRowData):(i.remove(),this.table.draw()),this.currentRowData=null,this.trigger("cancel")},handleSaveButtonClick:function(e){var t=$(e.target).closest("tr"),i=this.table.row(t),n={start:null,end:null},a=this.columns.map(function(e,t){var i=e.editor;return e.name.startsWith("Start Date")&&(n.start=e.editor),e.name.startsWith("End Date")&&(n.end=e.editor),i.getValue()}),o=this.columns.map(function(e,t){return e.editor.validate()}),l=!0;_.isEmpty(n.start)||_.isEmpty(n.end)||((l=+moment(n.start.getValue())<+moment(n.end.getValue()))||n.start.validate(!0));!o.includes(!1)&&l&&(this.$el.find(".edit-button").show(),$(".disable-while-row-edit").removeClass("disabled-by-edit"),t.removeClass("editing"),i.data(a.concat(this.editColHtml)),this.trigger("change",a))},handleEditButtonClick:function(e){var t=$(e.target).closest("tr");this.enterEditMode(t),this.trigger("edit",t.data())},enterEditMode:function(e){this.$el.find(".edit-button").hide(),$(".disable-while-row-edit").addClass("disabled-by-edit"),e.addClass("editing");var t=this.table.row(e).index();this.currentRowData=_.cloneDeep(this.table.row(e).data());for(var i=0;i<this.tableColCount;i++){var n=this.table.cell(t,i);if(i===this.tableColCount-1&&this.isInlineEditorEnabled){return void n.data('<div class="cancel-button ld-secondary-small-button">Cancel</div><div class="save-button ld-primary-small-button">Done</div>')}var a=this.currentRowData[i],o=this.columns[i].editor;!_.isUndefined(o)&&!_.isNull(o)?(n.data(""),o.setValue(a),o.setElement(n.node()),o.render()):n.data(a)}},addRow:function(){var e=Array(this.dataColCount).fill("");e.push(null);var t=this.table.row.add(e);this.table.draw();var i=$(t.node());this.enterEditMode(i)},reset:function(){this.table.clear().draw(),this.table.columns.adjust().draw(),this.trigger("reset")},revert:function(){this.table.clear(),this.table.rows.add(_.cloneDeep(this.originalData)),this.table.draw(),this.trigger("revert")},getData:function(){for(var e=this.table.rows().data(),t=[],i=0;i<e.length;i++){var n=_.clone(e[i]);this.isInlineEditorEnabled&&(n=n.slice(0,this.dataColCount)),t.push(n)}return t},getNamedData:function(){for(var e=this,t=this.table.rows().data(),i=[],n=0;n<t.length;n++){var a=_.clone(t[n]);this.isInlineEditorEnabled&&(a=a.slice(0,this.dataColCount));var o={};a.forEach(function(t,i){var n=e.columns[i].name;o[n]=t}),i.push(o)}return i},initialize:function(e){this.columns=e.columns,this.givenDatatableOptions=e.datatableOptions||{},this.isInlineEditorEnabled=e.isInlineEditorEnabled,this.dataColCount=e.columns.length,this.tableColCount=e.columns.length+(this.isInlineEditorEnabled?1:0),this.originalData=e.data,this.editColHtml='<div class="edit-button ld-secondary-small-button">Edit</div><div class="delete-button ld-secondary-small-button">Delete</div>'},template:_.template(i(271)),render:function(){var e=this.template({});return this.$el.html(e),function initializeHeaderRow(){var e=this.$el.find(".header-row");this.columns.forEach(function(t){e.append("<th>"+t.name+"</th>")}),this.isInlineEditorEnabled&&e.append("<th></th>")}.call(this),theview=this,this.table=function initializeDatatable(e){var t={columnDefs:[],data:e.data,paginate:!1,autoWidth:!0,scrollInfinite:!0,scrollCollapse:!1,scrollY:"450px",searchDelay:0,deferRender:!1,dom:"frtp",select:!0,rowId:"data-cid",language:{search:"",searchPlaceholder:"Search"},createdRow:function(t,i,n){e.givenDatatableOptions.disableRowHover||$(t).addClass("hover-row"),_.each(e.givenDatatableOptions.additionalRowDataAttributes,function(e){$(t).attr(e.prop,i[e.dataVal])},this)},drawCallback:function(e){}},i={columnDefs:[]};if(this.isInlineEditorEnabled){var n=this.tableColCount-1;i.columnDefs.push({orderable:!1,targets:n,defaultContent:this.editColHtml})}this.columns.forEach(function(e,t){var n=e.editor;n&&"getRenderFunction"in n&&i.columnDefs.push({targets:t,render:n.getRenderFunction()})});var a=_.defaultsDeep(e.givenDatatableOptions,t,i);return this.$el.find(".ld-table").DataTable(a)}.call(this,{data:this.originalData,givenDatatableOptions:this.givenDatatableOptions}),this}});Magellan.Views.LDTableCellEditors=Magellan.Views.LDTableCellEditors||{},Magellan.Views.LDTableCellEditors.Input=Backbone.View.extend({initialize:function(){},setValue:function(e){},getValue:function(){},validate:function(){return!0},getDisplayText:function(){}}),Magellan.Views.LDTableCellEditors.Text=Magellan.Views.LDTableCellEditors.Input.extend({template:_.template('<input class="ld-input-large" placeholder="<%= placeholder %>" value="<%= value %>"></input>'),initialize:function(e){this.value="",this.placeholder=e.placeholder||""},render:function(){var e=this.template({value:this.value,placeholder:this.placeholder});this.$el.html(e)},setValue:function(e){this.value=e},getValue:function(){return this.value=this.$el.find("input").val(),this.value},validate:function(){return""===this.getValue()?(this.$el.find("input").css("border","1px solid #ff6e6e"),!1):(this.$el.find("input").css("border","1px solid var(--lt-grey-2)"),!0)}}),Magellan.Views.LDTableCellEditors.AsyncTypeahead=Magellan.Views.LDTableCellEditors.Input.extend({initialize:function(e){this.placeholder=e.placeholder||"Search",this.asyncServiceCall=e.asyncServiceCall||_.noop,this.onSelect=e.onSelect||_.noop,this.typeahead=null,this.value=null},render:function(){this.typeahead=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,selection:_.isEmpty(this.value)?[]:[this.value],size:"large",asyncServiceCall:this.asyncServiceCall,onSelect:this._onSelect.bind(this),placeholder:this.placeholder}),this.typeahead.validate(),this.$el.html(this.typeahead.$el)},_onSelect:function(e,t){this.value=_.isArray(t)?t[0]:null,this.onSelect(this.value)},getValue:function(){return _.isArray(this.typeahead.selection)?this.typeahead.selection[0]:null},setValue:function(e){this.typeahead&&!_.isUndefined(e)&&this.typeahead.setSelection([e])},getRenderFunction:function(){return _.bind(function(){return _.isObject(this.value)?this.value.label:""},this)}}),Magellan.Views.LDTableCellEditors.ReadOnly=Magellan.Views.LDTableCellEditors.Text.extend({template:_.template("<%= value %>"),initialize:function(e){e=e||{},this.value=e.value||"",this.placeholder=e.placeholder||"",this.readOnly=!0},render:function(){var e=this.template({value:this.value});this.$el.html(e)},setValue:function(e){this.value=e||this.placeholder},getValue:function(){return this.value},validate:function(){return!0}}),Magellan.Views.LDTableCellEditors.DateTime=Magellan.Views.LDTableCellEditors.Text.extend({template:_.template('<input placeholder="<%= placeholder %>" class="datetime-cell-input ld-input-large" value="<%= value %>"></input>'),initialize:function(e){this.value="",this.placeholder=e.placeholder||"",this.timeFormat=e.timeFormat||"HH:mm:ss",this.isEndDate=e.isEndDate||!1},render:function(){var e=this.template({value:this.value,placeholder:this.placeholder});this.$el.html(e),this.$el.find("input").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:this.timeFormat,timeInput:!0,showHour:!1,showMinute:!1,showSecond:!1,hour:this.isEndDate?23:0,minute:this.isEndDate?59:0,second:this.isEndDate?59:0})},setValue:function(e){this.value=e},getValue:function(){return this.value=this.$el.find("input").val(),this.value},validate:function(e){return""===this.getValue()||e?(this.$el.find("input").css("border","1px solid #ff6e6e"),!1):(this.$el.find("input").css("border","1px solid var(--lt-grey-2)"),!0)}}),Magellan.Views.LDTableCellEditors.TimeZone=Magellan.Views.LDTableCellEditors.Input.extend({template:_.template('<div class="ld-dropdown-small timezone-dropdown"></div>'),initialize:function(e){this.value=e.value||"",this.placeholder=e.placeholder||"Select one"},render:function(){var e=this.template({value:this.value,placeholder:this.placeholder});this.$el.html(e);var t=Magellan.Util.Timezones.guessUserTimezone(),i=t?[t]:null;this.tzDropdown=new Magellan.Views.LDDropdown({required:!0,value:this.value||void 0,options:Object.keys(Magellan.Util.Timezones.idToTimezone),placeholder:this.placeholder,optionTemplate:function(e){return _.template("<span><%= option %></span>")({option:Magellan.Util.Timezones.idToName[e]})},onChange:function(e){this.value=e}.bind(this),preferredOptions:i,tokenizer:Magellan.Util.Timezones.tokenizer}),this.$el.find(".timezone-dropdown").html(this.tzDropdown.$el)},setValue:function(e){this.value=e},getValue:function(){return this.value},validate:function(){return this.tzDropdown.validate()}})}},function(e,t){e.exports=function(){Magellan.Views.DistributionBarChart=Backbone.View.extend({id:"ownership-distribution-chart",initialize:function(e){this.objectType=Magellan.Util.getPluralObjectName(e.objectType).toUpperCase(),this.data=e.data,this.totalCount=e.totalCount,this.displayedRows=Array.from(e.displayedRows).sort(),this.d3=d3.select(this.el)},render:function(){return this.drawChart(this.data,this.totalCount),this},drawChart:function(e,t){var i=50,n=40,a=80;const o=900-a-40-110-150,l=i+20+55*e.length+n,s=d3.max(e,function(e){return e[1]});if(0!==e.length){var r=["#ADBF38","#1793CA","#0D4D65","#F1716F","#F9B330","#1DB7C4"],d=["#9CAC32","#1584B6","#0C455B","#D96664","#E0A12B","#1AA5B0"],c=this,u=d3.scaleLinear().domain([0,s]).range([0,o]).nice(),p=(y=this.d3.append("svg").attr("id","ownership-distribution-chart-svg").attr("width",900).attr("height",l)).append("defs").append("filter").attr("id","dropshadow");p.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",2).attr("result","blur"),p.append("feOffset").attr("in","blur").attr("dx",0).attr("dy",0).attr("result","offsetBlur"),p.append("feFlood").attr("in","offsetBlur").attr("flood-color","#3d3d3d").attr("flood-opacity","0.3").attr("result","offsetColor"),p.append("feComposite").attr("in","offsetColor").attr("in2","offsetBlur").attr("operator","in").attr("result","offsetBlur");var h=p.append("feMerge");h.append("feMergeNode").attr("in","offsetBlur"),h.append("feMergeNode").attr("in","SourceGraphic");var g=y.append("g").attr("transform","translate("+a+","+i+")"),m=d3.axisTop(u).ticks(7).tickSize(-(l-i-n)).tickPadding(15).tickFormat(function(e){return e%1!=0?"":e<1e4?e:humanFormat(e)});g.append("text").attr("class","title").attr("transform","translate(10, -15)").text(this.objectType),g.append("g").attr("class","axis").attr("transform","translate(110, 0)").call(m),g.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("x",110).attr("y",function(e,t){return 55*t}).attr("width",function(e,t){return u(e[1])}).attr("height",40).attr("transform","translate(0,20)").attr("fill",function(e,t){return getFillColorFromIndex(t)});var f=g.selectAll(".nametag-container").data(e).enter().append("g").attr("class","nametag-container").attr("x",0).attr("y",function(e,t){return 55*t}).attr("transform",function(e,t){return"translate(0,"+(55*t+20)+")"});f.append("rect").attr("class","nametag").attr("width",110).attr("height",40).attr("fill",function(e,t){return getFillColorFromIndex(t,!0)}),f.append("text").text(function(e,t){return e[0]}).attr("fill","white").attr("pointer-events","none").attr("font-size","11").attr("font-weight","600").attr("transform","translate(13,17.5)").attr("dx",0).attr("y",0).attr("dy",0).attr("class","text").call(wrap,84);var v=g.selectAll(".right-col-container").data(e).enter().append("g").attr("class","right-col-container").attr("x",0).attr("y",function(e,t){return 55*t}).attr("transform",function(e,t){return"translate("+(110+o+30)+","+(55*t+20)+")"});v.append("text").text(function(e,t){var i=e[1];return(i<1?i:i<1e4?d3.format(",")(i):humanFormat(i,{decimals:1}))+" | "}).attr("fill",function(e,t){return getFillColorFromIndex(t)}).attr("text-anchor","end").attr("font-style","italic").attr("transform","translate(55,24)"),v.append("text").text(function(e,i){var n=e[1];return d3.format(".0%")(n/t)}).attr("fill",function(e,t){return getFillColorFromIndex(t)}).attr("text-anchor","end").attr("transform","translate(92,24)"),v.selectAll("text").attr("font-size","15").attr("font-weight","300"),d3.selectAll(".nametag-container").on("mouseover",function(t,i){d3.select(this).select(".nametag").transition(20).attr("width",160).attr("transform","translate(-50, 0)").attr("filter","url(#dropshadow)"),d3.select(this).select("text").text(e[i][0]).attr("dx","-50").call(wrap,134),d3.select(this).select("text").attr("fill-opacity","0.1").transition(20).attr("fill-opacity","1")}).on("mouseout",function(t,i){d3.select(this).select(".nametag").transition(20).attr("width",110).attr("transform","translate(0, 0)").attr("filter","none"),d3.select(this).select("text").text(e[i][0]).attr("dx","0").call(wrap,84),d3.select(this).select("text").attr("fill-opacity","0.1").transition(20).attr("fill-opacity","1")})}else{var y;(y=this.d3.append("svg").attr("id","ownership-distribution-chart-svg").attr("width",900).attr("height",l)).append("g").append("text").attr("width",900).attr("stroke","#333").attr("x","430").attr("y","70").attr("text-anchor","middle").text("No data available")}function getFillColorFromIndex(e,t){var i=c.displayedRows[e]%r.length;return t?d[i]:r[i]}function wrap(e,t){e.each(function(){for(var e,i=d3.select(this),n=i.text().split(/\s+/).reverse(),a=[],o=0,l=i.attr("y"),s=parseFloat(i.attr("dx")),r=parseFloat(i.attr("dy")),d=i.text(null).append("tspan").attr("x",0).attr("y",l).attr("dx",s).attr("dy",r+"em");e=n.pop();)if(a.push(e),d.text(a.join(" ")),d.node().getComputedTextLength()>t){a.pop();var c=a.join(" ");if(d.text(c),a=[e],!(o++<1)){var u=d.text();d.text(u+"...");break}d=i.append("tspan").attr("x",0).attr("y",l).attr("dx",s).attr("dy",1.2*o+r+"em").text(e)}0===o?(i.attr("y","6"),i.selectAll("tspan").attr("y","6")):(i.attr("y","0"),i.selectAll("tspan").attr("y","0"))})}}})}},function(e,t,i){e.exports=function(){var e=i(277),t=i(276),n=function(e){return e.parent&&e.parent.length>0&&"REFERENCE"===e.type};Magellan.Models.MultiNestedTypeaheadSelector=Magellan.Models.NestedTypeaheadSelector.extend({defaults:fieldMetaData||null}),Magellan.Views.MultiNestedTypeaheadSelector=Magellan.Views.NestedTypeaheadSelector.extend({multiSelectTemplate:_.template(t),events:{"click .tt-custom-input":"_onCustomInputSelect","click .multi-nestedtypeahead-checkbox":"_onSelectCheckBox","typeahead:autocomplete .typeahead":"_selectFirstItemOnMenu","typeahead:render .typeahead":"_onSuggestionsRendered","input .typeahead":"_onInputChange","blur .typeahead":"_setInputValueWithSelected","focus .typeahead":function(e){this.$(".tt-custom-input").toggleClass("hidden",!0),this.$(e.target).typeahead("val",""),this._refreshSelectionBreadcrumbs()}},initialize:function(t){Magellan.Views.MultiNestedTypeaheadSelector.__super__.initialize.apply(this,arguments),this.multiSelect=!0,this.selection=[],this.type=t.type||"PICKLIST",this.selectionTemplate=_.template(e),this.render(),t.selection&&this.setSelection(t.selection)},getTypeaheadConfigurations:function(e,t){var i=this,a=i.requireSelectionFromData?i.notFoundTemplate:function(){return"<div></div>"};return{name:e||"multi-nested-typeahead-selector",limit:1e3,display:function(e){return n(e)?e.label.replace(" ID",""):i.multiSelect?e.label.replace(" ID",", "):e.label},source:t,templates:{header:_.template('<div class="mnts-selected-field-container"></div>'),suggestion:function(e){var t={suggestion:e,title:e.name};return i.multiSelectTemplate(t)},notFound:a}}},_onCustomInputSelect:function(e){var t=$(e.currentTarget).text(),i=Magellan.Util.convertStringSelectionToArray(t)[0],n=this._indexInSelection(i);-1!=this._indexInSelection(i)?this.selection.splice(n,1):this.selection.push(i),this._refreshSelectionBreadcrumbs(),this.onSelectCallback(this,this.selection),this.$(".typeahead.tt-input").blur(),this.customInputSelect=!0},_onSelectCheckBox:function(e,t){var i=$(e.currentTarget),n=i.is(":checked"),a=i.attr("label"),o=_.find(this.model.get(this.root),function(e){return e.label===a},this);n&&-1==this._indexInSelection(o)?this.selection.push(o):this.selection.remove(o),this._refreshSelectionBreadcrumbs(),_.isEmpty(this.bloodHound.remote)&&this._refreshSelectionMenu(!1),this.onSelectCallback(this,this.selection)},_refreshSelectionBreadcrumbs:function(){var e=this.selectionTemplate({root:this.root,selection:this.selection,currentCustomValue:this.currentCustomValue,type:this.type});this.breadcrumbsEl&&this.breadcrumbsEl.remove(),this.breadcrumbsEl=$(e),this.$(".tt-menu").prepend(this.breadcrumbsEl)},_indexInSelection:function(e){for(var t=0;t<this.selection.length;t++)if(e.label===this.selection[t].label&&e.name===this.selection[t].name)return t;return-1},setSelection:function(e){if(!e)return!1;if(e.length>0){var t=e[0].name.match(/".*?"/g);if(t)for(var i=0;i<t.length;i++){var n=JSON.parse(t[i].replace(/,/g,"LDCOMMA"));e[0].name=e[0].name.replace(t[i],n)}for(var a="PICKLIST"===this.type?e[0].name.split(/, /):e[0].name.split(/; /),o=0;o<a.length;o++){a[o]=a[o].replace(/LDCOMMA/g,",");var l=_.find(this.model.get(this.root),function(e){return e.name===a[o]},this)||Magellan.Util.convertStringSelectionToArray(a[o])[0];l&&-1==this._indexInSelection(l)&&this.selection.push(l)}}this.$(".typeahead.tt-input").blur()},_setInputValueWithSelected:function(e){var t="PICKLIST"===this.type?", ":"; ",i=this.selection.reduce(function(e,i){var a=n(i)?i.label.replace(" ID",""):i.label;return", "===t&&a.includes(",")&&(a=JSON.stringify(a)),e+((""!==e?t:"")+htmlDecode(a))},"");this.requireSelectionFromData?this.$(e.target).typeahead("val",i):""!==this.currentTextValue&&this.customInputSelect?(this.$(e.target).typeahead("val",this.currentTextValue),this._addToSelection(Magellan.Util.convertStringSelectionToArray(this.currentTextValue)[0]),this.$el.trigger("multiNestedTypeaheadSelector:select",this)):null===i||""===i||this.emptyTextDesired?(this.$(e.target).typeahead("val",this.currentTextValue),this._addToSelection(Magellan.Util.convertStringSelectionToArray(this.currentTextValue)[0]),this.$el.trigger("multiNestedTypeaheadSelector:select",this)):(this.$(e.target).typeahead("val",i),this.$el.trigger("multiNestedTypeaheadSelector:select",this)),this.customInputSelect=!1,this.validate()}})}},function(e,t,i){e.exports=function(){var e=i(274),t=i(275),n=function(e){return e.parent&&e.parent.length>0&&"REFERENCE"===e.type};Magellan=Magellan||{},Magellan.Models=Magellan.Models||{},Magellan.Views=Magellan.Views||{};var a=Magellan.Models.NestedTypeaheadSelector=Backbone.Model.extend({defaults:fieldMetaData||null});Magellan.Views.NestedTypeaheadSelector=Backbone.View.extend({tagName:"span",selection:null,fieldSuggestionTemplate:_.template('<p title="<%=title%>"><%=suggestion.label%></p>'),categoryLabelTemplate:_.template('<p class="nts-category-label" title="<%=title%>"><%=suggestion.label%></p>'),objectSuggestionTemplate:_.template('<p title="<%=title%>"><span><%=suggestion.label.replace(" ID", "")%></span>&nbsp;&nbsp;<span class="expand-arrow">▸</span></p>'),disabledSuggestionTemplate:_.template('<p class="disabled" title="<%=title%>"><span><%=suggestion.label.replace(" ID", "")%></span>&nbsp;&nbsp;<span class="expand-arrow">▸</span>&nbsp;&nbsp;<span class="glyphicon glyphicon-warning-sign text-danger"></span></p>'),notFoundTemplate:_.template('<div class="alert alert-danger" style="padding: 0 5px; margin: 0">No Suggestion Found.</div>'),customValueTemplate:_.template('<div class="tt-dataset tt-dataset-nested-typeahead-selector"><div class="nts-selected-field-container"><p title="" class="tt-suggestion tt-custom-input tt-selectable hidden"></p></div></div>'),bloodHound:null,searchEngine:null,breadcrumbsEl:null,customValueEl:null,onSelectCallback:null,filterSuggestions:null,currentCustomValue:null,events:{"click .tt-custom-input":"_onCustomInputSelect","typeahead:select .typeahead":"_onSelect","typeahead:autocomplete .typeahead":"_selectFirstItemOnMenu","typeahead:render .typeahead":"_onSuggestionsRendered","input .typeahead":"_onInputChange","blur .typeahead":"_setInputValueWithSelected","focus .typeahead":function(e){this.$(".tt-custom-input").toggleClass("hidden",!0),this.$(e.target).typeahead("val",""),this._refreshSelectionBreadcrumbs()}},initialize:function(i){var n=this;"object"==typeof i.data?this.model=new a(i.data):i.model instanceof a?this.model=i.model:this.model=new a,this.selection=[],this.root=i.root,this.placeholder=i.placeholder||"Search",this.filterSuggestions="function"==typeof i.filter?i.filter:null,this.onSelectCallback="function"==typeof i.onSelect?i.onSelect:function(){},this.required=!0===i.required||!1,this.aliases=i.aliases||{},this.disableBreadcrumbs=null!=i.disableBreadcrumbs&&i.disableBreadcrumbs,this.requireSelectionFromData=null==i.requireSelectionFromData||i.requireSelectionFromData,this.emptyTextDesired=!1,this.datumTokenizer=i.datumTokenizer,this.queryTokenizer=i.queryTokenizer,this.bloodHound=_.isFunction(i.asyncServiceCall)?this._getAsyncBloodHound(i.asyncServiceCall):this._getBloodHound(this.model.get(this.root)),this.currentTextValue="",this.currentCustomValue={label:"blah",name:"blah",isCustomValue:!0},this.customValidationFunction=_.isFunction(i.customValidationFunction)?i.customValidationFunction:null,this.cachedValidValues=[],this.asyncServiceCall=_.isFunction(i.asyncServiceCall)?i.asyncServiceCall:null,_.isFunction(i.fetchData)&&i.fetchData().then(function(e){parsedData=JSON.parse(e),n.model=new a(parsedData),n.bloodHound=void 0!=i.asyncServiceCall?n._getAsyncBloodHound(i.asyncServiceCall):n._getBloodHound(n.model.get(n.root)),n.searchEngine=n._getSearchEngine(n.bloodHound),n.render(),n.selection&&n.setSelection(n.selection)}).fail(function(e,t){n.render(),n.bloodHound&&n.bloodHound.clear(),n.$(".typeahead-input").toggleClass("input-invalid",!0)}),this.searchEngine=_.isUndefined(i.asyncServiceCall)?this._getSearchEngine(this.bloodHound):this.bloodHound,i.size?this.$el.attr("class","nested-typeahead-selector typeahead-"+i.size):this.$el.attr("class","nested-typeahead-selector typeahead-small"),this.template=_.template(e),this.selectionTemplate=_.template(t),this.render(),i.selection&&this.setSelection(i.selection)},render:function(){return this.$el.empty(""),this.$el.append(this.template(this)),this._initTypeahead(this.$(".typeahead"),this.searchEngine),this},getTypeaheadOptions:function(){return{hint:!0,highlight:!0,minLength:0}},getTypeaheadConfigurations:function(e,t){var i=this,a=i.requireSelectionFromData?i.notFoundTemplate:function(){return"<div></div>"};return{name:e||"nested-typeahead-selector",limit:1e3,display:function(e){return e.label},source:t,templates:{header:_.template('<div class="nts-selected-field-container"></div>'),suggestion:function(e){var t={suggestion:e,title:e.name};return e.isCategoryLabel?i.categoryLabelTemplate(t):n(e)?i.selection.length>=4?(t.title="Maximum number of objects selected reached.",i.disabledSuggestionTemplate(t)):i.objectSuggestionTemplate(t):i.fieldSuggestionTemplate(t)},notFound:a}}},setSelection:function(e){if(!e)return!1;this.selection=e,this._resetBloodHoundDataUsingCurrentSelection(),this.$(".typeahead.tt-input").blur()},refreshBloodhoundData:function(){this.searchEngine.initialize(!0)},validate:function(){if(this.customValidationFunction)return this.customValidationFunction(this);var e=this,t=$.Deferred().always(function(t){e.$(".typeahead-input").toggleClass("input-invalid",!t)});return 0===this.selection.length?this.required?t.reject():t.resolve(!0):this.bloodHound.remote?this.cachedValidValues.includes(e.selection[0].Id)?t.resolve(!0):(this.asyncServiceCall(this.selection[0].name).then(function(i){_.each(i,function(i){if(e.selection[0].Id===i.Id)return e.cachedValidValues.push(i.Id),t.resolve(!0),!1})}).fail(function(e,i){t.reject()}),t):n(this.selection[this.selection.length-1])?t.reject():t.resolve(!0)},_prefetchSelectionData:function(e){if(null!=e){var t=this;e.then(function(e){parsedData=JSON.parse(e),t.model=new a(parsedData),t.bloodHound=t._getBloodHound(t.model.get(t.root)),t.searchEngine=t._getSearchEngine(t.bloodHound),t.render(),t.selection&&t.setSelection(t.selection)})}},_getParentFields:function(e){var t=this,i=[],n=this.aliases,a={};return _.each(e,function(o){var l=t.model.get(o);e.length>1&&i.push({label:o,isCategoryLabel:!0}),_.each(l,function(e){var t=o+"."+e.name;n.hasOwnProperty(t)&&a.hasOwnProperty(n[t])||(i.push(e),a[t]=e)})}),i},_resetBloodHoundData:function(e){null!=this.bloodHound&&this.bloodHound.clear(),e&&(this.bloodHound.local=e),null!=this.bloodHound&&this.bloodHound.initialize(!0)},_resetBloodHoundDataUsingCurrentSelection:function(){for(var e=null,t=this.selection.length-1;t>=0;t--)if(n(this.selection[t])){e=this.selection[t];break}if(0===this.selection.length||null===e){var i=this.model.get(this.root);null!=i&&this._resetBloodHoundData(i)}else{var a=this._getParentFields(e.parent);null!=a&&this._resetBloodHoundData(a)}},_onSuggestionsRendered:function(e,t){this.emptyTextDesired=this.currentTextValue.length>0&&""==this.$(e.target).typeahead("val"),this.currentTextValue=this.$(e.target).typeahead("val"),this.$(".tt-suggestion.disabled, .tt-suggestion.nts-category-label").on("click",function(e){return e.preventDefault(),!1})},_onInputChange:function(e){if(!1===this.requireSelectionFromData){var t=$(e.currentTarget).val();this.$(".tt-custom-input").text(t),this.$(".tt-custom-input")[0].title=t,""==t?this.$(".tt-custom-input").toggleClass("hidden",!0):this.$(".tt-custom-input").toggleClass("hidden",!1)}},_onCustomInputSelect:function(e){var t=$(e.currentTarget).text();this._addToSelection(Magellan.Util.convertStringSelectionToArray(t)[0]),this.$el.trigger("nestedTypeaheadSelector:select",this),this.onSelectCallback(this,this.selection),this.$(".typeahead.tt-input").blur(),this.customInputSelect=!0},_onSelect:function(e,t){this._addToSelection(t),this._refreshSelectionBreadcrumbs(),this._resetBloodHoundDataUsingCurrentSelection(),_.isEmpty(this.bloodHound.remote)&&this._refreshSelectionMenu(),this.$el.trigger("nestedTypeaheadSelector:select",this),this.onSelectCallback(this,this.selection),n(t)||this.$(".typeahead-input").trigger("blur")},_selectFirstItemOnMenu:function(e){var t=$.Event("keydown");t.keyCode=t.which=40,this.$(e.target).triggerHandler(t)},_setInputValueWithSelected:function(e){var t=this.selection.reduce(function(e,t){var i=t.label;return e+(""!==e?".":"")+htmlDecode(i)},"");this.requireSelectionFromData?this.$(e.target).typeahead("val",t):""!==this.currentTextValue&&this.customInputSelect?(this.$(e.target).typeahead("val",this.currentTextValue),this._addToSelection(Magellan.Util.convertStringSelectionToArray(this.currentTextValue)[0]),this.$el.trigger("nestedTypeaheadSelector:select",this)):null===t||""===t||this.emptyTextDesired?(this.$(e.target).typeahead("val",this.currentTextValue),this._addToSelection(Magellan.Util.convertStringSelectionToArray(this.currentTextValue)[0]),this.$el.trigger("nestedTypeaheadSelector:select",this)):this.$(e.target).typeahead("val",t),this.customInputSelect=!1,this.validate()},_getAsyncBloodHound:function(e){context=this;var t="function"==typeof this.filterSuggestions?this.filterSuggestions:null;return new Bloodhound({remote:{url:"%query%",wildcard:"%query%",transport:function(i,n,a){null===t?e(decodeURI(i.url)).then(n,a):e(decodeURI(i.url)).then(function(e){let i=t(e);n(i)},a)},cache:!1},sufficient:100,queryTokenizer:context.queryTokenizer||function(e){return[e]},datumTokenizer:context.datumTokenizer||function(e){return e},identify:function(e){return e.Id}})},_getBloodHound:function(e){if(!e)throw"NestedTypeaheadSelector Error: Invalid data. Failed to create bloodhound.";return globalData=e,context=this,new Bloodhound({local:e,identify:function(e){return e.name+" / "+e.label},datumTokenizer:context.datumTokenizer||function(e){return nameTokens=Bloodhound.tokenizers.whitespace(e.name),labelTokens=Bloodhound.tokenizers.whitespace(e.label),nameTokens.concat(labelTokens).concat(e.parent||[])},queryTokenizer:context.queryTokenizer||Bloodhound.tokenizers.whitespace})},_getSearchEngine:function(e){var t=this.filterSuggestions;return function(i,n){""===i?n("function"==typeof t?t(e.all()):e.all()):e.search(i,function(e){n("function"==typeof t?t(e):e)})}},_initTypeahead:function(e,t){e.typeahead("destroy");var i="nested-typeahead-selector-"+Date.now();e.typeahead(this.getTypeaheadOptions(),this.getTypeaheadConfigurations(i,t)),!1===this.requireSelectionFromData&&(this.customValueEl=this.customValueTemplate,this.$(".tt-menu").prepend(this.customValueEl)),this._refreshSelectionBreadcrumbs()},_addToSelection:function(e){if(!e)return this;var t=this.selection.length-1;t>-1&&!n(this.selection[t])?this.selection[t]=e:this.selection.push(e)},_refreshSelectionBreadcrumbs:function(){var e=this.selectionTemplate({root:this.root,selection:this.selection,currentCustomValue:this.currentCustomValue,hasChildren:n});this.breadcrumbsEl&&this.breadcrumbsEl.remove(),this.breadcrumbsEl=$(e),this.breadcrumbsEl.find(".nts-selected-node.nts-parent-node").each(function(e,t){$(t).on("click",this._deselectTo.bind(this,e))}.bind(this)),this.disableBreadcrumbs||this.$(".tt-menu").prepend(this.breadcrumbsEl)},_refreshSelectionMenu:function(e=!0){this._initTypeahead(this.$(".typeahead"),this._getSearchEngine(this.bloodHound)),this.$(".typeahead").focus(),e&&this.$(".tt-dataset").hide(0,function(){$(this).slideDown()})},_deselectTo:function(e){this.selection.splice(e),this._resetBloodHoundDataUsingCurrentSelection(),this._refreshSelectionMenu(),this._refreshSelectionBreadcrumbs()}})}},function(e,t,i){e.exports=function(){Magellan=Magellan||{},Magellan.Views=Magellan.Views||{},Magellan.Models=Magellan.Models||{};var e=i(278),t=i(279),n=i(79)(),a=[];Magellan.Views.SOFieldUpdater=Backbone.View.extend({tagName:"div",className:"so-field-updater",typeaheadDropdowns:null,initialize:function(e){let t=e.fields||[],i=Magellan.Validation.FIELD_BLACKLIST_SETS[`${e.object.toUpperCase()}_FIELDS`];t=_.filter(t,e=>!i.has(e.name)),this.model=new n({object:e.object,fields:t||[],updates:e.updates||[]}),this.model.get("updates").on("add",this._renderUpdates.bind(this)),this.model.get("updates").on("change",this._triggerModelChangeEvent.bind(this)),this.typeaheadDropdowns=[],this.render()},template:_.template(e),updateRowTemplate:_.template(t),events:{"click .add-rule-div":"addRow","click .sofu-boolean-dropdown-option":"_booleanDropdownHandler"},render:function(){return this.$el.html(this.template({model:this.model})),this._renderUpdates(),this},addRow:function(){this.model.get("updates").add({field:null,value:null,type:null})},deleteRow:function(e,t){e.remove(),this.model.get("updates").remove(t),this._triggerModelChangeEvent()},val:function(){return this.model.get("updates").toJSON()},_triggerModelChangeEvent:function(){this.$el.trigger("SOFieldUpdater:change",this)},_renderUpdates:function(){this.$(".field-updates-list").empty();var e={};e[this.model.get("object")]=this.model.get("fields").toJSON();return this.model.get("updates").each(function(t){var i=$(this.updateRowTemplate({update:t})),n=this._createFieldsDropdown(t,e);if(i.find(".sofu-field-selector").html(n.$el),i.find(".sofu-delete-column").on("click",this.deleteRow.bind(this,i,t)),i.find(".sofu-update-value").on("change",this._setUpdateValue.bind(this,t)),i.find(".sofu-ld-dropdown").LDDropdown({options:[!0,!1],value:t.get("value")}),i.find(".sofu-ld-dropdown").on("LDDropdown:change",this._setUpdateValue.bind(this,t)),_.isEmpty(t.get("field"))){var a=this._createValueTypeahead(t,e);i.find(".sofu-ld-typeahead").html(a.$el),i.find(".sofu-ld-typeahead").on("nestedTypeaheadSelector:select .sofu-ld-typeahead",this._setUpdateValue.bind(this,t))}this._refreshUpdateValueColumn(i,t),this.$(".sofu-field-updates-list").append(i)},this),this},_createValueTypeahead:function(e){var t=Magellan.Controllers.FlowBuilder.getCachedPicklistValues(this.model.get("object")+e.get("field"));null!=t&&(t=JSON.parse(t));var i={};return i[this.model.get("object")]=[],new Magellan.Views.NestedTypeaheadSelector({data:null==t?i:t,root:this.model.get("object"),disableBreadcrumbs:!0,requireSelectionFromData:!1,required:!1,fetchData:null==t?Magellan.Controllers.FlowBuilder.getPicklistFields.bind(null,this.model.get("object"),e.get("field")):null,selection:Magellan.Util.convertStringSelectionToArray(e.get("value"))})},_createMultiValueTypeahead:function(e){var t=Magellan.Controllers.FlowBuilder.getCachedPicklistValues(this.model.get("object")+e.get("field"));null!=t&&(t=JSON.parse(t));var i={};return i[this.model.get("object")]=[],new Magellan.Views.MultiNestedTypeaheadSelector({type:e.get("type"),data:null==t?i:t,root:this.model.get("object"),onSelect:this._setUpdateValue.bind(this,e),disableBreadcrumbs:!0,requireSelectionFromData:!1,required:!1,fetchData:null==t?Magellan.Controllers.FlowBuilder.getPicklistFields.bind(null,this.model.get("object"),e.get("field")):null,selection:Magellan.Util.convertStringSelectionToArray(e.get("value"))})},_createFieldsDropdown:function(e,t){var i=_.find(t[this.model.get("object")],function(t){return t.name===e.get("field")}),n={},o=Magellan.Controllers.FlowBuilder.getCustomUserFieldsByObject(LeanData__PrimarySObjectType),l=["ownerid"];_.each(o,function(e){e.name.endsWith("__r.id")?l.push(e.name.substring(0,e.name.length-6)+"__c"):e.name.endsWith(".id")&&l.push(e.name.substring(0,e.name.length-3))}),n[this.model.get("object")]=t[this.model.get("object")].filter(function(e){return!0===e.isUpdateable&&!1===l.includes(e.name)}),a=t[this.model.get("object")].filter(function(e){return!0===e.isNillable}),console.log(a);var s=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:this.model.get("object"),data:n,selection:i?[i]:[],onSelect:this._updateFieldOnSelected.bind(this,e)});return s.validate(),this.typeaheadDropdowns.push(s),s},_setUpdateValue:function(e,t,i){var n,a,o=e.get("type"),l=!1;i instanceof Magellan.Views.LDDropdown?(a=i.val(),n=i.$el.closest(".update-row")):i instanceof Magellan.Views.MultiNestedTypeaheadSelector?(a=_.isEmpty(i.selection)?"":i.selection.reduce(function(e,t){return""!==e&&(e+="; "),"REFERENCE"===t.type?e+Magellan.Util.flattenReferenceAPIs(t.name):e+t.name},""),l=this._isFieldNillable(e.get("field"))&&(""===a||null===a),n=i.$el.closest(".update-row")):i instanceof Magellan.Views.NestedTypeaheadSelector?(a=_.isEmpty(i.selection)?"":i.selection[0].name,l=this._isFieldNillable(e.get("field"))&&(""===a||null===a),n=i.$el.closest(".update-row")):(a=$(t.target).val(),l=this._isFieldNillable(e.get("field"))&&(""===a||null===a),"DATETIME"===o&&(!1===l&&(a=moment(a).format(Magellan.Validation.DATETIME_FORMAT)),$(t.target).val(a)),n=$(t.target).closest(".update-row")),l?e.set("value",null):e.set("value",a),this._validateRow(e,n)},_updateFieldOnSelected:function(e,t,i){var n=null;i.length>0&&(n=i[i.length-1]),e.set({field:n.name,type:n.type}),this._refreshUpdateValueColumn(t.$el.closest(".update-row"),e)},_refreshUpdateValueColumn:function(e,t){e.find(".sofu-update-value").datepicker("destroy").removeClass("hasDatepicker");var i=!0,n=!0,a=(t.get("type")||"").toLowerCase();if("date"===a)e.find(".sofu-update-value").datepicker({dateFormat:"yy-mm-dd"});else if("datetime"===a)e.find(".sofu-update-value").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss",timeInput:!0,showHour:!1,showMinute:!1,showSecond:!1});else if("boolean"===a)i=!1;else if("picklist"===a){n=!1;var o=this._createValueTypeahead(t);e.find(".sofu-ld-typeahead").html(o.$el),e.find(".sofu-ld-typeahead").on("nestedTypeaheadSelector:select .sofu-ld-typeahead",this._setUpdateValue.bind(this,t))}else if("multipicklist"===a){n=!1;o=this._createMultiValueTypeahead(t);e.find(".sofu-ld-typeahead").html(o.$el),e.find(".sofu-ld-typeahead").on("multiNestedTypeaheadSelector:select .sofu-ld-typeahead",this._setUpdateValue.bind(this,t))}e.find(".sofu-update-value").toggleClass("hidden",!i||!n),e.find(".sofu-ld-dropdown").toggleClass("hidden",i),e.find(".sofu-ld-typeahead").toggleClass("hidden",n),e.find(".sofu-update-value").val(t.get("value")),this._validateRow(t,e)},_validateRow:function(e,t){var i=e.get("value"),n=e.get("type"),a=Magellan.Validation.isValidValueOfType(n,i)||this._isFieldNillable(e.get("field"))&&(""===i||null===i);""!==i&&null!==i||(a=this._isFieldNillable(e.get("field"))),t.find(".sofu-ld-dropdown .ld-dropdown, .sofu-update-value").toggleClass("input-invalid",!a)},_isFieldNillable:function(e){return void 0!=_.find(a,function(t){return t.name===e})},_booleanDropdownHandler:function(e){e.preventDefault();var t=$(e.target).text(),i=$(e.target).data("value");$(e.target).closest(".sofu-boolean-dropdown").find(".sofu-boolean-dropdown-value-text").text(t),$(e.target).closest(".sofu-boolean-dropdown").find(".sofu-boolean-dropdown-value").val(i).trigger("change"),$(e.target).closest(".sofu-boolean-dropdown").toggleClass("input-invalid",!1)},remove:function(){this.typeaheadDropdowns.forEach(function(e){e.remove()}),Backbone.View.prototype.remove.apply(this,arguments)}})}},function(e,t,i){e.exports=function(){Magellan.Views.SingleTupleCondition=Backbone.View.extend({template:_.template(i(280)),initialize:function(e){this.idx=e.idx,this.selectedRoutingType=this.model.get("selectedRoutingType"),this.fieldObjectType=this.model.get("fieldObjectType"),this.operandObjectType=this.model.get("operandObjectType"),this.fieldData=this.model.get("fieldData"),this.operandData=this.model.get("operandData"),this.condition=e.condition,this.operandFieldCache=null,this.operandValueCache=null,this.render()},events:{"click .tuple-condition-delete":"deleteCondition","change .tuple-fieldset-radiogroup input":"radioButtonHandler","keyup .tuple-condition-operand-input":"operandInputHandler","change .tuple-condition-operand-input":"operandInputHandler"},deleteCondition:function(e){var t=$(e.target).closest(".tuple-condition").data("ruleIndex");this.model.deleteCondition(t)},radioButtonHandler:function(e){this.condition["value/field"]=this.$el.find("fieldset input:checked").val();this.$el.find(".tuple-condition-operand-dropdown"),this.$el.find(".tuple-condition-operand-input");"field"===this.condition["value/field"]?this.condition.operand=this.operandFieldCache:this.condition.operand=this.operandValueCache,this.render()},operandInputHandler:function(e){var t=$(e.target),i=t.val();t.toggleClass("input-invalid",_.isEmpty(i)||!Magellan.Validation.isValidValueOfType(this.condition.type,i)),this.condition.operand=_.isEmpty(i)?null:i,this.operandValueCache=_.isEmpty(i)?null:i},_createFieldNestedTypeahead:function(){var e=Magellan.Util.convertFieldSelectionStringToArray(this.condition.field,this.fieldObjectType,Magellan.Controllers.FlowBuilder.getFieldMetaDataMap());0===e.length?this.condition.field=null:e=Magellan.Util.createFlattenedFields(e),this.fieldNestedTypeahead=new Magellan.Views.NestedTypeaheadSelector({required:!0,data:this.fieldData,root:this.fieldObjectType,selection:e,onSelect:function(e,t){this.condition.field=Magellan.Util.convertFieldSelectionArrayToString(t),this.condition.type=t[t.length-1].type,"REFERENCE"!==this.condition.type&&this.render()}.bind(this)}),this.$el.find(".tuple-condition-field").html(this.fieldNestedTypeahead.$el)},_createOperatorDropdown:function(){var e,t,i=this.model.get("selectedRoutingType"),n=Magellan.Validation.SFDC_TYPE_TO_GROUPING[this.condition.type];t=(e="Update"===i?Magellan.Views.UT_GROUPING_TO_OPERATORS[n]:Magellan.Views.GROUPING_TO_OPERATORS[n])&&-1!==e.indexOf(this.condition.operator)?this.condition.operator:this.condition.operator=null,this.$el.find(".tuple-condition-operator").LDDropdown({required:!0,options:e,value:t,onChange:function(e){this.condition.operator=e,this.render()}.bind(this)})},_createOperandColumn:function(){var e=this.$el.find(".tuple-condition-operand-dropdown"),t=this.$el.find(".tuple-condition-operand-input");if(["has changed","is null","not null"].includes(this.condition.operator))e.hide(),t.hide(),this.condition.operand="";else if("field"===this.condition["value/field"]){this.$el.find('fieldset input[value="field"]').prop("checked",!0),t.hide();var i=Magellan.Validation.SFDC_TYPE_TO_GROUPING[this.condition.type],n=Magellan.Util.convertFieldSelectionStringToArray(this.condition.operand,this.operandObjectType,Magellan.Controllers.FlowBuilder.getFieldMetaDataMap());(0===n.length||n.length>0&&Magellan.Validation.SFDC_TYPE_TO_GROUPING[n[n.length-1].type]!==i)&&(n=[],this.condition.operand=null),this.operandFieldCache=this.condition.operand,this.operandNestedTypeahead=new Magellan.Views.NestedTypeaheadSelector({required:!0,data:this.operandData,root:this.operandObjectType,selection:n,filter:Magellan.Util.createFieldsFilter(Magellan.Validation.SFDC_TYPE_TO_GROUPING[this.condition.type]),onSelect:function(e,t){this.condition.operand=Magellan.Util.convertFieldSelectionArrayToString(t),this.condition["operand type"]=t[t.length-1].type,this.operandFieldCache=this.condition.operand}.bind(this)}),e.html(this.operandNestedTypeahead.$el)}else{switch(this.$el.find('fieldset input[value="value"]').prop("checked",!0),this.condition.type){case"BOOLEAN":t.hide(),e.LDDropdown({required:!0,options:[!0,!1],value:this.condition.operand,onChange:function(e){this.condition.operand=e}.bind(this)});break;case"COMBOBOX":case"PICKLIST":t.hide();var a=Magellan.Controllers.FlowBuilder.getCachedPicklistValues(this.operandObjectType+this.condition.field);_.isEmpty(a)||(a=JSON.parse(a));var o={};o[this.operandObjectType]=[];var l=new Magellan.Views.NestedTypeaheadSelector({required:!0,requireSelectionFromData:!1,disableBreadcrumbs:!0,data:_.isEmpty(a)?o:a,root:this.operandObjectType,selection:_.isEmpty(this.condition.operand)?Magellan.Util.convertStringSelectionToArray(""):Magellan.Util.convertStringSelectionToArray(this.condition.operand),fetchData:_.isEmpty(a)?Magellan.Controllers.FlowBuilder.getPicklistFields.bind(null,this.operandObjectType,this.condition.field):null,onSelect:function(e,t){this.condition.operand=Magellan.Util.convertFieldSelectionArrayToString(t),this.condition["operand type"]="STRING",this.operandFieldCache=this.condition.operand,this.render()}.bind(this)});e.html(l.$el);break;case"DATE":case"DATETIME":e.hide();var s=moment.utc(this.condition.operand);if(Magellan.Validation.isValidValueOfType(this.condition.type,this.condition.operand)){var r=s.local().format(Magellan.Validation.DATETIME_FORMAT);t.val(r)}else t.toggleClass("input-invalid",!0).val(this.condition.operand);"DATE"===this.condition.type?t.datepicker({dateFormat:"yy-mm-dd"}):t.datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss",timeInput:!0,showHour:!1,showMinute:!1,showSecond:!1});break;default:e.hide(),Magellan.Validation.isValidValueOfType(this.condition.type,this.condition.operand)||t.toggleClass("input-invalid",!0).val(this.condition.operand)}t.val(this.condition.operand),this.operandValueCache=this.condition.operand,this.condition["operand type"]="STRING"}},render:function(){var e=this.template({idx:this.idx,condition:this.condition,hideToggleColumn:this.model.get("hideToggleColumn")});return this.$el.html(e),this._createFieldNestedTypeahead(),this._createOperatorDropdown(),this._createOperandColumn(),this}})}},function(e,t,i){e.exports=function(){i(80)(),Magellan.Views.TupleConditions=Backbone.View.extend({className:"tuple-conditions-wrapper",template:_.template(i(281)),initialize:function(e){this.model=new Magellan.Models.TupleConditions(e),this.listenTo(this.model,"addedCondition",this.render),this.listenTo(this.model,"deletedCondition",this.render),this.listenTo(this.model,"resetLogic",this.render),this.render()},events:{"click .add-tuple-condition-btn":"addConditionButtonHandler","click .reset-tuple-rule-logic":"setDefaultLogic","input .tuple-rule-logic-input":"ruleLogicInputHandler"},returnModelValues:function(){return this.model.toJSON()},returnConditionValues:function(){return{conditions:this.model.get("conditions"),logic:this.model.get("logic"),rpnLogic:this.model.get("rpnLogic")}},validate:function(){return this.model.validate()},setDefaultLogic:function(){this.model.setDefaultLogic()},ruleLogicInputHandler:function(e){var t=$(e.target),i=t.val();_.isEmpty(i)?(this.model.set("logic",null),this.model.set("rpnLogicIsValid",!1)):this.model.parseLogic(i);var n=this.$el.find(".rule-logic-error-row");this.model.get("rpnLogicIsValid")?(t.toggleClass("input-invalid",!1),n.html(""),n.hide()):(t.toggleClass("input-invalid",!0),n.html(this.model.get("rpnLogicErrorMessages")[0]),n.show())},addConditionButtonHandler:function(e){this.addCondition(null)},addCondition:function(e){this.model.addCondition(e)},createRuleRows:function(){var e=this.$el.find(".tuple-conditions-row");e.empty();var t=this.model.get("conditions");0===t.length?this.addCondition(null):(_.each(t,function(t,i){var n=new Magellan.Views.SingleTupleCondition({idx:i,model:this.model,condition:t});e.append(n.$el)},this),this.model.validate())},render:function(){var e=this.template({fieldObjectType:this.model.get("fieldObjectType"),operandObjectType:this.model.get("operandObjectType"),logic:this.model.get("logic"),rpnLogicIsValid:this.model.get("rpnLogicIsValid")});return this.$el.html(e),this.createRuleRows(),this}})}},function(e,t,i){e.exports=function(){var e=i(282);return Magellan.Views.WaitingScreen=Backbone.View.extend({tagName:"div",className:"ld-waiting-screen hidden",template:_.template(e),messageTemplate:_.template('<div class="waiting-message"><%=message%></div>'),initialize:function(e){this.pendingPromises=new Backbone.Collection,this.container=e.container||null,this.container&&$(this.container).html(this.$el),this.render()},render:function(){return this.$el.html(this.template()),this},show:function(e){e=e||"Loading...";var t=$(this.messageTemplate({message:e}));this.$(".waiting-message-wrapper").append(t);var i=$.Deferred(),n=this.pendingPromises.add({promise:i,messageEl:t});return i.always(this.hide.bind(this,n)),this.$el.toggleClass("hidden",!1),i},hide:function(e){e?(e.get("messageEl").remove(),this.pendingPromises.remove(e)):this.pendingPromises.reset(),0===this.pendingPromises.length&&(this.$el.toggleClass("hidden",!0),this.$(".waiting-message-wrapper").empty())}})}},function(e,t,i){Magellan=window.Magellan=window.Magellan||{},Magellan.Controllers=Magellan.Controllers||{},Magellan.Controllers.AccountRouter={},Magellan.Controllers.AccountRouter.initialize=function(){Magellan.Views.AccountNodeForm=i(94)(),Magellan.Models.AccountInsertTriggerNode=i(89)(),Magellan.Views.AccountInsertTriggerNode=i(90)(),Magellan.Models.AccountUpdateTriggerNode=i(115)(),Magellan.Views.AccountUpdateTriggerNode=i(116)(),Magellan.Models.AccountMatchNode=i(92)(),Magellan.Models.AccountMatchNode.Account2Opportunity=i(91)(),Magellan.Views.AccountMatchNode=i(93)(),Magellan.Views.AccountDecisionNode=i(88)(),Magellan.Models.AccountTrueFalseNode=i(111)(),Magellan.Models.AccountTrueFalseNode.Account2Opportunity=i(110)(),Magellan.Views.AccountTrueFalseNode=i(112)(),Magellan.Models.AccountTrueFalseNodeStencil=Magellan.Models.TrueFalseNodeStencil.extend({}),Magellan.Models.AccountBranchNode=i(82)(),Magellan.Models.AccountBranchNode.Account2Opportunity=i(81)(),Magellan.Views.AccountBranchNode=i(83)(),Magellan.Models.AccountBranchNodeStencil=Magellan.Models.BranchNodeStencil.extend({}),Magellan.Models.AccountRerouteNode=i(101)(),Magellan.Models.AccountRerouteNodeStencil=Magellan.Models.RerouteNodeStencil.extend({}),Magellan.Views.AccountRerouteNode=Magellan.Views.Reroute.extend({}),Magellan.Models.AccountTeamRouting=i(108)(),Magellan.Views.AccountTeamRouting=i(109)(),Magellan.Models.AccountOpportunityRouting=i(95)(),Magellan.Views.AccountOpportunityRouting=i(96)(),Magellan.Models.AccountOwnerMappingRouting=i(99)(),Magellan.Views.AccountOwnerMappingRouting=i(100)(),Magellan.Models.AccountUserFieldRouting=i(117)(),Magellan.Views.AccountUserFieldRouting=i(118)(),Magellan.Models.AccountCreateOpportunity=i(84)(),Magellan.Views.AccountCreateOpportunity=i(85)(),Magellan.Models.AccountCreateTask=i(86)(),Magellan.Views.AccountCreateTask=i(87)(),Magellan.Models.AccountOwnerAssignment=i(97)(),Magellan.Views.AccountOwnerAssignment=i(98)(),Magellan.Models.AccountRoundRobin=i(102)(),Magellan.Views.AccountRoundRobin=i(103)(),Magellan.Models.AccountRouteToTerritory=i(104)(),Magellan.Views.AccountRouteToTerritory=i(105)(),Magellan.Models.AccountUpdateAction=i(113)(),Magellan.Views.AccountUpdateAction=i(114)(),_.assign(Magellan.Models.DecisionNode.OBJECT_TYPE_TO_DRAGGABLE_TRUE_FALSE_NODES_CLASS_INFO,{Account:[{dropdownLabel:"Account",dropdownImage:"Account Icon",nodeModel:"Magellan.Models.AccountTrueFalseNode"},{dropdownLabel:"Account2Opportunity",dropdownImage:"Account2Opportunity Icon",nodeModel:"Magellan.Models.AccountTrueFalseNode.Account2Opportunity"}]}),_.assign(Magellan.Models.DecisionNode.OBJECT_TYPE_TO_DRAGGABLE_BRANCH_NODES_CLASS_INFO,{Account:[{dropdownLabel:"Account",dropdownImage:"Account Icon",nodeModel:"Magellan.Models.AccountBranchNode"},{dropdownLabel:"Account2Opportunity",dropdownImage:"Account2Opportunity Icon",nodeModel:"Magellan.Models.AccountBranchNode.Account2Opportunity"}]}),_.assign(Magellan.Models.RerouteNode.OBJECT_TYPE_TO_DRAGGABLE_REROUTE_NODES_CLASS_INFO,{Account:[{dropdownLabel:"Time-based Rerouting",dropdownImage:"Timebased",nodeModel:"Magellan.Models.AccountRerouteNode"}]}),Magellan.Models.AccountSendNotification=i(106)(),Magellan.Views.AccountSendNotification=i(107)(),_.assign(Magellan.Models.DecisionNode.OBJECT_TYPE_TO_DRAGGABLE_DECISION_NODES_CLASS_INFO,{Account:[{dropdownLabel:"True/False",dropdownImage:"True/False",nodeModel:"Magellan.Models.AccountTrueFalseNode"},{dropdownLabel:"Branch",dropdownImage:"Branch",nodeModel:"Magellan.Models.AccountBranchNode"}]}),_.assign(Magellan.Models.MatchNode.OBJECT_TYPE_TO_DRAGGABLE_MATCH_NODES_CLASS_INFO,{Account:[{dropdownLabel:"Account2Opportunity",dropdownImage:"Account2Opportunity Icon",nodeModel:"Magellan.Models.AccountMatchNode.Account2Opportunity"}]}),_.assign(Magellan.Models.ActionNode.OBJECT_TYPE_TO_DRAGGABLE_ACTION_NODES_CLASS_INFO,{Account:[{dropdownLabel:"Route to Matched Opportunity",dropdownImage:"Assign Owner Opportunity",nodeModel:"Magellan.Models.AccountOpportunityRouting"},{dropdownLabel:"Route to Account Team",dropdownImage:"Assign Owner Account",nodeModel:"Magellan.Models.AccountTeamRouting"},{dropdownLabel:"Route to Owner Mapping",dropdownImage:"Assign Owner Account",nodeModel:"Magellan.Models.AccountOwnerMappingRouting"},{dropdownLabel:"Route to User Field",dropdownImage:"Assign Owner Account",nodeModel:"Magellan.Models.AccountUserFieldRouting"},{dropdownLabel:"Create Opportunity",dropdownImage:"Create Opportunity",nodeModel:"Magellan.Models.AccountCreateOpportunity"},{dropdownLabel:"Create Task",dropdownImage:"Create Task",nodeModel:"Magellan.Models.AccountCreateTask"},{dropdownLabel:"Assign Owner",dropdownImage:"Explicit Owner Assignment",nodeModel:"Magellan.Models.AccountOwnerAssignment"},{dropdownLabel:"Round Robin",dropdownImage:"Round Robin",nodeModel:"Magellan.Models.AccountRoundRobin"},{dropdownLabel:"Route to Territory",dropdownImage:"Route To Territory",nodeModel:"Magellan.Models.AccountRouteToTerritory"},{dropdownLabel:"Send Notification",dropdownImage:"Send Notification",stencilModel:"Magellan.Models.AccountSendNotification",nodeModel:"Magellan.Models.AccountSendNotification"},{dropdownLabel:"Update Account",dropdownImage:"Update Lead",nodeModel:"Magellan.Models.AccountUpdateAction"},{dropdownLabel:"Custom Interface",dropdownImage:"Custom Interface",nodeModel:"Magellan.Models.CustomInterface"}]})};var n=null;Magellan.Controllers.AccountRouter.createDeploymentHistoryView=function(e){return n instanceof Magellan.Views.DeploymentHistory&&n.remove(),n=new Magellan.Views.DeploymentHistory({model:e,objectType:"account",localStorageName:"account_tile_order"})},Magellan.Controllers.AccountRouter.getNodeFormViewFromNodeModel=function(e){switch(e.nodeInfo.magellanClass){case"Magellan.Models.AccountInsertTriggerNode":return Magellan.Views.AccountInsertTriggerNode;case"Magellan.Models.AccountUpdateTriggerNode":return Magellan.Views.AccountUpdateTriggerNode;case"Magellan.Models.AccountTrueFalseNode":case"Magellan.Models.AccountTrueFalseNode.Account2Opportunity":return Magellan.Views.AccountTrueFalseNode;case"Magellan.Models.AccountBranchNode":case"Magellan.Models.AccountBranchNode.Account2Opportunity":return Magellan.Views.AccountBranchNode;case"Magellan.Models.AccountRerouteNode":return Magellan.Views.AccountRerouteNode;case"Magellan.Models.AccountMatchNode":case"Magellan.Models.AccountMatchNode.Account2Opportunity":return Magellan.Views.AccountMatchNode;case"Magellan.Models.AccountTeamRouting":return Magellan.Views.AccountTeamRouting;case"Magellan.Models.AccountOpportunityRouting":return Magellan.Views.AccountOpportunityRouting;case"Magellan.Models.AccountOwnerMappingRouting":return Magellan.Views.AccountOwnerMappingRouting;case"Magellan.Models.AccountUserFieldRouting":return Magellan.Views.AccountUserFieldRouting;case"Magellan.Models.AccountCreateOpportunity":return Magellan.Views.AccountCreateOpportunity;case"Magellan.Models.AccountCreateTask":return Magellan.Views.AccountCreateTask;case"Magellan.Models.AccountOwnerAssignment":return Magellan.Views.AccountOwnerAssignment;case"Magellan.Models.AccountRoundRobin":return Magellan.Views.AccountRoundRobin;case"Magellan.Models.AccountRouteToTerritory":return Magellan.Views.AccountRouteToTerritory;case"Magellan.Models.AccountUpdateAction":return Magellan.Views.AccountUpdateAction;case"Magellan.Models.AccountSendNotification":return Magellan.Views.AccountSendNotification;case"Magellan.Models.CustomInterface":return Magellan.Views.CustomInterface;default:return null}};var a={Account:"Account",A2O:"Opportunity"};Magellan.Controllers.AccountRouter.getObjectNameFromHatType=function(e){return a[e]||LeanData__PrimarySObjectType},e.exports=Magellan.Controllers.AccountRouter},function(e,t,i){e.exports=function(){var e=Magellan.Controllers.GUI.appWaitingScreen.show("Loading Data..."),t=new(i(121)())({});j$(".dg_inner-wrapper").html(t.render(e).$el)}},function(e,t,i){e.exports=function(e){var t=new(i(123)())({model:new(i(122)())({userSettings:e})});j$(".dg_inner-wrapper").html(t.render().$el)}},function(e,t,i){Magellan=window.Magellan=window.Magellan||{},Magellan.Controllers=Magellan.Controllers||{},Magellan.Controllers.ContactRouter={},Magellan.Controllers.ContactRouter.initialize=function(){Magellan.Views.ContactNodeForm=i(142)(),Magellan.Models.InsertedContactTriggerNode=i(162)(),Magellan.Views.InsertedContactTriggerNode=i(163)(),Magellan.Models.UpdateContactTriggerNode=i(166)(),Magellan.Views.UpdateContactTriggerNode=i(167)(),Magellan.Models.ContactMatchNode=i(140)(),Magellan.Models.ContactMatchNode.Contact2Contact=i(138)(),Magellan.Models.ContactMatchNode.Contact2Opportunity=i(139)(),Magellan.Views.ContactMatchNode=i(141)(),Magellan.Views.ContactDecisionNode=i(133)(),Magellan.Models.ContactTrueFalseNode=i(136)(),Magellan.Models.ContactTrueFalseNode.Contact2Opportunity=i(135)(),Magellan.Models.ContactTrueFalseNode.Contact2Contact=i(134)(),Magellan.Views.ContactTrueFalseNode=i(137)(),Magellan.Models.ContactTrueFalseNodeStencil=Magellan.Models.TrueFalseNodeStencil.extend({}),Magellan.Models.ContactBranchNode=i(131)(),Magellan.Models.ContactBranchNode.Contact2Opportunity=i(130)(),Magellan.Models.ContactBranchNode.Contact2Contact=i(129)(),Magellan.Views.ContactBranchNode=i(132)(),Magellan.Models.ContactBranchNodeStencil=Magellan.Models.BranchNodeStencil.extend({}),Magellan.Models.ContactRerouteNode=i(147)(),Magellan.Models.ContactRerouteNodeStencil=Magellan.Models.RerouteNodeStencil.extend({}),Magellan.Views.ContactRerouteNode=Magellan.Views.Reroute.extend({}),Magellan.Models.ContactRouteToContact=i(152)(),Magellan.Views.ContactRouteToContact=i(153)(),Magellan.Models.ContactRouteToAccount=i(150)(),Magellan.Views.ContactRouteToAccount=i(151)(),Magellan.Models.ContactRouteToOpportunity=i(154)(),Magellan.Views.ContactRouteToOpportunity=i(155)(),Magellan.Models.ContactCreateOpportunity=i(125)(),Magellan.Views.ContactCreateOpportunity=i(126)(),Magellan.Models.ContactCreateTask=i(127)(),Magellan.Views.ContactCreateTask=i(128)(),Magellan.Models.ContactOutreachAddToSequence=i(143)(),Magellan.Views.ContactOutreachAddToSequence=i(144)(),Magellan.Models.ContactSalesloftAddToCadence=i(158)(),Magellan.Views.ContactSalesloftAddToCadence=i(159)(),Magellan.Models.ContactAssignOwnerAccount=i(145)(),Magellan.Views.ContactAssignOwnerAccount=i(146)(),Magellan.Models.ContactRoundRobin=i(148)(),Magellan.Views.ContactRoundRobin=i(149)(),Magellan.Models.ContactRouteToTerritory=i(156)(),Magellan.Views.ContactRouteToTerritory=i(157)(),Magellan.Models.UpdateContact=i(164)(),Magellan.Views.UpdateContact=i(165)(),Magellan.Models.ContactSendNotification=i(160)(),Magellan.Views.ContactSendNotification=i(161)(),_.assign(Magellan.Models.DecisionNode.OBJECT_TYPE_TO_DRAGGABLE_TRUE_FALSE_NODES_CLASS_INFO,{Contact:[{nodeModel:"Magellan.Models.ContactTrueFalseNode",dropdownLabel:"Contact",dropdownImage:"Contact Icon"},{nodeModel:"Magellan.Models.ContactTrueFalseNode.Contact2Contact",dropdownLabel:"Contact2Contact",dropdownImage:"Contact2Contact Icon"},{nodeModel:"Magellan.Models.ContactTrueFalseNode.Contact2Opportunity",dropdownLabel:"Contact2Opportunity",dropdownImage:"Contact2Opportunity Icon"}]}),_.assign(Magellan.Models.DecisionNode.OBJECT_TYPE_TO_DRAGGABLE_BRANCH_NODES_CLASS_INFO,{Contact:[{nodeModel:"Magellan.Models.ContactBranchNode",dropdownLabel:"Contact",dropdownImage:"Contact Icon"},{nodeModel:"Magellan.Models.ContactBranchNode.Contact2Contact",dropdownLabel:"Contact2Contact",dropdownImage:"Contact2Contact Icon"},{nodeModel:"Magellan.Models.ContactBranchNode.Contact2Opportunity",dropdownLabel:"Contact2Opportunity",dropdownImage:"Contact2Opportunity Icon"}]}),_.assign(Magellan.Models.RerouteNode.OBJECT_TYPE_TO_DRAGGABLE_REROUTE_NODES_CLASS_INFO,{Contact:[{nodeModel:"Magellan.Models.ContactRerouteNode",dropdownLabel:"Time-based Rerouting",dropdownImage:"Timebased"}]}),_.assign(Magellan.Models.DecisionNode.OBJECT_TYPE_TO_DRAGGABLE_DECISION_NODES_CLASS_INFO,{Contact:[{nodeModel:"Magellan.Models.ContactTrueFalseNode",dropdownLabel:"True/False",dropdownImage:"True/False"},{nodeModel:"Magellan.Models.ContactBranchNode",dropdownLabel:"Branch",dropdownImage:"Branch"}]}),_.assign(Magellan.Models.MatchNode.OBJECT_TYPE_TO_DRAGGABLE_MATCH_NODES_CLASS_INFO,{Contact:[{nodeModel:"Magellan.Models.ContactMatchNode.Contact2Contact",dropdownLabel:"Contact2Contact",dropdownImage:"Contact2Contact Icon"},{nodeModel:"Magellan.Models.ContactMatchNode.Contact2Opportunity",dropdownLabel:"Contact2Opportunity",dropdownImage:"Contact2Opportunity Icon"}]}),_.assign(Magellan.Models.ActionNode.OBJECT_TYPE_TO_DRAGGABLE_ACTION_NODES_CLASS_INFO,{Contact:[{nodeModel:"Magellan.Models.ContactRouteToContact",dropdownLabel:"Route To Matched Contact",dropdownImage:"Assign Owner Lead"},{nodeModel:"Magellan.Models.ContactRouteToAccount",dropdownLabel:"Route To Matched Account",dropdownImage:"Assign Owner Account"},{nodeModel:"Magellan.Models.ContactRouteToOpportunity",dropdownLabel:"Route To Matched Opportunity",dropdownImage:"Assign Owner Opportunity"},{nodeModel:"Magellan.Models.ContactRouteToTerritory",dropdownLabel:"Route to Territory",dropdownImage:"Route To Territory"},{nodeModel:"Magellan.Models.ContactCreateOpportunity",dropdownLabel:"Create Opportunity",dropdownImage:"Create Opportunity"},{nodeModel:"Magellan.Models.ContactCreateTask",dropdownLabel:"Create Task",dropdownImage:"Create Task"},{nodeModel:"Magellan.Models.ContactAssignOwnerAccount",dropdownLabel:"Assign Owner",dropdownImage:"Explicit Owner Assignment"},{nodeModel:"Magellan.Models.ContactRoundRobin",dropdownLabel:"Round Robin",dropdownImage:"Round Robin"},{nodeModel:"Magellan.Models.ContactSendNotification",dropdownLabel:"Send Notification",dropdownImage:"Send Notification"},{nodeModel:"Magellan.Models.UpdateContact",dropdownLabel:"Update Contact",dropdownImage:"Update Lead"},{dropdownLabel:"Custom Interface",dropdownImage:"Custom Interface",nodeModel:"Magellan.Models.CustomInterface"}]}),_.assign(Magellan.Models.OutreachNode.OBJECT_TYPE_TO_DRAGGABLE_PARTNER_NODES_CLASS_INFO,{Contact:[{nodeModel:"Magellan.Models.ContactOutreachAddToSequence",dropdownLabel:"Add to Sequence",dropdownImage:"Outreach Node Icon"}]}),_.assign(Magellan.Models.SalesloftNode.OBJECT_TYPE_TO_DRAGGABLE_PARTNER_NODES_CLASS_INFO,{Contact:[{nodeModel:"Magellan.Models.ContactSalesloftAddToCadence",dropdownLabel:"Add to Cadence",dropdownImage:"Salesloft Node Icon"}]})};var n=null;Magellan.Controllers.ContactRouter.createDeploymentHistoryView=function(e){return n instanceof Magellan.Views.DeploymentHistory&&n.remove(),n=new Magellan.Views.DeploymentHistory({model:e,objectType:"contact",localStorageName:"contact_tile_order"})},Magellan.Controllers.ContactRouter.getNodeFormViewFromNodeModel=function(e){switch(e.nodeInfo.magellanClass){case"Magellan.Models.InsertedContactTriggerNode":return Magellan.Views.InsertedContactTriggerNode;case"Magellan.Models.UpdateContactTriggerNode":return Magellan.Views.UpdateContactTriggerNode;case"Magellan.Models.ContactTrueFalseNode":case"Magellan.Models.ContactTrueFalseNode.Contact2Opportunity":case"Magellan.Models.ContactTrueFalseNode.Contact2Contact":return Magellan.Views.ContactTrueFalseNode;case"Magellan.Models.ContactBranchNode":case"Magellan.Models.ContactBranchNode.Contact2Opportunity":case"Magellan.Models.ContactBranchNode.Contact2Contact":return Magellan.Views.ContactBranchNode;case"Magellan.Models.ContactRerouteNode":return Magellan.Views.ContactRerouteNode;case"Magellan.Models.ContactMatchNode":case"Magellan.Models.ContactMatchNode.Contact2Opportunity":case"Magellan.Models.ContactMatchNode.Contact2Contact":return Magellan.Views.ContactMatchNode;case"Magellan.Models.ContactRouteToAccount":return Magellan.Views.ContactRouteToAccount;case"Magellan.Models.ContactRouteToOpportunity":return Magellan.Views.ContactRouteToOpportunity;case"Magellan.Models.ContactRouteToContact":return Magellan.Views.ContactRouteToContact;case"Magellan.Models.ContactCreateOpportunity":return Magellan.Views.ContactCreateOpportunity;case"Magellan.Models.ContactCreateTask":return Magellan.Views.ContactCreateTask;case"Magellan.Models.ContactOutreachAddToSequence":return Magellan.Views.ContactOutreachAddToSequence;case"Magellan.Models.ContactSalesloftAddToCadence":return Magellan.Views.ContactSalesloftAddToCadence;case"Magellan.Models.ContactRoundRobin":return Magellan.Views.ContactRoundRobin;case"Magellan.Models.ContactRouteToTerritory":return Magellan.Views.ContactRouteToTerritory;case"Magellan.Models.ContactAssignOwnerAccount":return Magellan.Views.ContactAssignOwnerAccount;case"Magellan.Models.UpdateContact":return Magellan.Views.UpdateContact;case"Magellan.Models.ContactSendNotification":return Magellan.Views.ContactSendNotification;case"Magellan.Models.CustomInterface":return Magellan.Views.CustomInterface;default:return null}};var a={Contact:"Account",C2O:"Opportunity",C2C:"Contact"};Magellan.Controllers.ContactRouter.getObjectNameFromHatType=function(e){return a[e]||LeanData__PrimarySObjectType},e.exports=Magellan.Controllers.ContactRouter},function(e,t,i){e.exports=function(e){Magellan.Views.HelpPage=i(168)();var t=new Magellan.Views.HelpPage({info:e});j$(".dg_inner-wrapper").html(t.render().$el)}},function(e,t){e.exports=function initializeMetricsDetail(e){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Views&&(Magellan.Views={}),Magellan.Views.MetricsDetail=Backbone.View.extend({parsedMetrics:e,removeAllChildViews:function(){_.each(this.childViews,function(e){try{e.remove()}catch(e){}}),this.childViews=[]},remove:function(){try{Backbone.View.prototype.remove.call(this,[])}catch(e){}this.removeAllChildViews()}})}},function(e,t,i){e.exports=function initializeMetricsDetailTable(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Views&&(Magellan.Views={}),i(7),Magellan.Views.MetricsDetailTable=Magellan.Views.MetricsDetail.extend({initialize:function(e){this.showErrorColumn=e.showErrorColumn,this.detailColumns=e.detailColumns,this.logs=e.logs,this.title=e.title,this.childViews=[],this.dataTable=null},template:_.template(magellanDocument.getElementById("metrics_table").innerHTML),events:{},createRow:function(e){var t=new Magellan.Views.MetricsDetailTableRow({log:e,columnLayout:Magellan.Models.Log.columnLayout[_.capitalize(this.parsedMetrics.objectType)]});this.childViews.push(t),this.$el.find("#metrics-detail-body").append(t.$el),t.render()},createErrorRow:function(e){var t=new Magellan.Views.MetricsDetailTableRowError({log:e});this.childViews.push(t),this.$el.find("#metrics-detail-body").append(t.$el),t.render()},render:function(){this.removeAllChildViews();var e=this.template({detailColumns:this.detailColumns,columnLayout:Magellan.Models.Log.columnLayout[_.capitalize(this.parsedMetrics.objectType)],columnHeaderMapping:Magellan.Models.Log.fieldToHeaderMapping[this.parsedMetrics.objectType],showErrorColumn:this.showErrorColumn,title:this.title});this.$el.html(e);var t=this;return _.each(this.logs,function(e){t.createRow(e),t.showErrorColumn&&t.createErrorRow(e)}),_.defer(function(e){t.dataTable=$("#metrics-detail-table").DataTable({paging:!1,info:!1,ordering:!1,searching:!1}),$("#metrics-detail-table").show()},this),this},showNewLogs:function(e){var t=this;$("#metrics-detail-body").empty(),_.each(e,function(e){t.createRow(e),t.showErrorColumn&&t.createErrorRow(e)})}})}},function(e,t,i){e.exports=function initializeMetricsDetailTableRow(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Views&&(Magellan.Views={}),i(8),Magellan.Views.MetricsDetailTableRow=Magellan.Views.MetricsDetail.extend({tagName:"tr",className:"metrics-detail-row",initialize:function(e){this.log=e.log,this.showErrorColumn=e.showErrorColumn,this.columnLayout=e.columnLayout},template:_.template(magellanDocument.getElementById("metrics_table_row").innerHTML),render:function(){var e=this.template({log:this.log.primary,idToNameMap:this.log.idToNameMap||{},showErrorColumn:this.showErrorColumn,columnLayout:this.columnLayout});return this.$el.html(e),this}})}},function(e,t,i){e.exports=function initializeMetricsDetailTableRowError(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Views&&(Magellan.Views={});var e=i(347);Magellan.Views.MetricsDetailTableRowError=Magellan.Views.MetricsDetail.extend({tagName:"tr",className:"metrics-detail-row-error",events:{},copyText:function(e){var t='Deployment Id: "'+this.parsedMetrics.deploymentId+'"; Node Name: "'+decodeURI(this.parsedMetrics.nodeName)+'"; Attribute Id: "'+this.log.attributes.Id+'"; '+this.log.objectType+' Id: "'+this.log.primary.id+'"; '+e.currentTarget.innerText,i=$("<input>");$("body").append(i),i.val(t).select(),document.execCommand("copy"),i.remove(),new Magellan.Views.ConfirmationModal({header:"Error Message",message:t,footer:"This error message has been copied to your clipboard.",primaryButtonText:"Ok",hideSecondaryButton:!0}).open()},initialize:function(e){this.log=e.log;var t=e.log.primary.graphLevelError;this.errorText="(No error detail to display)",t&&(this.errorText=_.escape(t.error))},template:_.template(e),render:function(){var e=this.template({errorText:this.errorText});return this.$el.html(e),this}})}},function(e,t,i){e.exports=function initializeMetricsDetailView(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Views&&(Magellan.Views={});var e=i(6);Magellan.Views.MetricsDetailView=Magellan.Views.MetricsDetail.extend({initialize:function(){this.userSettings={startDate:this.parsedMetrics.userStartDate,endDate:this.parsedMetrics.userEndDate,displayedReps:null,displayedTerritories:null,statusKey:this.parsedMetrics.statusKey,nextNodes:new Set(["Inactive User","Inactive Owner","Queue Owner","No Mapping Found","Invalid Group","Territory Not Assigned","Not Available For Routing","Error","Configuration Error","Missing User Id","Missing Prospect Id"])},this.isEdge="true"===this.parsedMetrics.isEdge,this.isEdge&&(this.source=decodeURIComponent(this.parsedMetrics.source),this.edgeName=decodeURIComponent(this.parsedMetrics.edgeName),this.target=decodeURIComponent(this.parsedMetrics.target)),this.nodeName=decodeURIComponent(this.parsedMetrics.nodeName),this.statType=this.parsedMetrics.statType,this.minDate=this.parsedMetrics.startDate,this.queryToViewCollections={},this.childViews=[],this.failureTypes=["update","convert","merge","fallback"],this.expanded=!1,this.currentTab="success-pill",this.detailColumns=["id","name","email","title","status","preOwner","postOwner","createddate","statType"],this.failureLogsConditions=[];var e=this.isEdge?this.edgeName:this.nodeName;this.title=e;var t=this.template({title:e,statType:this.statType,isEdge:this.isEdge});this.$el.html(t),this.initializeDatePickers(),"error"==this.userSettings.statusKey?this.currentTab="failure-pill":"endOfFlow"===this.userSettings.statusKey&&(this.isEOF=!0),this.dataTable=null,this.collection=new Magellan.Collections.Logs(null,{deploymentId:this.parsedMetrics.deploymentId,userStartDate:this.userSettings.startDate,userEndDate:this.userSettings.endDate,isEdge:this.isEdge,source:this.source,edgeName:this.edgeName,target:this.target,isEOF:this.isEOF}),this.currentDisplayedRecords=[],this.initializeRemoteDataThenRender()},initializeRemoteDataThenRender:function(){var e=this;this.collection.displayedFallbackEdges=this.userSettings.nextNodes,this.collection.initializeRemoteData().then(function(t){e.render(),e.populateNextNodes(e.userSettings.nextNodes)})},initializeDatePickers:function(){var e=this;_.defer(function(t){$("#logs-datepick-start").datepicker({dateFormat:"mm/dd/yy",minDate:new Date(e.minDate),maxDate:new Date}),e.userSettings.startDate&&$("#logs-datepick-start").datepicker("setDate",new Date(e.userSettings.startDate)),$("#logs-datepick-start").focus(function(){$("#logs-datepick-start").datepicker("show")}),$("#logs-datepick-end").datepicker({dateFormat:"mm/dd/yy",minDate:new Date(e.minDate),maxDate:new Date}),e.userSettings.endDate&&$("#logs-datepick-end").datepicker("setDate",new Date(e.userSettings.endDate)),$("#logs-datepick-end").focus(function(){$("#logs-datepick-end").datepicker("show")})},this)},template:_.template(e),events:{"click .status-pill":"handleTabChange","click #owner-select-box":"showOwnerCheckboxes","click #error-select-box":"showErrorCheckboxes","click #next-node-select-box":"showNextNodeCheckboxes","click #owner-checkboxes :checkbox":"handleCheckboxClick","click #error-checkboxes :checkbox":"handleErrorCheckboxClick","click #next-node-checkboxes :checkbox":"handleNextNodeCheckboxClick","change #logs-datepick-start, #logs-datepick-end":"changeDateRange","click .pagination-item":"handleDifferentPageClick","change #metric-type-select":"handleTypeFilterChange"},updateTableWithData:function(e){this.metricsDetailTable.showNewLogs(e)},updatePaginationButtons:function(){$(".pagination-item").removeClass("inactive"),this.collection.isOnFirstPage()&&$(".pagination-first, .pagination-back").addClass("inactive"),this.collection.isOnLastPage()&&$(".pagination-last, .pagination-next").addClass("inactive")},handleDifferentPageClick:function(e){var t=this,i=$(e.currentTarget).data("direction");this.collection.getDifferentPage(i).then(function(e){t.updateTableWithData(e),t.updatePaginationButtons()})},handleNextNodeCheckboxClick:function(e){var t=$(e.target).is(":checked"),i=e.currentTarget.labels[0].innerText;t?this.userSettings.nextNodes.add(i):this.userSettings.nextNodes.delete(i);var n=this;this.collection.updateFallbackEdges(this.userSettings.nextNodes).then(function(){n.drawTable(n.collection.models,!0),n.updatePaginationButtons()})},changeDateRange:function(e){var t=new Date($("#logs-datepick-start").val()),i=new Date($("#logs-datepick-end").val());this.userSettings.startDate=t,this.userSettings.endDate=i;var n=this,a=this.collection.filterRecordsByDate(t,i);a.paginatorPromise.then(function(){n.isEdge?n.drawTable(n.collection.models,!1):"ownership-distribution-pill"===n.currentTab?n.updateTableWithData(n.collection.models):"success-pill"===n.currentTab?n.drawTable(n.collection.models,!1):"failure-pill"===n.currentTab&&n.drawTable(n.collection.models,!0),n.updatePaginationButtons()}),a.ownershipDistributionPromise.then(function(){"ownership-distribution-pill"===n.currentTab&&n.renderOwnershipDistributionTab()})},render:function(){if(this.changeActivePill($("#"+this.currentTab)),!this.isEdge&&["Magellan.Models.TerritoryRouting","Magellan.Models.ContactRouteToTerritory","Magellan.Models.AccountRouteToTerritory","Magellan.Models.OpportunityRouteToTerritory"].includes(this.collection.currNodeInfo.magellanClass)&&$("#territory-distribution-pill").css("display","flex"),this.collection.isOneTime&&$("#daterange-inputs, .type-filter-dropdown").hide(),this.collection.isOneTime&&this.isEdge&&$("#outcome-tabs-wrapper").hide(),this.isEdge)this.drawTable(this.collection.models,!1),$("#daterange-inputs, .type-filter-dropdown").css("top","12px"),$(".status-pill").css("display","none");else switch(this.currentTab){default:this.collection.switchLogsType("success"),this.drawTable(this.collection.models,!1),$("#placeholder-dropdown-div").show(),$("#next-node-filter-dropdown, .metrics-detail-row-error").hide(),$("#outcome-filter-dropdown").hide();break;case"failure-pill":this.collection.switchLogsType("failure"),this.drawTable(this.collection.models,!0),$("#placeholder-dropdown-div").hide(),$("#next-node-filter-dropdown, .for-next-node-type, .metrics-detail-row-error").show(),$("#outcome-filter-dropdown, .for-ownership-distribution").hide();break;case"ownership-distribution-pill":this.renderOwnershipDistributionTab(),$("#placeholder-dropdown-div").hide(),$("#next-node-filter-dropdown, .for-next-node-type, .metrics-detail-row-error").hide(),$("#outcome-filter-dropdown, .for-ownership-distribution").show();break;case"territory-distribution-pill":this.renderTerritoryTab()}return this.updatePaginationButtons(),this},renderTerritoryTab:function(){$(".for-ownership-distribution").show(),$("#owner-select-box > select > option").text("Filter by Territory");var e=this;this.collection.getTerritoryGraphData().then(function(t){e.territoryGraphData=t,e.userSettings.displayedTerritories||(e.userSettings.displayedTerritories=new Set,_.each(e.territoryGraphData,function(t,i){e.userSettings.displayedTerritories.add(i)})),$("#owner-checkboxes").empty(),e.territoryGraphData.length||$("#owner-checkboxes").append("<p>No owners to display.</p>"),_.each(e.territoryGraphData,function(t,i){e.userSettings.displayedTerritories.has(i)?$("#owner-checkboxes").append('<label for="'+i+'"> <input type="checkbox" id="'+i+'" checked>'+_.escape(t[0])+"</label>"):$("#owner-checkboxes").append('<label for="'+i+'"> <input type="checkbox" id="'+i+'">'+_.escape(t[0])+"</label>")}),e.drawTerritoryChart(e.territoryGraphData)})},populateNextNodes:function(e){$(".next-node-dropdown-item").remove(),e.forEach(function(e,t){var i='<label class="next-node-dropdown-item" for="next-node-'+t+'"> <input type="checkbox" id="next-node-'+t+'" value="idx-'+t+'" checked>'+e+"</label>";$("#next-node-checkboxes").append(i)})},handleTabChange:function(e){this.currentTab!==e.currentTarget.id&&(this.currentTab=e.currentTarget.id,this.render())},showLoading:function(){this.$el.find()},renderOwnershipDistributionTab:function(){$(".for-ownership-distribution").show(),$("#owner-select-box > select > option").text("Filter by Owner");var e=this;this.collection.getOwnershipGraphData().then(function(t){e.ownershipGraphData=t,e.userSettings.displayedReps||(e.userSettings.displayedReps=new Set,_.each(e.ownershipGraphData,function(t,i){e.userSettings.displayedReps.add(i)})),$("#owner-checkboxes").empty(),e.ownershipGraphData.length||$("#owner-checkboxes").append("<p>No owners to display.</p>"),_.each(e.ownershipGraphData,function(t,i){e.userSettings.displayedReps.has(i)?$("#owner-checkboxes").append('<label for="'+i+'"> <input type="checkbox" id="'+i+'" checked>'+_.escape(t[0])+"</label>"):$("#owner-checkboxes").append('<label for="'+i+'"> <input type="checkbox" id="'+i+'">'+_.escape(t[0])+"</label>")}),"territory-distribution-pill"===e.currentTab?e.drawTerritoryChart(e.territoryGraphData):"ownership-distribution-pill"===e.currentTab&&e.drawOwnershipChart(e.ownershipGraphData)})},drawTable:function(e,t){this.metricsDetailTable=new Magellan.Views.MetricsDetailTable({detailColumns:this.detailColumns,logs:e,showErrorColumn:t,title:this.title}),this.removeAllChildViews(),this.childViews.push(this.metricsDetailTable),this.$el.find("#outcome-table-wrapper").html(this.metricsDetailTable.$el),this.metricsDetailTable.render()},drawOwnershipChart:function(e){var t=this,i=_.filter(e,function(e,i){return t.userSettings.displayedReps.has(i)}),n=_.reduce(e,function(e,t){return e+t[1]},0);this.ownershipDistributionChart=new Magellan.Views.DistributionBarChart({data:i,displayedRows:this.userSettings.displayedReps,totalCount:n,objectType:this.parsedMetrics.objectType}),this.removeAllChildViews(),this.childViews.push(this.ownershipDistributionChart),"ownership-distribution-pill"===this.currentTab&&this.$el.find("#outcome-table-wrapper").html(this.ownershipDistributionChart.$el),this.ownershipDistributionChart.render()},drawTerritoryChart:function(e){var t=this,i=_.filter(e,function(e,i){return t.userSettings.displayedTerritories.has(i)}),n=_.reduce(e,function(e,t){return e+t[1]},0);this.territoryDistributionChart=new Magellan.Views.DistributionBarChart({data:i,displayedRows:this.userSettings.displayedTerritories,totalCount:n,objectType:this.parsedMetrics.objectType}),this.childViews.push(this.territoryDistributionChart),"territory-distribution-pill"===this.currentTab&&this.$el.find("#outcome-table-wrapper").html(this.territoryDistributionChart.$el),this.territoryDistributionChart.render()},changeActivePill:function(e){$(".tab-specific-filter").hide(),$(".status-pill").removeClass("active"),$(e).addClass("active")},showCheckboxes:function(e){var t=document.getElementById(e);this.expanded?(t.style.display="none",this.expanded=!1):(t.style.display="block",this.expanded=!0)},showOwnerCheckboxes:function(){this.showCheckboxes("owner-checkboxes")},showNextNodeCheckboxes:function(){this.showCheckboxes("next-node-checkboxes")},showErrorCheckboxes:function(){this.showCheckboxes("error-checkboxes")},handleErrorCheckboxClick:function(e){this.render()},handleErrorCheckboxClick:function(e){this.failureTypes=$("#error-checkboxes input:checked").map(function(e){return this.value}).get(),this.render()},handleCheckboxClick:function(e){var t,i,n,a=$(e.target).is(":checked");switch(this.currentTab){case"territory-distribution-pill":t=this.userSettings.displayedTerritories,i=this.drawTerritoryChart,n=this.territoryGraphData;break;case"ownership-distribution-pill":t=this.userSettings.displayedReps,i=this.drawOwnershipChart,n=this.ownershipGraphData;break;default:console.warn("Something went wrong while finding list of elements to show")}a?t.add(+e.target.id):t.delete(+e.target.id),$("#ownership-distribution-chart-svg").remove(),i.call(this,n)},handleTypeFilterChange:function(e){var t=this;this.statType=e.currentTarget.value,this.collection.setStatType(this.statType).then(function(){t.render()})}})}},function(e,t){e.exports=function initializeMetricsDetailModels(e){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),Magellan.Models.Log=Backbone.Model.extend({getPrimary:function(t){var i,n;n=(i=JSON.parse(t[this.ns+"Message__c"])).attributes,"Lead"===this.objectType&&(n.account=n[this.ns+"reporting_matched_account__c"]),"Contact"!==this.objectType&&"Opportunity"!==this.objectType||(n.account=n[this.ns+"accountid"]),"Account"===this.objectType&&(n.account=n[this.ns+"id"]),t[this.ns+"Post_Owner__c"]?(n.postOwner=t[this.ns+"Post_Owner__c"],n.postOwnerName=t[this.ns+"Post_Owner__r"]?t[this.ns+"Post_Owner__r"].Name:""):(n.postOwner=t[this.ns+"Post_Queue_Id__c"],n.postOwnerName=t[this.ns+"Post_Queue_Name__c"]),t[this.ns+"Pre_Owner__c"]?(n.preOwner=t[this.ns+"Pre_Owner__c"],n.preOwnerName=t[this.ns+"Pre_Owner__r"]?t[this.ns+"Pre_Owner__r"].Name:""):(n.preOwner=t[this.ns+"Pre_Queue_Id__c"],n.preOwnerName=t[this.ns+"Pre_Queue_Name__c"]),n.nextNode=this._getNextNode(i);var a=i.route.filter(function(t){return t.name===decodeURIComponent(e.nodeName)})[0],o=this._getErrorData(i),l=this._getErrorData(a);return n.graphLevelError=this._getGraphLevelError(o,l),n.typeClass="RoutingInsert"===i["ccio type"]?"new_log_col_icon":"updated_log_col_icon",n.typeText={RoutingInsert:"New",RoutingUpdate:"Update",RoutingOnly:"One-Time",RoutingScheduled:"Time-Based",LiveRoutingInsert:"New",LiveRoutingUpdate:"Update"}[i["ccio type"]],this.isOneTime="RoutingOnly"===i["ccio type"],null==n.createddate&&(n.createddate=t[this.ns+"CreatedDate"]),null==n["account.name"]&&null!=n.account&&(n["account.name"]=this.idToNameMap[n.account]),n},initialize:function(e,t){this.idToNameMap=t,this.ns=e.LeanData__SObject_Type__c?"LeanData__":"",this.objectType=e[this.ns+"SObject_Type__c"],this.primary=this.getPrimary(e),this.isOneTime},_getGraphLevelError:function(e,t){return e||t||null},_getErrorData:function(e){return e?e["update error"]?{error:e["update error"],"error type":"update error"}:e["convert error"]?{error:e["convert error"],"error type":"convert error"}:e["merge error"]?{error:e["merge error"],"error type":"merge error"}:e["fallback error"]?{error:e["fallback error"],"error type":"fallback error"}:e.error?{error:e.error,"error type":e.error}:null:null},_getNextNode:function(t){var i,n=decodeURIComponent(e.nodeName);return t.route.forEach(function(e,t){e.name===n&&(i=t)}),t.route[i+1]||null}}),Magellan.Models.Log.fieldToHeaderMapping={id:"Company",name:"Full Name",email:"Email",title:"Title",status:"Lead Status",preOwner:"Pre-Owner",postOwner:"Post-Owner",ownerid:"Owner",createddate:"Created Date",statType:"Type"},Magellan.Models.Log.columnLayout={Lead:[["Type",function(e){return null},function(e){return e.typeText}],["Company",function(e){return e.account?"/"+e.account:e.accountid?"/"+e.accountid:null},function(e){return e.company}],["Full Name",function(e){return"/"+e.id},function(e){return e.name}],["Email",function(e){return"mailto:"+e.email},function(e){return e.email}],["Lead Status",function(e){return null},function(e){return e.status}],["Pre-Owner",function(e){return"/"+e.preOwner},function(e){return e.preOwnerName}],["Post-Owner",function(e){return"/"+e.postOwner},function(e){return e.postOwnerName}],["Created Date",function(e){return null},function(e){return formatDate(e.createddate)}]],Contact:[["Type",function(e){return null},function(e){return e.typeText}],["Account",function(e){return e.account?"/"+e.account:e.accountid?"/"+e.accountid:null},function(e,t){return t[e["account.name"]]||e["account.name"]}],["Full Name",function(e){return"/"+e.id},function(e){return e.name}],["Email",function(e){return"mailto:"+e.email},function(e){return e.email}],["Pre-Owner",function(e){return"/"+e.preOwner},function(e){return e.preOwnerName}],["Post-Owner",function(e){return"/"+e.postOwner},function(e){return e.postOwnerName}],["Created Date",function(e){return null},function(e){return formatDate(e.createddate)}]],Account:[["Type",function(e){return null},function(e){return e.typeText}],["Account Name",function(e){return"/"+e.id},function(e){return e.name}],["Pre-Owner",function(e){return"/"+e.preOwner},function(e){return e.preOwnerName}],["Post-Owner",function(e){return"/"+e.postOwner},function(e){return e.postOwnerName}],["Created Date",function(e){return null},function(e){return formatDate(e.createddate)}]],Opportunity:[["Type",function(e){return null},function(e){return e.typeText}],["Opportunity",function(e){return e.id?"/"+e.id:null},function(e){return e.name}],["Account",function(e){return e.account?"/"+e.account:e.accountid?"/"+e.accountid:null},function(e,t){return t[e["account.name"]]||e["account.name"]}],["Stage",function(e){return null},function(e){return e.stagename}],["Pre-Owner",function(e){return"/"+e.preOwner},function(e){return e.preOwnerName}],["Post-Owner",function(e){return"/"+e.postOwner},function(e){return e.postOwnerName}],["Created Date",function(e){return null},function(e){return formatDate(e.createddate)}],["Close Date",function(e){return null},function(e){return formatDate(e.closedate)}]]},Magellan.Collections.Logs=Backbone.Collection.extend({initialize:function(t,i){this.deploymentId=i.deploymentId,this.routingDeploymentInfo={graphJSON:null,Metric_Translation_JSON__c:null,Node_Name_To_Height_Map__c:null},this.hasOneTime=!1,this.hasGoodNextNode,this.ownershipDistributionData,this.isEdge=i.isEdge,this.isEOF=i.isEOF,this.isOneTime=!1,this.isEdge?this.currEdgeInfo={source:i.source,name:i.edgeName,target:i.target}:this.currNodeInfo={magellanClass:null,fallbackEdgeNumbers:[],nonFallbackEdgeNumbers:[],nodeNumber:-1,nodeHeight:-1},this.statType=e.statType||"all",this.dateRange=[];var n=new Date(i.userStartDate),a=new Date(i.userEndDate);this.dateRange[0]=i.userStartDate&&isFinite(n)?n:new Date(0),this.dateRange[1]=i.userEndDate&&isFinite(a)?this.addDays(a,1):new Date(1e13),this.displayedFallbackEdges,this.ownershipDistributionDataIsOutdated=!0,this.territoryDistributionDataIsOutdated=!0,this.idToNameMap={}},model:Magellan.Models.Log,setStatType:function(e){var t=this,i=$.Deferred();return this.statType=e,this.ownershipDistributionDataIsOutdated=!0,this.initializePaginators().then(function(){t.processAndUpdateCollection(t.currentFetcher.currentRecords),i.resolve()}),i},filterRecordsByDate:function(e,t){var i=this,n={paginatorPromise:$.Deferred(),ownershipDistributionPromise:$.Deferred(),territoryDistributionPromise:$.Deferred()};return(new Date).getTimezoneOffset(),this.dateRange=[],this.dateRange[0]=isFinite(e)?e:new Date(0),this.dateRange[1]=isFinite(t)?this.addDays(t,1):new Date(1e13),this.initializePaginators().then(function(){i.processAndUpdateCollection(i.currentFetcher.currentRecords),n.paginatorPromise.resolve()}),this.isEdge||(this.ownershipDistributionDataIsOutdated=!0,this.territoryDistributionDataIsOutdated=!0,this.getOwnershipGraphData().then(function(){n.ownershipDistributionPromise.resolve()}),this.getTerritoryGraphData().then(function(){n.territoryDistributionPromise.resolve()})),n},updateFallbackEdges:function(e){var t=this,i=$.Deferred();return this.displayedFallbackEdges=e,this.initializePaginators().then(function(){t.processAndUpdateCollection(t.currentFetcher.currentRecords),i.resolve()}),i},addDays:function(e,t){var i=new Date(e);return i.setDate(i.getDate()+t),i},getTerritoryGraphData:function(){var e,t,i=this,n=$.Deferred();return this.dateRange?(e=this.dateRange[0].getTime(),t=this.dateRange[1].getTime()):(e=null,t=null),!this.territoryDistributionData||this.territoryDistributionDataIsOutdated?(Magellan.Services.FlowBuilder.getTerritoryDistributionData(this.deploymentId,this.currNodeInfo.nodeHeight,this.currNodeInfo.nodeNumber,e,t).then(function(e){for(var t in i.territoryDistributionData=[],e)i.territoryDistributionData.push([t,e[t]]);n.resolve(i.territoryDistributionData)}),this.territoryDistributionDataIsOutdated=!1):n.resolve(i.territoryDistributionData),n},getOwnershipGraphData:function(){var e,t,i=this,n=$.Deferred();return this.dateRange?(e=this.dateRange[0].getTime(),t=this.dateRange[1].getTime()):(e=null,t=null),!this.ownershipDistributionData||this.ownershipDistributionDataIsOutdated?(Magellan.Services.FlowBuilder.getOwnershipDistributionData(this.deploymentId,this.currNodeInfo.nodeHeight,this.currNodeInfo.nodeNumber,this.statType,e,t).then(function(e){for(var t in i.ownershipDistributionData=[],e)i.ownershipDistributionData.push([t,e[t]]);n.resolve(i.ownershipDistributionData)}),this.ownershipDistributionDataIsOutdated=!1):n.resolve(i.ownershipDistributionData),n},_getPathCondition:function(e){var t=[];if(e)(n=this.currNodeInfo.nonFallbackEdgeNumbers).push(0);else{var i=this,n=this.currNodeInfo.fallbackEdgeNumbers.filter(function(e){var t=i.routingDeploymentInfo.Metric_Translation_JSON__c[e].edge;return i.displayedFallbackEdges.has(t)});t=this.currNodeInfo.fallbackEdgeNumbers.filter(function(e){var t=i.routingDeploymentInfo.Metric_Translation_JSON__c[e].edge;return!i.displayedFallbackEdges.has(t)})}i=this;var a=n.map(function(e){return"Path_Node_"+i.currNodeInfo.nodeHeight+"__c = "+(i.currNodeInfo.nodeNumber+e/1e4)});if(0===n.length)var o="Path_Node_0__c=-1";else o="("+a.join(" OR ")+")";if("new"===this.statType?o+=" AND (Path_Node_0__c >= 0 AND Path_Node_0__c < 1)":"updated"===this.statType&&(o+=" AND (Path_Node_0__c >= 1 AND Path_Node_0__c < 2)"),this.isEOF&&(o+=" AND Path_Node_"+(i.currNodeInfo.nodeHeight+1)+"__c = null"),e)return"("+o+")";var l=t.map(function(e){return"Path_Node_"+i.currNodeInfo.nodeHeight+"__c != "+(i.currNodeInfo.nodeNumber+e/1e4)});return t.length>0?(l.join(" AND "),"(("+o+") AND ("+l+"))"):"("+o+")"},_getErrorCondition:function(e){var t=this,i=this.currNodeInfo.fallbackEdgeNumbers.filter(function(e){var i=t.routingDeploymentInfo.Metric_Translation_JSON__c[e].edge;return!t.displayedFallbackEdges.has(i)}).map(function(e){return"Path_Node_"+t.currNodeInfo.nodeHeight+"__c != "+(t.currNodeInfo.nodeNumber+e/1e4)}),n=i.length?" AND ("+i.join(" AND ")+")":"";return"("+(e?"Routing_Action_Picklist__c includes ('error', 'convert error', 'merge error', 'update error')":"Routing_Action_Picklist__c excludes ('error', 'convert error', 'merge error', 'update error')")+" AND Path_Node_"+this.currNodeInfo.nodeHeight+"__c >= "+this.currNodeInfo.nodeNumber+" AND Path_Node_"+this.currNodeInfo.nodeHeight+"__c < "+(this.currNodeInfo.nodeNumber+1)+n+")"},_getDateCondition:function(){return this.dateRange[0]instanceof Date&&this.dateRange[1]instanceof Date&&isFinite(this.dateRange[0])&&isFinite(this.dateRange[1])?"CreatedDate > "+this.dateRange[0].toISOString()+" AND CreatedDate < "+this.dateRange[1].toISOString():""},_getEdgeConditions:function(){var e=this;console.log(this.currEdgeInfo),console.log(this.routingDeploymentInfo);var t=_.findKey(this.routingDeploymentInfo.Metric_Translation_JSON__c,function(t){return t.target===e.currEdgeInfo.target&&t.source===e.currEdgeInfo.source&&t.edge===e.currEdgeInfo.name}),i=_.findKey(this.routingDeploymentInfo.graphJSON.businessLogic,function(t){return t[0].name===e.currEdgeInfo.source}),n="(Path_Node_"+this.routingDeploymentInfo.Node_Name_To_Height_Map__c[this.currEdgeInfo.source]+"__c="+(+i+t/1e4)+")",a=this._getDateCondition();return a?(console.log("(("+n+") AND "+a+")"),"(("+n+") AND "+a+")"):(console.log(n),"("+n+")")},_getConditions:function(e){var t;e&&this.hasGoodNextNode?t=this._getPathCondition(!0):e&&!this.hasGoodNextNode?t=this._getPathCondition(!0)+" AND "+this._getErrorCondition(!1):!e&&this.hasGoodNextNode?t=this._getPathCondition(!1):e||this.hasGoodNextNode||(t=this._getPathCondition(!1)+" OR "+this._getErrorCondition(!0));var i=this._getDateCondition();return i?(console.log("(("+t+") AND "+i+")"),"(("+t+") AND "+i+")"):(console.log(t),"("+t+")")},processAndUpdateCollection:function(e){this.reset([]);var t=this;_.each(e,function(e){var i=new Magellan.Models.Log(e,t.idToNameMap);t.add(i),"One-Time"===i.primary.typeText&&(t.hasOneTime=!0)})},initializePaginators:function(){var t=$.Deferred(),i={columns:["Id","Message__c","Message_2__c","Message_3__c","Message_4__c","SObject_Type__c","CreatedDate","L2aRouting_Error__c","LeadConverter_Error__c","Pre_Queue_Id__c","Pre_Owner__c","Pre_Owner__r.Name","Post_Owner__c","Post_Owner__r.Name","Post_Queue_Id__c","Pre_Queue_Name__c","Post_Queue_Name__c"].map(function(e){return"__c"===e.slice(-3)&&(e=ns+e),e}),"sobject type":ns+"Log__c",conditions:[],"has paginate behavior":!0,"has first pagination":!0,"has last pagination":!0},n="Routing_Deployment__c = '"+e.deploymentId+"'",a="(Id != null)";if("new"===this.statType?a="(Path_Node_0__c >= 0 AND Path_Node_0__c < 1)":"updated"===this.statType&&(a="(Path_Node_0__c >= 1 AND Path_Node_0__c < 2)"),this.isEdge){var o=_.defaults({conditions:[this._getEdgeConditions(),n,a]},i);this.currentFetcher=this.edgeRecordsFetcher=new RecordsFetcher(o),console.log("edge query: ",o.conditions.join(" AND "));var l=this.edgeRecordsFetcher.initializePagination(),s=this.edgeRecordsFetcher.getFirstPage();$.when(l,s).done(function(){t.resolve()})}else{var r=_.defaults({conditions:[this._getConditions(!0),n,a]},i),d=_.defaults({conditions:[this._getConditions(!1),n,a]},i);console.log("success query: ",r.conditions.join(" AND ")),console.log("failure query: ",d.conditions.join(" AND "));var c=!1;this.currentFetcher===this.failureRecordsFetcher&&void 0!==this.currentFetcher&&(c=!0),this.successRecordsFetcher=new RecordsFetcher(r),this.failureRecordsFetcher=new RecordsFetcher(d),this.currentFetcher=c?this.failureRecordsFetcher:this.successRecordsFetcher;var u=this.successRecordsFetcher.initializePagination(),p=this.failureRecordsFetcher.initializePagination(),h=this.successRecordsFetcher.getFirstPage(),g=this.failureRecordsFetcher.getFirstPage();$.when(u,p,h,g).done(function(){t.resolve()})}return t},initializeRoutingDeploymentInfo:function(t){this.routingDeploymentInfo.graphJSON=JSON.parse(t.graphJSON),this.routingDeploymentInfo.Metric_Translation_JSON__c=JSON.parse(t.Metric_Translation_JSON__c),this.routingDeploymentInfo.Node_Name_To_Height_Map__c=JSON.parse(t.Node_Name_To_Height_Map__c),_.each(this.routingDeploymentInfo.Metric_Translation_JSON__c,function(e,t){e.edge=e.edge||e.e,e.source=e.source||e.s,e.target=e.target||e.t});var i=this.routingDeploymentInfo.Metric_Translation_JSON__c;if(!this.isEdge){const t=["Inactive User","Inactive Owner","Queue Owner","No Mapping Found","Invalid Group","Territory Not Assigned","Error","Configuration Error","Missing User Id","Missing Prospect Id"];var n=decodeURIComponent(e.nodeName);for(var a in i)i[a].source===n&&(-1!==t.indexOf(i[a].edge)?this.currNodeInfo.fallbackEdgeNumbers.push(+a):this.currNodeInfo.nonFallbackEdgeNumbers.push(+a));var o=this.routingDeploymentInfo.graphJSON.businessLogic;for(var l in o)if(n===o[l][0].name){this.currNodeInfo.nodeNumber=+l,this.currNodeInfo.magellanClass=o[l][0].magellanClass;break}for(var a in i)i[a].source===n&&"Next Node"===i[a].edge&&("-1"===i[a].target?this.hasGoodNextNode=!1:this.hasGoodNextNode=!0);this.currNodeInfo.nodeHeight=this.routingDeploymentInfo.Node_Name_To_Height_Map__c[n]}},initializeRemoteData:function(){var t=$.Deferred(),i=this;return Magellan.Services.FlowBuilder.getRoutingDeploymentInfo(e.deploymentId).then(function(e){i.initializeRoutingDeploymentInfo(e),i.isEdge||(i.getTerritoryGraphData(),i.getOwnershipGraphData()),i.initializePaginators().then(function(){var e=[];_.each(i.currentFetcher.currentRecords,function(t){e.push(t[this.ns+"Message__c"])}),Magellan.Services.FlowBuilder.getIdsToNamesMap(e).then(function(e){i.idToNameMap=e,i.processAndUpdateCollection(i.currentFetcher.currentRecords)}).always(function(){t.resolve()})})}),t},getCurrentPage:function(){return this.models},isOnFirstPage:function(){return this.currentFetcher.isOnFirstPage()},isOnLastPage:function(){return this.currentFetcher.isOnLastPage()},getDifferentPage:function(e){var t={first:this.currentFetcher.getFirstPage,previous:this.currentFetcher.getPreviousPage,next:this.currentFetcher.getNextPage,last:this.currentFetcher.getLastPage}[e];if(t){var i=$.Deferred(),n=this;return t.apply(this.currentFetcher).then(function(e){n.processAndUpdateCollection(n.currentFetcher.currentRecords),i.resolve(n.models)}),i}console.warn("getDifferentPage must be called with either 'first', 'previous', 'next', or 'last'")},switchLogsType:function(e){return"success"===e?this.currentFetcher=this.successRecordsFetcher:"failure"===e?this.currentFetcher=this.failureRecordsFetcher:console.warn("switchLogsType must be called with 'success' or 'failure'"),this.processAndUpdateCollection(this.currentFetcher.currentRecords),this.currentFetcher},isOnFirstPage:function(){return this.currentFetcher.isOnFirstPage()},isOnLastPage:function(){return this.currentFetcher.isOnLastPage()}})}},function(e,t,i){Magellan=window.Magellan=window.Magellan||{},Magellan.Controllers=Magellan.Controllers||{},Magellan.Controllers.OpportunityRouter={},Magellan.Controllers.OpportunityRouter.initialize=function(){Magellan.Views.OpportunityNodeForm=i(184)(),Magellan.Models.OpportunityInsertTriggerNode=i(178)(),Magellan.Views.OpportunityInsertTriggerNode=i(179)(),Magellan.Models.OpportunityUpdateTriggerNode=i(206)(),Magellan.Views.OpportunityUpdateTriggerNode=i(207)(),Magellan.Models.OpportunityMatchNode=i(182)(),Magellan.Models.OpportunityMatchNode.Opportunity2Contact=i(180)(),Magellan.Models.OpportunityMatchNode.Opportunity2Opportunity=i(181)(),Magellan.Views.OpportunityMatchNode=i(183)(),Magellan.Views.OpportunityDecisionNode=i(177)(),Magellan.Models.OpportunityTrueFalseNode=i(202)(),Magellan.Models.OpportunityTrueFalseNode.Opportunity2Contact=i(200)(),Magellan.Models.OpportunityTrueFalseNode.Opportunity2Opportunity=i(201)(),Magellan.Views.OpportunityTrueFalseNode=i(203)(),Magellan.Models.OpportunityTrueFalseNodeStencil=Magellan.Models.TrueFalseNodeStencil.extend({}),Magellan.Models.OpportunityBranchNode=i(171)(),Magellan.Models.OpportunityBranchNode.Opportunity2Contact=i(169)(),Magellan.Models.OpportunityBranchNode.Opportunity2Opportunity=i(170)(),Magellan.Views.OpportunityBranchNode=i(172)(),Magellan.Models.OpportunityBranchNodeStencil=Magellan.Models.BranchNodeStencil.extend({}),Magellan.Models.OpportunityRerouteNode=i(187)(),Magellan.Models.OpportunityRerouteNodeStencil=Magellan.Models.RerouteNodeStencil.extend({}),Magellan.Views.OpportunityRerouteNode=Magellan.Views.Reroute.extend({}),Magellan.Models.OpportunityRouteToContact=i(192)(),Magellan.Views.OpportunityRouteToContact=i(193)(),Magellan.Models.OpportunityRouteToAccount=i(190)(),Magellan.Views.OpportunityRouteToAccount=i(191)(),Magellan.Models.OpportunityRouteToOpportunity=i(194)(),Magellan.Views.OpportunityRouteToOpportunity=i(195)(),Magellan.Models.OpportunityCreateOpportunity=i(173)(),Magellan.Views.OpportunityCreateOpportunity=i(174)(),Magellan.Models.OpportunityCreateTask=i(175)(),Magellan.Views.OpportunityCreateTask=i(176)(),Magellan.Models.OpportunityOwnerAssignment=i(185)(),Magellan.Views.OpportunityOwnerAssignment=i(186)(),Magellan.Models.OpportunityRoundRobin=i(188)(),Magellan.Views.OpportunityRoundRobin=i(189)(),Magellan.Models.OpportunityRouteToTerritory=i(196)(),Magellan.Views.OpportunityRouteToTerritory=i(197)(),Magellan.Models.OpportunityUpdateAction=i(204)(),Magellan.Views.OpportunityUpdateAction=i(205)(),Magellan.Models.OpportunitySendNotification=i(198)(),Magellan.Views.OpportunitySendNotification=i(199)(),_.assign(Magellan.Models.DecisionNode.OBJECT_TYPE_TO_DRAGGABLE_TRUE_FALSE_NODES_CLASS_INFO,{Opportunity:[{dropdownLabel:"Opportunity",dropdownImage:"Opportunity Icon",nodeModel:"Magellan.Models.OpportunityTrueFalseNode"},{dropdownLabel:"Opportunity2Contact",dropdownImage:"Opportunity2Contact Icon",nodeModel:"Magellan.Models.OpportunityTrueFalseNode.Opportunity2Contact"},{dropdownLabel:"Opportunity2Opportunity",dropdownImage:"Opportunity2Opportunity Icon",nodeModel:"Magellan.Models.OpportunityTrueFalseNode.Opportunity2Opportunity"}]}),_.assign(Magellan.Models.DecisionNode.OBJECT_TYPE_TO_DRAGGABLE_BRANCH_NODES_CLASS_INFO,{Opportunity:[{dropdownLabel:"Opportunity",dropdownImage:"Opportunity Icon",nodeModel:"Magellan.Models.OpportunityBranchNode"},{dropdownLabel:"Opportunity2Contact",dropdownImage:"Opportunity2Contact Icon",nodeModel:"Magellan.Models.OpportunityBranchNode.Opportunity2Contact"},{dropdownLabel:"Opportunity2Opportunity",dropdownImage:"Opportunity2Opportunity Icon",nodeModel:"Magellan.Models.OpportunityBranchNode.Opportunity2Opportunity"}]}),_.assign(Magellan.Models.RerouteNode.OBJECT_TYPE_TO_DRAGGABLE_REROUTE_NODES_CLASS_INFO,{Opportunity:[{dropdownLabel:"Time-based Rerouting",dropdownImage:"Timebased",nodeModel:"Magellan.Models.OpportunityRerouteNode"}]}),_.assign(Magellan.Models.DecisionNode.OBJECT_TYPE_TO_DRAGGABLE_DECISION_NODES_CLASS_INFO,{Opportunity:[{dropdownLabel:"True/False",dropdownImage:"True/False",nodeModel:"Magellan.Models.OpportunityTrueFalseNode"},{dropdownLabel:"Branch",dropdownImage:"Branch",nodeModel:"Magellan.Models.OpportunityBranchNode"}]}),_.assign(Magellan.Models.MatchNode.OBJECT_TYPE_TO_DRAGGABLE_MATCH_NODES_CLASS_INFO,{Opportunity:[{dropdownLabel:"Opportunity2Contact",dropdownImage:"Opportunity2Contact Icon",nodeModel:"Magellan.Models.OpportunityMatchNode.Opportunity2Contact"},{dropdownLabel:"Opportunity2Opportunity",dropdownImage:"Opportunity2Opportunity Icon",nodeModel:"Magellan.Models.OpportunityMatchNode.Opportunity2Opportunity"}]}),_.assign(Magellan.Models.ActionNode.OBJECT_TYPE_TO_DRAGGABLE_ACTION_NODES_CLASS_INFO,{Opportunity:[{dropdownLabel:"Route to Matched Contact",dropdownImage:"Assign Owner Lead",nodeModel:"Magellan.Models.OpportunityRouteToContact"},{dropdownLabel:"Route to Matched Account",dropdownImage:"Assign Owner Account",nodeModel:"Magellan.Models.OpportunityRouteToAccount"},{dropdownLabel:"Route to Matched Opportunity",dropdownImage:"Assign Owner Opportunity",nodeModel:"Magellan.Models.OpportunityRouteToOpportunity"},{dropdownLabel:"Route to Territory",dropdownImage:"Route To Territory",nodeModel:"Magellan.Models.OpportunityRouteToTerritory"},{dropdownLabel:"Create Opportunity",dropdownImage:"Create Opportunity",nodeModel:"Magellan.Models.OpportunityCreateOpportunity"},{dropdownLabel:"Create Task",dropdownImage:"Create Task",nodeModel:"Magellan.Models.OpportunityCreateTask"},{dropdownLabel:"Assign Owner",dropdownImage:"Explicit Owner Assignment",nodeModel:"Magellan.Models.OpportunityOwnerAssignment"},{dropdownLabel:"Round Robin",dropdownImage:"Round Robin",nodeModel:"Magellan.Models.OpportunityRoundRobin"},{dropdownLabel:"Send Notification",dropdownImage:"Send Notification",nodeModel:"Magellan.Models.OpportunitySendNotification"},{dropdownLabel:"Update Opportunity",dropdownImage:"Update Lead",nodeModel:"Magellan.Models.OpportunityUpdateAction"},{dropdownLabel:"Custom Interface",dropdownImage:"Custom Interface",nodeModel:"Magellan.Models.CustomInterface"}]})};var n=null;Magellan.Controllers.OpportunityRouter.createDeploymentHistoryView=function(e){return n instanceof Magellan.Views.DeploymentHistory&&n.remove(),n=new Magellan.Views.DeploymentHistory({model:e,objectType:"opportunity",localStorageName:"opportunity_tile_order"})},Magellan.Controllers.OpportunityRouter.getNodeFormViewFromNodeModel=function(e){switch(e.nodeInfo.magellanClass){case"Magellan.Models.OpportunityInsertTriggerNode":return Magellan.Views.OpportunityInsertTriggerNode;case"Magellan.Models.OpportunityUpdateTriggerNode":return Magellan.Views.OpportunityUpdateTriggerNode;case"Magellan.Models.OpportunityTrueFalseNode":case"Magellan.Models.OpportunityTrueFalseNode.Opportunity2Contact":case"Magellan.Models.OpportunityTrueFalseNode.Opportunity2Opportunity":return Magellan.Views.OpportunityTrueFalseNode;case"Magellan.Models.OpportunityBranchNode":case"Magellan.Models.OpportunityBranchNode.Opportunity2Contact":case"Magellan.Models.OpportunityBranchNode.Opportunity2Opportunity":return Magellan.Views.OpportunityBranchNode;case"Magellan.Models.OpportunityRerouteNode":return Magellan.Views.OpportunityRerouteNode;case"Magellan.Models.OpportunityMatchNode":case"Magellan.Models.OpportunityMatchNode.Opportunity2Contact":case"Magellan.Models.OpportunityMatchNode.Opportunity2Opportunity":return Magellan.Views.OpportunityMatchNode;case"Magellan.Models.OpportunityRouteToContact":return Magellan.Views.OpportunityRouteToContact;case"Magellan.Models.OpportunityRouteToAccount":return Magellan.Views.OpportunityRouteToAccount;case"Magellan.Models.OpportunityRouteToOpportunity":return Magellan.Views.OpportunityRouteToOpportunity;case"Magellan.Models.OpportunityCreateOpportunity":return Magellan.Views.OpportunityCreateOpportunity;case"Magellan.Models.OpportunityCreateTask":return Magellan.Views.OpportunityCreateTask;case"Magellan.Models.OpportunityOwnerAssignment":return Magellan.Views.OpportunityOwnerAssignment;case"Magellan.Models.OpportunityRoundRobin":return Magellan.Views.OpportunityRoundRobin;case"Magellan.Models.OpportunityRouteToTerritory":return Magellan.Views.OpportunityRouteToTerritory;case"Magellan.Models.OpportunityUpdateAction":return Magellan.Views.OpportunityUpdateAction;case"Magellan.Models.OpportunitySendNotification":return Magellan.Views.OpportunitySendNotification;case"Magellan.Models.CustomInterface":return Magellan.Views.CustomInterface;default:return null}};var a={Opportunity:"Opportunity",O2O:"Opportunity",O2C:"Contact"};Magellan.Controllers.OpportunityRouter.getObjectNameFromHatType=function(e){return a[e]||LeanData__PrimarySObjectType},e.exports=Magellan.Controllers.OpportunityRouter},function(e,t,i){e.exports=function(e){var t=i(213)();new(i(214)())({model:new t({data:e})}).setElement($(".dg_inner-wrapper")).render()}},function(e,t,i){e.exports=function(){var e=i(217)(),t=new(i(218)())({model:new e({memberId:Magellan.Navigation.selectedRoundRobinMemberId,tab:Magellan.Navigation.selectedRoundRobinMemberTab})});$(".dg_inner-wrapper").html(t.$el)}},function(e,t,i){e.exports=function(){var e=i(219)();new(i(220)())({model:new e({})}).setElement($(".dg_inner-wrapper")).render()}},function(e,t,i){e.exports=function(e){if(_.each(e.filteredUserList,function(e){"Queue"===e.Type&&(e.IsActive=!0,e.type="Queue")}),!0===e.existing&&_.isUndefined(e.pool))return Magellan.Navigation.navigate("round_robin_pools"),void(e.waitingScreen&&e.waitingScreen.resolve());i(4)(),i(224)(),Magellan.Views.RoundRobinSchedulesHoursCreator=i(3)(),Magellan.Views.RoundRobinPoolsCreatorTabs={},Magellan.Views.RoundRobinPoolsCreatorTabs.Info=i(222)(),i(223)(),i(221)(),Magellan.Views.RoundRobinPoolsCreator=i(225)();var t=new Magellan.Views.RoundRobinPoolsCreator(e);window.rrpoolview=t,j$(".dg_inner-wrapper").html(""),j$(".dg_inner-wrapper").html(t.render().$el)}},function(e,t,i){e.exports=function(e){i(226)(),Magellan.Views.RoundRobinPools=i(227)(),new Magellan.Views.RoundRobinPools(e).setElement(j$(".dg_inner-wrapper")).render()}},function(e,t,i){e.exports=function(){i(235)(),i(4)(),i(229)(),i(233)(),Magellan.Views.RoundRobinSchedulesHours=i(231)(),Magellan.Views.RoundRobinSchedulesHolidays=i(230)(),Magellan.Views.RoundRobinSchedulesVacations=i(234)(),Magellan.Views.RoundRobinSchedulesHoursCreator=i(3)(),Magellan.Views.RoundRobinSchedulesHolidaysCreator=i(228)(),Magellan.Views.RoundRobinSchedulesVacationsCreator=i(232)(),Magellan.Views.RoundRobinSchedules=i(236)();var e=Magellan.Controllers.GUI.appWaitingScreen.show("Loading Data..."),t=Magellan.Services.FlowBuilder.getRoundRobinScheduleSettings(),n=Magellan.Services.FlowBuilder.getRoundRobinPoolSettings();$.when(t,n).done(function(e,t){Magellan.Models.roundRobinSchedulesData=new Magellan.Models.RoundRobinSchedulesData({},{data:e[0],poolsData:t[0]}),(new Magellan.Views.RoundRobinSchedules).setElement(j$(".dg_inner-wrapper")).render()}).always(function(){e.resolve()})}},function(e,t,i){e.exports=function(e){i(237)(),i(238)();var t=new Magellan.Views.TerritorySegmentAssignments;j$(".dg_inner-wrapper").html(t.$el)}},function(e,t,i){e.exports=function(e){i(5)(),i(239)();var t=new Magellan.Views.TerritorySegmentEditor;j$(".dg_inner-wrapper").html(t.$el)}},function(e,t,i){e.exports=function(){i(5)(),i(240)(),Magellan.Views.TerritorySegments=i(241)();var e=new Magellan.Views.TerritorySegments;j$(".dg_inner-wrapper").html(""),j$(".dg_inner-wrapper").html(e.$el)}},function(e,t){e.exports=function(){var e=window.Magellan=window.Magellan||{};e.External=e.External||{},e.External.Joint=e.External.Joint||{},e.External.Joint.Graph=joint.dia.Graph.extend({flattenedGraph:function(){if(!_.isUndefined(e.Models.Node)&&!_.isNull(e.Models.Node)){var t=_.filter(this.getElements(),function(t){return t instanceof e.Models.Node});return _.map(t,function(e){return[e.nodeInfo,e.position()]})}console.error("flattenedGraph requires Magellan.Models.Node to be defined")}})}},function(e,t){e.exports=function(){window.assembleGraph=function(e){if(""!==e){var t;allNodes=[];var i,n=JSON.parse(e);n=Magellan.Migration.migrateGraphJSON(n),t=Magellan.Controllers.GUI.assembleGraphFromJSON(n),Magellan.Controllers.GUI.bindButtons(),i=chosenGraphIdMap.contact?chosenGraphIdMap.contact:chosenGraphIdMap.lead?chosenGraphIdMap.lead:chosenGraphIdMap.account?chosenGraphIdMap.account:chosenGraphIdMap.opportunity?chosenGraphIdMap.opportunity:null;var a=getLastPaperPosition(i);a?(paperScroller.scroll(a.x,a.y),setZoomLevel(a.zoom)):null!==t&&_.defer(function(){var e=paperScroller.getVisibleArea(),i=t[0]+54,n=t[1]+e.height/2-100;paperScroller.scroll(i,n)})}else setTriggerNodesOnGraph()},window.setZoomLevel=function(e){e>2||e<.25?console.log("zoomLevel should be between 0.25 and 2"):(paperScroller.zoom(e,{absolute:!0}),_.defer(function(){$(".zoom-status-text").text(Math.round(100*e)),$("#zoom-slider-input").val(Math.round(500*(100*e-25)/175))}))},window.saveTaggingSettings=function(e){Magellan.Services.FlowBuilder.saveTaggingSettings(e).then(function(e){$("#save-tagging-settings-modal").modal("show")})},window.upsertLastPaperPosition=function(e,t,i){null===localStorage.getItem("last_paper_positions")&&localStorage.setItem("last_paper_positions","{}");var n=JSON.parse(localStorage.getItem("last_paper_positions")),a={x:t.x+t.width/2,y:t.y+t.height/2,zoom:i.sx};n[e]=a,localStorage.setItem("last_paper_positions",JSON.stringify(n))},window.getLastPaperPosition=function(e){return e&&(t=localStorage.getItem("last_paper_positions"))&&(i=JSON.parse(t))&&i[e]?i[e]:null;var t,i},window.toggleTaggingSettingsSwitch=function(){taggingResources["enabled continuous tagging"]=!taggingResources["enabled continuous tagging"];var e=taggingResources["enabled continuous tagging"]?1:0;renderTaggingSettingsSwitch(e),saveTaggingSettingsSwitch(e)},window.saveTaggingSettingsSwitch=function(e){var t=Magellan.Services.FlowBuilder.saveTaggingSettingsSwitch(e).then(function(e,i){i.status?t.resolve():t.reject(i.message)});return t},window.deployGraph=function(e){var t=Magellan.Services.FlowBuilder.deployGraph(chosenGraphIdMap[e]),i=$.Deferred();return t.then(function(t,n){if(n.status){console.log(t);var a=JSON.parse(t);a["is valid"]?(liveGraphIdMap[e]=chosenGraphIdMap[e],currentDeploymentIdMap[e]=a["deployment id"],$("#graph-deploy-success-modal").modal("show"),i.resolve()):($("#graph-deploy-failure-modal").modal("show"),i.reject(a.error))}else $("#graph-deploy-failure-modal").modal("show"),i.reject()}),i},window.displayVerboseErrorModal=function(e,t){var i="",n={nodesWithMissingMatchTypes:"Nodes missing required Match Node",nodesFailingIsValid:"Nodes with Invalid Configurations",nodesWithDanglingEdges:"Nodes with Edges pointing to None",danglingNodes:"Nodes not incorporated into graph",nodesWithInvalidTemplates:"Invalid email templates",setOfNodeCycles:"Nodes form a cycle"};_.each(e,function(e,t){if(0!==e.length)if("setOfNodeCycles"!==t){var a=_.map(e,function(e){var t=e.nodeInfo.type;return"UPDATE TRIGGER"===t&&(t="TRIGGER"),"<li class='list-style-"+t+"'>"+_.escape(e.nodeInfo.name)+"</li>"});i+="<span style='font-weight: 500;'>"+n[t]+"</span>",i+="<ul style='padding-left: 20px;'>"+a.join("")+"</ul><br/>"}else i+="<span style='font-weight: 500;'>"+n[t]+"</span><br/>"}),""!==i&&(void 0!==t&&null!==t?($("#import-graph-success-modal-text").html('<div>Your flow <span style="font-style:italic;font-weight:500;">'+t+'</span> has been successfully imported.</div><div class="validation-errors-modal-icon" style="margin-top:10px;"></div><div style="margin-top:5px; color:#d91e18">The following validation errors were detected and must be fixed prior to taking this flow live.</div><div style="margin-top:20px;margin-bottom:-40px;max-height:300px;overflow:auto">'+i+"</div>"),requestModalResponse("import-graph-success")):($("#validation-errors-modal-text").html('<div style="margin-top:5px; color:#d91e18">The following validation errors were detected and must be fixed prior to taking this flow live.</div><div style="margin-top:20px;margin-bottom:-40px;max-height:300px;overflow:auto">'+i+"</div>"),requestModalResponse("validation-errors")))},window.refreshFlowCharts=function(){var e;"main-contact"==magellanPage||"deploymentMetrics-contact"==magellanPage?e="Contact":"main"===magellanPage||"deploymentMetrics-lead"===magellanPage?e="Lead":"main-account"===magellanPage||"deploymentMetrics-account"===magellanPage?e="Account":"main-opportunity"!==magellanPage&&"deploymentMetrics-opportunity"!==magellanPage||(e="Opportunity");var t=Magellan.Controllers.GUI.appWaitingScreen.show("Refreshing Data...");Magellan.Services.FlowBuilder.getRoutingGraphs(e).then(function(t,i){graphImages=t,loadGraphsMenu(e)}).always(function(){t.resolve()})},window.getTaggingResponse=function(e){var t=Magellan.Services.FlowBuilder.getTaggingResponse(e);return t.then(function(e,i){i.status?t.resolve(e):(console.log("Error Message: "+i.message),t.reject(i.message))}),t},window.requestModalResponse=function(e,t){var i=$.Deferred(),n="#"+e+"-button-1",a="#"+e+"-button-2",o="#"+e+"-modal";return $(n+", "+a).off(),$(n).on("click",function(){i.reject()}),$(a).on("click",function(){var e={};_.each(t,function(t){e[t]=_.map($(t),function(e){return $(e).val()})}),i.resolve(e)}),$(o).on("hidden.bs.modal",function(e){i.reject()}),$(o).modal("show"),i}}},function(e,t){e.exports=function(){var e=window.Magellan=window.Magellan||{};e.Controllers=e.Controllers||{};const t={},i={};var n=JSON.parse(window.localStorage.getItem("field_metadata_map"))||{},a=JSON.parse(window.localStorage.getItem("flattened_field_metadata"))||{},o=JSON.parse(window.localStorage.getItem("flattened_field_metadata_map"))||{},l=JSON.parse(window.localStorage.getItem("optima_field_metadata"))||{},s=JSON.parse(window.localStorage.getItem("optima_field_metadata_map"))||{},r={},d={},c=JSON.parse(window.localStorage.getItem("object_type_to_fields_metadata_map"))||{},u=JSON.parse(window.localStorage.getItem("custom_user_field_metadata_map"))||{},p={},h=[],g={},m=null,f={},v=[],y={};const b=new Set(["deploymentHistory","deploymentMetrics-lead","deploymentHistory-contact","deploymentMetrics-contact","deploymentHistory-account","deploymentMetrics-account","deploymentHistory-opportunity","deploymentMetrics-opportunity"]);e.Services.FlowBuilder.getOpportunityStageOptions().then(function(e){h=_.map(e,function(e){return e.label=e.MasterLabel,e})}),e.Controllers.FlowBuilder={getFieldsMetaData:function(){var t=e.Services.FlowBuilder.getFieldsMetaData(["Lead","Contact","Opportunity","Account","Task"],4),i=e.Services.FlowBuilder.getTaskFieldValues();return $.when(t,i).then(function(t,i,p){var h=_.mapValues(t[0],function(e,t){var i={};return _.forEach(e,function(e,t){e.parent&&e.parent.length>0&&"REFERENCE"===e.type&&(e.label=e.label.replace(" ID","")),i[e.label]=!_.isUndefined(i[e.label])}),e=_.sortBy(e,function(e){return i[e.label]&&(e.label=e.label+" ("+e.name+")"),"id"===e.name?"      "+e.label:e.label})});h["Group/User"]=[{label:"ID",name:"id",type:"ID",parent:[]}],_.findLast(h.Lead,function(e){return"ownerid"===e.name}).parent.unshift("Group/User"),fieldMetaData=h,function(t){e.Validation._fieldValidationCache={},n=e.Util.unset(n)||{},a=e.Util.unset(a)||{},l=e.Util.unset(l)||{},s=e.Util.unset(s)||{},r=e.Util.unset(r)||{},d=e.Util.unset(d)||{},_.each(t,function(t,i){n[i]={},a[i]=[],o[i]={},s[i]={},r[i]=[],d[i]={},c[i]={},u[i]=[],"Account"===i?(l[i]=_.cloneDeep(e.Migration.OPTIMA_FIELDS),_.each(l[i],function(e){e.objectType=i,s[i][e.name]=e})):"Opportunity"===i?(l[i]=[{name:"account",label:"Account ID",parent:["Account"],type:"REFERENCE"}],s[i].account={name:"account",label:"Account ID",parent:["Account"],type:"REFERENCE"}):l[i]=[],"Lead"===i?(d[i].ld__matched_account={name:"ld__matched_account",label:"Matched Account",parent:["Account"],type:"REFERENCE"},d[i].ld__matched_opportunity={name:"ld__matched_opportunity",label:"Matched Opportunity",parent:["Opportunity"],type:"REFERENCE"},r[i]=[{name:"ld__matched_account",label:"Matched Account",parent:["Account"],type:"REFERENCE"},{name:"ld__matched_opportunity",label:"Matched Opportunity",parent:["Opportunity"],type:"REFERENCE"}]):"Contact"===i?(d[i].ld__matched_opportunity={name:"ld__matched_opportunity",label:"Matched Opportunity",parent:["Opportunity"],type:"REFERENCE"},r[i]=[{name:"ld__matched_opportunity",label:"Matched Opportunity",parent:["Opportunity"],type:"REFERENCE"}]):"Account"===i&&(d[i].ld__matched_opportunity={name:"ld__matched_opportunity",label:"Matched Opportunity",parent:["Opportunity"],type:"REFERENCE"},r[i]=[{name:"ld__matched_opportunity",label:"Matched Opportunity",parent:["Opportunity"],type:"REFERENCE"}]),_.each(t,function(t){t.objectType=i,n[i].hasOwnProperty(t.name)&&console.warn("Duplicate field names for the same object?"),n[i][t.name]=t;var p=e.Util.flattenField(t);a[i].push(p),o[i][t.name]=p;var h=e.Validation.SFDC_TYPE_TO_GROUPING[t.type]||t.type;if({Number:!0,Date:!0,Datetime:!0,LD_OPTIMA:!0}.hasOwnProperty(h)){var g=_.cloneDeep(t);delete g.parent,l[i].push(g),s[i][g.name]=g}if(r[i].push(t),d[i][t.name]=t,"REFERENCE"===t.type&&_.contains(t.parent,"User")){var m=_.cloneDeep(t);m.label=e.Util.flattenReferenceLabels(m.label)+".ID",m.name=e.Util.flattenReferenceAPIs(m.name)+".id",m.type="ID",u[i].push(m)}"REFERENCE"==h&&(h="Id"),c[i].hasOwnProperty(h)||(c[i][h]=[]),c[i][h].push(t)}),a[i]=e.Util.createFlattenedFields(t)})}(fieldMetaData),e.Controllers.FlowBuilder.initObjectContextMetaData(),taskFieldValues=i[0];try{window.localStorage.setItem("field_metadata",JSON.stringify(fieldMetaData)),window.localStorage.setItem("field_metadata_map",JSON.stringify(n)),window.localStorage.setItem("flattened_field_metadata",JSON.stringify(a)),window.localStorage.setItem("flattened_field_metadata_map",JSON.stringify(o)),window.localStorage.setItem("optima_field_metadata",JSON.stringify(l)),window.localStorage.setItem("optima_field_metadata_map",JSON.stringify(s)),window.localStorage.setItem("object_type_to_fields_metadata_map",JSON.stringify(c)),window.localStorage.setItem("custom_user_field_metadata_map",JSON.stringify(u))}catch(e){console.warn(e)}})},searchSObject:function(e,t,i,n,a){var o=$.Deferred(),l={};if(n=n||{},a){var s=[];if(_.each(i,function(e){n.hasOwnProperty(e)&&(null!==n[e]&&(l[e]=n[e]),s.push(e))}),s.length===i.length)return o.resolve(Object.values(l))}return e(t||null,i||null).then(function(e){_.each(e,e=>{l[e.Id]=n[e.Id]=e}),_.each(i,e=>{l.hasOwnProperty(e)||(n[e]=null)}),o.resolve(Object.values(l))}),o},searchOwners:function(t,i,n,a){var o=$.Deferred(),l=[];return $.when(e.Controllers.FlowBuilder.searchUsers(t,i,a).then(function(e){l.push(...e)}),n?$.Deferred().resolve():e.Controllers.FlowBuilder.searchGroups(t,i,a).then(function(e){l.push(...e)})).then(function(){o.resolve(l)}),o},searchUsers:function(i,n,a){var o=t.searchUsers=t.searchUsers||{};return e.Controllers.FlowBuilder.searchSObject(e.Services.FlowBuilder.searchUsers,i,n,o,a).then(function(e){return _.each(e,e=>e.label=e.name=e.Name)})},searchGroups:function(i,n,a){var o=t.searchGroups=t.searchGroups||{};return e.Controllers.FlowBuilder.searchSObject(e.Services.FlowBuilder.searchGroups,i,n,o,a).then(function(e){return _.each(e,e=>e.label=e.name=e.Name)})},searchEmailTemplates:function(i,n,a){var o=t.searchEmailTemplates=t.searchEmailTemplates||{};return e.Controllers.FlowBuilder.searchSObject(e.Services.FlowBuilder.queryEmailTemplates,i,n,o,a).then(function(e){return _.each(e,e=>e.label=e.name=e.Name)})},getActionNodeMetaData:function(){var t=e.Services.FlowBuilder.getActionNodeMetaData();return t.then(function(e,i){if(i.status){e.convertedLeadStatuses.unshift({MasterLabel:"< Current Lead Status >"}),actionNodeMetaData=e;try{window.localStorage.setItem("action_node_metadata",JSON.stringify(e))}catch(e){console.warn(e)}t.resolve()}else"exception"===i.type?(console.log("Exception thrown: "+i.message),console.log("Apex stack trace: "+i.where),t.reject()):(console.log("Something happened: "+i.message),console.log("Apex stack trace: "+i.where),t.reject())}),t},getCachedPicklistValues:function(e){return p[e]},getAssignmentRules:e=>_.filter(actionNodeMetaData.assignmentRules,function(t){return t.SobjectType===e}),getAssignmentRulesIdMap:function(t){return f[t]||(f[t]=_.mapKeys(e.Controllers.FlowBuilder.getAssignmentRules(t),function(e){return e.Id})),f[t]},getPicklistFields:function(t,i){var n=e.Services.FlowBuilder.getPicklistFields(t,i);return n.then(function(e,a){a.status?(null!=i&&""!=i&&(p[t+i]=e),n.resolve()):"exception"===a.type?(console.log("Exception thrown: "+a.message),console.log("Apex stack trace: "+a.where),n.reject()):(console.log("Something happened: "+a.message),console.log("Apex stack trace: "+a.where),n.reject())}),n},queryEmailTemplates:function(i,n,a){var o=$.Deferred();_.isEmpty(t.queryEmailTemplates)&&(t.queryEmailTemplates={});var l=[];if(a){var s=new Set(n||null);if(s.forEach(function(e){_.isEmpty(t.queryEmailTemplates[e])||(l.push(t.queryEmailTemplates[e]),s.delete(e))}),0===s.size)return o.resolve(l);n=Array.from(s)}return e.Services.FlowBuilder.queryEmailTemplates(i||"",n||[]).then(function(e,i){i.status?(_.each(e,function(e){e.label=e.Name,e.name=e.Name,t.queryEmailTemplates[e.Id]=e}),o.resolve(l.concat(e))):"exception"===i.type?(console.log("Exception thrown: "+i.message),console.log("Apex stack trace: "+i.where),o.reject()):(console.log("Something happened: "+i.message),console.log("Apex stack trace: "+i.where),o.reject())}),o},getEmailTemplateName:function(t){var i=e.Services.FlowBuilder.getEmailTemplateName(t);return i.then(function(e,t){i.resolve()}).fail(function(e,t){"exception"===t.type?(console.log("Exception thrown: "+t.message),console.log("Apex stack trace: "+t.where),i.reject()):(console.log("Something happened: "+t.message),console.log("Apex stack trace: "+t.where),i.reject())}),i},getEmailTemplateStatuses:function(t){if(actionNodeMetaData.emailTemplateStatuses=actionNodeMetaData.emailTemplateStatuses||{},!_.isEmpty(t)&&_.some(t,function(e){return!actionNodeMetaData.emailTemplateStatuses.hasOwnProperty(e)})){var i=e.Services.FlowBuilder.getEmailTemplateStatuses(t.join(","));return i.then(function(e,t){_.assign(actionNodeMetaData.emailTemplateStatuses,e)}),i}return $.Deferred().resolve(actionNodeMetaData.emailTemplateStatuses)},getPartnerAuthorizations:function(){const t=$.Deferred();return e.Services.FlowBuilder.getPartnerAuthorizations().then(e=>{console.log("partnerAuthorizationsJSON",e),partnerAuthorizations={},JSON.parse(e).forEach(e=>{partnerAuthorizations[e.Name]=e[actionNodeMetaData.namespace+"Authorized__c"]}),window.localStorage.setItem("partner_authorizations",JSON.stringify(partnerAuthorizations)),t.resolve()}),t},getMetaData:function(){var e=$.Deferred();return $.when(this.getFieldsMetaData(),this.getActionNodeMetaData()).then(function(){e.resolve()}),_.isEmpty(actionNodeMetaData)||_.isEmpty(fieldMetaData)||_.isEmpty(n)||_.isEmpty(a)||_.isEmpty(o)||_.isEmpty(l)||_.isEmpty(s)||_.isEmpty(c)||_.isEmpty(u)||e.resolve(),e},getAllGraphNames:function(){return _.isUndefined(graphImages)?[]:graphImages.map(function(e){return e.name})},getAllGraphIds:function(){return _.isUndefined(graphImages)?[]:graphImages.map(function(e){return e.id})},graphNameExists:function(e,t){if(_.isUndefined(graphImages))return!1;var i=e.trim().toLowerCase();return graphImages.some(function(e){return e.name.trim().toLowerCase()===i&&e.id!==t})},getFieldMetaDataMap:function(){return n},getFlattenedFieldsByObject:function(e){return a[e]},getFlattenedFieldsMapByObject:function(e){return o[e]},getOptimaFieldMetaData:function(){return l},getOptimaFieldMetaDataMap:function(){return s},getTerritoryFieldMetaData:function(){return r},getTerritoryFieldMetaDataMap:function(){return d},getFieldsByObjectType:function(e,t){return c[e][t]},getFlattenedFieldsByObjectType:function(t,i){return e.Util.createFlattenedFields(c[t][i])},getFlattenedWriteFields:function(){return LeanData__PrimarySObjectType in g||(g[LeanData__PrimarySObjectType]=_.filter(e.Controllers.FlowBuilder.getFlattenedFieldsByObject(LeanData__PrimarySObjectType),function(e){return e.isUpdateable&&("STRING"===e.type||"PICKLIST"===e.type||"TEXTAREA"===e.type)})),g},getStandardMappingFields:function(){return v},getCustomUserFieldsByObject:function(e){return u[e]},getOwnerMappingGroups:function(){return actionNodeMetaData.ownerMaps},getAccountTeamRules:function(){return actionNodeMetaData.accountTeamRules},getOpportunityStages:function(){return h},fetchGraphsByIds:function(t){_.isString(t)&&(t=t.split(","));var i=$.Deferred();_.isEmpty(m)&&(m={});var n=[],a={};return _.each(t,function(t){var i=e.Services.FlowBuilder.retrieveGraph(t).then(function(e){var t=m[e.id];t&&e.graphJSON===t.graphJSON&&e.name==e.name?t.updatedFromServer=!1:(e.retrievedAt=Date.now(),e.updatedFromServer=!0,m[e.id]=e),a[e.id]=m[e.id]});n.push(i)}),$.when.apply($,n).always(function(){i.resolve(a)}),i},getTaskFieldValues:function(i){var n=$.Deferred();return _.isEmpty(t.taskFieldValues)&&(t.taskFieldValues={}),i&&!_.isEmpty(t.taskFieldValues)?n.resolve(t.taskFieldValues):(e.Services.FlowBuilder.getTaskFieldValues().then(function(e,i){t.taskFieldValues=e,n.resolve(e)}),n)},getUsageMetricsRoutingListOnDate:function(t){const i=e.Services.Admin.getUsageMetricsRoutingListOnDate(t);return i.then(function(e,t){t.status?i.resolve():"exception"===t.type?(console.log("Exception thrown: "+t.message),console.log("Apex stack trace: "+t.where),i.reject()):(console.log("Something happened: "+t.message),console.log("Apex stack trace: "+t.where),i.reject())}),i},getUsageMetricsRoutingList:function(t,i){const n=e.Services.Admin.getUsageMetricsRoutingList(t,i);return n.then(function(e,t){t.status?n.resolve():"exception"===t.type?(console.log("Exception thrown: "+t.message),console.log("Apex stack trace: "+t.where),n.reject()):(console.log("Something happened: "+t.message),console.log("Apex stack trace: "+t.where),n.reject())}),n},getRoutingUsageMetricsAndLicenseCount:function(t,i){const n=e.Services.Admin.getRoutingUsageMetricsAndLicenseCount(t,i);return n.then(function(e,t){t.status?n.resolve():"exception"===t.type?(console.log("Exception thrown: "+t.message),console.log("Apex stack trace: "+t.where),n.reject()):(console.log("Something happened: "+t.message),console.log("Apex stack trace: "+t.where),n.reject())}),n},getAllOwnerDataRemote:function(t,i){var n=$.Deferred();return e.Services.FlowBuilder.getAllOwnerDataRemote(t||"",i||!0).then(function(e,t){if(t.status){var i=JSON.parse(e.owners);_.each(i,function(e){e.label=e[ns+"Grouping_Name__c"]||e.Name,e.name=e.Name}),n.resolve(i)}}),n},getAllOwnerDataActiveOnlyRemote:function(t,i){var n=$.Deferred();return e.Services.FlowBuilder.getAllOwnerDataRemote(t||"",i||!0).then(function(e,t){if(t.status){var i=JSON.parse(e.owners);_.each(i,function(e){(e.IsActive||e[ns+"Grouping_Name__c"]||"00G"===e.Id.substring(0,3))&&(e.label=e[ns+"Grouping_Name__c"]||e.Name,e.name=e.Name)}),n.resolve(i)}}),n},outreach_validateOutreachSequence:function(t){return partnerAuthorizations.outreach&&e.Controllers.FlowBuilder.partnerObjectExists("outreach","sequences",t,e.Services.FlowBuilder.outreach_getSequencesForValidation)},salesloft_validateSalesloftCadence:function(t){return partnerAuthorizations.salesloft&&e.Controllers.FlowBuilder.partnerObjectExists("salesloft","cadences",t,e.Services.FlowBuilder.salesloft_getCadencesForValidation)},outreach_validateOutreachUser:function(t){return partnerAuthorizations.outreach&&e.Controllers.FlowBuilder.partnerObjectExists("outreach","users",t,e.Services.FlowBuilder.outreach_getUsersForValidation)},salesloft_validateSalesloftUser:function(t){return partnerAuthorizations.salesloft&&e.Controllers.FlowBuilder.partnerObjectExists("salesloft","users",t,e.Services.FlowBuilder.salesloft_getUsersForValidation,"email")},partnerObjectExists:function(e,n,a,o,l="id"){if(!partnerAuthorizations[e])return $.Deferred(e=>e.resolve(!1));let s;const r=`${e}_${n}`;return(s=t.hasOwnProperty(r)||i.hasOwnProperty(r)?i.hasOwnProperty(r)?i[r]:$.Deferred(e=>e.resolve(t[r])):i[r]=o().then(e=>JSON.parse(e)).then(function(e){return e instanceof Array&&(e=e.reduce((e,t)=>(e[t[l]]=t,e),{})),t[r]=e,delete i[r],t[r]})).then(e=>{try{return e.hasOwnProperty(a[l])}catch(e){}return!1})},resetMetadataCache:function(e){t.hasOwnProperty(e)&&delete t[e]},outreach_refreshSequencesData:function(){return e.Services.FlowBuilder.outreach_refreshSequencesData()},salesloft_refreshCadencesData:function(){return e.Services.FlowBuilder.salesloft_refreshCadencesData()},outreach_refreshedUsersData:!1,outreach_refreshUsersData:function(t=!1){return t||!e.Controllers.FlowBuilder.outreach_refreshedUsersData?e.Services.FlowBuilder.outreach_refreshUsersData().then(()=>{e.Controllers.FlowBuilder.outreach_refreshedUsersData=!0}):$.Deferred(e=>e.resolve())},salesloft_refreshUsersData:function(){return e.Services.FlowBuilder.salesloft_refreshUsersData()},outreach_getSequencesForTypeahead:function(i){let n=!Object.keys(t).includes("outreachSequencesRefreshed");return t.outreachSequencesRefreshed=!0,e.Services.FlowBuilder.outreach_getSequencesForTypeahead(n).then(t=>e.Util.filterTypeaheadResults(JSON.parse(t),i))},salesloft_getCadencesForTypeahead:function(i){void 0===i&&(i="");let n=!Object.keys(t).includes("salesloftCadencesRefreshed");return t.salesloftCadencesRefreshed=!0,e.Services.FlowBuilder.salesloft_getCadencesForTypeahead(n).then(t=>e.Util.filterTypeaheadResults(JSON.parse(t),i))},outreach_getUsersForTypeahead:function(i){void 0===i&&(i="");let n=!Object.keys(t).includes("outreachUsersRefreshed");return t.outreachUsersRefreshed=!0,e.Services.FlowBuilder.outreach_getUsersForTypeahead(n).then(t=>e.Util.filterTypeaheadResults(JSON.parse(t),i))},salesloft_getUsersForTypeahead:function(i){void 0===i&&(i="");let n=!Object.keys(t).includes("salesloftUsersRefreshed");return t.salesloftUsersRefreshed=!0,e.Services.FlowBuilder.salesloft_getUsersForTypeahead(n).then(t=>e.Util.filterTypeaheadResults(Object.values(JSON.parse(t)),i))},initObjectContextMetaData:function(){fieldMetaData.Object=[];var e=["Lead","Contact","Account","Opportunity"];_.each(["Routed","Matched","Created"],function(t){_.each(e,function(e){var i=t+"_"+e,n={isUnique:!1,isUpdateable:!1,label:t+" "+e,name:t.toLowerCase()+" "+e.toLowerCase(),objectType:e,parent:[i],type:"REFERENCE",contextType:t};fieldMetaData[i]=fieldMetaData[e],fieldMetaData.Object.push(n),y[t+" "+e]={label:t+" "+e,value:t.toLowerCase(),objectType:e}})})},isEditMode:function(){return!b.has(magellanPage)},getObjectContextDropdownOptions:function(e,t,i){var n=[];return n.push(y["Routed "+e]),_.each(t,function(e){y["Matched "+e]&&n.push(y["Matched "+e])}),_.each(i,function(e){y["Created "+e]&&n.push(y["Created "+e])}),n},savePartnerIntegrationConfiguration:function(t,i,n){return e.Services.Admin.savePartnerIntegrationConfiguration(t,i,n)},disablePartnerAuthorization:function(t){return e.Services.Admin.disablePartnerAuthorization(t)},retrievePartnerAppsMetaData:function(){return e.Services.Admin.retrievePartnerAppsMetaData()}}}},function(e,t,i){e.exports=function initializeMagellanController(){"undefined"==typeof Magellan&&(Magellan={});var e={},t={};void 0===Magellan.Controllers&&(Magellan.Controllers={}),Magellan.Controllers.GUI=Magellan.Controllers.GUI||{},Magellan.Controllers.GUI.clickX=null,Magellan.Controllers.GUI.clickY=null,Magellan.Controllers.GUI.selectedModel=null,Magellan.Controllers.GUI.clipboardModel=null,Magellan.Controllers.GUI.nodeWithIcons=null,Magellan.Controllers.GUI.nextLink=null,Magellan.Controllers.GUI.paramsJSONToCachedStats={},Magellan.Controllers.GUI.graphCellsToAdd=[],$(".node-inspector").on("paste",function(e){e.preventDefault();var t=e.originalEvent.clipboardData.getData("text");document.execCommand("insertHTML",!1,t)});var n,a,o={markup:'<g><text class="dummy-text-box"><tspan class="dummy-tspan"/></text></g>',position:{x:0,y:0},attrs:{"text.dummy-text-box":{fill:"#555555","font-family":"Open Sans","font-size":"10px","font-weight":"400",opacity:"0"}}};Magellan.Controllers.GUI._triggerAddGraphCells=_.debounce(function(){new Date,graph.addCells(Magellan.Controllers.GUI.graphCellsToAdd),Magellan.Controllers.GUI.graphCellsToAdd=[],new Date},100),Magellan.Controllers.GUI.addGraphCells=function(e){(_.isUndefined(window.graph)||_.isNull(window.graph))&&console.error("Trying to add graph cells but window.graph is undefined or null"),Magellan.Controllers.GUI.graphCellsToAdd=Magellan.Controllers.GUI.graphCellsToAdd.concat(e),Magellan.Controllers.GUI._triggerAddGraphCells()},Magellan.Controllers.GUI.graphHasChanged=function(){return Magellan.Controllers.GUI.startingGraph!=JSON.stringify(graph.flattenedGraph())},Magellan.Controllers.GUI.assembleGraphFromJSON=function(e){new joint.shapes.basic.Generic(o).addTo(graph);var t=[];_.each(e.businessLogic,function(e){var i=e[0],n=e[1];"TRIGGER"===i.type&&(newX=n.x,newY=n.y);var a=new(Magellan.Models.getObjectByName(i.magellanClass))({position:n,nodeInfo:i});t.push(a)}),graph.addCells(t);for(var i=[],n=0;n<t.length;n++)t[n].refreshLinkHandler(),Array.prototype.push.apply(i,t[n].linkHandler.getAllLinks());return graph.addCells(i),Magellan.Controllers.GUI.startingGraph=JSON.stringify(graph.flattenedGraph()),magellanPage&&magellanPage.indexOf("deployment"),[newX,newY]},Magellan.Controllers.GUI.ctrlMousedownData={hasMousedownedOnSelectedNode:!1,mousedownY:null,mousedownX:null},Magellan.Controllers.GUI.handleCtrlMouseup=function(e){Magellan.Controllers.GUI.ctrlMousedownData.hasMousedownedOnSelectedNode&&Magellan.Controllers.GUI.ctrlMousedownData.mousedownX===e.clientX&&Magellan.Controllers.GUI.ctrlMousedownData.mousedownY===e.clientY&&(Magellan.Controllers.GUI.ctrlMousedownData.hasMousedownedOnSelectedNode=!1,selection.collection.remove(Magellan.Controllers.GUI.ctrlMousedownData.targetModel),Magellan.Controllers.GUI.ctrlMousedownData.targetModel===Magellan.Controllers.GUI.selectedModel&&(Magellan.Controllers.GUI.selectedModel=null))},Magellan.Controllers.GUI.handleCtrlMousedown=function(e){var t=$(e.target).closest(".cell").attr("model-id"),i=graph.getCell(t);Magellan.Controllers.GUI.clickX=e.pageX,Magellan.Controllers.GUI.clickY=e.pageY,Magellan.Controllers.GUI.selectedModel&&"defaultMagellanLink"===Magellan.Controllers.GUI.selectedModel.attributes.type&&Magellan.Controllers.GUI.selectedModel.defaultPresentation(),(e.metaKey||e.ctrlKey||e.shiftKey)&&(selection.collection.contains(i)?(Magellan.Controllers.GUI.ctrlMousedownData.hasMousedownedOnSelectedNode=!0,Magellan.Controllers.GUI.ctrlMousedownData.targetModel=i,Magellan.Controllers.GUI.ctrlMousedownData.mousedownX=e.clientX,Magellan.Controllers.GUI.ctrlMousedownData.mousedownY=e.clientY):(0===selection.collection.length&&i&&Magellan.Controllers.GUI.selectedModel&&"defaultMagellanLink"!==Magellan.Controllers.GUI.selectedModel.attributes.type&&selection.collection.add(Magellan.Controllers.GUI.selectedModel),i&&"defaultMagellanLink"!==i.attributes.type&&selection.collection.add(i))),selection.collection.contains(i)?selection.onSelectionBoxPointerDown(e):selection.collection.reset([])},Magellan.Controllers.GUI.resyncSelectionAndPresentation=function(){_.each(graph.getCells(),function(e){var t=paper.findViewByModel(e).el;selection.collection.contains(e)&&"defaultMagellanLink"!==e.attributes.type?t.classList.add("selected"):t.classList.remove("selected")})},Magellan.Controllers.GUI.clickAction=function(e){$("#html-multiple-links-menu").hide(),$("#html-edge-menu").hide(),Magellan.Controllers.GUI.activeView&&Magellan.Controllers.GUI.activeView.remove(),Magellan.Controllers.GUI.activeView=null;var t=graph.getCell($(this).closest(".element, .type-defaultmagellanlink").attr("model-id"));if(Magellan.Controllers.GUI.changeNodeWithIcons(t),!e||e.pageX===Magellan.Controllers.GUI.clickX&&e.pageY===Magellan.Controllers.GUI.clickY){var i=this&&this.classList&&this.classList.contains("function-menu");if(Magellan.Controllers.GUI.unselectAllStatBox(),!Magellan.Controllers.GUI.selectedModel||i||selection.collection.contains(Magellan.Controllers.GUI.selectedModel)||(Magellan.Controllers.GUI.selectedModel.defaultPresentation(),Magellan.Controllers.GUI.selectedModel instanceof Magellan.Models.DefaultLink&&Magellan.Controllers.GUI.selectedModel.getSourceElement()&&Magellan.Controllers.GUI.selectedModel.getSourceElement().resyncNodeInfoAndPresentation()),e)switch($(e.currentTarget).data("action-type")){case"pasteNode":break;case"copyNode":Magellan.Controllers.GUI.clipboardModel=t,Magellan.Controllers.GUI.pasteNode();break;case"editNode":Magellan.Controllers.GUI.editNode(t);break;case"deleteNode":$("#delete-node-button-2").click(function(){Magellan.Controllers.GUI.deleteNode(t)}),$("#delete-node-modal").modal("show");break;case"selectNode":Magellan.Controllers.GUI.selectedModel=t,e.metaKey||e.ctrlKey||e.shiftKey||Magellan.Controllers.GUI.highlightNode(t);break;case"openEdgeMenu":var n=$(this).closest(".element");Magellan.Controllers.GUI.openEdgeMenu(t,n),Magellan.Controllers.GUI.selectedModel=t}else Magellan.Controllers.GUI.selectedModel=null}else selection.collection.contains(t)||"mousewheel"===e.type||selection.collection.reset([])},Magellan.Controllers.GUI.changeNodeWithIcons=function(e){e&&e.nodeInfo&&(Magellan.Controllers.GUI.nodeWithIcons&&Magellan.Controllers.GUI.nodeWithIcons.hideActionIcons(),Magellan.Controllers.GUI.nodeWithIcons=e)},Magellan.Controllers.GUI.fetchStats=function(e,t){var i=$.Deferred();if(Magellan.Migration.savedGraphVersion<.65)return i.reject("Incompatible Graph Version for Metrics");var n=Magellan.Controllers.GUI.paramsJSONToCachedStats[e];return _.isEmpty(n)?(Magellan.Services.FlowBuilder.getPinnedMetrics(e).then(function(n,a){a.status?(window.currentDeploymentId!==window.chosenGraphIdMap[t]&&(Magellan.Controllers.GUI.paramsJSONToCachedStats[e]=n),i.resolve(n)):i.reject(a.message)}),i):i.resolve(n)},Magellan.Controllers.GUI.displayStats=function(e){var t=[],i=Magellan.Util.getNodeNamesToNodesMap(),n=$("#stat-type-select :checked").val();_.forEach(i,function(e,i){("TRIGGER"!==e.nodeInfo.type||"new"!==n&&"all"!==n)&&("UPDATE TRIGGER"!==e.nodeInfo.type||"updated"!==n&&"all"!==n)&&"REROUTING"!==e.nodeInfo.type||t.push(e.nodeInfo.name)});var a=moment($("#metricswrapper-initial-date").val()).format("YYYY-MM-DD"),o=moment($("#metricswrapper-end-date").val()).format("YYYY-MM-DD");"Invalid date"===o&&(o=moment().format("YYYY-MM-DD"));var l={"start date":a,"end date":o,"graph id":Magellan.Controllers.GUI.deploymentToDisplay,pins:t},s=JSON.stringify(l);Magellan.Controllers.GUI.fetchStats(s,e).then(function(e){var i=e.metrics;_.isEmpty(i)&&requestModalResponse("nothing-routed"),Magellan.Controllers.GUI.traverseContiguousPopulateMetricsAndRefreshDisplay(i,t,e.pendingCCIOs),Magellan.Controllers.GUI.bindButtons()},function(e){console.log(e),"Incompatible Graph Version for Metrics"===e?requestModalResponse("metrics-incompatible"):requestModalResponse("metrics-error"),$("#view-metrics").prop("checked",!1),Magellan.Controllers.GUI.undisplayStats()})},Magellan.Controllers.GUI.traverseContiguousPopulateMetricsAndRefreshDisplay=function(e,t,i){var n=Magellan.Util.getNodeNamesToNodesMap(),a=Magellan.Util.getContiguousNodeNames(n,t);_.each(n,function(e,t){e.edgeToMetrics={},e.pendingCCIOs=i[t]||0}),_.each(e,function(e){var t=e.node,i=e.edge,a=e.count;n[t].edgeToMetrics[i]=a}),_.each(a,function(e){var t=n[e];paper.findViewByModel(t).render()});var o=Magellan.Controllers.GUI.getLinks(),l=_.filter(o,function(e){var t=_.includes(a,e.getSourceElement().nodeInfo.name),i=_.includes(a,e.getTargetElement().nodeInfo.name);return t&&i});_.each(l,function(e){paper.findViewByModel(e).render()})},Magellan.Controllers.GUI.formatStatNumber=function(e){return e||0===e?e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):""},Magellan.Controllers.GUI.undisplayStats=function(){var e=$("#view-metrics").prop("checked");$("#view-metrics").prop("checked",!1);var t=Magellan.Util.getNodeNamesToNodesMap(),i=Magellan.Controllers.GUI.getLinks();_.each(t,function(e){paper.findViewByModel(e).render()}),_.each(i,function(e){paper.findViewByModel(e).render()}),$("#view-metrics").prop("checked",e),Magellan.Controllers.GUI.bindButtons()},Magellan.Controllers.GUI.selectLink=function(e){Magellan.Controllers.GUI.selectedModel&&Magellan.Controllers.GUI.selectedModel.defaultPresentation(),Magellan.Controllers.GUI.selectedModel=e,e.styleAsSelected()},Magellan.Controllers.GUI.editNode=function(e){selection.collection.reset([]),inspectorUp=!0,$(".hide-on-inspect").hide(),$("#inspector").addClass("reveal"),function populateInspector(e){Date.now(),$("#paper").toggleClass("inspector-open",!0);var t=paperScroller.getVisibleArea(),i=paper.findViewByModel(e.id),n=t.x;areaWidth=t.width*(1-$("#inspector").width()/paperScroller.$el.width()),i.getStrokeBBox().x-10<t.x?n=i.getStrokeBBox().x-10:i.getStrokeBBox().x+i.getStrokeBBox().width+10>t.x+areaWidth&&(n=i.getStrokeBBox().x+i.getStrokeBBox().width+10-areaWidth);var o=t.y;if(i.getStrokeBBox().y-10<t.y?o=i.getStrokeBBox().y-10:i.getStrokeBBox().y+i.getStrokeBBox().height+10>t.y+t.height&&(o=i.getStrokeBBox().y+i.getStrokeBBox().height+10-t.height),paperScroller.center(n+t.width/2,o+t.height/2),a.position(n,o),$("#paper-overlay").show(),paperScroller.$el.css("overflow","hidden"),"Contact"===LeanData__PrimarySObjectType)var l=Magellan.Controllers.GUI.activeView=new Magellan.Views.ContactNodeForm({model:e});else if("Account"===LeanData__PrimarySObjectType)var l=Magellan.Controllers.GUI.activeView=new Magellan.Views.AccountNodeForm({model:e});else if("Opportunity"===LeanData__PrimarySObjectType)var l=Magellan.Controllers.GUI.activeView=new Magellan.Views.OpportunityNodeForm({model:e});else if("Lead"===LeanData__PrimarySObjectType)var l=Magellan.Controllers.GUI.activeView=new Magellan.Views.NewNodeForm({model:e});else var l=new Magellan.Views.NodeForm({model:e});var s=l.render().$el;$("#properties-wrapper").html(s),$(".node-inspector").not(".upsell-button").on("click",function(e){e.target.classList.contains("upsell-button")||$(".upsell-for-inspector").remove()}),$("#properties-wrapper").find(".node-partial").trigger("initialize")}(e),Magellan.Controllers.GUI.selectedModel=e,$("#save-button, #close-button, #save-deploy-button, #validate-button, .zoom-wrapper").hide(),setTimeout(function(e){inspectedEl=e,e.highlightNode()},10,e)},Magellan.Controllers.GUI.deleteNode=function(e){var t=_.filter(graph.getConnectedLinks(e,{inbound:!0}),function(e){return!_.isEmpty(e)}),i=(e.getAbsoluteCenter(),[]);_.each(t,function(t){var n=t.getSourceElement();n&&i.push(n),_.each(t.edges,function(t){t.target=null,n&&n.linkHandler.removeLinkForEdge(t,e.nodeInfo.name)})}),_.each(i,function(e){e.resyncNodeInfoAndPresentation()}),Magellan.Controllers.GUI.selectedModel=null,e.remove()},Magellan.Controllers.GUI.highlightNode=function(e,t){e.toFront(),e.highlightNode(),e.showActionIcons()},Magellan.Controllers.GUI.openEdgeMenu=function(e,t){selection.collection.reset([]),e.openEdgeMenu(t)},Magellan.Controllers.GUI.openLinkOverlapMenu=function(e){Magellan.Controllers.GUI.activeView&&Magellan.Controllers.GUI.activeView.remove(),Magellan.Controllers.GUI.activeView=null,e.openMultipleLinksMenu()},Magellan.Controllers.GUI.listenForLink=function(){$(".joint-paper").mousemove(Magellan.Controllers.GUI.dragLink),$(".joint-paper").mouseup(Magellan.Controllers.GUI.dropLink)},Magellan.Controllers.GUI.stopListeningForLink=function(){$(".joint-paper").unbind("mousemove",Magellan.Controllers.GUI.dragLink),$(".joint-paper").unbind("mouseup",Magellan.Controllers.GUI.dropLink)},Magellan.Controllers.GUI.startDraggingLink=function(e,t,i){Magellan.Controllers.GUI.clickAction(),graph.trigger("batch:start"),(t=t||new Magellan.Models.DefaultLink).set("source",{id:i.id}),t.set("target",paper.snapToGrid({x:e.clientX,y:e.clientY})),graph.addCell(t),t.styleAsSelected(),Magellan.Controllers.GUI.nextLink=paper.findViewByModel(t),Magellan.Controllers.GUI.nextLink.startArrowheadMove("target",{whenNotAllowed:"remove"}),n=(new Date).getTime()},Magellan.Controllers.GUI.dragLink=function(e){if(Magellan.Controllers.GUI.nextLink){var t=paper.snapToGrid({x:e.clientX,y:e.clientY});Magellan.Controllers.GUI.nextLink.pointermove(e,t.x,t.y)}},Magellan.Controllers.GUI.dropLink=function(e){if(!((new Date).getTime()-n<150)&&Magellan.Controllers.GUI.nextLink){Magellan.Controllers.GUI.nextLink.pointerup(e);var t=Magellan.Controllers.GUI.nextLink.model.getSourceElement(),i=Magellan.Controllers.GUI.nextLink.model.getTargetElement(),a=Magellan.Controllers.GUI.nextLink.model.edges[0];Magellan.Controllers.GUI.nextLink.model.remove(),i instanceof Magellan.Models.TriggerNode||(i&&i!==t?(t.linkHandler.changeEdgeTargetFromMenu(a,i.nodeInfo.name,null),t.resyncNodeInfoAndPresentation()):t&&t.linkHandler.removeLinkForEdge(a,null),graph.trigger("batch:stop"),Magellan.Controllers.GUI.nextLink=null,Magellan.Controllers.GUI.stopListeningForLink(),Magellan.Controllers.GUI.activeView&&Magellan.Controllers.GUI.activeView.remove(),Magellan.Controllers.GUI.activeView=null)}},Magellan.Controllers.GUI.getNodes=function(){return Object.values(e)},Magellan.Controllers.GUI.getNameToNodeMap=function(){return _.isEmpty(t)&&(t=Magellan.Controllers.GUI.getNodeNamesToNodesMap()),t},Magellan.Controllers.GUI.handleNodeNameChanged=function(e,i){e!==i&&(t[i]=t[e],delete t[e])},Magellan.Controllers.GUI.getLinks=function(){return graph.getLinks()},Magellan.Controllers.GUI.getCopyName=function(e){for(var t=e+" copy",i=Magellan.Util.getNodeNamesToNodesMap(),n=1,a="";i.hasOwnProperty(t+a);)a=" "+ ++n;return t+a},Magellan.Controllers.GUI.pasteNode=function(){if(Magellan.Controllers.GUI.clipboardModel){var e=Magellan.Controllers.GUI.clipboardModel,t=JSON.parse(JSON.stringify(e.nodeInfo));t.name=Magellan.Controllers.GUI.getCopyName(t.name),_.each(t.edges,function(e){-1!==e.target&&null!==e.target&&(e.target=null)});var i=Magellan.Models.getObjectByName(t.magellanClass),n=e.position().x+140,a=e.position().y+140;e.hasOwnProperty("lastCopyCoordinates")?(n=e.lastCopyCoordinates.x=e.lastCopyCoordinates.x+25,a=e.lastCopyCoordinates.y=e.lastCopyCoordinates.y+25,clearTimeout(e.expiration),e.expiration=setTimeout(function(){delete e.lastCopyCoordinates},3e4)):e.lastCopyCoordinates={x:n,y:a,expiration:setTimeout(function(){delete e.lastCopyCoordinates},3e4)};var o=new i({position:{x:n,y:a},nodeInfo:t});o.addTo(graph),o.resyncNodeInfoAndPresentation()}},Magellan.Controllers.GUI.Stencil=joint.ui.Stencil.extend({drop:function(e,t){var i=joint.ui.Stencil.prototype.drop.call(this,e,t);return t.resyncNodeInfoAndPresentation(),i},setPaperDragOffset:function(e,t){var i=document.body.scrollTop||document.documentElement.scrollTop,n=document.body.scrollLeft||document.documentElement.scrollLeft,a=this._cloneViewBBox,o=this._paperDragPadding,l={left:e-a.width/2+n-o,top:t-a.height/2+i-o};return this._paperDrag.$el.offset(l),l}}),Magellan.Controllers.GUI.drawStencil=function(e,t,i){var n=t.getStencils(e);n=_.flatten(_.partition(n,function(e){return!e.attributes.isDisabled})),_.each(n,function(e,t){e.attributes.isDisabled&&(e.attributes.attrs["rect.stencil-dropdown-item-rect"].fill="var(--lt-grey-1_5)"),e.translate(0,40*t)});var a=new Magellan.Controllers.GUI.Stencil({paper:paperScroller,height:40*n.length+1,width:199});$(i).html(a.render().el),a.load(n)},Magellan.Controllers.GUI.bindButtons=_.debounce(function(){var e=LeanData__PrimarySObjectType;"Lead"===e?(Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.MatchNode,".stencil-overlay.match-node-stencils-dropdown"),Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.TrueFalseNode,".stencil-overlay.true-false-node-stencils-dropdown"),Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.BranchNode,".stencil-overlay.branch-node-stencils-dropdown"),Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.RerouteNode,".stencil-overlay.reroute-node-stencils-dropdown")):"Contact"===e?(Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.ContactMatchNode,".stencil-overlay.match-node-stencils-dropdown"),Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.ContactTrueFalseNode,".stencil-overlay.true-false-node-stencils-dropdown"),Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.ContactBranchNode,".stencil-overlay.branch-node-stencils-dropdown"),Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.ContactRerouteNode,".stencil-overlay.reroute-node-stencils-dropdown")):"Account"===e?(Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.AccountMatchNode,".stencil-overlay.match-node-stencils-dropdown"),Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.AccountTrueFalseNode,".stencil-overlay.true-false-node-stencils-dropdown"),Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.AccountBranchNode,".stencil-overlay.branch-node-stencils-dropdown"),Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.AccountRerouteNode,".stencil-overlay.reroute-node-stencils-dropdown")):"Opportunity"===e&&(Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.OpportunityMatchNode,".stencil-overlay.match-node-stencils-dropdown"),Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.OpportunityTrueFalseNode,".stencil-overlay.true-false-node-stencils-dropdown"),Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.OpportunityBranchNode,".stencil-overlay.branch-node-stencils-dropdown"),Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.OpportunityRerouteNode,".stencil-overlay.reroute-node-stencils-dropdown")),Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.ActionNode,".stencil-overlay.action-node-stencils-dropdown"),Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.OutreachNode,".stencil-overlay.outreach-node-stencils-dropdown"),Magellan.Controllers.GUI.drawStencil(e,Magellan.Models.SalesloftNode,".stencil-overlay.salesloft-node-stencils-dropdown"),$(".disabled-stencil").parent().removeAttr("model-id"),$(".disabled-stencil").on("mouseenter",function(e){var t=$(e.target).closest(".disabled-stencil"),n=t.closest(".elements").offset(),a=t.offset(),o=a.top-n.top,l=a.left-n.left,s=$(e.currentTarget.closest(".stencil-overlay").querySelector(".upsell-container"));s.addClass("upsell-for-stencil");const r=i(2);try{const t=r[e.target.closest("g.stencil-dropdown-item").dataset.nodeModel];s.find(".upsell-title").text(t.title),s.find(".upsell-body").text(t.body),s.find(".upsell-link").text(t.action),s.find(".upsell-link").parent().attr("href",t.location),s.show(),s.css("top",o),s.css("left",l-$(".upsell-container").width()-41)}catch(t){console.warn("couldn't find upsell text for "+e,t)}}),$(".disabled-node-submenu").on("mouseenter",function(e){console.log("disabled-node-hover",e);var t=$(e.currentTarget);const n=$(e.currentTarget).offset(),a=$(e.currentTarget).closest(".elements").offset();var o=$(".upsell-container");o.addClass("upsell-for-stencil");const l=i(2);try{const i=l[t.data("submenuKey")];o.find(".upsell-title").text(i.title),o.find(".upsell-body").text(i.body),o.find(".upsell-link").text(i.action),o.find(".upsell-link").parent().attr("href",i.location),o.show(),o.css("top",Math.floor(n.top-a.top)),o.css("left",Math.floor(n.left-a.left-$(".upsell-container").width()-42))}catch(t){console.warn("couldn't find upsell text for "+e,t)}}),$(".stencil-dropdown-item").on("mouseenter",function(e){$target=$(e.target),$target.parent()[0].hasClass("disabled-stencil")||$(".upsell-container").hide()}),["action","match","true-false","branch","decision","reroute","partner","outreach","salesloft"].forEach(function registerMouseEvents(e){var t=["decision"];$(".toggle-"+e+"-nodes").on("mouseenter",function(){$("div.stencil-overlay."+e+"-node-stencils-dropdown > div.joint-theme-default.joint-stencil").css("display","block"),t.includes(e)||0===$(".toggle-"+e+"-nodes .elements .upsell-container").length&&$(".toggle-"+e+"-nodes .elements").append(dashboardController.viewObject.upsellContainerHtml)}),$(".unauthorized-"+e+"-nodes").on("mouseenter",function(e){$(".authorize-popup-container div.ld-body-large").text("To authorize, go to Admin > Partner Apps."),$(".authorize-popup-container").css("visibility","hidden"),$(".authorize-popup-container").css("display","flex"),$(".authorize-popup-container").css("left","-380px"),$(".authorize-popup-container").css("width","380px"),$(".authorize-popup-container").css("top",e.currentTarget.dataset.offset+"px"),$(".authorize-popup-container").css("visibility","visible")}),$(".unauthorized-"+e+"-nodes").on("mouseleave",function(){$("div.stencil-overlay."+e+"-node-stencils-dropdown > div.joint-theme-default.joint-stencil").css("display","none"),$(".authorize-popup-container").hide()}),$(".toggle-"+e+"-nodes").on("mouseleave",function(){$("div.stencil-overlay."+e+"-node-stencils-dropdown > div.joint-theme-default.joint-stencil").css("display","none"),$(".toggle-"+e+"-nodes .upsell-container").hide()})}),$("#node-group-container > .node-group-item").on("mouseenter",function(){$("#node-group-container > .node-group-item").not(this).children(".node-group-item-image, .node-group-item-label").stop().animate({opacity:"0.9"},0)}),$("#node-group-container > .node-group-item").on("mouseleave",function(){$("#node-group-container > .node-group-item").children(".node-group-item-image, .node-group-item-label").stop().animate({opacity:"1"},0)}),$(".type-magellan-models-stencilelement").not(".toggle-true-false-nodes, .toggle-branch-nodes").on("mouseenter",function(){this instanceof SVGElement&&this.addClass("stencil-hover")}),$(".type-magellan-models-stencilelement").not(".toggle-true-false-nodes, .toggle-branch-nodes").on("mouseleave",function(){this instanceof SVGElement&&this.removeClass("stencil-hover")}),$(".toggle-true-false-nodes").on("mouseenter",function(){this instanceof SVGElement&&this.addClass("stencil-hover"),$(".decision-submenu").not(".toggle-true-false-nodes").find("image, text").stop().animate({opacity:"0.9"},100)}),$(".toggle-true-false-nodes").on("mouseleave",function(){this instanceof SVGElement&&this.removeClass("stencil-hover"),$(".decision-submenu").not(".toggle-true-false-nodes").find("image, text").stop().animate({opacity:"1"},100)}),$(".toggle-branch-nodes").on("mouseenter",function(){this instanceof SVGElement&&this.addClass("stencil-hover"),$(".decision-submenu").not(".toggle-branch-nodes").find("image, text").stop().animate({opacity:"0.9"},100)}),$(".toggle-branch-nodes").on("mouseleave",function(){this instanceof SVGElement&&this.removeClass("stencil-hover"),$(".decision-submenu").not(".toggle-branch-nodes").find("image, text").stop().animate({opacity:"1"},100)}),$(".clickAction").unbind("click",Magellan.Controllers.GUI.clickAction),$(".clickAction").click(Magellan.Controllers.GUI.clickAction),$(".clickAction").unbind("mouseup",Magellan.Controllers.GUI.handleCtrlMouseup),$(".clickAction").on("mouseup",Magellan.Controllers.GUI.handleCtrlMouseup),$(".clickAction").unbind("mousedown",Magellan.Controllers.GUI.handleCtrlMousedown),$(".clickAction").on("mousedown",Magellan.Controllers.GUI.handleCtrlMousedown),$(".marker-arrowhead").unbind("mousedown",Magellan.Controllers.GUI.clickAction),$(".marker-arrowhead").on("mousedown",Magellan.Controllers.GUI.clickAction),$("g.element.basic image.main-icon").on("mousedown",function(e){if(clickedModel=graph.getCell($(this).parents("g.element.basic").attr("model-id")),clickedModel!=Magellan.Controllers.GUI.selectedModel&&!(selection.collection.length>0)){if(Magellan.Controllers.GUI.selectedModel&&(Magellan.Controllers.GUI.selectedModel.defaultPresentation(),Magellan.Controllers.GUI.selectedModel instanceof Magellan.Models.DefaultLink&&Magellan.Controllers.GUI.selectedModel.getSourceElement()&&Magellan.Controllers.GUI.selectedModel.getSourceElement().resyncNodeInfoAndPresentation(),paper.findViewByModel(Magellan.Controllers.GUI.selectedModel))){var t=paper.findViewByModel(Magellan.Controllers.GUI.selectedModel).el;t&&t.classList.remove("selected")}Magellan.Controllers.GUI.selectedModel=clickedModel,Magellan.Controllers.GUI.highlightNode(clickedModel)}})},500),parseSVG=function(e){var t=document.createElementNS("http://www.w3.org/1999/xhtml","div");t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+e+"</svg>";for(var i=document.createDocumentFragment();t.firstChild.firstChild;)i.appendChild(t.firstChild.firstChild);return i},setTriggerNodesOnGraph=function(){new joint.shapes.basic.Generic({markup:'<g><text class="dummy-text-box"><tspan class="dummy-tspan"/></text></g>',position:{x:0,y:0},attrs:{"text.dummy-text-box":{fill:"#555555","font-family":"Open Sans","font-size":"10px","font-weight":"400",opacity:"0"}}}).addTo(graph);var e,t={id:"",position:{x:550,y:60},attrs:{size:{width:100,height:75}}};(e="main-contact"===magellanPage?new Magellan.Models.InsertedContactTriggerNode(t):"main-account"===magellanPage?new Magellan.Models.AccountInsertTriggerNode(t):"main-opportunity"===magellanPage?new Magellan.Models.OpportunityInsertTriggerNode(t):new Magellan.Models.InsertedLeadTriggerNode(t)).addTo(graph),e.resyncNodeInfoAndPresentation(),t.position={x:330,y:60},"main"===magellanPage?e=new Magellan.Models.UpdateTriggerNode(t):"main-contact"===magellanPage?e=new Magellan.Models.UpdateContactTriggerNode(t):"main-account"===magellanPage?e=new Magellan.Models.AccountUpdateTriggerNode(t):"main-opportunity"===magellanPage&&(e=new Magellan.Models.OpportunityUpdateTriggerNode(t)),e.addTo(graph),e.resyncNodeInfoAndPresentation(),Magellan.Controllers.GUI.bindButtons(),Magellan.Controllers.GUI.startingGraph=JSON.stringify(graph.flattenedGraph())},Magellan.Controllers.GUI.refreshFlowBuilder=function(){Magellan.Controllers.GUI.selectedModel=null,e={},t={},window.graph instanceof joint.dia.Graph&&window.paper instanceof joint.dia.Paper&&(graph.get("cells").forEach(function(e){paper.findViewByModel(e).remove()}),graph.clear(),paper.remove(),paper=null,graph=null),inspectorUp=!1,inspectedEl=null,Magellan.Controllers.GUI.isInteractive=!Magellan.Util.checkIfReadOnlyGraph(),graph=new Magellan.External.Joint.Graph,paper=new joint.dia.Paper({width:4500,height:1805,model:graph,gridSize:1,linkPinning:!0,markAvailable:!1,linkConnectionPoint:Magellan.Util.getLinkConnectionPoint,interactive:!!Magellan.Controllers.GUI.isInteractive&&{vertexAdd:!1},preventContextMenu:!1}),selection=new joint.ui.Selection({paper}),paper.on("blank:pointerup",function(e,t,i){Magellan.Controllers.GUI.clickX!==e.pageX||Magellan.Controllers.GUI.clickY!==e.pageY||e.metaKey||e.ctrlKey||(selection.collection.reset([]),Magellan.Controllers.GUI.selectedModel=null)}),Magellan.Controllers.GUI.updateSelectionInfo=function(){if(selection.collection.length){var e=selection.collection.length+" node"+(selection.collection.length>1?"s":"");$("#selectionInfo").fadeIn(150),$("#selectionInfo-count").html(e)}else $("#selectionInfo").fadeOut(150)},_.isUndefined(window.paperScroller)||paperScroller.remove(),paperScroller=new joint.ui.PaperScroller({autoResizePaper:!0,padding:0,paper}),$("#paper").append(paperScroller.render().el),Magellan.Controllers.GUI.isInteractive||(paperScroller.options.baseHeight+=250,paperScroller.$el.find(".joint-paper").height(paperScroller.options.baseHeight));var i=paperScroller.$el.find("svg")[0];i.insertBefore(parseSVG(_.template(magellanDocument.getElementById("svg_defs").innerHTML)()),i.firstChild),i=null,paper.on("blank:pointerdown",function(e){Magellan.Controllers.GUI.clickX=e.pageX,Magellan.Controllers.GUI.clickY=e.pageY,Magellan.Controllers.GUI.clickWhiteSpace(),e.shiftKey||e.metaKey||e.ctrl?selection.startSelecting(e):paperScroller.startPanning(e)}),paper.off("cell:highlight"),paper.on("cell:highlight",function(e){var t=e.model;t instanceof Magellan.Models.Node&&!(t instanceof Magellan.Models.TriggerNode)&&t.selectNodeForEdge()}),paper.on("cell:unhighlight",function(e){var t=e.model;t instanceof Magellan.Models.Node&&!(t instanceof Magellan.Models.TriggerNode)&&t.defaultPresentation()}),paper.on("cell:pointerup",function(e){e.model instanceof Magellan.Models.DefaultLink&&e.model==Magellan.Controllers.GUI.selectedModel&&e.model.dropLink();var t=e.model.get("position");if(void 0!=t){var i={x:g.snapToGrid(t.x,28),y:g.snapToGrid(t.y,15)};e.model.set("position",i)}}),$(".clickAction").on("mousedown",function(e){Magellan.Controllers.GUI.clickX=e.pageX,Magellan.Controllers.GUI.clickY=e.pageY}),paper.$el.on("mousewheel DOMMouseScroll",Magellan.Controllers.GUI.clickAction),$("#paper-overlay").click(function(){$("#node-properties-wrapper").trigger("dismiss")}),graph.on("add",function(i,n,a){i instanceof joint.dia.Link?(i.set("source",{id:i.getSourceElement().id}),i.on("change:target",function(){var e=i.getSourceElement();e&&(e.toFront(),i.getTargetElement()&&i.getTargetElement()===e&&(i.edges[0].target=null,paper.findViewByModel(e).render(),i.remove(),e.refreshLinkHandler()))})):i instanceof Magellan.Models.Node&&(e[i.id]=i,t[i.nodeInfo.name]=i)}),graph.on("remove",function(i){i instanceof Magellan.Models.Node&&(delete e[i.id],delete t[i.nodeInfo.name])});var n=paperScroller.getVisibleArea();a=new joint.shapes.basic.Rect({size:{width:n.width,height:n.height},attrs:{rect:{fill:"#999999",opacity:.4}}}),graph.addCell(a),paper.findViewByModel(a).el.classList.add("overlay-rect"),commandManager=new joint.dia.CommandManager({graph}),keyboardJS.reset(),keyboardJS.on("ctrl + z",function(){commandManager.undo()}),keyboardJS.on("ctrl + v",Magellan.Controllers.GUI.pasteNode),keyboardJS.on("ctrl + shift + z",function(){commandManager.redo()}),selection.collection.on("reset add remove",function(e){Magellan.Controllers.GUI.resyncSelectionAndPresentation(),Magellan.Controllers.GUI.updateSelectionInfo(),0===e.length&&(Magellan.Controllers.GUI.selectedModel=null)})},Magellan.Controllers.GUI.closeInspector=function(){a.toBack(),$("#paper-overlay").hide(),$("#paper").toggleClass("inspector-open",!1),inspectorUp&&null!=inspectedEl&&($(".hide-on-inspect").show(),$("#inspector").removeClass("reveal"),$("#save-button, #close-button, #save-deploy-button, #validate-button, .zoom-wrapper").show(),$("#properties-wrapper").empty(),paperScroller.$el.css("overflow","scroll"),inspectorUp=!1,inspectedEl.model instanceof joint.dia.Link&&inspectedEl.model.attr(".connection/stroke",inspectedEl.model.attr("originalProps").stroke),inspectedEl=null),Magellan.Controllers.GUI.bindButtons(),Magellan.Controllers.GUI.activeView&&Magellan.Controllers.GUI.activeView.remove(),Magellan.Controllers.GUI.activeView=null},Magellan.Controllers.GUI.unselectAllStatBox=function(){$(".stat-box").hide(),$(".image-wrapper image").attr("xlink:href",iconToURLMap["Edge Stat Icon"]),$(".image-wrapper .metric-number").attr("fill","#2DB670")},Magellan.Controllers.GUI.clickWhiteSpace=function(){$("#html-multiple-links-menu").hide(),$("#html-edge-menu").hide(),Magellan.Controllers.GUI.unselectAllStatBox(),inspectorUp&&Magellan.Controllers.GUI.closeInspector(),Magellan.Controllers.GUI.selectedModel&&(Magellan.Controllers.GUI.selectedModel.defaultPresentation(),Magellan.Controllers.GUI.selectedModel instanceof Magellan.Models.DefaultLink&&Magellan.Controllers.GUI.selectedModel.getSourceElement()&&(Magellan.Controllers.GUI.selectedModel.getSourceElement().resyncNodeInfoAndPresentation(),Magellan.Controllers.GUI.selectedModel.getTargetElement()&&Magellan.Controllers.GUI.selectedModel.getTargetElement().toFront()),Magellan.Controllers.GUI.selectedModel=null),Magellan.Controllers.GUI.activeView&&Magellan.Controllers.GUI.activeView.remove(),Magellan.Controllers.GUI.activeView=null},Magellan.Controllers.GUI.appWaitingScreen=new Magellan.Views.WaitingScreen({container:"#app-waiting-screen"})}},function(e,t){e.exports=function initializeMagellanMigration(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Migration&&(Magellan.Migration={}),Magellan.Migration.currentGraphVersion=.73,Magellan.Migration.savedGraphVersion=0,Magellan.Migration.migrateGraphJSON=function(e){switch(e.graphVersion){case void 0:this.discardPresentationLogic(e);case.1:this.migrateDecisionNodesToBranch(e);case.2:case.3:case.4:this.migrateObjectTypeAndTrueFalseDefaultEdge(e);case.5:this.trueFalseNodeFix(e);case.6:this.eliminateInappropriateTiebrakers(e);case.61:this.fixUpdateTriggers(e);case.62:this.renameActionNodes(e);case.63:this.persistDefaultSelections(e);case.64:this.addNextNodeToDestructiveNodes(e);case.65:case.66:this.removeL2LQueueOwnerEdge(e);case.67:this.flattenOwnerFieldsInInsertTrigger(e)}return e},Magellan.Migration.discardPresentationLogic=function(e){var t=e.graph;t.cells=_.filter(t.cells,function(e){return void 0==e.arrowheadMarkup}),delete e.graph,_.map(e.businessLogic,function(i,n){var a=i[0];switch(i.shift(),i[0].type){case"TRIGGER":case"UPDATE TRIGGER":i[0].magellanClass="Magellan.Models.TriggerNode";break;case"MATCH":i[0].magellanClass="Magellan.Models.MatchNode";break;case"DECISION":i[0].magellanClass="Magellan.Models.DecisionNode";break;case"ACTION":var o=i[0].actionType;["Account Based Routing","Assign Owner Account","Route to Account","Route to Matched Account"].includes(o)?i[0].magellanClass="Magellan.Models.AssignOwnerAccount":["Lead Based Routing","Assign Owner Lead","Route to Matched Lead"].includes(o)?i[0].magellanClass="Magellan.Models.AssignOwnerLead":["Opportunity Based Routing","Assign Owner Opportunity","Route to Opportunity","Route to Matched Opportunity"].includes(o)?i[0].magellanClass="Magellan.Models.AssignOwnerOpportunity":"Convert"==o?i[0].magellanClass="Magellan.Models.Convert":"Create Account"==o?i[0].magellanClass="Magellan.Models.CreateAccount":"Create Opportunity"==o?i[0].magellanClass="Magellan.Models.CreateOpportunity":"Update Lead"==o?i[0].magellanClass="Magellan.Models.UpdateLead":"Merge Dupe"==o?i[0].magellanClass="Magellan.Models.Merge":"Round Robin"==o?i[0].magellanClass="Magellan.Models.RoundRobin":"Route To Territory"==o&&(console.log("in TerritoryRouting"),i[0].magellanClass="Magellan.Models.TerritoryRouting")}var l=_.find(t.cells,function(e){return e.id==a});return i[1]=l.position,e})},Magellan.Migration.migrateDecisionNodesToBranch=function(e){return _.map(e.businessLogic,function(e,t){"Magellan.Models.DecisionNode"===e[0].magellanClass&&(e[0].magellanClass="Magellan.Models.BranchNode")}),e},Magellan.Migration.migrateObjectTypeAndTrueFalseDefaultEdge=function(e){return _.each(e.businessLogic,function(e,t){"Magellan.Models.TrueFalseNode"===e[0].magellanClass&&(e[0].edges[1].type="default"),"Lead"===e[0].objectType&&(e[0].objectType="Primary")}),e},Magellan.Migration.trueFalseNodeFix=function(e){return _.each(e.businessLogic,function(e,t){"Magellan.Models.TrueFalseNode"===e[0].magellanClass&&_.each(e[0].edges,function(e,t){"logic"===e.type&&(e.type="conditions")})}),e},Magellan.Migration.eliminateInappropriateTiebrakers=function(e){return _.each(e.businessLogic,function(e,t){"Magellan.Models.TrueFalseNode"!==e[0].magellanClass&&"Magellan.Models.BranchNode"!==e[0].magellanClass||delete e[0].tiebreakers}),e},Magellan.Migration.fixUpdateTriggers=function(e){return e.businessLogic[1][0].type="UPDATE TRIGGER",e},Magellan.Migration.renameActionNodes=function(e){return _.each(e.businessLogic,function(e,t){if("ACTION"===e[0].type)switch(e[0].actionType){case"Assign Owner Account":e[0].actionType="Account Based Routing";break;case"Assign Owner Lead":e[0].actionType="Lead Based Routing";break;case"Assign Owner Opportunity":e[0].actionType="Opportunity Based Routing";break;case"Convert":e[0].actionType="Convert Lead";break;case"Create Account":e[0].actionType="Account Creation";break;case"Opportunity Creation":case"Create New Opportunity":e[0].actionType="Create Opportunity";break;case"Merge Dupe":e[0].actionType="Merge Dupe Lead"}}),e},Magellan.Migration.persistDefaultSelections=function(e){return _.each(e.businessLogic,function(e,t){if(["Account Based Routing","Assign Owner Account","Route to Account","Route to Matched Account"].includes(e[0].actionType)){var i=e[0]["abr type"];(_.isNull(i)||_.isUndefined(i))&&(e[0]["abr type"]="account owner")}else["Opportunity Based Routing","Assign Owner Opportunity","Route to Opportunity","Route to Matched Opportunity"].includes(e[0].actionType)&&(e[0]["obr type"],(_.isNull(i)||_.isUndefined(i))&&(e[0]["obr type"]="opportunity owner"))}),e},Magellan.Migration.addNextNodeToDestructiveNodes=function(e){var t=["Convert Lead","Merge Dupe Lead","Merge Dupe Contact"];return _.each(e.businessLogic,function(e,i){var n=_.includes(t,e[0].actionType),a=_.filter(e[0].edges,function(e){return"Next Node"===e.name}).length>0;n&&!a&&e[0].edges.push({type:"fixed",condition:"Next Node",name:"Next Node",target:-1})}),e},Magellan.Migration.removeL2LQueueOwnerEdge=function(e){return _.each(e.businessLogic,function(e,t){"Merge Dupe Lead"===e[0].actionType&&(e[0].edges=_.filter(e[0].edges,function(e){return"Queue Owner"!==e.name}))}),e},Magellan.Migration.flattenOwnerFieldsInInsertTrigger=function(e){_.each(e.businessLogic,function(e,t){"TRIGGER"===e[0].type&&_.each(e[0].edges,function(e){e.conditions&&_.each(e.conditions,function(e){"owner.id"===e.field.toLowerCase()&&(e.field="ownerid")})})})},Magellan.Migration.emptySoqlCondition=function(){return{type:"soql",soqlCondition:""}},Magellan.Migration.emptyMinMaxRule=function(){return{type:"optima",field:null,direction:"max"}},Magellan.Migration.emptyEdge=function(e,t,i){var n={type:t,"next node":null,description:""};return i?n.name=i:e instanceof Magellan.Models.TriggerNode?n.name="Edge "+(Number(e.nodeInfo.edges.length)+1):_.isArray(e)?n.name="Edge "+e.length:n.name="Edge "+e.nodeInfo.edges.length,"conditions"===t&&_.merge(n,Magellan.Migration.emptyLogicRule()),n},Magellan.Migration.defaultInactiveUserEdge=function(){return{type:"fixed",condition:"Inactive User",name:"Inactive User",target:-1}},Magellan.Migration.defaultEndOfFlowNextNodeEdge=function(){return{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}},Magellan.Migration.defaultNoOwnerMappingFoundEdge=function(){return{type:"fixed",condition:"No Mapping Found",name:"No Mapping Found",target:-1}},Magellan.Migration.defaultNotAvailableForRoutingEdge=function(){return{type:"fixed",condition:"Not Available For Routing",name:"Not Available For Routing",target:-1}},Magellan.Migration.defaultInvalidPoolEdge=function(){return{type:"fixed",condition:"Invalid Round Robin Group",name:"Invalid Group",target:-1}},Magellan.Migration.defaultMatchEdge=function(){return{name:"Match",target:null,type:"fixed",condition:"Match"}},Magellan.Migration.defaultNoMatchEdge=function(){return{name:"No Match",target:null,type:"fixed",condition:"No Match"}},Magellan.Migration.defaultMatchWithoutParentEdge=function(){return{name:"Match without Parent",target:null,type:"fixed",condition:"Match without Parent"}},Magellan.Migration.defaultMatchParentAccountEdge=function(){return{name:"Match (Parent)",target:null,type:"fixed",condition:"Match (Parent)"}},Magellan.Migration.defaultMatchUltimateParentAccountEdge=function(){return{name:"Match (Ultimate Parent)",target:null,type:"fixed",condition:"Match (Ultimate Parent)"}},Magellan.Migration.migrateL2AMatchNodeEdges=function(e,t){var i,n;t?(i=Magellan.Migration.defaultMatchWithoutParentEdge(),n="parent"===t?Magellan.Migration.defaultMatchParentAccountEdge():Magellan.Migration.defaultMatchUltimateParentAccountEdge()):i=Magellan.Migration.defaultMatchEdge();var a=[];return a.push(i),n&&a.push(n),_.each(e,function(e){switch(e.name){case"Match":case"Match without Parent":i.target=e.target;break;case"Match (Parent)":case"Match (Ultimate Parent)":null!=n&&(n.target=e.target);break;default:a.push(e)}}),a},Magellan.Migration.emptyLogicRule=function(){return{type:"conditions",logic:"1",conditions:[Magellan.Migration.emptyCondition()],rpnLogic:[1]}},Magellan.Migration.emptyCustomRule=function(){return{type:"custom",parameter:""}},Magellan.Migration.emptyCondition=function(){return{"value/field":"value",field:null,operator:"equals",operand:null}},Magellan.Migration.OPPORTUNITY_OPTIMA_FIELDS=[{label:"Account's Number of Children*",name:"#children",parent:[],type:"LD_OPTIMA"},{label:"Account's Number of Opportunities*",name:"#opportunities",parent:[],type:"LD_OPTIMA"},{label:"Account's Number of Contacts*",name:"#contacts",parent:[],type:"LD_OPTIMA"}],Magellan.Migration.OPTIMA_FIELDS=[{label:"Number of Children*",name:"#children",parent:[],type:"LD_OPTIMA"},{label:"Number of Opportunities*",name:"#opportunities",parent:[],type:"LD_OPTIMA"},{label:"Number of Contacts*",name:"#contacts",parent:[],type:"LD_OPTIMA"}],Magellan.Migration.createDefaultTiebreakers=function(){return[{type:"conditions",logic:"1 AND 2 AND 3",conditions:[{"value/field":"field",field:"BillingCountry",operator:"equals",operand:"Country",type:"STRING","operand type":"STRING"},{"value/field":"field",field:"BillingState",operator:"equals",operand:"State",type:"STRING","operand type":"STRING"},{"value/field":"field",field:"BillingPostalCode",operator:"equals",operand:"PostalCode",type:"STRING","operand type":"STRING"}],rpnLogic:[1,2,"AND",3,"AND"]},{type:"conditions",logic:"1 AND 2",conditions:[{"value/field":"field",field:"BillingCountry",operator:"equals",operand:"Country",type:"STRING","operand type":"STRING"},{"value/field":"field",field:"BillingState",operator:"equals",operand:"State",type:"STRING","operand type":"STRING"}],rpnLogic:[1,2,"AND"]},{type:"conditions",logic:"1",conditions:[{"value/field":"field",field:"BillingCountry",operator:"equals",operand:"Country",type:"STRING","operand type":"STRING"}],rpnLogic:[1]},{type:"optima",field:"#children",direction:"max"},{type:"optima",field:"#opportunities",direction:"max"},{type:"optima",field:"#contacts",direction:"max"},{type:"optima",field:"LastActivityDate",direction:"max"},{type:"optima",field:"CreatedDate",direction:"min"}]},Magellan.Migration.createDefaultTiebreakerSet=function(){return{name:_.uniqueId("tiebreakers_set_"),tiebreakers:Magellan.Migration.createDefaultTiebreakers(),filter:{rpnLogic:[1],type:"conditions",logic:"1",conditions:[{"value/field":"field",field:null,operator:"equals",operand:null,type:"STRING","operand type":"STRING"}]},"filter type":"none"}},Magellan.Migration.defaultTaggingSettings={enableAccountFiltering:!1,enableMultiTiebreakerSets:!1,leadSegments:[{type:"conditions",conditions:[{type:"conditions",conditions:[],logic:"1",rpnLogic:[1]}],logic:"1",rpnLogic:[1],name:"Lead Segment 1",tiebreakerSetKey:null,description:""},{type:"default",name:"Default",tiebreakerSetKey:"Default Tiebreakers",logic:"",description:""}],tiebreakerSets:{"Default Tiebreakers":function(){var e=Magellan.Migration.createDefaultTiebreakerSet();return e.name="Default Tiebreakers",e}()},filter:{rpnLogic:[1],type:"conditions",logic:"1",conditions:[{"value/field":"field",field:null,operator:"equals",operand:null,type:"STRING","operand type":"STRING"}]},"filter type":null,tiebreakers:Magellan.Migration.createDefaultTiebreakers()},Magellan.Migration.createDefaultOpportunityTiebreakers=function(){return[{type:"conditions",logic:"1",conditions:[{"value/field":"value",field:"isclosed",type:"BOOLEAN",operator:"equals",operand:!1}],rpnLogic:[1]},{type:"conditions",logic:"1",conditions:[{"value/field":"value",field:"stagename",type:"PICKLIST",operator:"contains",operand:"open"}],rpnLogic:[1]},{type:"optima",field:"CreatedDate",direction:"min"}]},Magellan.Migration.createDefaultC2CTiebreakers=function(){return[{type:"conditions",logic:"1 AND 2 AND 3",conditions:[{"value/field":"field",field:"mailingcountry",type:"STRING",operator:"equals",operand:"mailingcountry","operand type":"STRING"},{"value/field":"field",field:"mailingstate",type:"STRING",operator:"equals",operand:"mailingstate","operand type":"STRING"},{"value/field":"field",field:"mailingpostalcode",type:"STRING",operator:"equals",operand:"mailingpostalcode","operand type":"STRING"}],rpnLogic:[1,2,"AND",3,"AND"]},{type:"conditions",logic:"1 AND 2 AND 3",conditions:[{"value/field":"field",field:"mailingcountry",type:"STRING",operator:"equals",operand:"mailingcountry","operand type":"STRING"},{"value/field":"field",field:"mailingstate",type:"STRING",operator:"equals",operand:"mailingstate","operand type":"STRING"},{"value/field":"field",field:"mailingcity",type:"STRING",operator:"equals",operand:"mailingcity","operand type":"STRING"}],rpnLogic:[1,2,"AND",3,"AND"]},{type:"conditions",logic:"1 AND 2",conditions:[{"value/field":"field",field:"mailingcountry",type:"STRING",operator:"equals",operand:"mailingcountry","operand type":"STRING"},{"value/field":"field",field:"mailingstate",type:"STRING",operator:"equals",operand:"mailingstate","operand type":"STRING"}],rpnLogic:[1,2,"AND"]},{type:"conditions",logic:"1",conditions:[{"value/field":"field",field:"mailingcountry",type:"STRING",operator:"equals",operand:"mailingcountry","operand type":"STRING"}],rpnLogic:[1]},{type:"optima",field:"lastactivitydate",direction:"max"},{type:"optima",field:"createddate",direction:"min"}]},Magellan.Migration.getFormattedEdgeName=function(e){return["Inactive User","Invalid User","Inactive Matched Lead Owner","Inactive Lead Owner","Inactive Owner"].includes(e)?"Invalid/Inactive User":"Invalid Round Robin Group"===e?"Invalid Round Robin Pool":"Not Available For Routing"===e?"No Round Robin Members Available":"Match without Parent"===e?"Match without Parent Account":"Match (Parent)"===e?"Match (Parent Account)":"Match (Ultimate Parent)"===e?"Match (Ultimate Parent Account)":e},Magellan.Migration.createDefaultO2CTiebreakers=function(){return[{type:"optima",field:"lastactivitydate",direction:"max"},{type:"optima",field:"createddate",direction:"min"}]}}},function(e,t,i){e.exports=function initializeMagellanModels(e){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),joint.dia.ElementView.prototype.initialize=function(){this.magellanNode=this.model instanceof Magellan.Models.Node,this.magellanNode&&(this.markupTemplate=_.template(magellanDocument.getElementById("node_markdown").innerHTML)),_.bindAll(this,"translate","resize","rotate"),joint.dia.CellView.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change:position",this.translate),this.listenTo(this.model,"change:size",this.resize),this.listenTo(this.model,"change:angle",this.rotate)},joint.dia.ElementView.prototype.renderMarkup=function(){var e,t=window.LeanData__PrimarySObjectType.toLowerCase(),i=window.chosenGraphIdMap[t]||null,n=!Magellan.Controllers.FlowBuilder.isEditMode();if(this.magellanNode){nodeStats=Magellan.Util.generateNodeMetricStats(this.model,i);var a=!Magellan.Validation.nodeNameToIsValidCache||!1!==Magellan.Validation.nodeNameToIsValidCache[this.model.nodeInfo.name];e=this.markupTemplate({node:this.model,isValid:a,nodeStats,currentGraphId:i,objectType:t,showDetailsLink:n,showMetrics:n&&$("#view-metrics").prop("checked")})}else e=this.model.get("markup")||this.model.markup;if(!e)throw new Error("properties.markup is missing while the default render() implementation is used.");var o=V(e);this.vel.append(o)},joint.dia.ElementView.prototype.refreshValidationIcons=function(){this.model.isValid().then(function(e){var t=this.model.getNumberOfDanglingEdges();this.$el.find(".edge-notification-number tspan").text(t),e=e&&t<=0,_.each(this.$el.find(".edge-notification"),function(e){var i=e.classList.contains("hidden");t>0?(e.classList.remove("hidden"),$(e).find("tspan").text(t)):t<=0&&!i&&e.classList.add("hidden")});var i=this.$el.find(".validation-error-icon")[0],n=i.classList.contains("hidden");e&&!n?i.classList.add("hidden"):!e&&n&&i.classList.remove("hidden")}.bind(this))},Magellan.Models.getObjectByName=function(e,t){for(var i=t||window,n=e.split("."),a=0;a<n.length;a++)i=i[n[a]];return i},Magellan.Models.setValueByName=function(e,t,i){for(var n=i||window,a=e.split("."),o=!1,l=0;l<a.length;l++)n[a[l]]||(n[a[l]]={}),l==a.length-1?n[a[l]]!=t&&(o=!0,n[a[l]]=t):n=n[a[l]];return o},Magellan.Models.LinkHandler=Backbone.Model.extend({initialize:function(e){this.node=e.node,this.buildLinksForEdges(),this.getEdgeNameToLinkMap(),this.inboundLinks=this.getInboundLinks(),this.nameToNodeMap=Magellan.Controllers.GUI.getNameToNodeMap()},getEdgeNameToLinkMap:function(){this.edgeNameToLink={};var e=this,t=graph.getConnectedLinks(this.node,{outbound:!0});_.each(t,function(t){_.each(t.edges,function(i){e.edgeNameToLink[i.name]=t})})},getInboundLinks:function(){return graph.getConnectedLinks(this.node,{inbound:!0})},changeName:function(e){_.isEmpty(this.inboundLinks)&&(this.inboundLinks=this.getInboundLinks());var t=this;this.inboundLinks=this.getInboundLinks(),_.each(this.inboundLinks,function(i,n){i?_.each(i.edges,function(t){t.target=e}):t.inboundLinks.splice(n,1)})},buildLinksForEdges:function(){var e={};_.each(this.node.nodeInfo.edges,function(t){t.target&&-1!==t.target&&0!==t.target&&(e[t.target]?e[t.target].push(t):e[t.target]=[t])}),this.targetNodeToIncidentEdges=e},refreshLinks:function(){this.buildLinksForEdges(),this.getEdgeNameToLinkMap(),this.removeAllLinks(),this.drawAllLinks()},removeAllLinks:function(){var e=graph.getConnectedLinks(this.node,{outbound:!0});_.each(e,function(e){e.remove()})},drawAllLinks:function(){var e=this.getAllLinks();Magellan.Controllers.GUI.addGraphCells(e)},getAllLinks:function(){var e=[];return this.edgeNameToLink={},_.each(this.targetNodeToIncidentEdges,function(t,i){e.push(this.createNewLink(t,i,!0))},this),e},linkedNodesToFront:function(){var e=graph.getConnectedLinks(this.node,{outbound:!0});_.each(e,function(e){e.getTargetElement().toFront()}),this.node.toFront()},createSeparateLinkForEdge:function(e,t){this.clearLabel(e)},clearLabel:function(e){e.label(0,{attrs:{text:{text:""}}})},labelLink:function(e,t){!t&&e.getTargetElement()&&(t=e.getTargetElement().nodeInfo.name),t&&(this.targetNodeToIncidentEdges[t].length>1?e.label(0,{attrs:{text:{text:Magellan.Util.breakLabelText(_.map(e.edges,function(e){return e.formattedName||Magellan.Migration.getFormattedEdgeName(e.name)}).join("; "))}}}):e.label(0,{attrs:{text:{text:Magellan.Util.breakLabelText(e.edges[0].formattedName||Magellan.Migration.getFormattedEdgeName(e.edges[0].name))}}}))},createNewLink:function(e,t,i){var n=this;e=e.map(function(e){return e.source=n.node.nodeInfo.name,e});var a=new Magellan.Models.DefaultLink({edges:e});return n=this,_.each(e,function(e){n.edgeNameToLink[e.name]=a}),a.set("source",{id:this.node.id,selector:"rect"}),a.set("target",{id:this.nameToNodeMap[t].id,selector:"rect"}),i||(a.addTo(graph),a.getTargetElement().toFront(),this.node.toFront()),this.labelLink(a,t),a},moveLink:function(e,t){},removeLinkForEdge:function(e,t){if((t||e.target)&&this.edgeNameToLink[e.name]){var i=this.edgeNameToLink[e.name];if(t=t||e.target,this.targetNodeToIncidentEdges[t]&&this.targetNodeToIncidentEdges[t].length>1){var n=[];this.targetNodeToIncidentEdges[t]=[];var a=this;_.each(i.edges,function(i){i.name!==e.name&&(a.targetNodeToIncidentEdges[t].push(i),n.push(i))}),i.remove(),this.createNewLink(n,t,!1)}else delete this.targetNodeToIncidentEdges[t],i.remove();delete this.edgeNameToLink[e.name]}},changeEdgeTargetFromMenu:function(e,t,i){var n=Magellan.Util.getNodeNamesToNodesMap(),a=Magellan.Util.getTriggerNodeNames(n);if(_.includes(a,t)&&(t=i),this.removeLinkForEdge(e,i),this.targetNodeToIncidentEdges[t]){var o=this.edgeNameToLink[this.targetNodeToIncidentEdges[t][0].name],l=o.edges;l.push(e),o.remove(),this.createNewLink(l,t,!1)}else this.targetNodeToIncidentEdges[t]=[e],this.createNewLink([e],t,!1);e.target=t},changeLinkTargetFromUI:function(){}}),Magellan.Models.DefaultLink=joint.shapes.defaultMagellanLink=joint.dia.Link.extend({initialize:function(e){e=e||{},joint.dia.Link.prototype.initialize.apply(this,[]),this.edges=e.edges,this.hideLabels=!1},defaults:joint.util.deepSupplement({markup:['<path class="connection" stroke="black" d="M 0 0 0 0"/>','<path class="marker-source" fill="black" stroke="black" d="M 0 0 0 0"/>','<path class="marker-target" fill="black" stroke="black" d="M 0 0 0 0"/>','<path class="connection-wrap" d="M 0 0 0 0"/>','<path class="connection-saber" d="M 0 0 0 0"/>','<g class="marker-vertices"/>','<g class="marker-arrowheads"/>','<g class="link-tools"/>','<g class="labels"/>'].join(""),ldLabelMarkup:magellanDocument.getElementById("label_markup").innerHTML,statsMarkup:magellanDocument.getElementById("stats_markup").innerHTML,arrowheadMarkup:'<g class="custom-marker marker-arrowhead-group marker-arrowhead-group-<%= end %>"><g><rect x="0" height="20" width="20" fill="black" end="target" data-action-type="moveLink" class="marker-arrowhead"/></g></g>',type:"defaultMagellanLink",attrs:{".labels g.image-wrapper":{},".labels rect":{fill:"rgba(255,255,255,1)"},".link-tools":{display:"none"},".connection":{stroke:"#B3B3B3","stroke-width":1},originalProps:{stroke:"#B3B3B3"},".marker-target":{opacity:1,fill:"white","stroke-width":0,d:"M 0 0 L 15 15 z"},".marker-source":{opacity:1,fill:"white","stroke-width":0,d:"M 0 0 L 5 5 z"}},labels:[{position:.5,attrs:{text:{fill:"#555555","font-size":"10px","font-weight":400,"font-family":"Open Sans",x:0,y:0},rect:{stroke:"white","stroke-width":10,rx:5,ry:5,"stroke-opacity":.75}}}]},joint.dia.Link.defaults)}),Magellan.Models.DefaultLink.prototype.getLinkStats=function(){var e=this.getSourceElement();return _.reduce(this.edges,function(t,i){return t+e.getEdgeStats(i.name)},0)},Magellan.Models.DefaultLink.prototype.getRawLinkStats=function(){var e=this.getSourceElement();return _.map(this.edges,function(t){return e.getEdgeStats(t.name)})},Magellan.Models.DefaultLink.prototype.openMultipleLinksMenu=function(){this.prop("attrs/.labels rect.toggle-edges",{"xlink:href":iconToURLMap["Edge Selected"]});var e=new Magellan.Views.MultipleLinksMenu({link:this,sourceNode:this.getSourceElement()});Magellan.Controllers.GUI.activeView=e,$("#html-multiple-links-menu").html(e.render().$el);var t=$(paper.findViewByModel(this).el).find(".labels image").position(),i=$(".joint-paper-scroller").offset();$("#html-multiple-links-menu").css({left:t.left-45-(i.left-136),top:t.top-100-(i.top-131)}),$("#html-multiple-links-menu").show()},Magellan.Models.DefaultLinkView=joint.shapes.defaultMagellanLinkView=joint.dia.LinkView.extend({initialize:function(){joint.dia.LinkView.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"redraw",this.renderLabels)},toggleMultiLinkMenu:function(e){Magellan.Controllers.GUI.openLinkOverlapMenu(this.model)},selectLink:function(e){$(e.target.closest("g")).is(".edge-stats")||($(e.target).is(".marker-arrowhead")?$(e.target).closest(".marker-arrowhead-group-target")[0].classList.add("is-dragging"):e.stopPropagation(),this.model===Magellan.Controllers.GUI.selectedModel||e.metaKey||e.ctrlKey||e.shiftKey||Magellan.Controllers.GUI.selectLink(this.model))},dropLink:function(e){},showInfoBox:function(e){e.stopPropagation(),Magellan.Controllers.GUI.unselectAllStatBox(),$(e.currentTarget).closest(".link").appendTo($(e.currentTarget).closest(".link").parent()),$(e.currentTarget).children("image").attr("xlink:href",iconToURLMap["Selected Edge Stat Icon"]),$(e.currentTarget).children(".metric-number").attr("fill","#1abc9c"),$(e.currentTarget).closest(".labels").find(".stat-box").show(),this.createMetricInfoBoxContent(this.model.getRawLinkStats())},events:{"mousedown .connection-wrap, .labels, .marker-arrowhead":"selectLink","mousedown .image-wrapper":"showInfoBox"},options:{shortLinkLength:0,doubleLinkTools:!1,longLinkLength:160,linkToolsOffset:40,doubleLinkToolsOffset:60,sampleInterval:50},renderLabels:function(){var e=$("#view-metrics").prop("checked"),t=e?this.model.get("statsMarkup"):this.model.get("ldLabelMarkup");return this.model.set("labelMarkup",t),joint.dia.LinkView.prototype.renderLabels.apply(this,arguments),e&&this.formatLabels(),this},createMetricInfoBoxContent:function(e){if(this.$("g.edge-stats").is(".stats-info-rendered"))return this;this.$("g.edge-stats").empty();var t="http://www.w3.org/2000/svg",i=document.createElementNS(t,"rect");i.classList.add("edge-stats-rect"),this.$("g.edge-stats").append(i);var n=document.createElementNS(t,"text");n.classList.add("stats-number","edge-stats-metrics");for(var a=0;a<e.length;a++){var o=this.model.edges[a],l=LeanData__PrimarySObjectType.toLowerCase(),s=chosenGraphIdMap[l],r=document.createElementNS(t,"a"),d=$("#metricswrapper-initial-date").datepicker("getDate")?$("#metricswrapper-initial-date").datepicker("getDate").getTime():"null",c=$("#metricswrapper-end-date").datepicker("getDate")?$("#metricswrapper-end-date").datepicker("getDate").getTime():"null";r.setAttribute("target","_blank"),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","/apex/Dashboard?deploymentId="+s+"&isEdge=true&statType="+$("#stat-type-select").val()+"&source="+encodeURIComponent(o.source)+"&edgeName="+encodeURIComponent(o.name)+"&userStartDate="+d+"&userEndDate="+c+"&target="+encodeURIComponent(o.target)+"#routing/"+l+"/metrics");var u=document.createElementNS(t,"tspan");u.classList.add("edge-stats-metric-number"),u.setAttribute("y",20*a),u.appendChild(document.createTextNode(e[a])),r.appendChild(u),n.appendChild(r);var p=document.createElementNS(t,"tspan");p.classList.add("edge-stats-metric-name","v-line"),p.setAttribute("y",20*a),p.appendChild(document.createTextNode(Magellan.Migration.getFormattedEdgeName(o.name))),n.appendChild(p)}return this.$("g.edge-stats").append(n),this.$("g.edge-stats")[0].classList.add("stats-info-rendered"),this.formatStatsInfoBox(e),this},formatLabels:function(){var e=this.model.getLinkStats()+"";return this.$(".wrapper-box").attr({"stroke-width":0,height:"40px",transform:this.$(".wrapper-box").attr("transform")+" translate(0, -15)"}),this.$(".edge-name").attr({transform:this.$(".edge-name").attr("transform")+" translate(0, 8)"}),this.$(".edge-name-box").attr({"stroke-width":0,transform:this.$(".edge-name-box").attr("transform")+" translate(0, 9)"}),this.$(".metric-number").text(e).attr({fill:"#2DB670",transform:this.$(".metric-number").attr("transform")+" translate(0, -8)","font-weight":400,"font-size":"16px","font-family":"'Open Sans', sans-serif"}),this.$(".metric-number-box").attr({"stroke-width":0,width:10*e.length,transform:this.$(".metric-number").attr("transform")+" translate(-5, -12)"}),this},formatStatsInfoBox:function(){this.$(".edge-stats").attr({transform:"translate(30, -10)"});var e=0;this.$(".edge-stats-metrics .edge-stats-metric-number").each(function(){e=Math.max(this.getComputedTextLength(),e)});var t=e+10,i=this.$(".edge-stats-metrics")[0].getBBox(),n=i.width+30,a=i.height+20;return this.$(".edge-stats-metrics").attr({transform:"translate(10, 10)"}),this.$(".edge-stats-metric-number").attr({x:0,"font-weight":600}),this.$(".edge-stats-metric-name").attr({x:t}),this.$(".edge-stats-rect").attr({stroke:"#5e7178","stroke-width":"1pt",fill:"#f1f9ff",x:0,y:-10,rx:5,ry:5,width:n,height:a}),this},updateConnection:function(e){e=e||{};var t,i=this.model;if(e.translateBy&&i.isRelationshipEmbeddedIn(e.translateBy)){var n=e.tx||0,a=e.ty||0;t=this.route=_.map(this.route,function(e){return g.point(e).offset(n,a)}),this._translateConnectionPoints(n,a)}else t=this.route=this.findRoute(i.get("vertices")||[],e),this._findConnectionPoints(t);var o=this.getPathData(t);this._V.connection.attr("d",o),this._V.connectionWrap&&this._V.connectionWrap.attr("d",o),this._translateAndAutoOrientArrows(this._V.markerSource,this._V.markerTarget),this._V.connectionSaber&&this._V.connectionSaber.attr("d",o)}}),Magellan.Models.DefaultLink.prototype.dropLink=function(){this.defaultPresentation();var e=this.getSourceElement();if(e){var t=this.getTargetElement();if(t===e&&this.remove(),t){var i=Magellan.Util.getNodeNamesToNodesMap(),n=Magellan.Util.getTriggerNodeNames(i);if(_.includes(n,t.nodeInfo.name)){var a=this.edges[0].condition,o=e.nodeInfo.edges.filter(function(e){return e.condition===a})[0];this.edges[0].target=o.target}else this.edges[0].target=t.nodeInfo.name}else this.edges[0].target=null;e.resyncNodeInfoAndPresentation()}},Magellan.Models.DefaultLink.prototype.defaultPresentation=function(){var e=paper.findViewByModel(this)?paper.findViewByModel(this).el:null,t=$(e).find(".marker-arrowhead-group-target .marker-arrowhead"),i=$(e).find(".connection-saber")[0];e&&e.classList.remove("selected"),i&&(i.classList.remove("selected"),t.removeClass("selected"))},Magellan.Models.DefaultLink.prototype.styleAsSelected=function(){var e=paper.findViewByModel(this).el,t=$(e).find(".marker-arrowhead-group-target .marker-arrowhead"),i=$(e).find(".connection-saber")[0];$(e).find(".connection").css({stroke:"var(--dk-grey-1","stroke-width":"2px"}),e&&e.classList.add("selected"),t&&t.css({visibility:"visible",fill:"url(#edge-arrow-selected)"}),i&&(i.classList.add("selected"),t.addClass("selected"),console.log(t.attr("class"))),this.toFront(),this.getSourceElement().toFront()},Magellan.Models.DefaultLink.prototype.styleAsError=function(){var e=paper.findViewByModel(this).el,t=($(e).find(".marker-arrowhead-group-target .marker-arrowhead"),$(e).find(".connection-saber")[0]);e&&e.classList.add("error"),t&&t.classList.add("error")},Magellan.Models.DefaultLink.prototype.clearStyles=function(){var e=paper.findViewByModel(this).el,t=($(e).find(".marker-arrowhead-group-target .marker-arrowhead"),$(e).find(".connection-saber")[0]);e&&(e.classList.remove("error"),e.classList.remove("selected")),t&&(t.classList.remove("error"),t.classList.remove("selected"))},Magellan.Models.DefaultLink.prototype.getLinkSlope=function(){var e=this.getSourceElement()?this.getSourceElement().get("position"):this.get("source");return(0+(this.getTargetElement()?this.getTargetElement().get("position"):this.get("target")).y-e.y)/(0+e.x-e.x)},Magellan.Models.StencilElement=joint.shapes.basic.Rect.extend({initialize:function(e){var t=_.merge({height:40,width:198},e);joint.shapes.basic.Rect.prototype.initialize.call(this,t),this.attributes.size.width=e.width||198,this.attributes.size.height=e.height||40,this.nodeModel=e.nodeModel,this.stencilModel=e.stencilModel},clone:function(){return new(Magellan.Models.getObjectByName(this.nodeModel))({id:"",position:{x:0,y:0}})},defaults:_.defaultsDeep({type:"Magellan.Models.StencilElement",attrs:{"rect.stencil-dropdown-item-rect":{fill:"rgba(255, 255, 255, 1)",stroke:"rgba(230, 230, 230, 1)",width:198,height:40}}},joint.shapes.basic.Generic.prototype.defaults)}),Magellan.Models.MatchNodeStencil=Magellan.Models.StencilElement.extend({initialize:function(e){var t=_.merge({width:198,nodeModel:"Magellan.Models.MatchNode",stencilModel:"Magellan.Models.MatchNodeStencil",iconType:"image"},e);Magellan.Models.StencilElement.prototype.initialize.call(this,t),this.dropdownLabel=e.dropdownLabel,this.dropdownImage=e.dropdownImage,this.iconType=t.iconType,this.template=_.template(magellanDocument.getElementById("stencil_dropdown_item").innerHTML),this.markup=this.template({stencil:this})},defaults:_.defaultsDeep({attrs:{"rect.stencil-dropdown-item-rect":{fill:"rgba(255, 255, 255, 0)",stroke:"rgba(230, 230, 230, 1)",width:198,height:40}}},Magellan.Models.StencilElement.prototype.defaults)}),Magellan.Models.DecisionNodeStencil=Magellan.Models.StencilElement.extend({initialize:function(e){if(_.isEmpty(e.nodeModel)||_.isEmpty(e.dropdownLabel)||_.isEmpty(e.dropdownImage))throw new Error("Decision Node Stencil should not be instantiated in its raw form!");var t=_.merge({stencilModel:"Magellan.Models.DecisionNodeStencil",iconType:"image"},e);Magellan.Models.StencilElement.prototype.initialize.call(this,t),this.dropdownLabel=e.dropdownLabel,this.dropdownImage=e.dropdownImage,this.iconType=t.iconType,this.template=_.template(magellanDocument.getElementById("stencil_dropdown_item").innerHTML),this.markup=this.template({stencil:this})}}),Magellan.Models.TrueFalseNodeStencil=Magellan.Models.DecisionNodeStencil.extend({initialize:function(e){if(_.isEmpty(e.nodeModel)||_.isEmpty(e.dropdownLabel)||_.isEmpty(e.dropdownImage))throw new Error("True/False Node Stencil should not be instantiated in its raw form!");var t=_.merge({stencilModel:"Magellan.Models.TrueFalseNodeStencil",iconType:"image"},e);Magellan.Models.DecisionNodeStencil.prototype.initialize.call(this,t)}}),Magellan.Models.BranchNodeStencil=Magellan.Models.DecisionNodeStencil.extend({initialize:function(e){if(_.isEmpty(e.nodeModel)||_.isEmpty(e.dropdownLabel)||_.isEmpty(e.dropdownImage))throw new Error("Branch Node Stencil should not be instantiated in its raw form!");var t=_.merge({stencilModel:"Magellan.Models.BranchNodeStencil",iconType:"image"},e);Magellan.Models.DecisionNodeStencil.prototype.initialize.call(this,t)}}),Magellan.Models.RerouteNodeStencil=Magellan.Models.StencilElement.extend({initialize:function(e){if(_.isEmpty(e.nodeModel)||_.isEmpty(e.dropdownLabel)||_.isEmpty(e.dropdownImage))throw new Error("Re-route Node Stencil should not be instantiated in its raw form!");var t=_.merge({stencilModel:"Magellan.Models.RerouteNodeStencil"},e);Magellan.Models.StencilElement.prototype.initialize.call(this,t),this.dropdownLabel=e.dropdownLabel,this.dropdownImage=e.dropdownImage,this.iconType="image",this.template=_.template(magellanDocument.getElementById("stencil_dropdown_item").innerHTML),this.markup=this.template({stencil:this})}}),Magellan.Models.ActionNodeStencil=Magellan.Models.StencilElement.extend({initialize:function(e){if(_.isEmpty(e.nodeModel)||_.isEmpty(e.dropdownLabel)||_.isEmpty(e.dropdownImage))throw new Error("Action Node Stencil should not be instantiated in its raw form!");var t=_.merge({stencilModel:"Magellan.Models.ActionNodeStencil"},e);Magellan.Models.StencilElement.prototype.initialize.call(this,t),this.dropdownLabel=e.dropdownLabel,this.dropdownImage=e.dropdownImage,this.iconType="image",this.template=_.template(magellanDocument.getElementById("stencil_dropdown_item").innerHTML),this.markup=this.template({stencil:this})}}),Magellan.Models.OutreachNodeStencil=Magellan.Models.StencilElement.extend({initialize:function(e){if(_.isEmpty(e.nodeModel)||_.isEmpty(e.dropdownLabel)||_.isEmpty(e.dropdownImage))throw new Error("Outreach Node Stencil should not be instantiated in its raw form!");const t=_.merge({stencilModel:"Magellan.Models.OutreachNodeStencil"},e);Magellan.Models.StencilElement.prototype.initialize.call(this,t),this.dropdownLabel=e.dropdownLabel,this.dropdownImage=e.dropdownImage,this.iconType="image",this.template=_.template(magellanDocument.getElementById("stencil_dropdown_item").innerHTML),this.markup=this.template({stencil:this})}}),Magellan.Models.SalesloftNodeStencil=Magellan.Models.StencilElement.extend({initialize:function(e){if(_.isEmpty(e.nodeModel)||_.isEmpty(e.dropdownLabel)||_.isEmpty(e.dropdownImage))throw new Error("Salesloft Node Stencil should not be instantiated in its raw form!");const t=_.merge({stencilModel:"Magellan.Models.SalesloftNodeStencil"},e);Magellan.Models.StencilElement.prototype.initialize.call(this,t),this.dropdownLabel=e.dropdownLabel,this.dropdownImage=e.dropdownImage,this.iconType="image",this.template=_.template(magellanDocument.getElementById("stencil_dropdown_item").innerHTML),this.markup=this.template({stencil:this})}}),Magellan.Models.TerritoryStencil=Magellan.Models.ActionNodeStencil.extend({defaults:joint.util.deepSupplement({dropdownLabel:"Territory",dropdownImage:"Route To Territory",stencilModel:"Magellan.Models.TerritoryStencil",nodeModel:"Magellan.Models.TerritoryNode"},Magellan.Models.ActionNodeStencil.prototype.defaults)}),Magellan.Models.TerritoryRoutingStencil=Magellan.Models.ActionNodeStencil.extend({defaults:joint.util.deepSupplement({dropdownLabel:"Route to Territory",dropdownImage:"Route To Territory",stencilModel:"Magellan.Models.TerritoryRoutingStencil",nodeModel:"Magellan.Models.TerritoryRouting"},Magellan.Models.ActionNodeStencil.prototype.defaults)}),Magellan.Models.Node=joint.shapes.basic.Generic.Node=joint.shapes.basic.Generic.extend({initialize:function(e){Magellan.Models.Node.__super__.initialize.apply(this,[]),e.nodeInfo?(this.nodeInfo=e.nodeInfo,this.runLazyMigration()):this.addNodeInfo(),this.edgeToMetrics={},this.nameLines=this.parseNodeName(this.nodeInfo.name);var t=this.getDynamicNodeNameLinesPositioning(this.nameLines.length),i=this.get("attrs");t["line-1"]&&(i["tspan.line-1"]=t["line-1"]),t["line-2"]&&(i["tspan.line-2"]=t["line-2"]),t["line-3"]&&(i["tspan.line-3"]=t["line-3"])},runLazyMigration:function(){if((this instanceof Magellan.Models.ContactTrueFalseNode||this instanceof Magellan.Models.ContactBranchNode)&&!this.nodeInfo.objectType&&(this.nodeInfo.objectType="Contact"),(this instanceof Magellan.Models.AccountTrueFalseNode||this instanceof Magellan.Models.AccountBranchNode)&&!this.nodeInfo.objectType&&(this.nodeInfo.objectType="Account"),this instanceof Magellan.Models.AccountTeamRouting&&-1==_.findIndex(this.nodeInfo.edges,{condition:"Inactive User"})&&this.nodeInfo.edges.push(Magellan.Migration.defaultInactiveUserEdge()),(this instanceof Magellan.Models.RoundRobin||this instanceof Magellan.Models.ContactRoundRobin||this instanceof Magellan.Models.AccountRoundRobin||this instanceof Magellan.Models.OpportunityRoundRobin||this instanceof Magellan.Models.TerritoryRouting||this instanceof Magellan.Models.ContactRouteToTerritory||this instanceof Magellan.Models.AccountRouteToTerritory||this instanceof Magellan.Models.OpportunityRouteToTerritory)&&-1===_.findIndex(this.nodeInfo.edges,{condition:"Not Available For Routing"})&&this.nodeInfo.edges.splice(1,0,Magellan.Migration.defaultNotAvailableForRoutingEdge()),(this instanceof Magellan.Models.TerritoryRouting||this instanceof Magellan.Models.ContactRouteToTerritory||this instanceof Magellan.Models.AccountRouteToTerritory||this instanceof Magellan.Models.OpportunityRouteToTerritory)&&-1===_.findIndex(this.nodeInfo.edges,{name:"Invalid Group"})&&this.nodeInfo.edges.splice(1,0,Magellan.Migration.defaultInvalidPoolEdge()),this instanceof Magellan.Models.MatchNode&&"L2O"===this.nodeInfo.objectType){var e=new Set(_.map(Magellan.Migration.OPPORTUNITY_OPTIMA_FIELDS,function(e){return e.name}));_.each(this.nodeInfo.tiebreakers,function(t){"optima"===t.type&&e.has(t.field)&&(t.field="account."+t.field)},this)}if(this instanceof Magellan.Models.MatchNode&&null!=this.nodeInfo["exclude inactive and queue owned"]&&(this.nodeInfo["exclude inactive owned"]=this.nodeInfo["exclude inactive and queue owned"],delete this.nodeInfo["exclude inactive and queue owned"]),this instanceof Magellan.Models.SendNotification&&("Contact"===LeanData__PrimarySObjectType&&(this.nodeInfo.magellanClass="Magellan.Models.ContactSendNotification"),"Account"===LeanData__PrimarySObjectType&&(this.nodeInfo.magellanClass="Magellan.Models.AccountSendNotification"),"Opportunity"===LeanData__PrimarySObjectType&&(this.nodeInfo.magellanClass="Magellan.Models.OpportunitySendNotification")),this instanceof Magellan.Models.RerouteNode){var t=!1;delete this.nodeInfo.objectType,_.each(this.nodeInfo.edges,function(e){"schedule_route"===e.type&&(e.type="system"),"[Abort]"===e.name&&(t=!0)}),t||this.nodeInfo.edges.splice(this.nodeInfo.edges.length-1,0,{type:"system",name:"[Abort]",target:-1})}},refreshLinkHandler:function(){this.linkHandler=new Magellan.Models.LinkHandler({node:this})},refreshLinks:function(){this.linkHandler||this.refreshLinkHandler(),this.linkHandler.refreshLinks()},changeName:function(e){this.nodeInfo.name=e,this.linkHandler.changeName(e),this.renderName(e)},updateMetrics:function(e,t){this.edgeToMetrics[e]=t},markup:magellanDocument.getElementById("node_markdown").innerHTML,defaults:joint.util.deepSupplement({type:"basic.Generic.Node",attrs:{"image.function-menu":{},"image.paste-icon":{"xlink:href":iconToURLMap["Paste Function Icon"],height:20,width:20,x:122,y:22,display:"none"},"image.copy-icon":{"xlink:href":iconToURLMap["Copy Function Icon"],height:20,width:20,x:100,y:22,display:"none"},"image.edit-icon":{"xlink:href":iconToURLMap["Edit Function Icon"],height:20,width:20,x:100,y:0,display:"none"},"image.delete-icon":{"xlink:href":iconToURLMap["Delete Function Icon"],height:20,width:20,x:100,y:44,display:"none"},"image.validation-error-icon":{"xlink:href":iconToURLMap["Node Validation Error Icon"],height:20,width:20},"image.edge-notification-icon":{"xlink:href":iconToURLMap["Edge Notification Icon"],height:22,width:23},"image.main-icon":{x:0,y:0,opacity:1},"image.auxiliary-icon":{display:"none"},"text.edge-notification-number":{fill:"#000000","font-size":"10px","font-family":"Arial"},"text.node-name-text-box":{fill:"#555555","text-shadow":"1px 0 0 lightgray","text-anchor":"middle","font-family":"Arial",display:"block","font-size":"12px","font-weight":"400","pointer-events":"none"},"tspan.object-hat":{display:"none",fill:"#000000","font-weight":"500","font-size":"9px"},"tspan.line-1":{x:38,y:20},"tspan.line-2":{x:38,y:32},"tspan.line-3":{x:38,y:44}}},joint.shapes.basic.Generic.prototype.defaults)}),Magellan.Models.Node.prototype.getDefaultName=function(e){var t;this instanceof Magellan.Models.RerouteNode?t="Time-Based Route":this instanceof Magellan.Models.DecisionNode?t=this instanceof Magellan.Models.BranchNode?"Branch":this instanceof Magellan.Models.TerritoryNode?"Territory":"True/False":this instanceof Magellan.Models.MatchNode?t="Match Node":this instanceof Magellan.Models.CreateAccount?t="Create Account":this instanceof Magellan.Models.AssignOwnerOpportunity?t="Route to Matched Opportunity":"Explicit Owner Assignment"==this.attributes.actionType?t="Assign Owner":["Account Based Routing","Assign Owner Account","Route to Account"].includes(this.attributes.actionType)?t="Route to Matched Account":["Lead Based Routing","Assign Owner Lead"].includes(this.attributes.actionType)?t="Route to Matched Lead":["Route to Contact"].includes(this.attributes.actionType)?t="Route to Matched Contact":this instanceof Magellan.Models.TerritoryRouting?t="Route to Territory":"Outreach - Add to Sequence"==this.attributes.actionType?t="Add to Sequence":"Salesloft - Add to Cadence"==this.attributes.actionType?t="Add to Cadence":this instanceof Magellan.Models.ActionNode&&(t=this.attributes.actionType);var i=0,a=new RegExp("^\\s*"+t+"\\s*[0-9]+$"),o=new RegExp("^\\s*"+t+"\\s*$"),l=Magellan.Util.getAllNodes(window.graph);return _.each(l,function(e){0==i&&e.nodeInfo&&o.exec(e.nodeInfo.name)?i=1:e.nodeInfo&&a.exec(e.nodeInfo.name)&&(n=parseInt(e.nodeInfo.name.split(t)[1]))>i&&(i=n)}),i>0&&!e?t+" "+(i+1):t},Magellan.Models.Node.prototype.showActionIcons=function(){this.prop("attrs/image.edit-icon",{display:"block"}),this instanceof Magellan.Models.CustomInterface||this instanceof Magellan.Models.TriggerNode||this.prop("attrs/image.copy-icon",{display:"block"}),this instanceof Magellan.Models.TriggerNode||this.prop("attrs/image.delete-icon",{display:"block"})},Magellan.Models.Node.prototype.hideActionIcons=function(){this.prop("attrs/image.delete-icon",{display:"none"}),this.prop("attrs/image.copy-icon",{display:"none"}),this.prop("attrs/image.edit-icon",{display:"none"})},Magellan.Models.Node.prototype.defaultPresentation=function(){var e=paper.findViewByModel(this);domNode=e?e.el:null,domNode&&!selection.collection.contains(graph.getCell(this.id))&&domNode.classList.remove("selected"),this.prop("attrs/image.edge-notification-icon",{"xlink:href":iconToURLMap["Edge Notification Icon"],x:this.attributes.defaultNotificationIcon.x,y:this.attributes.defaultNotificationIcon.y,height:22,width:23}),this.prop("attrs/.labels rect.toggle-edges",{"xlink:href":iconToURLMap["Edge Unselected"]}),this.prop("attrs/image.main-icon",{"xlink:href":this.attributes.defaultImage.source,x:this.attributes.defaultImage.x,y:this.attributes.defaultImage.y,height:this.attributes.defaultImage.height,width:this.attributes.defaultImage.width}),this.hideActionIcons()},Magellan.Models.Node.prototype.getNumberOfDanglingEdges=function(){var e=0;return _.each(this.nodeInfo.edges,function(t){t.target||0===t.target||"system"===t.type||e++}),e},Magellan.Models.Node.prototype.getNameToEdgeMap=function(){var e={};return _.each(this.nodeInfo.edges,function(t){e[t.name]=t}),e},Magellan.Models.Node.prototype.getEdgesForSelection=function(){return this.nodeInfo.edges},Magellan.Models.Node.prototype.getStats=function(){return this.edgeToMetrics},Magellan.Models.Node.prototype.getSuccessEdgeNames=function(){return["Next Node"]},Magellan.Models.Node.prototype.getSuccessStats=function(){var e=this.getSuccessEdgeNames(),t=0;return e.length>0&&(t=_.reduce(e,function(e,t){return e+this.getEdgeStats(t)},0,this)),t},Magellan.Models.Node.prototype.getSuccessEOFEdgeNames=function(){var e=this.getSuccessEdgeNames(),t=_.filter(this.nodeInfo.edges,function(t){return _.includes(e,t.name)&&(-1===t.target||_.isEmpty(t.target))});return _.map(t,function(e){return e.name})},Magellan.Models.Node.prototype.getSuccessEOFStats=function(){var e=this.getSuccessEOFEdgeNames(),t=0;return e.length>0&&(t=_.reduce(e,function(e,t){return e+this.getEdgeStats(t)},0,this)),t},Magellan.Models.Node.prototype.getFailureEdgeNames=function(){var e=this.getSuccessEdgeNames(),t=_.filter(this.nodeInfo.edges,function(t){return!_.includes(e,t.name)});return _.map(t,function(e){return e.name})},Magellan.Models.Node.prototype.getFailureStats=function(){var e=this.getFailureEdgeNames(),t=0;return e.length>0&&(t=_.reduce(e,function(e,t){return e+this.getEdgeStats(t)},0,this)),t},Magellan.Models.Node.prototype.getErrorEdgeNames=function(){return["Other Errors"]},Magellan.Models.Node.prototype.getErrorStats=function(){var e=this.getErrorEdgeNames(),t=0;return e.length>0&&(t=_.reduce(e,function(e,t){return e+this.getEdgeStats(t)},0,this)),t},Magellan.Models.Node.prototype.getEndOfFlowStats=function(){var e=0,t=_.filter(this.nodeInfo.edges,function(e){return(-1===e.target||_.isEmpty(e.target))&&"[Schedule Route]"!==e.name});return t.length>0&&(e=_.reduce(t,function(e,t){return e+this.getEdgeStats(t.name)},0,this)),e},Magellan.Models.Node.prototype.getEdgeStats=function(e){return this.edgeToMetrics[e]||0},Magellan.Models.Node.prototype.openEdgeMenu=function(e){this.prop("attrs/image.edge-notification-icon",{"xlink:href":iconToURLMap["Edge Notification Icon Highlighted"],x:this.attributes.highlightedNotificationIcon.x,y:this.attributes.highlightedNotificationIcon.y,height:32,width:32});var t=new Magellan.Views.EdgeMenu({node:this});$("#html-edge-menu").html(t.render().$el);var i=$(".joint-paper-scroller").offset();$("#html-edge-menu").css({left:e.offset().left-this.attributes.edgeMenuMargin.x-(i.left-156),top:e.offset().top-this.attributes.edgeMenuMargin.y-(i.top-131)}),$("#html-edge-menu").show()},Magellan.Models.Node.prototype.selectNodeForEdge=function(){this.prop("attrs/image.main-icon",{"xlink:href":this.attributes.dashedImage.source,x:this.attributes.dashedImage.x,y:this.attributes.dashedImage.y,height:this.attributes.dashedImage.height,width:this.attributes.dashedImage.width})},Magellan.Models.Node.prototype.addNodeInfo=function(){console.log(this),console.error("addNodeInfo of generic Node class should not be called")},Magellan.Models.Node.prototype.highlightNode=function(){return this.toFront(),domNode=paper.findViewByModel(this).el,domNode&&domNode.classList.add("selected"),this},Magellan.Models.Node.prototype.parseNodeName=function(e){e=_.escape(e);var t=this instanceof Magellan.Models.DecisionNode||this instanceof Magellan.Models.RerouteNode?2:3,i=61;return this instanceof Magellan.Models.MatchNode?i=55:this instanceof Magellan.Models.RerouteNode&&Magellan.Controllers.FlowBuilder.isEditMode()?i=120:this instanceof Magellan.Models.OutreachNode?i=95:this instanceof Magellan.Models.SalesloftNode&&(i=95),Magellan.Util.wrapText(e,t,i)},Magellan.Models.Node.prototype.renderName=function(e){if(this._oldName!==e){this.nameLines=[];var t=this.parseNodeName(e);this.spaceText(t.length);var i=paper.findViewByModel(this);$(i.$el.find(".line-1")[0]).html(this.nameLines[0]=t[0]||""),$(i.$el.find(".line-2")[0]).html(this.nameLines[1]=t[1]||""),$(i.$el.find(".line-3")[0]).html(this.nameLines[2]=t[2]||""),this._oldName=e}},Magellan.Models.Node.prototype.getDynamicNodeNameLinesPositioning=function(e){var t,i={},n=this.get("defaultImage").height,a=this.get("attrs")["tspan.line-1"].x;return this instanceof Magellan.Models.MatchNode||this instanceof Magellan.Models.DecisionNode?t=5*(e-1)-5:this instanceof Magellan.Models.ActionNode?t=0+7*(e-1):this instanceof Magellan.Models.RerouteNode?(Magellan.Controllers.FlowBuilder.isEditMode()||(a=37),t=5*(e-1)-3):t=this instanceof Magellan.Models.OutreachNode||this instanceof Magellan.Models.SalesloftNode?1.5*(e*e+e)-4:5+5*(e-1),1===e?i["line-1"]={x:a,y:n/2-t}:2===e?(i["line-1"]={x:a,y:n/2-t},i["line-2"]={x:a,y:i["line-1"].y+14*1.1}):3===e&&(i["line-1"]={x:a,y:n/2-t},i["line-2"]={x:a,y:i["line-1"].y+14*1.1},i["line-3"]={x:a,y:i["line-2"].y+14*1.1}),i},Magellan.Models.Node.prototype.spaceText=function(e){var t=this.getDynamicNodeNameLinesPositioning(e);this.prop("attrs/tspan.line-1",t["line-1"]),this.prop("attrs/tspan.line-2",t["line-2"]),this.prop("attrs/tspan.line-3",t["line-3"])},Magellan.Models.Node.prototype.getAbsoluteCenter=function(){var e=this.position(),t=this.get("linkConnection");return g.point(e.x+t.x,e.y+t.y)},Magellan.Models.Node.prototype.resyncNodeInfoAndPresentation=function(e){if(e=e||{},this.renderName(this.nodeInfo.name),e.renderForm){var t=new Magellan.Views.NodeForm({model:this}).render().$el;$("#properties-wrapper").html(t)}this.refreshLinkHandler(),!1!==e.refreshLinks&&this.refreshLinks(),!1!==e.toFront&&this.toFront(),!1!==e.bindButtons&&Magellan.Controllers.GUI.bindButtons(),paper.findViewByModel(this).refreshValidationIcons()},Magellan.Models.MatchNode=joint.shapes.basic.Generic.MatchNode=Magellan.Models.Node.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.MatchNode",magellanClass:"Magellan.Models.MatchNode",defaultImage:{source:iconToURLMap["Match Node Opaque"],width:86.5,height:83,x:15,y:0},highlightedImage:{source:iconToURLMap["Match Node Highlighted"],width:96,height:92,x:10,y:-5},dashedImage:{source:iconToURLMap["Match Node Dashed"],width:86.5,height:83,x:15,y:0},selectedImage:{source:iconToURLMap["Match Node"],width:86.5,height:83,x:15,y:0},defaultNotificationIcon:{x:45,y:69},highlightedNotificationIcon:{x:40,y:64},edgeMenuMargin:{x:45,y:100},transparentImage:"",labelClass:"match-node-label",linkConnection:{x:58.25,y:41.5},attrs:{label:"Match Node","image.paste-icon":{x:125,y:27},"image.copy-icon":{x:106,y:27},"image.edit-icon":{x:106,y:5},"image.delete-icon":{x:106,y:49},"image.validation-error-icon":{x:5,y:16},"g.highlighted image.main-icon":{"xlink:href":iconToURLMap["Match Node Dashed"]},"image.main-icon":{"xlink:href":iconToURLMap["Match Node Opaque"],height:82,width:86,x:15},"image.edge-notification-icon":{x:45,y:69},"text.edge-notification-number":{x:56,y:85},"tspan.object-hat":{display:"block",x:61,y:18},"tspan.line-1":{x:58,y:36},"tspan.line-2":{x:58,y:48},"tspan.line-3":{x:58,y:60},"image.end-of-flow-icon":{"xlink:href":iconToURLMap["End of Flow Icon"],height:40,width:40}}},Magellan.Models.Node.prototype.defaults)}),Magellan.Models.MatchNodes={},Magellan.Models.MatchNodes.Lead2Account=Magellan.Models.MatchNode.extend({defaults:joint.util.deepSupplement({objectType:"L2A"},Magellan.Models.MatchNode.prototype.defaults)}),Magellan.Models.MatchNodes.Lead2Opportunity=Magellan.Models.MatchNode.extend({defaults:joint.util.deepSupplement({objectType:"L2O"},Magellan.Models.MatchNode.prototype.defaults)}),Magellan.Models.MatchNodes.Lead2Lead=Magellan.Models.MatchNode.extend({defaults:joint.util.deepSupplement({objectType:"L2L"},Magellan.Models.MatchNode.prototype.defaults)}),Magellan.Models.MatchNodes.Duplicate=Magellan.Models.MatchNode.extend({defaults:joint.util.deepSupplement({objectType:"Dupe"},Magellan.Models.MatchNode.prototype.defaults)}),Magellan.Models.MatchNodes.DuplicateContact=Magellan.Models.MatchNode.extend({defaults:joint.util.deepSupplement({objectType:"DupeC"},Magellan.Models.MatchNode.prototype.defaults)}),Magellan.Models.MatchNode.prototype.getFormTitle=function(){return"Match Node"},Magellan.Models.MatchNode.prototype.addNodeInfo=function(e){var t={type:"MATCH",magellanClass:this.attributes.magellanClass,name:e||this.getDefaultName(),objectType:this.attributes.objectType,edges:[Magellan.Migration.defaultMatchEdge(),Magellan.Migration.defaultNoMatchEdge()],"filter type":"none",filter:{type:"conditions",conditions:[],logic:""}};switch(this.nodeInfo=t,this.nodeInfo.objectType){case"L2L":case"Dupe":this.nodeInfo.tiebreakers=[{type:"conditions",logic:"1 AND 2 AND 3",conditions:[{"value/field":"field",field:"Country",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"State",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"},{"value/field":"field",field:"PostalCode",type:"STRING",operator:"equals",operand:"PostalCode","operand type":"STRING"}],rpnLogic:[1,2,"AND",3,"AND"]},{type:"conditions",logic:"1 AND 2 AND 3",conditions:[{"value/field":"field",field:"Country",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"State",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"},{"value/field":"field",field:"City",type:"STRING",operator:"equals",operand:"City","operand type":"STRING"}],rpnLogic:[1,2,"AND",3,"AND"]},{type:"conditions",logic:"1 AND 2",conditions:[{"value/field":"field",field:"Country",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"State",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"}],rpnLogic:[1,2,"AND"]},{type:"conditions",logic:"1",conditions:[{"value/field":"field",field:"Country",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"}],rpnLogic:[1]},{type:"optima",field:"LastActivityDate",direction:"max"},{type:"optima",field:"CreatedDate",direction:"min"}];break;case"L2A":this.nodeInfo.tiebreakers=[{type:"conditions",logic:"1 AND 2 AND 3",conditions:[{"value/field":"field",field:"BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"BillingState",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"},{"value/field":"field",field:"BillingPostalCode",type:"STRING",operator:"equals",operand:"PostalCode","operand type":"STRING"}],rpnLogic:[1,2,"AND",3,"AND"]},{type:"conditions",logic:"1 AND 2",conditions:[{"value/field":"field",field:"BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"BillingState",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"}],rpnLogic:[1,2,"AND"]},{type:"conditions",logic:"1",conditions:[{"value/field":"field",field:"BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"}],rpnLogic:[1]},{type:"optima",field:"#children",direction:"max"},{type:"optima",field:"#opportunities",direction:"max"},{type:"optima",field:"#contacts",direction:"max"},{type:"optima",field:"LastActivityDate",direction:"max"},{type:"optima",field:"CreatedDate",direction:"min"}];break;case"L2O":this.nodeInfo.tiebreakers=[{type:"conditions",logic:"1",conditions:[{"value/field":"value",field:"isclosed",type:"BOOLEAN",operator:"equals",operand:!1}],rpnLogic:[1]},{type:"conditions",logic:"1",conditions:[{"value/field":"value",field:"stagename",type:"PICKLIST",operator:"contains",operand:"open"}],rpnLogic:[1]},{type:"optima",field:"CreatedDate",direction:"min"}],this.nodeInfo["restrict l2o to chosen account"]=!0;break;case"DupeC":this.nodeInfo.tiebreakers=[{type:"conditions",logic:"1 AND 2 AND 3",conditions:[{"value/field":"field",field:"Account.BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"Account.BillingState",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"},{"value/field":"field",field:"Account.BillingPostalCode",type:"STRING",operator:"equals",operand:"PostalCode","operand type":"STRING"}],rpnLogic:[1,2,"AND",3,"AND"]},{type:"conditions",logic:"1 AND 2 AND 3",conditions:[{"value/field":"field",field:"Account.BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"Account.BillingState",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"},{"value/field":"field",field:"Account.BillingCity",type:"STRING",operator:"equals",operand:"City","operand type":"STRING"}],rpnLogic:[1,2,"AND",3,"AND"]},{type:"conditions",logic:"1 AND 2",conditions:[{"value/field":"field",field:"Account.BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"Account.BillingState",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"}],rpnLogic:[1,2,"AND"]},{type:"conditions",logic:"1",conditions:[{"value/field":"field",field:"Account.BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"}],rpnLogic:[1]},{type:"optima",field:"LastActivityDate",direction:"max"},{type:"optima",field:"CreatedDate",direction:"min"}]}},Magellan.Models.MatchNode.OBJECT_TYPE_TO_DRAGGABLE_MATCH_NODES_CLASS_INFO={Lead:[{nodeModel:"Magellan.Models.MatchNodes.Lead2Lead",dropdownLabel:"Lead2Lead",dropdownImage:"Lead2Lead Icon"},{nodeModel:"Magellan.Models.MatchNodes.Lead2Account",dropdownLabel:"Lead2Account",dropdownImage:"Lead2Account Icon"},{nodeModel:"Magellan.Models.MatchNodes.Lead2Opportunity",dropdownLabel:"Lead2Opportunity",dropdownImage:"Lead2Opportunity Icon"},{nodeModel:"Magellan.Models.MatchNodes.Duplicate",dropdownLabel:"Duplicate",dropdownImage:"Duplicate Icon"},{nodeModel:"Magellan.Models.MatchNodes.DuplicateContact",dropdownLabel:"Duplicate Contact",dropdownImage:"DuplicateContact Icon"}]},Magellan.Models.MatchNode.getDraggableMatchNodesClassInfo=function(e){return Magellan.Models.MatchNode.OBJECT_TYPE_TO_DRAGGABLE_MATCH_NODES_CLASS_INFO[e]},Magellan.Models.MatchNode.getStencils=function(e){var t=Magellan.Models.MatchNode.getDraggableMatchNodesClassInfo(e);return _.map(t,function(e){var t={nodeModel:e.nodeModel,stencilModel:e.nodeModel+"Stencil",dropdownLabel:e.dropdownLabel,dropdownImage:e.dropdownImage,isDisabled:!Magellan.Models.Provisioning.flowBuilderNodes[e.nodeModel]};return new Magellan.Models.MatchNodeStencil(t)})},Magellan.Models.TriggerNode=joint.shapes.basic.Generic.TriggerNode=Magellan.Models.Node.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.TriggerNode",magellanClass:"Magellan.Models.TriggerNode",defaultImage:{source:iconToURLMap["Trigger Node Opaque"],width:77,height:76,x:18,y:0},highlightedImage:{source:iconToURLMap["Trigger Node Highlighted"],height:86,width:87,x:13,y:-5},selectedImage:{source:iconToURLMap["Trigger Node"],width:77,height:76,x:18,y:0},defaultNotificationIcon:{x:45,y:61},highlightedNotificationIcon:{x:40,y:56},edgeMenuMargin:{x:53,y:100},transparentImage:"",labelClass:"trigger-node-label",linkConnection:{x:56.5,y:38},attrs:{label:"Trigger","image.delete-icon":{display:"none"},"image.main-icon":{"xlink:href":iconToURLMap["Trigger Node Opaque"],height:76,width:77,x:18},"image.edge-notification-icon":{x:45,y:61},"text.edge-notification-number":{x:56,y:77},"image.validation-error-icon":{x:8,y:16},"tspan.line-1":{x:56,y:20},"tspan.line-2":{x:56,y:32},"tspan.line-3":{x:56,y:44}}},Magellan.Models.Node.prototype.defaults)}),joint.shapes.basic.Image.TriggerNode=Magellan.Models.TriggerNode,Magellan.Models.UpdateTriggerNode=Magellan.Models.TriggerNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.UpdateTriggerNode",magellanClass:"Magellan.Models.UpdateTriggerNode"},Magellan.Models.TriggerNode.prototype.defaults)}),Magellan.Models.UpdateTriggerNode.prototype.getFormTitle=function(){return"Updated Lead Trigger"},Magellan.Models.InsertedLeadTriggerNode=Magellan.Models.TriggerNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.InsertedLeadTriggerNode",magellanClass:"Magellan.Models.InsertedLeadTriggerNode"},Magellan.Models.TriggerNode.prototype.defaults)}),Magellan.Models.InsertedLeadTriggerNode.prototype.getFormTitle=function(){return"New Lead Trigger"},Magellan.Models.TriggerNode.defaultInclusionEdges=function(){return[{type:"conditions",conditions:[{field:"",operand:"",operator:""}],logic:"1",rpnLogic:[1],name:"Edge 1","next node":"",description:""}]},Magellan.Models.TriggerNode.defaultInsertEdges=function(e){return[{type:"fixed",condition:e,name:"Insert",target:null}]},Magellan.Models.TriggerNode.prototype.addNodeInfo=function(){var e,t,i,n={magellanClass:this.attributes.magellanClass};this instanceof Magellan.Models.UpdateTriggerNode?(e="UPDATE TRIGGER",t="Updated Lead",n.edges=Magellan.Models.TriggerNode.defaultInclusionEdges(),i="inclusion"):this instanceof Magellan.Models.InsertedLeadTriggerNode&&(e="TRIGGER",t="New Lead",n.edges=Magellan.Models.TriggerNode.defaultInsertEdges(t),i="none"),n.type=e,n.name=t,n["filter type"]=i,this.nodeInfo=n},Magellan.Models.TriggerNode.prototype.getFormTitle=function(){return"UPDATE TRIGGER"===this.nodeInfo.type?"Updated Lead Trigger":"TRIGGER"===this.nodeInfo.type?"New Lead Trigger":void 0},Magellan.Models.OutreachNode=joint.shapes.basic.Generic.OutreachNode=Magellan.Models.Node.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.OutreachNode",defaultImage:{source:iconToURLMap["Outreach Node"],width:162,height:57,x:-6,y:-3},dashedImage:{source:iconToURLMap["Outreach Node Dashed"],width:162,height:57,x:-6,y:-3},defaultNotificationIcon:{x:45,y:42},highlightedNotificationIcon:{x:40,y:37},edgeMenuMargin:{x:17,y:110},transparentImage:"",labelClass:"outreach-node-label",linkConnection:{x:81,y:29},attrs:{"image.validation-error-icon":{x:-14,y:15},"image.success-icon":{"xlink:href":iconToURLMap["Success Stats Pill"],height:40,width:40},"image.failure-icon":{"xlink:href":iconToURLMap["Error Stats Pill"],height:40,width:40},"image.success-failure-icon":{"xlink:href":iconToURLMap["Success Failure Icon"],height:40,width:40},"image.edit-icon":{x:161,y:-3},"image.paste-icon":{x:184,y:20},"image.copy-icon":{x:161,y:20},"image.delete-icon":{x:161,y:42},"image.main-icon":{"xlink:href":iconToURLMap["Outreach Node"],height:57,width:162,x:-6,y:-3},"image.end-of-flow-icon":{"xlink:href":iconToURLMap["End of Flow Icon"],height:40,width:40},"image.auxiliary-icon":{display:"block",height:35,width:35,x:82,y:39},"image.edge-notification-icon":{x:38,y:39},"text.edge-notification-number":{x:56,y:58},"tspan.line-1":{x:56},"text.node-name-text-box":{fill:"#ffffff"}}},Magellan.Models.Node.prototype.defaults)}),Magellan.Models.SalesloftNode=joint.shapes.basic.Generic.SalesloftNode=Magellan.Models.OutreachNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.OutreachNode",defaultImage:{source:iconToURLMap["Salesloft Node"],width:162,height:57,x:0,y:0},dashedImage:{source:iconToURLMap["Salesloft Node Dashed"],width:162,height:57,x:0,y:0},defaultNotificationIcon:{x:45,y:42},highlightedNotificationIcon:{x:40,y:37},edgeMenuMargin:{x:17,y:110},transparentImage:"",labelClass:"salesloft-node-label",linkConnection:{x:81,y:29},attrs:{"image.validation-error-icon":{x:-14,y:15},"image.success-icon":{"xlink:href":iconToURLMap["Success Stats Pill"],height:40,width:40},"image.failure-icon":{"xlink:href":iconToURLMap["Error Stats Pill"],height:40,width:40},"image.success-failure-icon":{"xlink:href":iconToURLMap["Success Failure Icon"],height:40,width:40},"image.end-of-flow-icon":{"xlink:href":iconToURLMap["End of Flow Icon"],height:40,width:40},"image.edit-icon":{x:161,y:-3},"image.paste-icon":{x:184,y:20},"image.copy-icon":{x:161,y:20},"image.delete-icon":{x:161,y:42},"image.main-icon":{"xlink:href":iconToURLMap["Salesloft Node"],height:57,width:162,x:-6,y:-3},"image.auxiliary-icon":{display:"block",height:35,width:35,x:82,y:39},"image.edge-notification-icon":{x:38,y:39},"text.edge-notification-number":{x:56,y:58},"tspan.line-1":{x:56},"text.node-name-text-box":{fill:"#ffffff"}}},Magellan.Models.Node.prototype.defaults)}),Magellan.Models.OutreachNode.prototype.addNodeInfo=function(e){var t={type:"PARTNER ACTION",actionType:this.attributes.actionType,magellanClass:this.attributes.magellanClass,name:e||this.getDefaultName(),edges:[]};"Outreach - Add to Sequence"==t.actionType&&(t.sequenceSelection=[],t.userSelection=[],t.mailboxSelection="owner",t.customUserField="",t.edges=[{type:"fixed",condition:"Next Node",name:"Next Node",target:-1},{type:"fixed",condition:"Configuration Error",name:"Configuration Error",target:-1},{type:"fixed",condition:"Missing Prospect Id",name:"Missing Prospect Id",target:-1},{type:"fixed",condition:"Missing User Id",name:"Missing User Id",target:-1}],"Magellan.Models.OutreachAddToSequence"===t.magellanClass&&t.edges.push({type:"fixed",condition:"Queue Owner",name:"Queue Owner",target:-1})),this.nodeInfo=t},Magellan.Models.SalesloftNode.prototype.addNodeInfo=function(e){const t={type:"PARTNER ACTION",actionType:this.attributes.actionType,magellanClass:this.attributes.magellanClass,name:e||this.getDefaultName(),edges:[]};"Salesloft - Add to Cadence"==t.actionType&&(t.cadenceSelection=[],t.userSelection=[],t.assigneeSelection="owner",t.customUserField="",t.edges=[{type:"fixed",condition:"Next Node",name:"Next Node",target:-1},{type:"fixed",condition:"No User in Field",name:"No User in Field",target:-1},{type:"fixed",condition:"Configuration Error",name:"Configuration Error",target:-1}],"Magellan.Models.SalesloftAddToCadence"===t.magellanClass&&t.edges.push({type:"fixed",condition:"Queue Owner",name:"Queue Owner",target:-1})),this.nodeInfo=t},Magellan.Models.ActionNode=joint.shapes.basic.Generic.ActionNode=Magellan.Models.Node.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.ActionNode",defaultImage:{source:iconToURLMap["Action Node Opaque"],width:124,height:57,x:-6,y:-3},highlightedImage:{source:iconToURLMap["Action Node Highlighted"],height:67,width:133,x:-11,y:-8},dashedImage:{source:iconToURLMap["Action Node Dashed"],width:124,height:57,x:-6,y:-3},selectedImage:{source:iconToURLMap["Action Node"],width:124,height:57,x:-6,y:-3},defaultNotificationIcon:{x:45,y:42},highlightedNotificationIcon:{x:40,y:37},edgeMenuMargin:{x:17,y:110},transparentImage:"",labelClass:"action-node-label",linkConnection:{x:57,y:25},attrs:{"image.validation-error-icon":{x:-4,y:12},"image.success-icon":{"xlink:href":iconToURLMap["Success Stats Pill"],height:40,width:40},"image.failure-icon":{"xlink:href":iconToURLMap["Error Stats Pill"],height:40,width:40},"image.success-failure-icon":{"xlink:href":iconToURLMap["Success Failure Icon"],height:40,width:40},"image.paste-icon":{x:146,y:20},"image.copy-icon":{x:123,y:20},"image.edit-icon":{x:123,y:-3},"image.delete-icon":{x:123,y:42},"image.main-icon":{"xlink:href":iconToURLMap["Action Node Opaque"],height:57,width:124,x:-6,y:-3},"image.auxiliary-icon":{display:"block",height:35,width:35,x:82,y:39},"image.edge-notification-icon":{x:38,y:39},"text.edge-notification-number":{x:56,y:58},"tspan.line-1":{x:56,y:17},"tspan.line-2":{x:56,y:29},"tspan.line-3":{x:56,y:41}}},Magellan.Models.Node.prototype.defaults)}),Magellan.Models.ActionNode.prototype.addNodeInfo=function(e){var t={type:"ACTION",actionType:this.attributes.actionType,magellanClass:this.attributes.magellanClass,name:e||this.getDefaultName(),edges:[]};if(["Account Based Routing","Assign Owner Account","Route to Account","Route to Matched Account"].includes(t.actionType))t["abr type"]="account owner",t.edges=[{type:"fixed",condition:"Inactive User",name:"Inactive User",target:-1},{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}],t["assignment field"]="OwnerId";else if(["Lead Based Routing","Assign Owner Lead","Route to Matched Lead"].includes(t.actionType))t["a2bbr type"]="lead owner",t.edges=[{type:"fixed",condition:"Inactive Matched Lead Owner",name:"Inactive Owner",target:-1},{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}],t["assignment field"]="OwnerId";else if(this instanceof Magellan.Models.AssignOwnerOpportunity)t["obr type"]="opportunity owner",t.edges=[{type:"fixed",condition:"Inactive User",name:"Inactive User",target:-1},{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}],t["assignment field"]="OwnerId";else if("Convert Lead"==t.actionType)t.edges=[{type:"fixed",condition:"Inactive Lead Owner",name:"Inactive Owner",target:-1},{type:"fixed",condition:"Queue Lead Owner",name:"Queue Owner",target:-1},{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}],t.doNotCreateOpportunity=!0,t["explicit account conversion"]=!1,t["explicit account id"]=null,t["convert status"]=null,t["assignment field"]="OwnerId",2===actionNodeMetaData.convertedLeadStatuses.length&&(t["convert status"]=actionNodeMetaData.convertedLeadStatuses[1].ApiName);else if(this instanceof Magellan.Models.UpdateLead)t.edges=[{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}],t.updates=[{field:"",value:""}];else if("Merge Dupe Lead"==t.actionType)t.edges=[{type:"fixed",condition:"Inactive Lead Owner",name:"Inactive Owner",target:-1},{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}];else if("Merge Dupe Contact"==t.actionType)t.edges=[{type:"fixed",condition:"Inactive Lead Owner",name:"Inactive Owner",target:-1},{type:"fixed",condition:"Queue Lead Owner",name:"Queue Owner",target:-1},{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}],t["merge status"]=null,2===actionNodeMetaData.convertedLeadStatuses.length&&(t["merge status"]=actionNodeMetaData.convertedLeadStatuses[1].ApiName);else if("Round Robin"==t.actionType){t.edges=[{type:"fixed",condition:"Invalid Round Robin Group",name:"Invalid Group",target:-1},{type:"fixed",condition:"Not Available For Routing",name:"Not Available For Routing",target:-1},{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}],t["round robin group"]=null,t["round robin id"]=null,t["assignment field"]="OwnerId";var i=LeanData__PrimarySObjectType.toLowerCase();actionNodeMetaData.roundRobinGroupingMap[i],1===actionNodeMetaData.roundRobinGroupingMap[i].length&&(t["round robin group"]=actionNodeMetaData.roundRobinGroupingMap[i][0][actionNodeMetaData.namespace+"Grouping_Name__c"],t["round robin id"]=actionNodeMetaData.roundRobinGroupingMap[i][0].Id)}else if(["Account Creation","Create New Account","Create Account"].includes(t.actionType))t["convert status"]=null,2===actionNodeMetaData.convertedLeadStatuses.length&&(t["convert status"]=actionNodeMetaData.convertedLeadStatuses[1].ApiName),t.doNotCreateOpportunity=!0,t.convertLeadToContact=!1,t.edges=[{type:"fixed",condition:"Inactive Lead Owner",name:"Inactive Owner",target:-1},{type:"fixed",condition:"Queue Lead Owner",name:"Queue Owner",target:-1},{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}];else if("Create Opportunity"==t.actionType)t.edges=[{type:"fixed",condition:"Inactive User",name:"Inactive User",target:-1},{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}];else if("Create Task"==t.actionType)t.relatedToType="relatedToPrimary",t.relatedToValue=null,t.assignedToType="assignedToPrimary",t.assignedToValue=null,t.userField="owner.id",t.taskStatus=null,t.taskSubject=null,t.taskPriority=null,t.taskDays=-1,t.dueDate="",t.taskFields=[],t.edges=[{type:"fixed",condition:"Inactive User",name:"Inactive User",target:-1},{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}];else if(["Explicit Owner Assignment","Assign Owner"].includes(t.actionType))t["explicit owner assignment id"]=null,t.edges=[{type:"fixed",condition:"Inactive User",name:"Inactive User",target:-1},{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}],t["assignment field"]="OwnerId";else if("Route To Territory"==t.actionType)t.edges=[{type:"fixed",condition:"Next Node",name:"Next Node",target:-1},{type:"fixed",condition:"Territory Not Assigned",name:"Territory Not Assigned",target:-1},{type:"fixed",condition:"Inactive User",name:"Inactive User",target:-1},{type:"fixed",condition:"Invalid Round Robin Group",name:"Invalid Group",target:-1},{type:"fixed",condition:"Not Available For Routing",name:"Not Available For Routing",target:-1}],t["assignment field"]="OwnerId",t["populate territory field checked"]=!1,t["populate territory field"]=null,t["only tag territory"]=!1;else if("Send Notification"==t.actionType)t.edges=[{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}];else if("Custom Interface"==t.actionType){var n=actionNodeMetaData.customInterfaceNodeAndEdges;n&&t.parameter?_.each(n,function(e,i){_.each(i,function(e){t.parameter===e&&t.edges.push({type:"fixed",condition:e,name:e,target:-1})})}):t.edges=[{type:"fixed",condition:"True",name:"True",target:-1},{type:"fixed",condition:"False",name:"False",target:-1},{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}]}this.nodeInfo=t},Magellan.Models.AssignOwnerAccount=joint.shapes.basic.Generic.AssignOwnerAccount=Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.AssignOwnerAccount",actionType:"Account Based Routing",magellanClass:"Magellan.Models.AssignOwnerAccount",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Assign Owner Account"]},label:"Assign Owner"}},Magellan.Models.ActionNode.prototype.defaults)}),Magellan.Models.AssignOwnerAccount.prototype.getFormTitle=function(){return"Action – Assign to Matched Account Owner"},Magellan.Models.AssignOwnerLead=joint.shapes.basic.Generic.AssignOwnerLead=Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.AssignOwnerLead",actionType:"Lead Based Routing",magellanClass:"Magellan.Models.AssignOwnerLead",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Assign Owner Lead"]},label:"Assign Owner"}},Magellan.Models.ActionNode.prototype.defaults)}),Magellan.Models.AssignOwnerLead.prototype.getFormTitle=function(){return"Action – Assign to Matched Lead Owner"},Magellan.Models.ExplicitOwnerAssignment=joint.shapes.basic.Generic.ExplicitOwnerAssignment=Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.ExplicitOwnerAssignment",actionType:"Explicit Owner Assignment",magellanClass:"Magellan.Models.ExplicitOwnerAssignment",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Explicit Owner Assignment"]},label:"Assign Owner"}},Magellan.Models.ActionNode.prototype.defaults)}),Magellan.Models.ExplicitOwnerAssignment.prototype.getFormTitle=function(){return"Action – Assign to Selected User(s)"},Magellan.Models.AssignOwnerOpportunity=joint.shapes.basic.Generic.AssignOwnerOpportunity=Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.AssignOwnerOpportunity",actionType:"Opportunity Based Routing",magellanClass:"Magellan.Models.AssignOwnerOpportunity",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Assign Owner Opportunity"]},label:"Assign Owner"}},Magellan.Models.ActionNode.prototype.defaults)}),Magellan.Models.AssignOwnerOpportunity.prototype.getFormTitle=function(){return"Action – Assign to Matched Opportunity Owner"},Magellan.Models.Convert=joint.shapes.basic.Generic.Convert=Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.Convert",actionType:"Convert Lead",magellanClass:"Magellan.Models.Convert",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap.Convert},label:"Convert"}},Magellan.Models.ActionNode.prototype.defaults)}),Magellan.Models.Convert.prototype.getFormTitle=function(){return"Action – Convert"},Magellan.Models.Convert.prototype.getErrorEdgeNames=function(){return["Convert Errors"]},Magellan.Models.Convert.prototype.getEdgesForSelection=function(){return this.nodeInfo.edges},Magellan.Models.CreateAccount=joint.shapes.basic.Generic.CreateAccount=Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.CreateAccount",actionType:"Account Creation",magellanClass:"Magellan.Models.CreateAccount",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Create Account"]},label:"Create Account"}},Magellan.Models.ActionNode.prototype.defaults)}),Magellan.Models.CreateAccount.prototype.getFormTitle=function(){return"Action – Create Account"},Magellan.Models.CreateAccount.prototype.getErrorEdgeNames=function(){return this.nodeInfo.convertLeadToContact?["Convert Errors"]:["Other Errors"]},Magellan.Models.CreateAccount.prototype.getEdgesForSelection=function(){var e=[],t=this.nodeInfo.edges;return this.nodeInfo.convertLeadToContact&&(e=["Next Node"]),e.length>0&&(t=_.filter(this.nodeInfo.edges,function(t){return!_.includes(e,t.name)})),t},Magellan.Models.CreateOpportunity=joint.shapes.basic.Generic.CreateOpportunity=Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.CreateOpportunity",actionType:"Create Opportunity",magellanClass:"Magellan.Models.CreateOpportunity",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Create Opportunity"]},label:"Create Opportunity"}},Magellan.Models.ActionNode.prototype.defaults)}),Magellan.Models.CreateOpportunity.prototype.getFormTitle=function(){return"Action – Create Opportunity"},Magellan.Models.CreateOpportunity.prototype.getErrorEdgeNames=function(){return["Create Errors"]},Magellan.Models.CreateOpportunity.prototype.getEdgesForSelection=function(){return this.nodeInfo.edges},Magellan.Models.Merge=joint.shapes.basic.Generic.Merge=Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.Merge",actionType:"Merge Dupe Lead",magellanClass:"Magellan.Models.Merge",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap.Merge},label:"Merge"}},Magellan.Models.ActionNode.prototype.defaults)}),Magellan.Models.Merge.prototype.getFormTitle=function(){return"Action – Merge Dupe"},Magellan.Models.Merge.prototype.getErrorEdgeNames=function(){return["Merge Errors"]},Magellan.Models.Merge.prototype.getEdgesForSelection=function(){var e=["Next Node"],t=this.nodeInfo.edges;return e.length>0&&(t=_.filter(this.nodeInfo.edges,function(t){return!_.includes(e,t.name)})),t},Magellan.Models.MergeContact=joint.shapes.basic.Generic.MergeContact=Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.Merge",actionType:"Merge Dupe Contact",magellanClass:"Magellan.Models.MergeContact",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Merge Contact"]},label:"Merge Contact"}},Magellan.Models.ActionNode.prototype.defaults)}),Magellan.Models.MergeContact.prototype.getFormTitle=function(){return"Action – Merge Dupe"},Magellan.Models.MergeContact.prototype.getErrorEdgeNames=function(){return["Merge Errors"]},Magellan.Models.MergeContact.prototype.getEdgesForSelection=function(){var e=["Next Node"],t=this.nodeInfo.edges;return e.length>0&&(t=_.filter(this.nodeInfo.edges,function(t){return!_.includes(e,t.name)})),t},Magellan.Models.RoundRobin=joint.shapes.basic.Generic.RoundRobin=Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.RoundRobin",actionType:"Round Robin",magellanClass:"Magellan.Models.RoundRobin",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Round Robin"]},label:"Round Robin"}},Magellan.Models.ActionNode.prototype.defaults)}),Magellan.Models.RoundRobin.prototype.getFormTitle=function(){return"Action – Round Robin"},Magellan.Models.RoundRobin.prototype.getSuccessEdgeNames=function(){return["Next Node","Not Available For Routing"]},Magellan.Models.UpdateLead=joint.shapes.basic.Generic.UpdateLead=Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.UpdateLead",actionType:"Update Lead",magellanClass:"Magellan.Models.UpdateLead",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Update Lead"]},label:"Update Lead"}},Magellan.Models.ActionNode.prototype.defaults)}),Magellan.Models.UpdateLead.prototype.getFormTitle=function(){return"Action – Update Lead"},Magellan.Models.TerritoryRouting=joint.shapes.basic.Generic.TerritoryRouting=Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.TerritoryRouting",actionType:"Route To Territory",magellanClass:"Magellan.Models.TerritoryRouting",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Route To Territory"]},label:"Route to Territory"}},Magellan.Models.ActionNode.prototype.defaults)}),Magellan.Models.TerritoryRouting.prototype.getFormTitle=function(){return"Action – Route To Territory"},Magellan.Models.TerritoryRouting.prototype.getSuccessEdgeNames=function(){return["Next Node"]},Magellan.Models.SendNotification=joint.shapes.basic.Generic.SendNotification=Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.SendNotification",actionType:"Send Notification",magellanClass:"Magellan.Models.SendNotification",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Send Notification"]},label:"Send Notification"}},Magellan.Models.ActionNode.prototype.defaults)}),Magellan.Models.SendNotification.prototype.getFormTitle=function(){return"Action – Send Notification"},Magellan.Models.LeadSendNotification=Magellan.Models.SendNotification.extend({}),Magellan.Models.CreateTask=joint.shapes.basic.Generic.CreateTask=Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.CreateTask",actionType:"Create Task",magellanClass:"Magellan.Models.CreateTask",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Create Task"]},label:"Create Task"}},Magellan.Models.ActionNode.prototype.defaults)}),Magellan.Models.CreateTask.prototype.getFormTitle=function(){return"Action – Create Task"},Magellan.Models.CreateTask.prototype.getEdgesForSelection=function(){return this.nodeInfo.edges},Magellan.Models.OutreachAddToSequence=joint.shapes.basic.Generic.OutreachAddToSequence=Magellan.Models.OutreachNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.OutreachAddToSequence",actionType:"Outreach - Add to Sequence",magellanClass:"Magellan.Models.OutreachAddToSequence",attrs:{"image.auxiliary-icon":{},label:"Outreach - Add to Sequence"}},Magellan.Models.OutreachNode.prototype.defaults)}),Magellan.Models.OutreachAddToSequence.prototype.getFormTitle=function(){return"Action – Add Prospect to Sequence"},Magellan.Models.OutreachAddToSequence.prototype.getEdgesForSelection=function(){return this.nodeInfo.edges},Magellan.Models.SalesloftAddToCadence=joint.shapes.basic.Generic.SalesloftAddToCadence=Magellan.Models.SalesloftNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.SalesloftAddToCadence",actionType:"Salesloft - Add to Cadence",magellanClass:"Magellan.Models.SalesloftAddToCadence",attrs:{"image.auxiliary-icon":{},label:"Salesloft - Add to Cadence"}},Magellan.Models.SalesloftNode.prototype.defaults)}),Magellan.Models.SalesloftAddToCadence.prototype.getFormTitle=function(){return"Action – Add Person to Cadence"},Magellan.Models.SalesloftAddToCadence.prototype.getEdgesForSelection=function(){return this.nodeInfo.edges},Magellan.Models.CustomInterface=joint.shapes.basic.Generic.CustomInterface=Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.CustomInterface",actionType:"Custom Interface",magellanClass:"Magellan.Models.CustomInterface",attrs:{"image.edit-icon":{x:123,y:-3},"image.delete-icon":{x:123,y:20},"image.auxiliary-icon":{"xlink:href":iconToURLMap["Custom Interface"]},label:"Custom Interface"}},Magellan.Models.ActionNode.prototype.defaults)}),Magellan.Models.CustomInterface.prototype.getFormTitle=function(){return"Action - Custom Interface"},Magellan.Models.ActionNode.OBJECT_TYPE_TO_DRAGGABLE_ACTION_NODES_CLASS_INFO={Lead:[{nodeModel:"Magellan.Models.AssignOwnerLead",dropdownLabel:"Route to Matched Lead",dropdownImage:"Assign Owner Lead"},{nodeModel:"Magellan.Models.AssignOwnerAccount",dropdownLabel:"Route to Matched Account",dropdownImage:"Assign Owner Account"},{nodeModel:"Magellan.Models.AssignOwnerOpportunity",dropdownLabel:"Route to Matched Opportunity",dropdownImage:"Assign Owner Opportunity"},{nodeModel:"Magellan.Models.TerritoryRouting",dropdownLabel:"Route to Territory",dropdownImage:"Route To Territory"},{nodeModel:"Magellan.Models.Convert",dropdownLabel:"Convert Lead",dropdownImage:"Convert"},{nodeModel:"Magellan.Models.CreateAccount",dropdownLabel:"Create Account",dropdownImage:"Create Account"},{nodeModel:"Magellan.Models.CreateOpportunity",dropdownLabel:"Create Opportunity",dropdownImage:"Create Opportunity"},{nodeModel:"Magellan.Models.CreateTask",dropdownLabel:"Create Task",dropdownImage:"Create Task"},{nodeModel:"Magellan.Models.Merge",dropdownLabel:"Merge Dupe Lead",dropdownImage:"Merge"},{nodeModel:"Magellan.Models.MergeContact",dropdownLabel:"Merge Dupe Contact",dropdownImage:"Merge Contact"},{nodeModel:"Magellan.Models.ExplicitOwnerAssignment",dropdownLabel:"Assign Owner",dropdownImage:"Explicit Owner Assignment"},{nodeModel:"Magellan.Models.RoundRobin",dropdownLabel:"Round Robin",dropdownImage:"Round Robin"},{nodeModel:"Magellan.Models.LeadSendNotification",dropdownLabel:"Send Notification",dropdownImage:"Send Notification"},{nodeModel:"Magellan.Models.UpdateLead",dropdownLabel:"Update Lead",dropdownImage:"Update Lead"},{nodeModel:"Magellan.Models.CustomInterface",dropdownLabel:"Custom Interface",dropdownImage:"Custom Interface"}],Contact:[]},Magellan.Models.ActionNode.getDraggableActionNodesClassInfo=function(e){return Magellan.Models.ActionNode.OBJECT_TYPE_TO_DRAGGABLE_ACTION_NODES_CLASS_INFO[e]},Magellan.Models.ActionNode.getStencils=function(e){var t=Magellan.Models.ActionNode.getDraggableActionNodesClassInfo(e),i=_.map(t,function(e){var t={nodeModel:e.nodeModel,dropdownLabel:e.dropdownLabel,dropdownImage:e.dropdownImage,stencilModel:e.nodeModel+"Stencil",isDisabled:!Magellan.Models.Provisioning.flowBuilderNodes[e.nodeModel]};return new Magellan.Models.ActionNodeStencil(t)}),n=actionNodeMetaData.hasCustomInterfaceNodeSelection;return i=_.filter(i,function(e){return"Magellan.Models.CustomInterface"!==e.nodeModel||n},this)},Magellan.Models.DecisionNode=joint.shapes.basic.Generic.DecisionNode=Magellan.Models.Node.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.DecisionNode",magellanClass:"Magellan.Models.DecisionNode",defaultImage:{source:iconToURLMap["Decision Node Opaque"],width:113,height:85.5,x:0,y:0},highlightedImage:{source:iconToURLMap["Decision Node Highlighted"],height:94,width:122,x:-5,y:-5},dashedImage:{source:iconToURLMap["Decision Node Dashed"],width:113,height:85.5,x:0,y:0},selectedImage:{source:iconToURLMap["Decision Node"],width:113,height:85.5,x:0,y:0},defaultNotificationIcon:{x:45,y:70},highlightedNotificationIcon:{x:40,y:65},edgeMenuMargin:{x:21,y:100},transparentImage:"",linkConnection:{x:56.5,y:42.75},labelClass:"decision-node-label",attrs:{label:"Decision Node","image.validation-error-icon":{x:-8,y:31},"image.paste-icon":{x:140,y:22},"image.copy-icon":{x:118,y:22},"image.edit-icon":{x:118,y:0},"image.delete-icon":{x:118,y:44},"image.main-icon":{"xlink:href":iconToURLMap["Decision Node Opaque"],width:113,height:85},"image.edge-notification-icon":{x:45,y:70},"text.edge-notification-number":{x:56,y:86},"tspan.object-hat":{display:"block",x:59,y:18},"tspan.line-1":{x:56,y:32},"tspan.line-2":{x:56,y:44},"tspan.line-3":{x:56,y:56},"image.end-of-flow-icon":{"xlink:href":iconToURLMap["End of Flow Icon"],height:40,width:40}}},Magellan.Models.Node.prototype.defaults)}),Magellan.Models.DecisionNode.prototype.addNodeInfo=function(e){var t={type:"DECISION",magellanClass:this.attributes.magellanClass,name:e||this.getDefaultName(),objectType:this.attributes.objectType,edges:[{type:this instanceof Magellan.Models.TrueFalseNode?null:"conditions",conditions:this instanceof Magellan.Models.TrueFalseNode?[{field:null,operand:null,operator:"equals","value/field":"value"}]:[{type:"conditions",conditions:[],logic:"1",rpnLogic:[1]}],logic:"1",rpnLogic:[1],condition:this instanceof Magellan.Models.TrueFalseNode?"Met":void 0,name:this instanceof Magellan.Models.TrueFalseNode?"True":"Edge 1","next node":"",description:""},{type:"default",name:this instanceof Magellan.Models.TrueFalseNode?"False":"Default",condition:this instanceof Magellan.Models.TrueFalseNode?"Not Met":void 0,"next node":"",target:this instanceof Magellan.Models.TrueFalseNode?void 0:-1,logic:"",description:""}]};this.nodeInfo=t,this instanceof Magellan.Models.TerritoryNode&&(this.nodeInfo.edges=[{type:"fixed",name:"Not Found",condition:"Not Found","next node":"",target:-1,logic:"",description:""}])},Magellan.Models.BranchNode=Magellan.Models.DecisionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.BranchNode",magellanClass:"Magellan.Models.BranchNode"},Magellan.Models.DecisionNode.prototype.defaults)}),Magellan.Models.BranchNodes={},Magellan.Models.BranchNodes.Lead=Magellan.Models.BranchNode.extend({defaults:joint.util.deepSupplement({objectType:"Lead"},Magellan.Models.BranchNode.prototype.defaults)}),Magellan.Models.BranchNodes.Lead2Account=Magellan.Models.BranchNode.extend({defaults:joint.util.deepSupplement({objectType:"L2A"},Magellan.Models.BranchNode.prototype.defaults)}),Magellan.Models.BranchNodes.Lead2Opportunity=Magellan.Models.BranchNode.extend({defaults:joint.util.deepSupplement({objectType:"L2O"},Magellan.Models.BranchNode.prototype.defaults)}),Magellan.Models.BranchNodes.Lead2Lead=Magellan.Models.BranchNode.extend({defaults:joint.util.deepSupplement({objectType:"L2L"},Magellan.Models.BranchNode.prototype.defaults)}),Magellan.Models.BranchNodes.Duplicate=Magellan.Models.BranchNode.extend({defaults:joint.util.deepSupplement({objectType:"Dupe"},Magellan.Models.BranchNode.prototype.defaults)}),Magellan.Models.BranchNodes.DuplicateContact=Magellan.Models.BranchNode.extend({defaults:joint.util.deepSupplement({objectType:"DupeC"},Magellan.Models.BranchNode.prototype.defaults)}),Magellan.Models.BranchNode.prototype.getFormTitle=function(){return"Decision - Branch"},Magellan.Models.TerritoryNode=Magellan.Models.DecisionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.TerritoryNode",magellanClass:"Magellan.Models.TerritoryNode",name:"Route To Territory"},Magellan.Models.DecisionNode.prototype.defaults)}),Magellan.Models.TerritoryNode.addNodeInfo=function(e){var t={type:"DECISION",magellanClass:this.attributes.magellanClass,name:e||this.getDefaultName(),edges:[{type:"fixed",name:"Not Found",condition:"Not Found","next node":"",target:-1,logic:"",description:""}]};this.nodeInfo=t},Magellan.Models.TerritoryNode.prototype.getFormTitle=function(){return"Decision - Territory"},Magellan.Models.TerritoryNode.getTerritoryNodeStencils=function(){return[new Magellan.Models.TerritoryStencil({nodeModel:"Magellan.Models.TerritoryNode",stencilModel:"Magellan.Models.TerritoryNodeStencil",dropdownLabel:"Territory",dropdownImage:"Route To Territory"})]},Magellan.Models.TrueFalseNode=Magellan.Models.DecisionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.TrueFalseNode",magellanClass:"Magellan.Models.TrueFalseNode"},Magellan.Models.DecisionNode.prototype.defaults)}),Magellan.Models.TrueFalseNode.prototype.getFormTitle=function(){return"Decision - True/False"},Magellan.Models.TrueFalseNodes={},Magellan.Models.TrueFalseNodes.Lead=Magellan.Models.TrueFalseNode.extend({defaults:joint.util.deepSupplement({objectType:"Lead"},Magellan.Models.TrueFalseNode.prototype.defaults)}),Magellan.Models.TrueFalseNodes.Lead2Account=Magellan.Models.TrueFalseNode.extend({defaults:joint.util.deepSupplement({objectType:"L2A"},Magellan.Models.TrueFalseNode.prototype.defaults)}),Magellan.Models.TrueFalseNodes.Lead2Opportunity=Magellan.Models.TrueFalseNode.extend({defaults:joint.util.deepSupplement({objectType:"L2O"},Magellan.Models.TrueFalseNode.prototype.defaults)}),Magellan.Models.TrueFalseNodes.Lead2Lead=Magellan.Models.TrueFalseNode.extend({defaults:joint.util.deepSupplement({objectType:"L2L"},Magellan.Models.TrueFalseNode.prototype.defaults)}),Magellan.Models.TrueFalseNodes.Duplicate=Magellan.Models.TrueFalseNode.extend({defaults:joint.util.deepSupplement({objectType:"Dupe"},Magellan.Models.TrueFalseNode.prototype.defaults)}),Magellan.Models.TrueFalseNodes.DuplicateContact=Magellan.Models.TrueFalseNode.extend({defaults:joint.util.deepSupplement({objectType:"DupeC"},Magellan.Models.TrueFalseNode.prototype.defaults)}),Magellan.Models.DecisionNode.OBJECT_TYPE_TO_DRAGGABLE_DECISION_NODES_CLASS_INFO={Lead:[]},Magellan.Models.OutreachNode.OBJECT_TYPE_TO_DRAGGABLE_PARTNER_NODES_CLASS_INFO={Lead:[{nodeModel:"Magellan.Models.OutreachAddToSequence",dropdownLabel:"Add to Sequence",dropdownImage:"Outreach Node Icon"}],Contact:[],Account:[],Opportunity:[]},Magellan.Models.SalesloftNode.OBJECT_TYPE_TO_DRAGGABLE_PARTNER_NODES_CLASS_INFO={Lead:[{nodeModel:"Magellan.Models.SalesloftAddToCadence",dropdownLabel:"Add to Cadence",dropdownImage:"Salesloft Node Icon"}],Contact:[],Account:[],Opportunity:[]},Magellan.Models.DecisionNode.OBJECT_TYPE_TO_DRAGGABLE_TRUE_FALSE_NODES_CLASS_INFO={Lead:[{nodeModel:"Magellan.Models.TrueFalseNodes.Lead",dropdownLabel:"Lead",dropdownImage:"Lead Icon"},{nodeModel:"Magellan.Models.TrueFalseNodes.Lead2Lead",dropdownLabel:"Lead2Lead",dropdownImage:"Lead2Lead Icon"},{nodeModel:"Magellan.Models.TrueFalseNodes.Lead2Account",dropdownLabel:"Lead2Account",dropdownImage:"Lead2Account Icon"},{nodeModel:"Magellan.Models.TrueFalseNodes.Lead2Opportunity",dropdownLabel:"Lead2Opportunity",dropdownImage:"Lead2Opportunity Icon"},{nodeModel:"Magellan.Models.TrueFalseNodes.Duplicate",dropdownLabel:"Duplicate",dropdownImage:"Duplicate Icon"},{nodeModel:"Magellan.Models.TrueFalseNodes.DuplicateContact",dropdownLabel:"Duplicate Contact",dropdownImage:"DuplicateContact Icon"}],Contact:[],Account:[],Opportunity:[]},Magellan.Models.DecisionNode.OBJECT_TYPE_TO_DRAGGABLE_BRANCH_NODES_CLASS_INFO={Lead:[{nodeModel:"Magellan.Models.BranchNodes.Lead",dropdownLabel:"Lead",dropdownImage:"Lead Icon"},{nodeModel:"Magellan.Models.BranchNodes.Lead2Lead",dropdownLabel:"Lead2Lead",dropdownImage:"Lead2Lead Icon"},{nodeModel:"Magellan.Models.BranchNodes.Lead2Account",dropdownLabel:"Lead2Account",dropdownImage:"Lead2Account Icon"},{nodeModel:"Magellan.Models.BranchNodes.Lead2Opportunity",dropdownLabel:"Lead2Opportunity",dropdownImage:"Lead2Opportunity Icon"},{nodeModel:"Magellan.Models.BranchNodes.Duplicate",dropdownLabel:"Duplicate",dropdownImage:"Duplicate Icon"},{nodeModel:"Magellan.Models.BranchNodes.DuplicateContact",dropdownLabel:"Duplicate Contact",dropdownImage:"DuplicateContact Icon"}],Contact:[],Account:[],Opportunity:[]},Magellan.Models.DecisionNode.getDraggableDecisionNodesClassInfo=function(e){return Magellan.Models.DecisionNode.OBJECT_TYPE_TO_DRAGGABLE_DECISION_NODES_CLASS_INFO[e]},Magellan.Models.OutreachNode.getDraggableOutreachNodesClassInfo=function(e){return Magellan.Models.OutreachNode.OBJECT_TYPE_TO_DRAGGABLE_PARTNER_NODES_CLASS_INFO[e]},Magellan.Models.SalesloftNode.getDraggableSalesloftNodesClassInfo=function(e){return Magellan.Models.SalesloftNode.OBJECT_TYPE_TO_DRAGGABLE_PARTNER_NODES_CLASS_INFO[e]},Magellan.Models.DecisionNode.getStencils=function(e){var t=Magellan.Models.DecisionNode.getDraggableDecisionNodesClassInfo(e);return _.map(t,function(e){var t={nodeModel:e.nodeModel,dropdownLabel:e.dropdownLabel,dropdownImage:e.dropdownImage,stencilModel:e.nodeModel+"Stencil",isDisabled:!Magellan.Models.Provisioning.flowBuilderNodes[e.nodeModel]};return new Magellan.Models.DecisionNodeStencil(t)})},Magellan.Models.OutreachNode.getStencils=function(e){var t=Magellan.Models.OutreachNode.getDraggableOutreachNodesClassInfo(e);return _.map(t,function(e){var t={nodeModel:e.nodeModel,dropdownLabel:e.dropdownLabel,dropdownImage:e.dropdownImage,stencilModel:e.nodeModel+"Stencil",isDisabled:!Magellan.Models.Provisioning.flowBuilderNodes[e.nodeModel]};return new Magellan.Models.DecisionNodeStencil(t)})},Magellan.Models.SalesloftNode.getStencils=function(e){var t=Magellan.Models.SalesloftNode.getDraggableSalesloftNodesClassInfo(e);return _.map(t,function(e){var t={nodeModel:e.nodeModel,dropdownLabel:e.dropdownLabel,dropdownImage:e.dropdownImage,stencilModel:e.nodeModel+"Stencil",isDisabled:!Magellan.Models.Provisioning.flowBuilderNodes[e.nodeModel]};return new Magellan.Models.DecisionNodeStencil(t)})},Magellan.Models.TrueFalseNode.getDraggableTrueFalseNodesClassInfo=function(e){return Magellan.Models.DecisionNode.OBJECT_TYPE_TO_DRAGGABLE_TRUE_FALSE_NODES_CLASS_INFO[e]},Magellan.Models.TrueFalseNode.getStencils=function(e){var t=Magellan.Models.TrueFalseNode.getDraggableTrueFalseNodesClassInfo(e);return _.map(t,function(e){var t={nodeModel:e.nodeModel,dropdownLabel:e.dropdownLabel,dropdownImage:e.dropdownImage,stencilModel:e.nodeModel+"Stencil",isDisabled:!Magellan.Models.Provisioning.flowBuilderNodes[e.nodeModel]};return new Magellan.Models.TrueFalseNodeStencil(t)})},Magellan.Models.BranchNode.getDraggableBranchNodesClassInfo=function(e){return Magellan.Models.DecisionNode.OBJECT_TYPE_TO_DRAGGABLE_BRANCH_NODES_CLASS_INFO[e]},Magellan.Models.BranchNode.getStencils=function(e){var t=Magellan.Models.BranchNode.getDraggableBranchNodesClassInfo(e);return _.map(t,function(e){var t={nodeModel:e.nodeModel,dropdownLabel:e.dropdownLabel,dropdownImage:e.dropdownImage,stencilModel:e.nodeModel+"Stencil",isDisabled:!Magellan.Models.Provisioning.flowBuilderNodes[e.nodeModel]};return new Magellan.Models.BranchNodeStencil(t)})},Magellan.Models.RerouteNode=joint.shapes.basic.Generic.RerouteNode=Magellan.Models.Node.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.RerouteNode",defaultImage:{source:iconToURLMap["Timebased Reroute Node"],width:134,height:60,x:0,y:0},highlightedImage:{source:iconToURLMap["Timebased Reroute Node Selected"],height:67,width:143,x:-11,y:-8},dashedImage:{source:iconToURLMap["Timebased Reroute Node Connected"],width:134,height:60,x:0,y:0},selectedImage:{source:iconToURLMap["Timebased Reroute Node Selected"],width:134,height:60,x:0,y:0},defaultNotificationIcon:{x:55,y:47},highlightedNotificationIcon:{x:50,y:42},edgeMenuMargin:{x:0,y:120},transparentImage:"",labelClass:"reroute-node-label",linkConnection:{x:66,y:35},attrs:{"image.validation-error-icon":{x:-10,y:20},"image.success-icon":{"xlink:href":iconToURLMap["Success Stats Pill"],height:40,width:40},"image.failure-icon":{"xlink:href":iconToURLMap["Error Stats Pill"],height:40,width:40},"image.success-failure-icon":{"xlink:href":iconToURLMap["Success Failure Icon"],height:40,width:40},"image.paste-icon":{x:150,y:20},"image.copy-icon":{x:137,y:20},"image.edit-icon":{x:137,y:-3},"image.delete-icon":{x:137,y:42},"image.main-icon":{"xlink:href":iconToURLMap["Timebased Reroute Node"],width:134,x:0,y:0},"image.auxiliary-icon":{display:"block",height:35,width:35,x:82,y:39},"image.edge-notification-icon":{x:55,y:47},"text.edge-notification-number":{x:66,y:62},"image.end-of-flow-icon":{"xlink:href":iconToURLMap["End of Flow Icon"],height:40,width:40},"tspan.line-1":{x:65,y:7},"tspan.line-2":{x:65,y:21},"tspan.line-3":{x:65,y:35}}},Magellan.Models.Node.prototype.defaults),initialize:function(){Magellan.Controllers.FlowBuilder.isEditMode()||(this.attributes.defaultImage.source=iconToURLMap["Timebased Reroute Node Insights"],this.attributes.dashedImage.source=iconToURLMap["Timebased Reroute Node Insights"],this.attributes.selectedImage.source=iconToURLMap["Timebased Reroute Node Insights"],this.attributes.attrs["image.main-icon"]["xlink:href"]=iconToURLMap["Timebased Reroute Node Insights"]),Magellan.Models.Node.prototype.initialize.apply(this,arguments),this.nodeInfo&&this.set(_.pick(this.nodeInfo,["days","hours","minutes","edges"]))},getFormTitle:function(){return"Time-Based Route"},addNodeInfo:function(e){this.nodeInfo={type:"REROUTING",magellanClass:this.attributes.magellanClass||"Magellan.Models.RerouteNode",name:e||this.getDefaultName(),edges:[{type:"conditions",name:"Edge 1",conditions:[{field:null,operand:null,operator:"equals","value/field":"value"}],logic:"1",rpnLogic:[1],target:null,description:""},{type:"system",name:"[Abort]",target:-1},{type:"system",name:"[Schedule Route]"},{type:"default",name:"Default",target:-1}]}},isValidRerouteTimeFrame:function(){return Magellan.Validation.isValidRerouteTimeFrame(this.nodeInfo.days,this.nodeInfo.hours,this.nodeInfo.minutes)}}),Magellan.Models.RerouteNode.OBJECT_TYPE_TO_DRAGGABLE_REROUTE_NODES_CLASS_INFO={Lead:[{nodeModel:"Magellan.Models.RerouteNode",dropdownLabel:"Time-based",dropdownImage:"Timebased"}],Contact:[],Account:[],Opportunity:[]},Magellan.Models.RerouteNode.getStencils=function(e){var t=Magellan.Models.RerouteNode.OBJECT_TYPE_TO_DRAGGABLE_REROUTE_NODES_CLASS_INFO[e];return _.map(t,function(e){var t={nodeModel:e.nodeModel,dropdownLabel:e.dropdownLabel,dropdownImage:e.dropdownImage,stencilModel:e.nodeModel+"Stencil",isDisabled:!Magellan.Models.Provisioning.flowBuilderNodes[e.nodeModel]};return new Magellan.Models.RerouteNodeStencil(t)})},Magellan.Models.criterionEmpty=function(e){return"optima"===e.type&&!e.field||"conditions"===e.type&&(0===e.conditions.length||!e.conditions[0].field&&!e.conditions[0].operand)||"soql"===e.type&&!e.soqlCondition||"custom"===e.type&&!e.parameter},Magellan.Models.criterionInvalid=function(e){return _.isArray(e)&&e.conditions.length&&Magellan.Util.parseLogic(e.conditions.length,e.logic?e.logic:e.conditions.logic).feedbackMessage.length>0},Magellan.Models.Provisioning=i(208)(dashboardController.viewObject.featureProvisioning)}},function(e,t,i){e.exports=function initializeNewViews(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Views&&(Magellan.Views={});var e=i(378),t=i(367),n=i(353),a=i(370),o=i(361),l={};Magellan.Views.GROUPING_TO_OPERATORS={Id:["equals","not equal to","is null","not null"],String:["equals","not equal to","starts with","ends with","does not start with","does not end with","contains","does not contain","is null","not null"],Email:["equals","not equal to","starts with","ends with","does not start with","does not end with","contains","does not contain","is null","not null"],Number:["equals","not equal to","greater than","greater or equal","less than","less or equal","is null","not null"],Boolean:["equals","not equal to","is null","not null"],Phone:["equals","not equal to","starts with","ends with","does not start with","does not end with","contains","does not contain","is null","not null"],Date:["equals","not equal to","greater than","greater or equal","less than","less or equal","is null","not null"],Datetime:["equals","not equal to","greater than","greater or equal","less than","less or equal","is null","not null"],Multipicklist:["equals","not equal to","includes","excludes","is null","not null"]},Magellan.Views.UT_GROUPING_TO_OPERATORS={Id:["equals","not equal to","is null","not null","has changed"],String:["equals","not equal to","starts with","ends with","does not start with","does not end with","contains","does not contain","is null","not null","has changed"],Email:["equals","not equal to","starts with","ends with","does not start with","does not end with","contains","does not contain","is null","not null","has changed"],Number:["equals","not equal to","greater than","greater or equal","less than","less or equal","is null","not null","has changed"],Boolean:["equals","not equal to","is null","not null","has changed"],Phone:["equals","not equal to","starts with","ends with","does not start with","does not end with","contains","does not contain","is null","not null","has changed"],Date:["equals","not equal to","greater than","greater or equal","less than","less or equal","is null","not null","has changed"],Datetime:["equals","not equal to","greater than","greater or equal","less than","less or equal","is null","not null","has changed"],Multipicklist:["equals","not equal to","includes","excludes","is null","not null"]};var s=["ownerid","owner.name","owner.isactive","createddate","lastactivitydate","firstname","lastname","email","phone","stagname","stagename","amount","street","city","state","country","postalcode","billingstreet","billingcity","billingstate","billingcountry","billingpostalcode","mailingstreet","mailingcity","mailingstate","mailingcountry","mailingpostalcode","accountid","account.name","account.ownerid","account.website","account.phone","account.billingstreet","account.billingcity","account.billingstate","account.billingcountry","account.billingpostalcode","annualrevenue","numberofemployees","account.ld_emaildomain__c","account.ld_emaildomains__c","Routing_Action__c"],r=["name","website","company","id","status","industry","type","description","fax","rating","isconverted","isdeleted","lastmodifiedbyid","lastmodifieddate","shippingcity","shippingcountry","shippingpostalcode","shippingstate","shippingstreet","parentid","parent.parentid","parent.parent.parentid","ld_emaildomain__c","ld_emaildomains__c","search__c","scenario_1_owner__c","scenario_2_owner__c","scenario_3_owner__c","scenario_4_owner__c","reporting_matched_account__c","routing_status__c","a2b_group__c","routing_action__c","has_matched__c","search_index__c","matched_account_name__c","matched_account_website__c","matched_account_annual_revenue__c","matched_account_billing_country__c","matched_account_billing_postal_code__c","matched_account_billing_state__c","matched_account_employees__c","matched_account_industry__c","matched_account_type__c","reporting_timestamp__c","a2b_account__c","matched_buyer_persona__c","matched_buyer_persona__r.name","status_info__c"];Magellan.Views.getAPIObjectNameFromObjectType=function(e){return"Lead"===LeanData__PrimarySObjectType?Magellan.Validation.MATCH_TYPE_TO_OBJECT_MAP[e]||LeanData__PrimarySObjectType:"Contact"===LeanData__PrimarySObjectType?Magellan.Controllers.ContactRouter.getObjectNameFromHatType(e):"Account"===LeanData__PrimarySObjectType?Magellan.Controllers.AccountRouter.getObjectNameFromHatType(e):"Opportunity"===LeanData__PrimarySObjectType?Magellan.Controllers.OpportunityRouter.getObjectNameFromHatType(e):null},Magellan.Views.getPluralAPIObjectNameFromObjectType=function(e){var t=Magellan.Views.getAPIObjectNameFromObjectType(e);return t?"Opportunity"===t?"Opportunities":t+"s":null},Magellan.Views.ButtonHandler=Backbone.View.extend({initialize:function(e){this.childViews=[]},removeAllChildViews:function(){_.each(this.childViews,function(e){try{e.remove()}catch(e){}}),this.childViews=[]},remove:function(){try{Backbone.View.prototype.remove.call(this,[])}catch(e){}this.removeAllChildViews()},hideInfoBox:function(e){$(e.currentTarget).siblings(".stat-box").hide()},showInfoBox:function(e){e.stopPropagation(),Magellan.Controllers.GUI.unselectAllStatBox(),graph.getCell($(e.currentTarget).closest("g.cell").attr("model-id")).toFront(),$(e.currentTarget).siblings(".stat-box").show()},originalEvents:{"click .collapsible-section-header":"toggleCollapsibleSection","click .change-parameter-dropdown.dropdown-choice":"changeParameter","click .change-parameter-input":"changeParameterInput","input .change-parameter-input":"changeParameterInput","click .metrics-wrapping-g:not(.showing-stat-box)":"showInfoBox"},additionalEvents:{},events:function(){return _.extend({},this.originalEvents,this.additionalEvents)},changeParameter:function(e){e.stopPropagation();var t=$(e.currentTarget),i=t.data("parameter");this.model[i]=t.data("value");var n=t.data("parameter2");n&&(this.model[n]=t.data("value2")),this.render()},changeParameterInput:function(e){e.stopPropagation();var t=$(e.currentTarget),i=t.data("parameter");this.model[i]=t.val()},toggleCollapsibleSection:function(e){$(e.currentTarget).parent(".collapsible-outer-container").toggleClass("open"),e.stopPropagation()}}),Magellan.Views.NewNodeForm=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.childViews=[],this.originalName=this.model.nodeInfo.name,this.currentName=this.originalName,this.listenTo(this.model,"renderForm",this.render),this.listenTo($("#node-properties-wrapper"),"dismiss",this.cancel),this.setOriginalModelString();var t=this;this.listenTo(this.model,"chooseObjectType",function(){t.setOriginalModelString(),t.render()})},setOriginalModelString:function(){this.originalModelString=JSON.stringify(this.model.nodeInfo)},modelDirty:function(){return this.originalModelString!==JSON.stringify(this.model.nodeInfo)},template:_.template(magellanDocument.getElementById("new_node_template").innerHTML),matchNodeTemplate:_.template(magellanDocument.getElementById("new_match_node").innerHTML),createAccountTemplate:_.template(magellanDocument.getElementById("create_new_account").innerHTML),mergeLeadTemplate:_.template(magellanDocument.getElementById("merge_lead").innerHTML),decisionNodeTemplate:_.template(magellanDocument.getElementById("new_decision_node").innerHTML),changeNodeName:function(e){this.currentName=$(e.currentTarget).val().trim(),this.model.changeName(this.currentName)},changeDescription:function(e){this.model.nodeInfo.description=$(e.currentTarget).val()},cancel:function(e){if(this.modelDirty()||Magellan.Validation.hasDirtyFormComponent){var t=this;$("#dirty-button-2").off("click"),$("#dirty-button-2").click(function(){Magellan.Validation.hasDirtyFormComponent=!1,t.model.changeName(t.originalName),t.model.nodeInfo=JSON.parse(t.originalModelString),t.model.resyncNodeInfoAndPresentation(),Magellan.Controllers.GUI.closeInspector()}),$("#dirty-modal").modal("show")}else this.model.resyncNodeInfoAndPresentation(),Magellan.Controllers.GUI.closeInspector();paper.findViewByModel(this.model).refreshValidationIcons()},ok:function(e){var t=Magellan.Controllers.GUI.getNameToNodeMap(),i=_.keys(t);this.currentName=this.currentName.trim();var n=_.reduce(i,function(e,t){return this.currentName===t?e+1:e},0,this);if(this.currentName!==this.originalName&&n>=1){var a=this;$("#name-taken-button-2").off("click"),$("#name-taken-button-2").on("click",function(){a.model.changeName(a.originalName),Magellan.Controllers.GUI.closeInspector(),a.model.resyncNodeInfoAndPresentation()}),$("#name-taken-modal").modal("show")}else Magellan.Controllers.GUI.handleNodeNameChanged(this.originalName,this.currentName),this.model.changeName(this.currentName),this.model.resyncNodeInfoAndPresentation(),Magellan.Controllers.GUI.closeInspector();this.model.trigger("saveNodeEvent"),Magellan.Validation.hasDirtyFormComponent=!1,paper.findViewByModel(this.model).refreshValidationIcons()},toggleDescription:function(e){$(e.currentTarget).toggleClass("collapsed")},additionalEvents:{"dismiss #node-properties-wrapper":"cancel","change #do-not-create-opportunity":"toggleCreateOpportunity","change [name='account-creation-choice']":"selectAccountCreationChoice","input #node-name-input":"changeNodeName","input #node-description-input":"changeDescription","click .node-panel-button.cancel":"cancel","click .node-panel-button.ok":"ok","nestedTypeaheadSelector:select #convert-status-typeahead-dropdown":"selectConvertedStatus","click .description-label":"toggleDescription"},toggleCreateOpportunity:function(e){this.openPanel=$("div.advanced-settings-view").hasClass("open"),this.model.nodeInfo.doNotCreateOpportunity=!$(e.currentTarget).is(":checked"),this.model.trigger("renderForm",this.model,{})},selectAccountCreationChoice:function(e){var t="convert lead to contact"===$(e.currentTarget).val();this.model.nodeInfo.convertLeadToContact=t,t?this.__lastConvertedLeadStatus&&(this.model.nodeInfo["convert status"]=this.__lastConvertedLeadStatus):(this.__lastConvertedLeadStatus=this.model.nodeInfo["convert status"]||"",delete this.model.nodeInfo["convert status"]),this.model.trigger("renderForm",this.model,{})},selectConvertedStatus:function(e,t){this.model.nodeInfo["convert status"]=t.selection[0].name,this.model.trigger("renderForm",this.model,{})},saveForm:function(){},render:function(){var e=this.template({currentNode:this.model,optionRequired:!1});if(this.removeAllChildViews(),this.$el.html(e),(this.model instanceof Magellan.Models.DecisionNode||this.model instanceof Magellan.Models.MatchNode)&&!this.model.nodeInfo.objectType&&!(this.model instanceof Magellan.Models.TerritoryNode)){var t=new Magellan.Views.OptionView({model:this.model});return this.childViews.push(t),this.$el.html(t.render().$el),this}if(this.model instanceof Magellan.Models.CreateAccount){var i=this.createAccountTemplate({chosenConvertStatus:actionNodeMetaData.convertedLeadStatusApiNameToLabel[this.model.nodeInfo["convert status"]],fieldMappingLink:"#routing/lead/account_creation",doNotCreateOpportunity:this.model.nodeInfo.doNotCreateOpportunity,convertLeadToContact:this.model.nodeInfo.convertLeadToContact,convertedLeadStatuses:actionNodeMetaData.convertedLeadStatuses,convertedLeadStatusApiNameToLabel:actionNodeMetaData.convertedLeadStatusApiNameToLabel,validateStatus:Magellan.Validation.validateConvertedLeadStatus.bind(this,this.model.nodeInfo["convert status"])});this.$el.find("#node-partial-wrapper").html(i),actionNodeMetaData.convertedLeadStatuses;var n={Status:[]},a="";_.each(actionNodeMetaData.convertedLeadStatusApiNameToLabel,function(e,t){n.Status.push({label:e,name:t}),t===this.model.nodeInfo["convert status"]&&(a=[{label:e,name:t}])},this),this.picklistTypeahead=new Magellan.Views.NestedTypeaheadSelector({data:n,root:"Status",disableBreadcrumbs:!0,requireSelectionFromData:!0,required:!0,selection:null===this.model.nodeInfo["convert status"]?"":a}),this.$el.find("#convert-status-typeahead-dropdown").html(this.picklistTypeahead.$el);var o=new Magellan.Views.AdvancedSettings({model:this.model});this.childViews.push(o),this.$el.find("#node-partial-wrapper #advanced-settings-wrapper").html(o.render().$el)}else if(this.model instanceof Magellan.Models.CreateOpportunity){var l=new Magellan.Views.CreateOpportunity({model:this.model});this.$el.find("#node-partial-wrapper").html(l.render().$el),l.delegateEvents()}else if(this.model instanceof Magellan.Models.CreateTask)l=new Magellan.Views.CreateTask({model:this.model}),this.$el.find("#node-partial-wrapper").html(l.render().$el),l.delegateEvents();else if(this.model instanceof Magellan.Models.OutreachAddToSequence){const e=new Magellan.Views.OutreachAddToSequence({model:this.model});this.$el.find("#node-partial-wrapper").html(e.render().$el),e.delegateEvents()}else if(this.model instanceof Magellan.Models.SalesloftAddToCadence){const e=new Magellan.Views.SalesloftAddToCadence({model:this.model});this.$el.find("#node-partial-wrapper").html(e.render().$el),e.delegateEvents()}else if(this.model instanceof Magellan.Models.Merge)i=this.mergeLeadTemplate(),this.$el.find("#node-partial-wrapper").html(i),o=new Magellan.Views.AdvancedSettings({model:this.model}),this.childViews.push(o),o.openPanel=this.openPanel,this.$el.find("#node-partial-wrapper #advanced-settings-wrapper").html(o.render().$el);else if(this.model instanceof Magellan.Models.MergeContact)i=new Magellan.Views.MergeContact({model:this.model}),this.$el.find("#node-partial-wrapper").html(i.render().$el);else if(this.model instanceof Magellan.Models.MatchNode){var s="Dupe"===this.model.nodeInfo.objectType||"DupeC"===this.model.nodeInfo.objectType;i=this.matchNodeTemplate({isDupeNode:s,pluralObjects:Magellan.Views.getPluralAPIObjectNameFromObjectType(this.model.nodeInfo.objectType),singleObject:Magellan.Views.getAPIObjectNameFromObjectType(this.model.nodeInfo.objectType)}),this.$el.find("#node-partial-wrapper").html(i),o=new Magellan.Views.AdvancedSettings({model:this.model,openPanel:!_.isEmpty(this.model.nodeInfo.matchToParent)}),this.childViews.push(o),this.$el.find("#node-partial-wrapper #advanced-settings-wrapper").html(o.render().$el);var r=new Magellan.Views.EdgeSelectionMenu({model:this.model.nodeInfo.tiebreakers,objectType:this.model.nodeInfo.objectType});this.childViews.push(r),this.$el.find("#criteria-list-partial").html(r.render().$el);var d=new Magellan.Views.FilterRules({model:this.model.nodeInfo,node:this.model,objectType:this.model.nodeInfo.objectType});this.childViews.push(d),this.$el.find(".filter-div").html(d.render().$el)}else if(this.model instanceof Magellan.Models.TriggerNode){var c=new Magellan.Views.TriggerNode({model:this.model,objectType:"lead"});this.childViews.push(c),this.$el.find("#node-partial-wrapper").html(c.render().$el)}else if(this.model instanceof Magellan.Models.TrueFalseNode){var u=new Magellan.Views.TrueFalseNode({model:this.model});this.childViews.push(u),this.$el.find("#node-partial-wrapper").html(u.render().$el)}else if(this.model instanceof Magellan.Models.BranchNode)i=this.decisionNodeTemplate(),this.$el.find("#node-partial-wrapper").html(i),r=new Magellan.Views.EdgeSelectionMenu({model:this.model,objectType:this.model.nodeInfo.objectType}),this.childViews.push(r),this.$el.find("#criteria-list-partial").html(r.render().$el);else if(this.model instanceof Magellan.Models.UpdateLead){var p=new Magellan.Views.UpdateLead({model:this.model});this.$el.find("#node-partial-wrapper").html(p.render().$el)}else if(this.model instanceof Magellan.Models.CustomInterface){var h=new Magellan.Views.CustomInterface({model:this.model});this.childViews.push(h),this.$el.find("#node-partial-wrapper").html(h.render().$el),o=new Magellan.Views.AdvancedSettings({model:this.model}),this.childViews.push(o),o.openPanel=this.openPanel,this.$el.find("#node-partial-wrapper #advanced-settings-wrapper").html(o.render().$el)}else if(this.model instanceof Magellan.Models.ExplicitOwnerAssignment){var g=new Magellan.Views.ExplicitOwnerAssignment({model:this.model,objectType:"Lead"});this.$el.find("#node-partial-wrapper").html(g.render().$el),o=new Magellan.Views.AdvancedSettings({model:this.model}),this.$el.find("#node-partial-wrapper #advanced-settings-wrapper").html(o.render().$el)}else if(this.model instanceof Magellan.Models.AssignOwnerAccount){var m=new Magellan.Views.AccountBasedRouting({model:this.model});this.$el.find("#node-partial-wrapper").html(m.render().$el)}else if(this.model instanceof Magellan.Models.AssignOwnerLead){var f=new Magellan.Views.LeadBasedRouting({model:this.model});this.$el.find("#node-partial-wrapper").html(f.render().$el)}else if(this.model instanceof Magellan.Models.AssignOwnerOpportunity){var v=new Magellan.Views.OpportunityBasedRouting({model:this.model});this.$el.find("#node-partial-wrapper").html(v.render().$el)}else if(this.model instanceof Magellan.Models.RoundRobin){var y=new Magellan.Views.RoundRobin({model:this.model});this.$el.find("#node-partial-wrapper").html(y.render().$el)}else if(this.model instanceof Magellan.Models.TerritoryRouting){var b=new Magellan.Views.TerritoryRouting({model:this.model,graphType:"lead"});this.$el.find("#node-partial-wrapper").html(b.render().$el)}else if(this.model instanceof Magellan.Models.Convert){var w=new Magellan.Views.Convert({model:this.model});this.$el.find("#node-partial-wrapper").html(w.render().$el),(o=new Magellan.Views.AdvancedSettings({model:this.model})).openPanel=this.openPanel,this.$el.find("#node-partial-wrapper #advanced-settings-wrapper").html(o.render().$el)}else this.model instanceof Magellan.Models.SendNotification&&(o=new Magellan.Views.AdvancedSettings({model:this.model}),this.$el.find("#advanced-settings-wrapper").html(o.render().$el));if(this.model instanceof Magellan.Models.ActionNode){var M=this.model instanceof Magellan.Models.SendNotification?"#node-partial-wrapper":"#email-notification-wrapper",T=new Magellan.Views.SendNotification({model:this.model});this.$el.find(M).html(T.render().$el)}else if(this.model instanceof Magellan.Models.RerouteNode){var C=new Magellan.Views.Reroute({model:this.model});this.$el.find("#node-partial-wrapper").html(C.render().$el)}return this.model instanceof Magellan.Models.SendNotification&&(o=new Magellan.Views.AdvancedSettings({model:this.model}),this.$el.find("#advanced-settings-wrapper").html(o.render().$el)),this.model.nodeInfo.name!==this.currentName&&this.$el.find("#node-name-input").val(this.currentName),this}}),Magellan.Views.OptionView=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.selectedOption=null,_.isArray(e.hatOptions)?this.hatOptions=e.hatOptions:this.model instanceof Magellan.Models.MatchNode?this.hatOptions=[{name:"Lead2Account (L2A)",description:"Find matched accounts",value:"L2A"},{name:"Lead2Opportunity (L2O)",description:"Find matched opportunities",value:"L2O"},{name:"Lead2Lead (L2L)",description:"Find matched leads",value:"L2L"},{name:"Duplicate (Dupe)",description:"Find duplicate leads",value:"Dupe"},{name:"Duplicate Contact (DupeC)",description:"Find duplicate contacts",value:"DupeC"}]:this.model instanceof Magellan.Models.DecisionNode&&(this.hatOptions=[{name:"Lead",value:"Primary"},{name:"Lead2Account (L2A)",value:"L2A"},{name:"Lead2Opportunity (L2O)",value:"L2O"},{name:"Lead2Lead (L2L)",value:"L2L"},{name:"Duplicate (Dupe)",value:"Dupe"},{name:"Duplicate Contact (DupeC)",value:"DupeC"}])},template:_.template(magellanDocument.getElementById("option_div").innerHTML),changeOption:function(e){this.selectedOption=$(e.currentTarget).data("value"),this.render()},setModelDefaultsByObjectType:function(){if(this.model instanceof Magellan.Models.MatchNode)switch(this.model.nodeInfo["exclude inactive owned"]=!0,this.model.nodeInfo.objectType){case"L2L":case"Dupe":this.model.nodeInfo.tiebreakers=[{type:"conditions",logic:"1 AND 2 AND 3",conditions:[{"value/field":"field",field:"Country",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"State",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"},{"value/field":"field",field:"PostalCode",type:"STRING",operator:"equals",operand:"PostalCode","operand type":"STRING"}],rpnLogic:[1,2,"AND",3,"AND"]},{type:"conditions",logic:"1 AND 2 AND 3",conditions:[{"value/field":"field",field:"Country",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"State",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"},{"value/field":"field",field:"City",type:"STRING",operator:"equals",operand:"City","operand type":"STRING"}],rpnLogic:[1,2,"AND",3,"AND"]},{type:"conditions",logic:"1 AND 2",conditions:[{"value/field":"field",field:"Country",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"State",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"}],rpnLogic:[1,2,"AND"]},{type:"conditions",logic:"1",conditions:[{"value/field":"field",field:"Country",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"}],rpnLogic:[1]},{type:"optima",field:"LastActivityDate",direction:"max"},{type:"optima",field:"CreatedDate",direction:"min"}];break;case"L2A":this.model.nodeInfo.tiebreakers=[{type:"conditions",logic:"1 AND 2 AND 3",conditions:[{"value/field":"field",field:"BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"BillingState",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"},{"value/field":"field",field:"BillingPostalCode",type:"STRING",operator:"equals",operand:"PostalCode","operand type":"STRING"}],rpnLogic:[1,2,"AND",3,"AND"]},{type:"conditions",logic:"1 AND 2",conditions:[{"value/field":"field",field:"BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"BillingState",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"}],rpnLogic:[1,2,"AND"]},{type:"conditions",logic:"1",conditions:[{"value/field":"field",field:"BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"}],rpnLogic:[1]},{type:"optima",field:"#children",direction:"max"},{type:"optima",field:"#opportunities",direction:"max"},{type:"optima",field:"#contacts",direction:"max"},{type:"optima",field:"LastActivityDate",direction:"max"},{type:"optima",field:"CreatedDate",direction:"min"}];break;case"L2O":this.model.nodeInfo.tiebreakers=[{type:"conditions",logic:"1",conditions:[{"value/field":"value",field:"isclosed",type:"BOOLEAN",operator:"equals",operand:!1}],rpnLogic:[1]},{type:"conditions",logic:"1",conditions:[{"value/field":"value",field:"stagename",type:"PICKLIST",operator:"contains",operand:"open"}],rpnLogic:[1]},{type:"optima",field:"CreatedDate",direction:"min"}],this.model.nodeInfo["restrict l2o to chosen account"]=!0;break;case"DupeC":this.model.nodeInfo.tiebreakers=[{type:"conditions",logic:"1 AND 2 AND 3",conditions:[{"value/field":"field",field:"Account.BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"Account.BillingState",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"},{"value/field":"field",field:"Account.BillingPostalCode",type:"STRING",operator:"equals",operand:"PostalCode","operand type":"STRING"}],rpnLogic:[1,2,"AND",3,"AND"]},{type:"conditions",logic:"1 AND 2 AND 3",conditions:[{"value/field":"field",field:"Account.BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"Account.BillingState",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"},{"value/field":"field",field:"Account.BillingCity",type:"STRING",operator:"equals",operand:"City","operand type":"STRING"}],rpnLogic:[1,2,"AND",3,"AND"]},{type:"conditions",logic:"1 AND 2",conditions:[{"value/field":"field",field:"Account.BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"Account.BillingState",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"}],rpnLogic:[1,2,"AND"]},{type:"conditions",logic:"1",conditions:[{"value/field":"field",field:"Account.BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"}],rpnLogic:[1]},{type:"optima",field:"LastActivityDate",direction:"max"},{type:"optima",field:"CreatedDate",direction:"min"}]}},renderFormForObject:function(e){this.model.nodeInfo.objectType=this.selectedOption,this.setModelDefaultsByObjectType(),this.model.resyncNodeInfoAndPresentation(),this.model.trigger("chooseObjectType",this.model,{}),e.stopPropagation()},additionalEvents:{"click .control":"changeOption","click .ok":"renderFormForObject","click .cancel":"closePanel"},render:function(){var e=this.template({hatOptions:this.hatOptions,selectedOption:this.selectedOption,disableOk:!this.selectedOption,nodeType:this.model instanceof Magellan.Models.DecisionNode?"Decision":"Match"});return this.$el.html(e),this}}),Magellan.Views.TriggerNode=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.isUpdateTrigger=this.isUpdateTrigger||"UPDATE TRIGGER"==this.model.nodeInfo.type,this.objectType=this.objectType||e.objectType||this.model.objectType||LeanData__PrimarySObjectType,this.loadPersistedEdgesFromModel(),this.initializeChildViews(),this.listenTo(this.model,"renderAdvancedSettings",this.renderAdvancedSettings)},loadPersistedEdgesFromModel:function(){this._persistedEdges={all:[],none:Magellan.Models.TriggerNode.defaultInsertEdges(this.model.nodeInfo.name),inclusion:Magellan.Models.TriggerNode.defaultInclusionEdges()},this._persistedEdges[this.model["filter type"]]=_.cloneDeep(this.model.edges)},initializeChildViews:function(){this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model,graphType:this.objectType||"lead"}),this.filterRulesView=new Magellan.Views.FilterRules({model:this.model.nodeInfo,objectType:this.objectType,triggerNode:!0,node:this.model,isUpdateTrigger:this.isUpdateTrigger,parentView:this})},template:_.template(magellanDocument.getElementById("trigger_node").innerHTML),renderFormBody:function(){var e=this.template({isUpdateTrigger:this.isUpdateTrigger,objectType:this.objectType,pluralObjectType:Magellan.Util.getPluralObjectName(this.objectType)});return this.$el.html(e),this},renderFilterRules:function(){return this.filterRulesView.setElement(this.$(".filter-div")).render(),this},renderAdvancedSettings:function(){return"all"!==this.model.nodeInfo["filter type"]&&"inclusion"!==this.model.nodeInfo["filter type"]?this.advancedSettingsView.setElement(this.$("#advanced-settings-wrapper")).render():this.$("#advanced-settings-wrapper").empty(),this},render:function(){return this.renderFormBody().renderFilterRules().renderAdvancedSettings(),this}}),Magellan.Views.Convert=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.model.nodeInfo.doNotCreateOpportunity=this.model.nodeInfo.doNotCreateOpportunity||!1,this.model.nodeInfo["explicit account conversion"]=this.model.nodeInfo["explicit account conversion"]||!1,this.model.nodeInfo["explicit account id"]=this.model.nodeInfo["explicit account id"]||null},template:_.template(magellanDocument.getElementById("convert").innerHTML),additionalEvents:{"change #explicit-account-conversion":"toggleExplicitAccountConversion","change #explicit-account-id":"changeExplicitAccountId","nestedTypeaheadSelector:select #convert-status-dropdown-div":"updateConvertStatus"},validateExplicitAccountConversion:function(){this.$("#explicit-account-id").toggleClass("input-invalid",this.model.nodeInfo["explicit account conversion"]&&!this.model.nodeInfo["explicit account id"])},toggleExplicitAccountConversion:function(e){this.openPanel=$("div.advanced-settings-view").hasClass("open"),this.model.nodeInfo["explicit account conversion"]=$(e.currentTarget).is(":checked"),this.validateExplicitAccountConversion()},changeExplicitAccountId:function(e){this.model.nodeInfo["explicit account id"]=$(e.currentTarget).val(),this.validateExplicitAccountConversion()},loadTypeahead:function(){var e={};e[LeanData__PrimarySObjectType]=[],_.each(actionNodeMetaData.convertedLeadStatusApiNameToLabel,function(t,i){e[LeanData__PrimarySObjectType].push({label:t,name:i})}),this.picklistTypeahead=new Magellan.Views.NestedTypeaheadSelector({data:e,root:LeanData__PrimarySObjectType,disableBreadcrumbs:!0,required:!0,selection:Magellan.Util.convertStringSelectionToArray(this.model.nodeInfo["convert status"])}),this.$el.find("#convert-status-dropdown-div").html(this.picklistTypeahead.$el)},updateConvertStatus:function(e,t){this.model.nodeInfo["convert status"]=t.selection[0].name},render:function(){var e=this.template({chosenConvertStatus:actionNodeMetaData.convertedLeadStatusApiNameToLabel[this.model.nodeInfo["convert status"]],doNotCreateOpportunity:this.model.nodeInfo.doNotCreateOpportunity,explicitAccountConversion:this.model.nodeInfo["explicit account conversion"],explicitAccountId:this.model.nodeInfo["explicit account id"],convertedLeadStatuses:actionNodeMetaData.convertedLeadStatuses,convertedLeadStatusApiNameToLabel:actionNodeMetaData.convertedLeadStatusApiNameToLabel,validateStatus:Magellan.Validation.validateConvertedLeadStatus.bind(this,this.model.nodeInfo["convert status"])});return this.$el.html(e),this.validateExplicitAccountConversion(),this.loadTypeahead(),this}}),Magellan.Views.UpdateLead=Magellan.Views.ButtonHandler.extend({fieldUpdaterView:null,initialize:function(e){this.model.nodeInfo.updates=this.model.nodeInfo.updates||(this.model.nodeInfo.assignmentRuleSelection?[]:[{field:"",value:""}]),this.updatableFields=Magellan.Controllers.FlowBuilder.getFlattenedFieldsByObject(LeanData__PrimarySObjectType)},template:_.template(magellanDocument.getElementById("update_lead").innerHTML),addRule:function(e){this.model.nodeInfo.updates.push({field:"",value:""}),this.render()},deleteRule:function(e){var t=$(e.currentTarget).data("rule-number");this.model.nodeInfo.updates.splice(t,1),this.render()},updateValue:function(e){var t=$(e.currentTarget).data("rule-number");this.model.nodeInfo.updates[t].value=$(e.currentTarget).val()},chooseAssignmentRule:function(e){this.model.nodeInfo.assignmentRuleSelection=$(e.currentTarget).data("choice"),this.render()},additionalEvents:{"click .add-rule-div":"addRule","click .delete-column":"deleteRule","click .assignment-rule-selection":"chooseAssignmentRule","input textarea.update-value":"updateValue","SOFieldUpdater:change":"_setFieldUpdates"},_setFieldUpdates:function(e,t){this.model.nodeInfo.updates=t.val(),!this.model.nodeInfo.assignmentRuleSelection&&this.model.nodeInfo.updates.length<=0&&t.addRow()},render:function(){this.removeAllChildViews();var e=Magellan.Controllers.FlowBuilder.getAssignmentRulesIdMap("Lead"),t=_.isEmpty(this.model.nodeInfo.assignmentRuleSelection)||e.hasOwnProperty(this.model.nodeInfo.assignmentRuleSelection),i=this.template({updateCriteria:this.model.nodeInfo.updates,fields:fieldMetaData.Lead,allowAssignmentRule:actionNodeMetaData.allowAssignmentRule,assignmentRules:Array.from(Object.values(e)),assignmentRuleSelection:this.model.nodeInfo.assignmentRuleSelection||null,assignmentRuleSelectionObject:e[this.model.nodeInfo.assignmentRuleSelection],isSelectionValid:t});this.$el.html(i),t||(this.model.nodeInfo.assignmentRuleSelection=null);var n=new Magellan.Views.SOFieldUpdater({object:LeanData__PrimarySObjectType,fields:this.updatableFields,updates:this.model.nodeInfo.updates});this.childViews.push(n),this.$(".so-field-updater-container").html(n.$el);var a=new Magellan.Views.AdvancedSettings({model:this.model});return this.childViews.push(a),a.openPanel=this.openPanel,this.$el.find("#advanced-settings-wrapper").html(a.render().$el),this}}),Magellan.Views.UpdateContact=Magellan.Views.UpdateLead.extend({initialize:function(){this.model.nodeInfo.updates=this.model.nodeInfo.updates||[{field:"",value:""}],this.contactFields=this.getContactFields()},getContactFields:function(){var e=_.cloneDeep(fieldMetaData.Contact);return _.each(e,function(e){"REFERENCE"===e.type&&(e.type="ID"),delete e.parent}),e},template:_.template(magellanDocument.getElementById("update_contact").innerHTML),render:function(){var e=this.template({updateCriteria:this.model.nodeInfo.updates,fields:fieldMetaData.Contact});this.$el.html(e);var t=new Magellan.Views.SOFieldUpdater({object:"Contact",fields:this.contactFields,updates:this.model.nodeInfo.updates});return this.$(".so-field-updater-container").html(t.$el),this}}),Magellan.Views.AlternateFieldAssignment=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.assignmentField=this.model.nodeInfo["assignment field"],this.customUserFields=Magellan.Controllers.FlowBuilder.getCustomUserFieldsByObject(LeanData__PrimarySObjectType),this.customUserFieldNames=_.map(this.customUserFields,function(e){return e.name})},template:_.template(i(375)),updateAlternateField:function(e,t){this.model.nodeInfo["assignment field"]=t.selection[0].name,this.model.trigger("renderForm",this.model,{})},updateAlternateFieldAssignment:function(e){null!=j$("#alternateFieldAssignment")&&0==j$("#alternateFieldAssignment").is(":checked")?(this.model.nodeInfo["assignment field"]="OwnerId",j$("#alternateFieldAssignmentLabel").css("color","#1f1f1f"),j$("#alternate-field-assignment-div").css("display","none")):("OwnerId"===this.assignmentField||void 0===this.assignmentField?this.model.nodeInfo["assignment field"]="":this.model.nodeInfo["assignment field"]=this.assignmentField,j$("#alternateFieldAssignmentLabel").css("color","var(--ld-green)"),j$("#alternate-field-assignment-div").css("display","inline-block"))},populateDropdowns:function(){var e=this,t={altFields:[]},i=null;_.each(this.customUserFields,function(n){"Created By.ID"!=n.label&&"Last Modified By.ID"!=n.label&&"Owner.ID"!=n.label&&(e.model.nodeInfo["assignment field"]==n.name&&(i=[{label:n.label,name:n.name}]),t.altFields.push({label:n.label,name:n.name}))});var n=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:"altFields",data:t,disableBreadcrumbs:!0,selection:i});n.validate(),this.$el.find("#alternate-field-assignment-typeahead").html(n.$el),this.rerenderDropdown()},rerenderDropdown:function(){var e=this.model.nodeInfo["assignment field"];_.isUndefined(e)||_.isNull(e)?(this.$el.find("#alternate-field-assignment-div .dropdown").css("outline",""),this.$el.find("#alternate-field-assignment-div .dropdown").addClass("dropdown-invalid")):(_.includes(this.customUserFieldNames,e)?(this.$el.find("#alternate-field-assignment-div .dropdown").css("outline","1px solid #9eb7cb"),this.$el.find("#alternate-field-assignment-div .dropdown").removeClass("dropdown-invalid")):(this.$el.find("#alternate-field-assignment-div .dropdown").css("outline",""),this.$el.find("#alternate-field-assignment-div .dropdown").addClass("dropdown-invalid")),"OwnerId"===this.model.nodeInfo["assignment field"]?this.$el.find("#alternate-field-assignment-div span.dropdown-selection").html(""):this.$el.find("#alternate-field-assignment-div span.dropdown-selection").html(this.model.nodeInfo["assignment field"]))},additionalEvents:{"nestedTypeaheadSelector:select #alternate-field-assignment-typeahead":"updateAlternateField","change #alternateFieldAssignment":"updateAlternateFieldAssignment"},render:function(){var e=this.template({primaryObject:LeanData__PrimarySObjectType});return this.$el.html(e),this.populateDropdowns(),null!=this.model.nodeInfo["assignment field"]&&"OwnerId"!==this.model.nodeInfo["assignment field"]?(this.$el.find("#alternateFieldAssignment").prop("checked",!0),this.$el.find("#alternateFieldAssignmentLabel").css("color","var(--ld-green)"),this.$el.find("#alternate-field-assignment-div").css("display","flex")):(this.$el.find("#alternateFieldAssignment").prop("checked",!1),this.$el.find("#alternateFieldAssignmentLabel").css("color","#1f1f1f"),this.$el.find("#alternate-field-assignment-div").css("display","none")),this}}),Magellan.Views.ExplicitOwnerAssignment=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.model.nodeInfo["explicit owner assignment id"]=this.model.nodeInfo["explicit owner assignment id"]||null,this.excludeGroups=_.isBoolean(e.excludeGroups)?e.excludeGroups:this.excludeGroups||!1,this.selectedOwnerString="",this.selectedOwnerId="",this._selectedOwnerIdCache=this.model.nodeInfo["explicit owner assignment id"],this._customUserFieldCache=this.model.nodeInfo[this.assignmentTypes.CUSTOM_USER_FIELD],this.model.nodeInfo.assignmentType=null==this.model.nodeInfo.assignmentType?this.assignmentTypes.EXPLICIT_OWNER_ASSIGNMENT:this.model.nodeInfo.assignmentType,this._assignmentType=this.model.nodeInfo.assignmentType,this.listenTo(this.model,"saveNodeEvent",this._handleSaveAction)},assignmentTypes:{EXPLICIT_OWNER_ASSIGNMENT:"by user id",CUSTOM_USER_FIELD:"user field"},template:_.template(magellanDocument.getElementById("explicit_owner_assignment").innerHTML),events:{"nestedTypeaheadSelector:select .user-finder-component":"updateSelectedOwner","nestedTypeaheadSelector:select .custom-user-field-selector":"updateSelectedCustomUserField","change input[type=radio]":"updateAssignmentTypeAndValue"},updateSelectedOwner:function(e,t){this.selectedOwner=t.selection[0].name,this._selectedOwnerIdCache=t.selection[0].Id,this.createOwnerString()},updateSelectedCustomUserField:function(e,t){this._customUserFieldCache=Magellan.Util.convertFieldSelectionArrayToString(t.selection)},updateAssignmentTypeAndValue:function(e){const t=$(e.target);this._assignmentType=t.data("type")},_handleSaveAction:function(){switch(this.model.nodeInfo.assignmentType=this._assignmentType,delete this.model.nodeInfo[this.assignmentTypes.EXPLICIT_OWNER_ASSIGNMENT],delete this.model.nodeInfo[this.assignmentTypes.CUSTOM_USER_FIELD],this._assignmentType){case this.assignmentTypes.EXPLICIT_OWNER_ASSIGNMENT:this.model.nodeInfo["explicit owner assignment id"]=this._selectedOwnerIdCache;break;case this.assignmentTypes.CUSTOM_USER_FIELD:this.model.nodeInfo[this.assignmentTypes.CUSTOM_USER_FIELD]=this._customUserFieldCache}},createOwnerString:function(){null===this.selectedOwner?(this.$el.find(".selected-user-information-text").show(),this.$el.find(".selected-user-information-href").hide()):(this.selectedOwnerString=this.selectedOwner+" ("+this._selectedOwnerIdCache+")",this.$el.find(".selected-user-information-href").attr("href","/"+this._selectedOwnerIdCache),this.$el.find(".selected-user-information-text").hide(),this.$el.find(".selected-user-information-href").show(),this.$el.find(".selected-user-information-href").text(this.selectedOwnerString))},createAssignOwnerTypeahead:function(){if(void 0==this.userFinderView){var e="";null!==this.model.nodeInfo["explicit owner assignment id"]&&null!==this.selectedOwner&&(e=[{Id:this.model.nodeInfo["explicit owner assignment id"],name:this.selectedOwner,label:this.selectedOwner}]),this.userFinderView=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,selection:e,asyncServiceCall:!0===this.excludeGroups?Magellan.Controllers.FlowBuilder.searchUsers:Magellan.Controllers.FlowBuilder.searchOwners})}},render:function(){var e=this.template({selectedOwnerString:this.selectedOwnerString});this.$el.html(e),this.$el.find(".selected-user-information-href").hide(),this.$el.find(".selected-user-information-text").hide(),null!==this.model.nodeInfo["explicit owner assignment id"]?($("#inspector").LoadingOverlay("show"),Magellan.Controllers.FlowBuilder.searchOwners("",[this.model.nodeInfo["explicit owner assignment id"]]).then(function(e){1===e.length?this.selectedOwner=e[0].Name:(this.selectedOwner=null,this.model.nodeInfo["explicit owner assignment id"]=null),this.createOwnerString(),this.createAssignOwnerTypeahead(),this.$el.find(".user-finder-component").html(this.userFinderView.$el),this.userFinderView.validate()}.bind(this)).fail(function(e){console.log("Error while trying to fetch name of Owner")}).always(function(){$("#inspector").LoadingOverlay("hide",!0)})):(this.selectedOwner=null,this.createOwnerString(),this.createAssignOwnerTypeahead(),this.$el.find(".user-finder-component").html(this.userFinderView.$el),this.userFinderView.validate());var t=new Magellan.Views.AlternateFieldAssignment({model:this.model});this.$el.find(".alternate-field-assignment-container").html(t.render().$el);var i=Magellan.Util.createBlacklistFilter(LeanData__PrimarySObjectType),n=Magellan.Util.createUserFieldsFilter(),a=Magellan.Util.createOwnerToOwnerMappingFilter();this.customUserFieldDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:fieldMetaData,root:LeanData__PrimarySObjectType,required:!0,attributes:{id:"matched-account-custom-user-field"},filter:function(e){return e=i(e),e=n(e),e=a(e)},selection:Magellan.Util.convertFieldSelectionStringToArray(this.model.nodeInfo[this.assignmentTypes.CUSTOM_USER_FIELD],LeanData__PrimarySObjectType,Magellan.Controllers.FlowBuilder.getFieldMetaDataMap())}),this.$el.find(".custom-user-field-selector").html(this.customUserFieldDropdownView.$el);var o=this.model.nodeInfo.assignmentType?this.$el.find("input[type=radio][data-type='"+this.model.nodeInfo.assignmentType+"']"):this.$el.find("input[type=radio][data-type='"+this.assignmentTypes.EXPLICIT_OWNER_ASSIGNMENT+"']");return o.prop("checked",!0),o.parent("label").addClass("checked"),this}}),Magellan.Views.CustomInterface=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.model.nodeInfo.parameter=this.model.nodeInfo.parameter||""},template:_.template(i(9)),updateCustomParameter:function(e){this.model.nodeInfo.parameter=$(e.currentTarget).val()},updateCustomParameterTypeAhead:function(e,t){this.model.nodeInfo.parameter=t.selection[0].name,this.model.trigger("renderForm",this.model,{})},additionalEvents:{"input .custom-interface-parameter":"updateCustomParameter","nestedTypeaheadSelector:select #customInterfaceNodeDropdown":"updateCustomParameterTypeAhead"},render:function(){this.removeAllChildViews();var e=this.template({customParameter:this.model.nodeInfo.parameter,customInterfaceNodesAndEdges:actionNodeMetaData.customInterfaceNodesAndEdges});this.$el.html(e);var t=this.model.nodeInfo.parameter,i={nodeTypes:[]};_.each(actionNodeMetaData.customInterfaceNodesAndEdges,function(e,n){i.nodeTypes.push({label:n,name:n,value:n}),t===n&&(this.edgeOptions={},_.each(e,function(e){var t={type:"fixed"};t.condition=e,t.name=e,t.target=-1,this.edgeOptions[e]=t},this),this.model.nodeInfo.edges=this.edgeOptions)},this);var n=new Magellan.Views.NestedTypeaheadSelector({required:!1,disableBreadcrumbs:!0,requireSelectionFromData:!0,data:i,root:"nodeTypes",selection:null==this.model.nodeInfo.parameter?"":Magellan.Util.convertStringSelectionToArray(this.model.nodeInfo.parameter)});this.$el.find("#customInterfaceNodeDropdown").html(n.$el);var a=new Magellan.Views.AdvancedSettings({model:this.model});return this.childViews.push(a),a.openPanel=this.openPanel,this.$el.find("#advanced-settings-wrapper").html(a.render().$el),this}}),Magellan.Views.AccountBasedRouting=Magellan.Views.ButtonHandler.extend({customUserFieldDropdownView:null,customUserFieldDropdownData:null,initialize:function(e){this.edgeOptions={"Inactive User":{type:"fixed",condition:"Inactive User",name:"Inactive User",target:-1},"Queue Owner":{type:"fixed",condition:"Queue Owned Lead",name:"Queue Owner",target:-1},"No Mapping Found":{type:"fixed",condition:"No Mapping Found",name:"No Mapping Found",target:-1},"Next Node":{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}},this.ADVANCED_SETTING_OUTCOME_MAP={"account owner":[this.edgeOptions["Inactive User"],this.edgeOptions["Next Node"]],"custom field":[this.edgeOptions["Inactive User"],this.edgeOptions["Next Node"]],"account team":[this.edgeOptions["Inactive User"],this.edgeOptions["Next Node"]],"owner mapping":[this.edgeOptions["Inactive User"],this.edgeOptions["No Mapping Found"],this.edgeOptions["Next Node"]],"custom interface":[this.edgeOptions["Inactive User"],this.edgeOptions["Next Node"]]}},template:_.template(magellanDocument.getElementById("account_based_routing").innerHTML),updateMatchedAccountCustomField:function(e){var t=this.customUserFieldDropdownView.selection,i=t[t.length-1];if(_.isUndefined(i)||"REFERENCE"===i.type)return!1;var n=t.reduce(function(e,t){return""!==e&&(e+="."),"REFERENCE"===t.type?e+Magellan.Util.flattenReferenceAPIs(t.name):e+t.name},"");this.model.nodeInfo["custom field"]=n,this.model.trigger("renderForm",this.model,{})},updateOwnerMapping:function(e,t){this.model.nodeInfo["owner mapping"]=t.selection[0].name,this.model.trigger("renderForm",this.model,{})},updateAccountTeam:function(e,t){this.model.nodeInfo["account team rule"]=t.selection[0].name,this.model.trigger("renderForm",this.model,{})},updateAbrType:function(e){$("#advanced-settings-wrapper").show(),this.model.nodeInfo["abr type"]=$(e.currentTarget).data("abr-type"),_.each(this.ADVANCED_SETTING_OUTCOME_MAP[this.model.nodeInfo["abr type"]],function(e){_.each(this.model.nodeInfo.edges,function(t){t.condition==e.condition&&(e.target=t.target)},this)},this),this.model.nodeInfo.edges=this.ADVANCED_SETTING_OUTCOME_MAP[this.model.nodeInfo["abr type"]],this.model.trigger("renderForm",this.model,{})},openAccountTeamLink:function(){var e=this.$el.find("#account-team-div .tt-highlight").html(),t=window.LeanData__PrimarySObjectType.toLowerCase();""!=e&&e?window.open("/apex/Dashboard#routing/"+t+"/specific_account_team/"+this.model.nodeInfo["account team rule"]):window.open("/apex/Dashboard#routing/"+t+"/account_teams")},populateDropdowns:function(){var e={maps:[]};_.each(actionNodeMetaData.ownerMaps,function(t){var i=t.Name;e.maps.push({label:i,name:i})}),this.ownerMapDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:e,root:"maps",disableBreadcrumbs:!0,requireSelectionFromData:!0,required:!0,selection:null==this.model.nodeInfo["owner mapping"]?"":Magellan.Util.convertStringSelectionToArray(this.model.nodeInfo["owner mapping"])});var t={rules:[]};_.each(actionNodeMetaData.accountTeamRules,function(e){var i=e.Name.substring(14);t.rules.push({label:i,name:i})}),this.accTeamDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:t,root:"rules",disableBreadcrumbs:!0,requireSelectionFromData:!0,required:!0,selection:null==this.model.nodeInfo["account team rule"]?"":Magellan.Util.convertStringSelectionToArray(this.model.nodeInfo["account team rule"])}),this.rerenderDropdown()},rerenderDropdown:function(){_.map(actionNodeMetaData.ownerMaps,function(e){return e.Name}),_.map(actionNodeMetaData.accountTeamRules,function(e){return e.Name.substring(14)}),"custom field"==this.model.nodeInfo["abr type"]?(this.customUserFieldDropdownView&&this.customUserFieldDropdownView.remove(),console.log(this.model.nodeInfo["custom field"]),this.customUserFieldDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:fieldMetaData,root:"Account",required:!0,attributes:{id:"matched-account-custom-user-field"},filter:Magellan.Util.createUserFieldsFilter(),selection:Magellan.Util.convertFieldSelectionStringToArray(this.model.nodeInfo["custom field"],"Account",Magellan.Controllers.FlowBuilder.getFieldMetaDataMap())}),this.$el.find(".custom-user-field-selector").html(this.customUserFieldDropdownView.$el)):"account team"==this.model.nodeInfo["abr type"]?(this.$el.find("#account-team-div").html(this.accTeamDropdownView.$el),this.accTeamDropdownView.validate()):"owner mapping"==this.model.nodeInfo["abr type"]&&(this.$el.find("#owner-mapping-div").html(this.ownerMapDropdownView.$el),this.ownerMapDropdownView.validate())},additionalEvents:{"nestedTypeaheadSelector:select #account-team-div":"updateAccountTeam","nestedTypeaheadSelector:select #owner-mapping-div":"updateOwnerMapping","change #abr-radio-control input[type=radio]":"updateAbrType","nestedTypeaheadSelector:select #matched-account-custom-user-field":"updateMatchedAccountCustomField","click #view-team-link":"openAccountTeamLink"},render:function(){this.removeAllChildViews();var e=this.template({model:this.model,primaryObject:LeanData__PrimarySObjectType});this.$el.html(e),this.populateDropdowns(),this.childViews.push(this.customUserFieldDropdownView);var t=new Magellan.Views.AdvancedSettings({model:this.model});if(this.childViews.push(t),t.openPanel=this.openPanel,this.$el.find("#advanced-settings-wrapper").html(t.render().$el),this.model.nodeInfo["abr type"]){var i=this.$el.find("input[type=radio][data-abr-type='"+this.model.nodeInfo["abr type"]+"']");i.prop("checked",!0),i.parent("label").addClass("checked"),this.$el.find("#advanced-settings-text").text("Specify backup actions to take in cases where the primary assignment action meets a condition below.")}else this.$el.find("#advanced-settings-wrapper").hide();var n=new Magellan.Views.AlternateFieldAssignment({model:this.model});return this.$el.find(".alternate-field-assignment-container").html(n.render().$el),this}}),Magellan.Views.LeadBasedRouting=Magellan.Views.ButtonHandler.extend({customUserFieldDropdownView:null,customUserFieldDropdownData:null,initialize:function(e){this.edgeOptions={"Inactive Owner":{type:"fixed",condition:"Inactive Owner",name:"Inactive Owner",target:-1},"Queue Owner":{type:"fixed",condition:"Queue-Owned Matched Lead",name:"Queue Owner",target:-1},"No Mapping Found":{type:"fixed",condition:"No Mapping Found",name:"No Mapping Found",target:-1},"Next Node":{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}},this.ADVANCED_SETTING_OUTCOME_MAP={default:[this.edgeOptions["Inactive Owner"],this.edgeOptions["Next Node"]],"lead owner":[this.edgeOptions["Inactive Owner"],this.edgeOptions["Next Node"]],"exclude queue owned":[this.edgeOptions["Inactive Owner"],this.edgeOptions["Queue Owner"],this.edgeOptions["Next Node"]],"custom field":[this.edgeOptions["Inactive Owner"],this.edgeOptions["Next Node"]]}},template:_.template(magellanDocument.getElementById("lead_based_routing").innerHTML),updateMatchedLeadCustomField:function(e){var t=this.customUserFieldDropdownView.selection,i=t[t.length-1];if(_.isUndefined(i)||"REFERENCE"===i.type)return!1;var n=t.reduce(function(e,t){return""!==e&&(e+="."),"REFERENCE"===t.type?e+Magellan.Util.flattenReferenceAPIs(t.name):e+t.name},"");this.model.nodeInfo["custom field"]=n,this.model.trigger("renderForm",this.model,{})},updateA2bbrType:function(e){$("#advanced-settings-wrapper").show(),this.model.nodeInfo["a2bbr type"]=$(e.currentTarget).data("a2bbr-type"),_.each(this.ADVANCED_SETTING_OUTCOME_MAP[this.model.nodeInfo["a2bbr type"]],function(e){_.each(this.model.nodeInfo.edges,function(t){t.condition==e.condition&&(e.target=t.target)},this)},this),this.model.nodeInfo.edges=this.ADVANCED_SETTING_OUTCOME_MAP[this.model.nodeInfo["a2bbr type"]],this.model.trigger("renderForm",this.model,{})},rerenderDropdown:function(){var e=Magellan.Util.createUserFieldsFilter(),t=Magellan.Util.createOwnerToOwnerMappingFilter();"custom field"==this.model.nodeInfo["a2bbr type"]&&(this.customUserFieldDropdownView&&this.customUserFieldDropdownView.remove(),this.customUserFieldDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:fieldMetaData,root:"Lead",required:!0,attributes:{id:"matched-lead-custom-user-field"},filter:function(i){return i=e(i),i=t(i)},selection:Magellan.Util.convertFieldSelectionStringToArray(this.model.nodeInfo["custom field"],"Lead",Magellan.Controllers.FlowBuilder.getFieldMetaDataMap())}),this.$el.find(".custom-user-field-selector").html(this.customUserFieldDropdownView.$el))},updateExcludeQueueOwned:function(e){null!=j$("#excludeQueueOwned")&&1==j$("#excludeQueueOwned")[0].checked?(_.each(this.ADVANCED_SETTING_OUTCOME_MAP["exclude queue owned"],function(e){_.each(this.model.nodeInfo.edges,function(t){t.condition==e.condition&&(e.target=t.target)},this)},this),this.model.nodeInfo.edges=this.ADVANCED_SETTING_OUTCOME_MAP["exclude queue owned"]):(_.each(this.ADVANCED_SETTING_OUTCOME_MAP.default,function(e){_.each(this.model.nodeInfo.edges,function(t){t.condition==e.condition&&(e.target=t.target)},this)},this),this.model.nodeInfo.edges=this.ADVANCED_SETTING_OUTCOME_MAP.default),1==j$("#excludeQueueOwned")[0].checked&&(this.model.openPanel=!0),this.model.trigger("renderForm",this.model,{})},additionalEvents:{"change #a2bbr-radio-control input[type=radio]":"updateA2bbrType","change #excludeQueueOwnedDiv input[type=checkbox]":"updateExcludeQueueOwned","nestedTypeaheadSelector:select #matched-lead-custom-user-field":"updateMatchedLeadCustomField"},render:function(){this.removeAllChildViews();var e=this.template({model:this.model,actionNodeMetaData:window.actionNodeMetaData,primaryObject:LeanData__PrimarySObjectType});if(this.$el.html(e),this.rerenderDropdown(),this.childViews.push(this.customUserFieldDropdownView),this.model.nodeInfo["a2bbr type"]){var t=this.$el.find("input[type=radio][data-a2bbr-type='"+this.model.nodeInfo["a2bbr type"]+"']");t.prop("checked",!0),t.parent("label").addClass("checked"),this.$el.find("#advanced-settings-text").text("Specify backup actions to take in cases where the primary assignment action meets a condition below.")}else this.$el.find("#advanced-settings-wrapper").hide();var i=!1;_.each(this.model.nodeInfo.edges,function(e){"Queue-Owned Matched Lead"==e.condition&&(i=!0)}),i?(this.$el.find("#excludeQueueOwned").prop("checked",!0),this.$el.find("#excludeQueueOwnedLabel").css("color","var(--ld-green)")):(this.$el.find("#excludeQueueOwned").prop("checked",!1),this.$el.find("#excludeQueueOwnedLabel").css("color","#1f1f1f"),this.model.openPanel=!1);var n=new Magellan.Views.AdvancedSettings({model:this.model});this.childViews.push(n),n.openPanel=this.model.openPanel,this.$el.find("#advanced-settings-wrapper").html(n.render().$el);var a=new Magellan.Views.AlternateFieldAssignment({model:this.model});return this.$el.find(".alternate-field-assignment-container").html(a.render().$el),this}}),Magellan.Views.OpportunityBasedRouting=Magellan.Views.ButtonHandler.extend({initialize:function(e){},template:_.template(magellanDocument.getElementById("opportunity_based_routing").innerHTML),updateMatchedOpportunityCustomField:function(e,t){this.model.nodeInfo["custom field"]=t.selection[0].name,this.model.trigger("renderForm",this.model,{})},updateObrType:function(e){this.$el.find("#advanced-settings-wrapper").show(),this.model.nodeInfo["obr type"]=$(e.currentTarget).data("obr-type"),this.model.trigger("renderForm",this.model,{})},populateDropdowns:function(){var e={userFields:[]};_.each(Magellan.Controllers.FlowBuilder.getCustomUserFieldsByObject("Opportunity"),function(t){e.userFields.push({label:t.label,name:t.name})}),this.matchedOppDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:e,root:"userFields",disableBreadcrumbs:!0,required:!0,selection:null==this.model.nodeInfo["custom field"]?"":Magellan.Util.convertStringSelectionToArray(this.model.nodeInfo["custom field"])}),this.rerenderDropdown()},rerenderDropdown:function(){_.map(Magellan.Controllers.FlowBuilder.getCustomUserFieldsByObject("Opportunity"),function(e){return e.name}),_.map(Magellan.Controllers.FlowBuilder.getCustomUserFieldsByObject(LeanData__PrimarySObjectType),function(e){return e.name}),"custom field"==this.model.nodeInfo["obr type"]&&this.$el.find("#matched-opportunity-custom-user-field-div").html(this.matchedOppDropdownView.$el)},additionalEvents:{"nestedTypeaheadSelector:select #matched-opportunity-custom-user-field-div":"updateMatchedOpportunityCustomField","change #obr-radio-control input[type=radio]":"updateObrType"},render:function(){this.removeAllChildViews();var e=this.template({primaryObject:LeanData__PrimarySObjectType,model:this.model});this.$el.html(e),this.populateDropdowns();var t=new Magellan.Views.AdvancedSettings({model:this.model});if(this.childViews.push(t),t.openPanel=this.openPanel,this.$el.find("#advanced-settings-wrapper").html(t.render().$el),this.model.nodeInfo["obr type"]){var i=this.$el.find("input[type=radio][data-obr-type='"+this.model.nodeInfo["obr type"]+"']");i.prop("checked",!0),i.parent("label").addClass("checked"),this.$el.find("#advanced-settings-text").text("Specify backup actions to take in cases where the primary assignment action meets a condition below.")}else this.$el.find("#advanced-settings-wrapper").hide();var n=new Magellan.Views.AlternateFieldAssignment({model:this.model});return this.$el.find(".alternate-field-assignment-container").html(n.render().$el),this}}),Magellan.Views.CreateOpportunity=Backbone.View.extend({initialize:function(e){this.model.nodeInfo.ownerAssignmentType=this.model.nodeInfo.ownerAssignmentType||"accountOwnerAssignment",this.model.nodeInfo.ownerAssignmentValue=this.model.nodeInfo.ownerAssignmentValue||null,this.model.nodeInfo.customUserField=this.model.nodeInfo.customUserField||null,this.model.nodeInfo.closeDate=this.model.nodeInfo.closeDate||"",this.model.nodeInfo.closeDays=this.model.nodeInfo.closeDays||(""==this.model.nodeInfo.closeDate.length?-1:14),this.model.nodeInfo.opportunityFields=this.model.nodeInfo.opportunityFields||[],0===this.model.nodeInfo.opportunityFields.length&&(this.model.nodeInfo.opportunityFields.push({type:"value",readFieldOrValue:"",writeField:"name"}),this.model.nodeInfo.opportunityFields.push({type:"value",readFieldOrValue:"",writeField:"stagename",isValid:!1})),this.assignmentValue_accountTeam,this.assignmentValue_explicitOwner,this.assignmentValue_customUser,"accountTeamAssignment"===this.model.nodeInfo.ownerAssignmentType&&(this.assignmentValue_accountTeam=this.model.nodeInfo.ownerAssignmentValue),"explicitOwnerAssignment"===this.model.nodeInfo.ownerAssignmentType&&(this.assignmentValue_explicitOwner=this.model.nodeInfo.ownerAssignmentValue),"customUserField"===this.model.nodeInfo.ownerAssignmentType&&(this.assignmentValue_customUser=this.model.nodeInfo.customUserField),this.availableAccountTeams=Magellan.Controllers.FlowBuilder.getAccountTeamRules(),this.customUserFields=_.filter(Magellan.Controllers.FlowBuilder.getCustomUserFieldsByObject(LeanData__PrimarySObjectType),function(e){return"owner.id"!==e.name})},template:_.template(e),events:{'input input[type=text][data-name="name"]':"updateName",'change input[type=radio][name="oc-owner-radio-control"]':"updateOwnerAssignmentType"},updateName:function(e){this.model.nodeInfo.opportunityFields[0].readFieldOrValue=e.currentTarget.value,0===e.currentTarget.value.length?$(e.target).addClass("input-invalid"):$(e.target).removeClass("input-invalid")},updateOwnerAssignmentType:function(e){this.model.nodeInfo.ownerAssignmentType=$(e.currentTarget).data("owner-type"),"ownerAssignment"===this.model.nodeInfo.ownerAssignmentType||"accountOwnerAssignment"===this.model.nodeInfo.ownerAssignmentType?(this.model.nodeInfo.ownerAssignmentValue=null,this.model.nodeInfo.customUserField=null):"accountTeamAssignment"===this.model.nodeInfo.ownerAssignmentType?(this.model.nodeInfo.ownerAssignmentValue=this.assignmentValue_accountTeam,this.model.nodeInfo.customUserField=null):"explicitOwnerAssignment"===this.model.nodeInfo.ownerAssignmentType?(this.model.nodeInfo.ownerAssignmentValue=this.assignmentValue_explicitOwner,this.model.nodeInfo.customUserField=null):"customUserField"===this.model.nodeInfo.ownerAssignmentType&&(this.model.nodeInfo.ownerAssignmentValue=null,this.model.nodeInfo.customUserField=this.assignmentValue_customUser)},render:function(){var e=this,t=this.template({oppName:this.model.nodeInfo.opportunityFields[0].readFieldOrValue,objectType:LeanData__PrimarySObjectType});this.$el.html(t);var i=this.model.nodeInfo.ownerAssignmentType?this.$el.find("input[type=radio][data-owner-type='"+this.model.nodeInfo.ownerAssignmentType+"']"):this.$el.find("input[type=radio][data-owner-type='accountOwnerAssignment']");i.prop("checked",!0),i.parent("label").addClass("checked");var n=this.$el.find("#invalidAccountTeamText");n.html('Error: Account Team "'+this.model.nodeInfo.ownerAssignmentValue+'" (Invalid or Does Not Exist)'),n.hide();var a=this.$el.find("#invalidExplicitOwnerText");a.hide();for(var o={accTeams:[]},l=0;l<this.availableAccountTeams.length;l++)o.accTeams.push({Id:this.availableAccountTeams[l].Id,label:this.availableAccountTeams[l][ns+"Key__c"],name:this.availableAccountTeams[l][ns+"Key__c"]});var s=_.filter(o.accTeams,"name","Account Team: "+this.model.nodeInfo.ownerAssignmentValue),r=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:"accTeams",data:o,disableBreadcrumbs:!0,selection:s,onSelect:function(t){e.model.nodeInfo.ownerAssignmentValue=t.selection[0].name.replace("Account Team: ",""),e.assignmentValue_accountTeam=t.selection[0].name.replace("Account Team: ",""),n.hide()}});r.validate(),this.$el.find("#account-team-typeahead").html(r.$el),"accountTeamAssignment"===this.model.nodeInfo.ownerAssignmentType&&this.model.nodeInfo.ownerAssignmentValue&&0===s.length&&n.show();var d=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,selection:[],asyncServiceCall:Magellan.Controllers.FlowBuilder.searchUsers,onSelect:function(e,t){this.model.nodeInfo.ownerAssignmentValue=t[0].Id,this.assignmentValue_explicitOwner=t[0].Id,a.hide()}.bind(this)});"explicitOwnerAssignment"===this.model.nodeInfo.ownerAssignmentType?($("#inspector").LoadingOverlay("show"),Magellan.Controllers.FlowBuilder.searchUsers("",[this.model.nodeInfo.ownerAssignmentValue]).then(e=>{var t=this.model.nodeInfo.ownerAssignmentValue?e:[];d.setSelection(t),"explicitOwnerAssignment"!==this.model.nodeInfo.ownerAssignmentType||_.isEmpty(this.model.nodeInfo.ownerAssignmentValue)||0!==t.length||(a.html('Error: User Id "'+this.model.nodeInfo.ownerAssignmentValue+'" is inactive or does not exist)'),a.show())}).fail(e=>{console.error("_renderExplicitOwnerTypeahead error",e)}).always(()=>{d.validate().always(()=>{this.$el.find("#ownerListDropdown").html(d.$el),$("#inspector").LoadingOverlay("hide",!0)})})):(d.validate(),this.$el.find("#ownerListDropdown").html(d.$el));var c={userFields:[]};for(l=0;l<this.customUserFields.length;l++)c.userFields.push({label:this.customUserFields[l].label,name:this.customUserFields[l].name});var u=_.filter(c.userFields,"name",this.model.nodeInfo.customUserField),p=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:"userFields",data:c,disableBreadcrumbs:!0,selection:u,onSelect:function(t){e.model.nodeInfo.customUserField=t.selection[0].name,e.assignmentValue_customUser=t.selection[0].name},filter:function(e){return _.filter(e,function(e){return!Magellan.Validation.FIELD_BLACKLIST_SETS.CUSTOM_USER_FIELDS.has(e.name)})}});p.validate(),this.$el.find("#custom-user-field-typeahead").html(p.$el);var h=new Magellan.Views.RequiredOpportunityFields({model:this.model});this.$el.find("#required-opp-fields-wrapper").html(h.render().$el);var g=new Magellan.Views.AdditionalOpportunityFields({model:this.model});this.$el.find("#additional-opp-fields-wrapper").html(g.render().$el);var m=new Magellan.Views.AdvancedSettings({model:this.model});return m.openPanel=this.openPanel,this.$el.find("#advanced-settings-wrapper").html(m.render().$el),this}}),Magellan.Views.RequiredOpportunityFields=Backbone.View.extend({initialize:function(e){this.model=e.model,this.oppStages=[]},template:_.template(t),events:{'change input[type=radio][name="oc-date-radio-control"]':"updateCloseDateType","input #oppDateDays":"updateCloseDays","change #oppDatePicker":"updateCloseDate"},updateCloseDateType:function(e){"specificDate"===$(e.currentTarget).data("date-type")?(this.model.nodeInfo.closeDays=-1,this.model.nodeInfo.closeDate=$("#oppDatePicker").val()):(this.model.nodeInfo.closeDays=$("#oppDateDays").val(),this.model.nodeInfo.closeDate="")},updateCloseDays:function(e){Number(e.currentTarget.value)?(e.currentTarget.value=parseInt(e.currentTarget.value),$(e.target).addClass("input-invalid")):(e.currentTarget.value=e.currentTarget.value.replace(/[^0-9]/g,""),$(e.target).removeClass("input-invalid")),this.model.nodeInfo.closeDays=e.currentTarget.value,0===e.currentTarget.value.length?$(e.target).addClass("input-invalid"):$(e.target).removeClass("input-invalid")},updateCloseDate:function(e){this.model.nodeInfo.closeDate=e.currentTarget.value,0!==e.currentTarget.value.length&&this.isValidDate(e.currentTarget.value)?$(e.target).removeClass("input-invalid"):$(e.target).addClass("input-invalid")},isValidDate:function(e){return e==moment(e).format("MM/DD/YYYY")},render:function(){this.model.nodeInfo.closeDate||this.model.nodeInfo.closeDays||(this.model.nodeInfo.closeDays=14);var e=this.template({closeDays:this.model.nodeInfo.closeDays,closeDateInvalid:!this.isValidDate(this.model.nodeInfo.closeDate)});this.$el.html(e);var t=this.model.nodeInfo.closeDays>=0?this.$el.find("input[type=radio][data-date-type='closeDays']"):this.$el.find("input[type=radio][data-date-type='specificDate']");t.prop("checked",!0),t.parent("label").addClass("checked");var i=this;this.$el.find("#opportunityStageDropdown").html("Loading Opportunities List..."),this.oppStages=Magellan.Controllers.FlowBuilder.getOpportunityStages();var n=_.filter(this.oppStages,"MasterLabel",this.model.nodeInfo.opportunityFields[1].readFieldOrValue),a=new Magellan.Views.LDDropdown({value:n.length>0?n[0]:null,options:this.oppStages,required:!0,optionTemplate:function(e){return _.template("<span><%=option ? option.label : null%></span>")({option:e})},onChange:function(e){i.model.nodeInfo.opportunityFields[1].readFieldOrValue=e.MasterLabel,i.model.nodeInfo.opportunityFields[1].isValid=!0}});return a.validate(),this.$el.find("#opportunityStageDropdown").html(a.$el),this.$el.find("#oppDatePicker").datepicker({dateFormat:"mm/dd/yy",minDate:new Date}),this.$el.find("#oppDatePicker").val(this.model.nodeInfo.closeDate||""),this}}),Magellan.Views.AdditionalOpportunityFields=Backbone.View.extend({initialize:function(e){this.fieldMetaData=fieldMetaData,this.relatedObjectTypes=Magellan.Validation.getNodesToCurrentNode(this.model.nodeInfo.name),this.relatedObjectTypes.routed=[LeanData__PrimarySObjectType],_.isEmpty(this.relatedObjectTypes)?this.filter=_.noop:this.filter=function(e){return"Created Contact"!==e.label&&(!e.contextType||(e.contextType?this.relatedObjectTypes[e.contextType.toLowerCase()]:[]).includes(e.objectType))}},template:_.template(n),events:{"click .add-rule-div":"addRule","click .delete-column":"deleteRule"},addRule:function(){this.model.nodeInfo.opportunityFields.push({type:"value",readFieldOrValue:"",writeField:null}),this.renderRows()},deleteRule:function(e){var t=$(e.currentTarget).data("rule-number");this.model.nodeInfo.opportunityFields.splice(t,1),this.renderRows()},renderRows:function(){var e=this.$el.find("#edit-opp-fields-wrapper");e.html(""),_.each(this.model.nodeInfo.opportunityFields,function(t,i){if("name"!==t.writeField&&"stagename"!==t.writeField){var n=new Magellan.Views.SingleMappingRow({field:t,ruleNum:i,writeType:"Opportunity",readType:"Object",readFieldHeader:"Routed/Matched/Created Object Field",nestedFields:this.fieldMetaData,blacklist:["closedate","stagename","ownerid","name","accountid"].concat(Magellan.Validation.FIELD_BLACKLIST_MAP.REPORTING_FIELDS),filter:this.filter.bind(this)});e.append(n.render().$el)}},this)},render:function(){var e=this.template({});return this.$el.html(e),this.renderRows(),this}}),Magellan.Views.SingleMappingRow=Backbone.View.extend({initialize:function(e){this.ruleNum=e.ruleNum,this.field=e.field,this.readFieldInput="value"===this.field.type?this.field.readFieldOrValue:null,this.readFieldSelect="field"===this.field.type?this.field.readFieldOrValue:null,this.readType=e.readType,this.readFieldHeader=e.readFieldHeader,this.writeType=e.writeType,this.nestedFields=e.nestedFields,this.flattenedWriteFields={},this.flattenedWriteFields[this.writeType]=_.filter(Magellan.Controllers.FlowBuilder.getFlattenedFieldsByObject(this.writeType),function(t){return!_.includes(e.blacklist,t.name)&&t.isUpdateable}),this.filter=e.filter||function(){return!0},this.readFieldDropdown,this.writeFieldDropdown,this.ownerToOwnerMappingFilter=Magellan.Util.createOwnerToOwnerMappingFilter()},template:_.template(a),events:{"change input[type=radio].match-type":"changeMatchType","change .change-condition-value":"changeInputText","LDDropdown:change .boolean-dropdown":"changeBooleanDropdownValue","nestedTypeaheadSelector:select .boolean-dropdown":"changePickListValue"},changeMatchType:function(e){this.field.type=$(e.currentTarget).val(),"field"===this.field.type?this.field.readFieldOrValue=this.readFieldSelect:this.field.readFieldOrValue=this.readFieldInput,this.render()},changeInputText:function(e){this.field.readFieldOrValue=e.currentTarget.value,this.readFieldInput=e.currentTarget.value,0===e.currentTarget.value.length?$(e.target).addClass("input-invalid"):$(e.target).removeClass("input-invalid"),this.validateRow()},changePickListValue:function(e,t){var i=t.selection[0].name;this.field.readFieldOrValue=i,this.readFieldInput=i,this.validateRow()},changeBooleanDropdownValue:function(e,t){var i=t.val().toString();this.field.readFieldOrValue=i,this.readFieldInput=i,this.validateRow()},validateRow:function(){var e="",t=!1;(t=!!this.restrictionType&&(this.readFieldType?_.includes(Magellan.Validation.SFDC_VALID_TYPE_MAPPING[this.readFieldType],this.restrictionType):Magellan.Validation.isValidValueOfType(this.restrictionType,this.readFieldInput)))||(e="Invalid condition: check for valid fields and compatible data types."),this.$(".error-message").html(e),this.$(".change-condition-value").toggleClass("input-invalid",!t),this.$(".matched-field-column .boolean-dropdown .ld-dropdown").toggleClass("input-invalid",!t)},updateRestrictionType:function(e){this.restrictionType=e.toUpperCase(),this.readFieldSelect=null,this.readFieldType=null,this.readFieldDropdown.setSelection([]),this.readFieldDropdown.render(),this.readFieldDropdown.validate(),this.render()},filterFields:function(e){if(!this.restrictionType)return;var t=["REFERENCE"];_.each(Magellan.Validation.SFDC_VALID_TYPE_MAPPING,function(e,i){_.includes(e,this.restrictionType)&&t.push(i)},this);let i=_.filter(e,function(e){return this.filter(e)&&_.includes(t,e.type)},this);return i=this.ownerToOwnerMappingFilter(i),i=_.filter(i,function(e){let t=Magellan.Validation.FIELD_BLACKLIST_SETS[e.objectType.toUpperCase()+"_FIELDS"];return!t||!t.has(e.name)},this)},setReadInputSelector:function(e,t){switch(e){case"BOOLEAN":this.$(".matched-field-column .boolean-dropdown").LDDropdown({options:[!0,!1],value:this.field.readFieldOrValue});break;case"DATE":case"DATETIME":var i=moment.utc(this.field.readFieldOrValue);if(i.isValid()){var n=i.local().format(Magellan.Validation.DATETIME_FORMAT);this.$(".matched-field-column input.change-condition-value").val(n)}else this.$(".matched-field-column input.change-condition-value").val(this.field.readFieldOrValue);"DATE"===e?this.$(".matched-field-column input.change-condition-value").datepicker({dateFormat:"yy-mm-dd"}):this.$(".matched-field-column input.change-condition-value").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss",timeInput:!0,showHour:!1,showMinute:!1,showSecond:!1})}},render:function(){var e=this.field.writeField?_.filter(this.flattenedWriteFields[this.writeType],"name",this.field.writeField.toLowerCase()):[];this.restrictionType=e.length>0?e[0].type:null;var t=this.template({ruleNum:this.ruleNum,fieldType:this.field.type,dataType:this.restrictionType?this.restrictionType.toUpperCase():null,fieldValue:this.field.readFieldOrValue,writeType:this.writeType,readFieldHeader:this.readFieldHeader});this.$el.html(t),this.writeFieldDropdown=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:this.writeType,data:this.flattenedWriteFields,selection:e.length>0?[e[0]]:[],onSelect:function(e){i.field.writeField=e.selection[0].name,i.field.dataType=e.selection[0].type,i.updateRestrictionType(e.selection[0].type)}}),this.$el.find(".write-field-dropdown").html(this.writeFieldDropdown.$el);var i=this,n=_.isEmpty(this.field.readFieldObjectContext)||_.isEmpty(this.field.readFieldObjectType)?this.field.readFieldOrValue:this.field.readFieldObjectContext+" "+this.field.readFieldObjectType+"."+this.field.readFieldOrValue,a=Magellan.Util.expandNestedDropdownFieldSelections(n,this.readType,this.nestedFields);return this.readFieldType=a.length>0?a[a.length-1].type:null,this.readFieldDropdown=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:this.readType,data:this.nestedFields,selection:a,onSelect:function(e){var t=e.selection[0].contextType?e.selection.slice(1):e.selection.slice(0);i.field.readFieldOrValue=Magellan.Util.convertFieldSelectionArrayToString(t),i.readFieldSelect=i.field.readFieldOrValue,i.readFieldType=e.selection[e.selection.length-1].type,i.field.readFieldObjectType=e.selection[0].objectType,i.field.readFieldObjectContext=e.selection[0].contextType||"Matched",i.validateRow()},filter:this.filterFields.bind(this)}),this.readFieldDropdown.validate(),this.$el.find(".read-field-dropdown").html(this.readFieldDropdown.$el),this.setReadInputSelector(this.restrictionType,e),this.validateRow(),this}}),Magellan.Views.RoundRobin=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.namespace=actionNodeMetaData.namespace,this.primaryObject=LeanData__PrimarySObjectType.toLowerCase()},template:_.template(magellanDocument.getElementById("round_robin").innerHTML),updateRoundRobinGrouping:function(e,t){$(e.currentTarget).parent().parent().css("outline","1px solid #9eb7cb"),this.model.nodeInfo["round robin group"]=t.selection[0].label,this.model.nodeInfo["round robin id"]=t.selection[0].Id,this.model.trigger("renderForm",this.model,{})},openRoundRobinLink:function(e){_.isNull(this.model.nodeInfo["round robin id"])||window.open("/apex/Dashboard#routing/round_robin_pools/creator/"+this.model.nodeInfo["round robin id"])},populateDropdowns:function(){var e=this,t={Groups:[]},i=[];_.each(actionNodeMetaData.roundRobinGroupingMap[e.primaryObject],function(n){if("live"!==n[e.namespace+"Pool_Type__c"]){var a=n[e.namespace+"Grouping_Name__c"],o={Id:n.Id,label:a,name:a};t.Groups.push(o),n.Id===e.model.nodeInfo["round robin id"]&&(i=[o])}}),_.isEmpty(i)&&!_.isEmpty(this.model.nodeInfo["round robin id"])?this.$el.find(".rr-error-message-div").text(`Round robin group "${this.model.nodeInfo["round robin group"]}" is not valid`):this.$el.find(".rr-error-message-div").hide();var n=actionNodeMetaData.roundRobinGroupingMap[this.primaryObject];_.isEmpty(this.model.nodeInfo["round robin id"])&&1===n.length&&(this.$el.find("#round-robin-group-dropdown-div span.dropdown-selection").html(n[0][this.namespace+"Grouping_Name__c"]),this.model.nodeInfo["round robin group"]=n[0][this.namespace+"Grouping_Name__c"],this.model.nodeInfo["round robin id"]=n[0].Id),this.validateSelection();var a=new Magellan.Views.NestedTypeaheadSelector({data:t,root:"Groups",disableBreadcrumbs:!0,required:!0,selection:i});this.$el.find("#round-robin-typeahead").html(a.$el)},validateSelection:function(){_.map(Magellan.Controllers.FlowBuilder.getCustomUserFieldsByObject(LeanData__PrimarySObjectType),function(e){return e.name});var e=this.model.nodeInfo["round robin group"],t=this.model.nodeInfo["round robin id"],i=[],n=[];_.each(actionNodeMetaData.roundRobinGroupingMap[this.primaryObject],function(e){i.push(e[actionNodeMetaData.namespace+"Grouping_Name__c"]),n.push(e.Id)},this),_.isNull(t)||_.isUndefined(t)?(this.$el.find("#round-robin-group-dropdown-div .dropdown").css("outline",""),this.$el.find("#round-robin-group-dropdown-div .dropdown").addClass("dropdown-invalid")):(_.includes(n,t)?(this.$el.find("#round-robin-group-dropdown-div .dropdown").css("outline","1px solid #9eb7cb"),this.$el.find("#round-robin-group-dropdown-div .dropdown").removeClass(""),this.$el.find(".rr-error-message-div").hide()):(this.$el.find("#round-robin-group-dropdown-div .dropdown").css("outline",""),this.$el.find("#round-robin-group-dropdown-div .dropdown").addClass("dropdown-invalid")),this.$el.find("#round-robin-group-dropdown-div span.dropdown-selection").html(e))},additionalEvents:{"nestedTypeaheadSelector:select #round-robin-typeahead":"updateRoundRobinGrouping","click #view-group-link":"openRoundRobinLink"},render:function(){this.removeAllChildViews();var e=this.template({model:this.model,graphType:this.graphType,capitalizedObjectType:Magellan.Util.capitalizeString(this.primaryObject)});this.$el.html(e),this.populateDropdowns(),this.$el.find("#do-not-create-opportunity-checkbox").prop("checked",this.model.nodeInfo.doNotCreateOpportunity);var t=new Magellan.Views.AdvancedSettings({model:this.model});this.childViews.push(t),t.openPanel=this.openPanel,this.$el.find("#advanced-settings-wrapper").html(t.render().$el);var i=new Magellan.Views.AlternateFieldAssignment({model:this.model});return this.$el.find(".alternate-field-assignment-container").html(i.render().$el),this}}),Magellan.Views.TerritoryRouting=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.namespace=actionNodeMetaData.namespace,this.graphType=LeanData__PrimarySObjectType.toLowerCase(),this.objectType=LeanData__PrimarySObjectType,this.childViews=[],this.territorySegments=[],this.segmentIds=[],this.segmentNames=[],this.segmentNameToId=new Map,this.segmentIdToName=new Map,this.segmentName="Default",this.segmentId="123",this.populateTerritoryField=""},template:_.template(magellanDocument.getElementById("territory_routing").innerHTML),updateModelOnNestedDropdownChange:function(e,t){var i=e.el.parentNode.dataset.field,n=t[t.length-1];if(_.isUndefined(n)||"REFERENCE"===n.type)return!1;var a=t.reduce(function(e,t){return""!==e&&(e+="."),"REFERENCE"===t.type?e+Magellan.Util.flattenReferenceAPIs(t.name):e+t.name},"");this.model.nodeInfo.fields=this.model.nodeInfo.fields||{},this.model.nodeInfo.fields[i]=a,this.model.type=n.type},handleSelectPopulateTerritoryField:function(e,t){e.el.parentNode.dataset.field;var i=t[t.length-1];if(_.isUndefined(i)||"REFERENCE"===i.type)return!1;var n=t.reduce(function(e,t){return""!==e&&(e+="."),"REFERENCE"===t.type?e+Magellan.Util.flattenReferenceAPIs(t.name):e+t.name},"");this.model.nodeInfo["populate territory field"]=n,this.model.type=i.type},populateSegments:function(){that=this,this.segmentNames=[],this.segmentNameToId=new Map,this.segmentIdToName=new Map,"Lead"==LeanData__PrimarySObjectType?_.each(actionNodeMetaData.territoryRoutingSegments,function(e,t){that.territorySegments=e,that.segmentNames.push({name:e[actionNodeMetaData.namespace+"Name__c"],label:e[actionNodeMetaData.namespace+"Name__c"]}),that.segmentNameToId.set(e[actionNodeMetaData.namespace+"Name__c"],e.Id),that.segmentIdToName.set(e.Id,e[actionNodeMetaData.namespace+"Name__c"])}):_.each(actionNodeMetaData.territoryRoutingSegmentsWithoutQueues,function(e,t){that.territorySegments=e,that.segmentNames.push({name:e[actionNodeMetaData.namespace+"Name__c"],label:e[actionNodeMetaData.namespace+"Name__c"]}),that.segmentNameToId.set(e[actionNodeMetaData.namespace+"Name__c"],e.Id),that.segmentIdToName.set(e.Id,e[actionNodeMetaData.namespace+"Name__c"])}),null!==that.segmentId&&void 0!==that.segmentId&&(that.segmentId=this.model.nodeInfo.segmentId,that.segmentName=that.segmentIdToName.get(that.segmentId))},populateTerritoryFields:function(){that=this,null!==that.populateTerritoryField&&void 0!==that.populateTerritoryField&&(that.populateTerritoryField=this.model.nodeInfo["populate territory field"]),null!=this.model.nodeInfo["populate territory field"]?(this.$el.find("#populateTerritoryField").prop("checked",!0),this.$el.find("#populateTerritoryFieldDiv").css("display","flex")):(this.$el.find("#populateTerritoryField").prop("checked",!1),this.$el.find("#populateTerritoryFieldDiv").css("display","none"))},additionalEvents:{"nestedTypeaheadSelector:select #territory-segment-typeahead-dropdown":"handleSelectSegment","change #populateTerritoryField":"handlePopulateTerritoryFieldCheckboxChange","change #onlyTagTerritory":"handleOnlyTagTerritoryCheckboxChange"},handleOnlyTagTerritoryCheckboxChange:function(e){that.model.nodeInfo["only tag territory"]=e.target.checked},handlePopulateTerritoryFieldCheckboxChange:function(e){this.showOrHideTerritoryField(e.target.checked)},showOrHideTerritoryField:function(e){this.model.nodeInfo["populate territory field checked"]=e,e||(that.model.nodeInfo["only tag territory"]=!1,$("#onlyTagTerritory").prop("checked",!1)),this.$el.find("#populateTerritoryDropdown").toggle(e),this.$el.find("#onlyTagTerritoryDropdown").toggle(e),console.log(Magellan.Controllers.FlowBuilder.getFlattenedWriteFields()),that.model.nodeInfo["populate territory field"]&&that.model.nodeInfo["populate territory field"];var t=new Magellan.Views.NestedTypeaheadSelector({data:Magellan.Controllers.FlowBuilder.getFlattenedWriteFields(),root:LeanData__PrimarySObjectType,onSelect:that.handleSelectPopulateTerritoryField.bind(that),disableBreadcrumbs:!0,required:!0,selection:Magellan.Util.convertFieldSelectionStringToArray(that.model.nodeInfo["populate territory field"],LeanData__PrimarySObjectType,Magellan.Controllers.FlowBuilder.getTerritoryFieldMetaDataMap())});this.$("#populateTerritoryFieldDropdown").html(t.$el)},handleSelectSegment:function(e,t){this.model.nodeInfo.segmentName=t.selection[0].name,this.model.nodeInfo.segmentId=this.segmentNameToId.get(t.selection[0].name),this.segmentName=t.selection[0].name,this.segmentId=this.segmentNameToId.get(t.selection[0].name),this.model.trigger("renderForm",this.model,{})},populateRoutingMappingForm:function(){var e=this,t=[];"Lead"==LeanData__PrimarySObjectType?_.each(actionNodeMetaData.territoryRoutingSegments,function(e){var i=e.Id;e[actionNodeMetaData.namespace+"Name__c"],i==this.model.nodeInfo.segmentId&&(t=e[actionNodeMetaData.namespace+"Fields_Used__c"].split(","))},this):_.each(actionNodeMetaData.territoryRoutingSegmentsWithoutQueues,function(e){var i=e.Id;e[actionNodeMetaData.namespace+"Name__c"],i==this.model.nodeInfo.segmentId&&(t=e[actionNodeMetaData.namespace+"Fields_Used__c"].split(","))},this);var i=fieldMetaData;this.model[LeanData__PrimarySObjectType]=i;var n="";t.forEach(function(e){n+='<div style="margin-bottom:10px;"><span style="margin-right:10px;width:60px;display:inline-block;">'+e+':</span><span style="width:250px;display:inline-block;" data-field="'+e+'" class="nested-dropdown-container-'+e+'"></span></div>'}),this.$(".territory-routing-field-mapping").html(n);var a=[],o={Lead:{CustomField:"",PostalCode:"postalcode",City:"city",State:"state",Country:"country"},Contact:{CustomField:"",PostalCode:"mailingpostalcode",City:"mailingcity",State:"mailingstate",Country:"mailingcountry"},Account:{CustomField:"",PostalCode:"billingpostalcode",City:"billingcity",State:"billingstate",Country:"billingcountry"},Opportunity:{CustomField:"",PostalCode:"account.billingpostalcode",City:"account.billingcity",State:"account.billingstate",Country:"account.billingcountry"}};(a=t.map(function(t){var i=null!=e.model.nodeInfo.fields&&null!=e.model.nodeInfo.fields[t]&&""!=e.model.nodeInfo.fields[t]?e.model.nodeInfo.fields[t]:o[LeanData__PrimarySObjectType][t];return e.model.nodeInfo.fields[t]=i,new Magellan.Views.NestedTypeaheadSelector({data:Magellan.Controllers.FlowBuilder.getTerritoryFieldMetaData(),root:LeanData__PrimarySObjectType,onSelect:e.updateModelOnNestedDropdownChange.bind(e),required:!0,selection:Magellan.Util.convertFieldSelectionStringToArray(e.model.nodeInfo.fields[t],LeanData__PrimarySObjectType,Magellan.Controllers.FlowBuilder.getTerritoryFieldMetaDataMap())})})).forEach(function(i,n){e.$(".nested-dropdown-container-"+t[n]).html(i.$el)}),a.length>0&&e.$("#territory-routing-field-mapping-title").show()},createTerritorySegmentDropdown:function(){var e=LeanData__PrimarySObjectType,t={};t[e]=this.segmentNames,console.log(t);var i=this.model.nodeInfo.segmentName,n=_.some(this.segmentNames,e=>e.name===i);this.territorySegmentDropdown=new Magellan.Views.NestedTypeaheadSelector({data:t,root:e,disableBreadcrumbs:!0,required:!0,selection:null!=this.model.nodeInfo.segmentName&&n?Magellan.Util.convertStringSelectionToArray(this.model.nodeInfo.segmentName):Magellan.Util.convertStringSelectionToArray("")}),this.$("#territory-segment-typeahead-dropdown").html(this.territorySegmentDropdown.$el)},render:function(){this.populateSegments(),this.populateTerritoryFields(),this.removeAllChildViews();var e=this.template({model:this.model,graphType:this.graphType,objectType:this.graphType,segmentId:this.segmentId,segmentName:this.segmentName,populateTerritoryField:this.populateTerritoryField,segmentNames:this.segmentNames});this.$el.html(e),this.model.nodeInfo.fields=this.model.nodeInfo.fields||{},this.createTerritorySegmentDropdown(),this.populateRoutingMappingForm(),"contact"==this.graphType&&(this.updateAccountOwner&&this.updateAccountOwner.remove(),this.updateAccountOwner=new Magellan.Views.UpdatePrimaryAccountOwner({model:this.model}),this.$("#update-account-owner").html(this.updateAccountOwner.render().$el),this.$("#update-account-owner").append('<hr class="horizontal-line-separator">'));var t=new Magellan.Views.AdvancedSettings({model:this.model,graphType:this.graphType||"lead"});this.childViews.push(t),t.openPanel=this.openPanel,this.$el.find("#advanced-settings-wrapper").html(t.render().$el);var i=new Magellan.Views.AlternateFieldAssignment({model:this.model,graphType:LeanData__PrimarySObjectType});this.$el.find(".alternate-field-assignment-container").html(i.render().$el);var n=this.model.nodeInfo["populate territory field checked"],a=this.model.nodeInfo["only tag territory"];return this.$el.find("#populateTerritoryField").prop("checked",n),this.$el.find("#onlyTagTerritory").prop("checked",a),this.showOrHideTerritoryField(n),this.$el.find("#segment-dropdown .ld-caret").on("mouseup",function(e){j$("#segment-dropdown").hasClass("open")||_.defer(function(e){j$("#segment-dropdown .dropdown-selection").click()})}),this}}),Magellan.Views.TrueFalseNode=Magellan.Views.ButtonHandler.extend({template:_.template(magellanDocument.getElementById("true_false_node").innerHTML),currentType:function(){return this.model.nodeInfo.edges[0].type},initialize:function(e){this.childViews=[],null==this.model.nodeInfo.edges[0].soqlCondition&&(this.model.nodeInfo.edges[0].soqlCondition=""),this.objectType=this.model.nodeInfo.objectType||LeanData__PrimarySObjectType},changeRuleType:function(e){var t=$(e.currentTarget).data("rule-type");this.model.nodeInfo.edges[0].type=t,this.render()},additionalEvents:{"change .rule-type-radio":"changeRuleType"},render:function(){this.removeAllChildViews();var e=this.currentType(),t=this.template({ruleType:e});if(this.$el.html(t),"soql"===e){var i=new Magellan.Views.SoqlRule({model:this.model.nodeInfo.edges[0],objectType:this.objectType});this.childViews.push(i),this.$el.find("#soql-rule-wrapper").html(i.render().$el)}else if("conditions"===e){var n=new Magellan.Views.ConditionsList({model:this.model.nodeInfo.edges[0],context:this.model,objectType:this.objectType,isTrueFalseNode:!0});this.childViews.push(n),this.$el.find("#condition-set-wrapper").html(n.render().$el)}var a=new Magellan.Views.EdgeSelectionMenu({model:this.model,objectType:this.objectType});return this.childViews.push(a),a.hideDragColumn=!0,this.$el.find(".criteria-list-partial").html(a.render().$el),this}}),Magellan.Views.MergeContact=Magellan.Views.ButtonHandler.extend({template:_.template(magellanDocument.getElementById("merge_contact").innerHTML),initialize:function(e){this.childViews=[]},additionalEvents:{"nestedTypeaheadSelector:select #merge-status-typeahead-dropdown":"selectMergeStatus"},populatePicklist:function(){var e={Status:[]};for(var t in actionNodeMetaData.convertedLeadStatusApiNameToLabel)e.Status.push({label:actionNodeMetaData.convertedLeadStatusApiNameToLabel[t],name:t});var i="";null!=this.model.nodeInfo["merge status"]&&(i=null==(i=actionNodeMetaData.convertedLeadStatusApiNameToLabel[this.model.nodeInfo["merge status"]])?this.model.nodeInfo["merge status"]:i);var n=[];Magellan.Validation.validateConvertedLeadStatus(this.model.nodeInfo["merge status"])?(n=Magellan.Util.convertStringSelectionToArray(i),this.$el.find(".merge-contact-error-message").hide()):this.$el.find(".merge-contact-error-message").text(`Previously selected status "${this.model.nodeInfo["merge status"]}" is no longer active or does not exist.`);var a=new Magellan.Views.NestedTypeaheadSelector({data:e,root:"Status",disableBreadcrumbs:!0,requireSelectionFromData:!1,required:!0,fetchData:null,selection:n});this.$el.find("#merge-status-typeahead-dropdown").html(a.$el)},selectMergeStatus:function(e,t){this.model.openPanel=$("div.advanced-settings-view").hasClass("open"),this.model.nodeInfo["merge status"]=t.selection[0].name,this.model.trigger("renderForm",this.model,{})},render:function(){this.removeAllChildViews();var e=this.template({validateStatus:Magellan.Validation.validateConvertedLeadStatus.bind(this,this.model.nodeInfo["merge status"]),mergeStatus:actionNodeMetaData.convertedLeadStatusApiNameToLabel[this.model.nodeInfo["merge status"]]});this.$el.html(e),this.populatePicklist();var t=new Magellan.Views.AdvancedSettings({model:this.model});return this.childViews.push(t),t.openPanel=this.model.openPanel,this.$el.find("#advanced-settings-wrapper").html(t.render().$el),this}}),Magellan.Views.SendNotification=Backbone.View.extend({template:_.template(i(368)),events:{"click .send-notif-form-cb":"_toggleForm"},initialize:function(e){this.model=e.model,this.showFailureNotificationForm=!(this.model instanceof Magellan.Models.SendNotification),_.isEmpty(this.model.nodeInfo.notificationSettings)&&(this.model.nodeInfo.notificationSettings={success:null,failure:null}),this.formDataCache=_.cloneDeep(this.model.nodeInfo.notificationSettings),_.isEmpty(this.model.nodeInfo.notificationSettings.success)&&(this.formDataCache.success=Magellan.Util.getDefaultNotificationSettings(),this.model.nodeInfo.notificationSettings.success=this.formDataCache.success),_.isEmpty(this.model.nodeInfo.notificationSettings.failure)&&(this.formDataCache.failure=Magellan.Util.getDefaultNotificationSettings(!0),this.model.nodeInfo.notificationSettings.failure=this.formDataCache.failure),this.hasData={success:!1,failure:!1},_.isEmpty(this.model.nodeInfo.notificationSettings)||(this.hasData.success=Magellan.Util.hasNotificationData(this.model.nodeInfo.notificationSettings.success),this.hasData.failure=Magellan.Util.hasNotificationData(this.model.nodeInfo.notificationSettings.failure));var t=Magellan.Validation.getNodesToCurrentNode(this.model.nodeInfo.name,!0);this.matchedObjectTypes=t.matched,this.createdObjectTypes=t.created,this.model instanceof Magellan.Models.Merge&&-1!==this.matchedObjectTypes.indexOf("Lead")&&this.matchedObjectTypes.splice(this.matchedObjectTypes.indexOf("Lead"),1),this.model instanceof Magellan.Models.MergeContact&&-1!==this.matchedObjectTypes.indexOf("Contact")&&this.matchedObjectTypes.splice(this.matchedObjectTypes.indexOf("Contact"),1),this.emailTemplateSelector={},this.emailRecipientSelector={},this.listenTo(this.model,"saveNodeEvent",function(){var e=Object.keys(Magellan.Util.getDefaultNotificationSettings().recipients);_.each(["success","failure"],function(t){this.emailRecipientSelector[t]&&this.model.nodeInfo.notificationSettings[t]&&(this.emailRecipientSelector[t]._setAdditionalObjectUserFieldsInModel(),this.emailRecipientSelector[t].validate(!0).then(function(){var i=this.emailRecipientSelector[t].model.toJSON(),n={};_.each(e,function(e){n[e]=i[e]}),this.model.nodeInfo.notificationSettings[t].recipients=n}.bind(this)))},this)}.bind(this)),this.render()},_createNotificationViews:function(e){this.emailTemplateSelector[e]=new Magellan.Views.EmailTemplateSelector({templateId:this.formDataCache[e].template}),this.listenTo(this.emailTemplateSelector[e],"selectedTemplate",this._updateTemplate.bind(this,e));var t="success"===e?".success-notification-template-selector":".failure-notification-template-selector";this.$el.find(t).html(this.emailTemplateSelector[e].$el);var i={primaryObjectType:LeanData__PrimarySObjectType,matchedObjectTypes:this.matchedObjectTypes,createdObjectTypes:this.createdObjectTypes,fieldMetaData,showNewPreviousOwnerOptions:!0};"failure"===e&&(i.notifyOwners=!1,i.notifyAdditionalObjectUsers=!1);var n=Object.keys(Magellan.Validation.CREATED_ACTION_TYPE_MAP).includes(this.model.nodeInfo.actionType);n&&(i.showNewObjectOption=!0),n&&(i.showNewPreviousOwnerOptions=!1),this.emailRecipientSelector[e]=new Magellan.Views.EmailRecipientSelector(_.assign({},this.formDataCache[e].recipients,i)),this.listenTo(this.emailRecipientSelector[e],"savedRecipients",this._updateRecipients.bind(this,e));var a="success"===e?".success-notification-recipient-selector":".failure-notification-recipient-selector";this.$el.find(a).html(this.emailRecipientSelector[e].$el)},_toggleForm:function(e){var t=$(e.target),i=t.data("type"),n=t.prop("checked"),a="success"===i?".success-notification-content":".failure-notification-content";this.$el.find(a).toggleClass("hidden",!n),this.model.nodeInfo.notificationSettings[i]=n?this.formDataCache[i]:null},_updateTemplate:function(e,t){this.model.nodeInfo.notificationSettings[e].template=this.formDataCache[e].template=t},_updateRecipients:function(e,t){this.model.nodeInfo.notificationSettings[e].recipients=this.formDataCache[e].recipients=t},render:function(){var e=this.template({showFailureNotificationForm:this.showFailureNotificationForm,showSuccessContent:!this.showFailureNotificationForm||this.hasData.success,showFailureContent:this.hasData.failure});this.$el.html(e),this._createNotificationViews("success"),this.showFailureNotificationForm&&this._createNotificationViews("failure");const t=dashboardController.viewObject.featureProvisioning[dashboardController.ROUTING_EMAIL_NOTIFICATIONS];var i=["send-notification"];if(i.push(this.showFailureNotificationForm?"show-failure-notification":""),i.push(t?"feature-is-enabled":"feature-is-disabled"),this.$el.attr("class",i.join(" ")),this.model instanceof Magellan.Models.SendNotification){var n=new Magellan.Views.AdvancedSettings({model:this.model});this.$el.find("#advanced-settings-wrapper").html(n.render().$el)}return this}}),Magellan.Views.UpdatePrimaryAccountOwner=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.objectType=this.objectType||e.objectType||this.model.objectType||LeanData__PrimarySObjectType.toLowerCase(),this.childViews=[],this.updateAccountOwner=e.model.nodeInfo.updateAccountOwner||!1},template:_.template(i(372)),events:{"click #updatePrimaryAccountOwner":"updateAccountOwnerChange"},render:function(){this.removeAllChildViews();var e=this.template({checked:this.updateAccountOwner,disableUpdateAccountCheckbox:"account owner"==this.model.nodeInfo["abr type"]});return this.$el.html(e),this},updateAccountOwnerChange:function(e){this.model.nodeInfo.updateAccountOwner=!this.model.nodeInfo.updateAccountOwner}}),Magellan.Views.AdvancedSettings=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.objectType=this.objectType||e.objectType||this.model.objectType||LeanData__PrimarySObjectType.toLowerCase()||"L2A",this.openPanel=!!_.isBoolean(e.openPanel)&&e.openPanel,this.childViews=[]},additionalEvents:{"change .l2a-match-parent-toggle":"l2aMatchParentToggleHandler","change .l2a-match-parent-choice":"l2aMatchParentSelectionHandler"},l2aMatchParentToggleHandler:function(e){$(e.target).is(":checked")?this.model.nodeInfo.matchToParent="parent":delete this.model.nodeInfo.matchToParent,this.$el.find(".l2a-match-parent-choices").toggleClass("hidden",!$(e.target).is(":checked")),this.$el.find('.l2a-match-parent-choice[value="'+this.model.nodeInfo.matchToParent+'"]').prop("checked",!0),this.renderEdgeSelectionMenu()},l2aMatchParentSelectionHandler:function(e){this.model.nodeInfo.matchToParent=$(e.target).val(),this.renderEdgeSelectionMenu()},renderEdgeSelectionMenu:function(){"L2A"===this.model.nodeInfo.objectType&&(this.model.nodeInfo.edges=Magellan.Migration.migrateL2AMatchNodeEdges(this.model.nodeInfo.edges,this.model.nodeInfo.matchToParent)),_.each(this.childViews,(e,t)=>{if(e instanceof Magellan.Views.EdgeSelectionMenu)return this.childViews.splice(t,1),!1},this);var e=new Magellan.Views.EdgeSelectionMenu({model:this.model,objectType:this.objectType});e.hideDragColumn=!0,this.childViews.push(e),this.$el.find(".criteria-list-partial").html(e.render().$el)},template:_.template(magellanDocument.getElementById("advanced_settings_view").innerHTML),render:function(){this.removeAllChildViews();var e=this.template({model:this.model,openPanel:this.openPanel});if(this.$el.html(e),"L2A"===this.model.nodeInfo.objectType){var t=_.template(o)({model:this.model});this.$el.find(".l2a-match-parent-settings-container").html(t)}return this.renderEdgeSelectionMenu(),this}}),Magellan.Views.TaggingPreview=Magellan.Views.ButtonHandler.extend({initialize:function(){},showFeedback:function(e){$("#feedback-message").text(e),$("#feedback-message-wrapper").css("display","initial")},hideFeedback:function(){$("#feedback-message-wrapper").css("display","none")},retrieveMatch:function(){var e=$("#lead-id").val(),t=this;$.when().then(function(){return t.hideFeedback(),getTaggingResponse(e)}).then(function(e){var i=JSON.parse(e);if(i["tagging error"])t.showFeedback(i["tagging error"]);else{var n=[i["tagging log"]];namespace=n[0].Message__c?"":"LeanData__",graphIdToNodeNameToNode={"tagging deployment":{"Tagging Preview":i["tagging deployment"].businessLogic[0][0]}};var a={"edge arrow":iconToURLMap["Edge Arrow Logs"],"trigger node":iconToURLMap["Trigger Node Small"],"decision node":iconToURLMap["Decision Node Small"],"match node":iconToURLMap["Match Node Small"],"action node":iconToURLMap["Action Node Small"]},o=t.tableTemplate({logs:n,graphIdToNodeNameToNode,imageURLs:a,objectParameters:{name:"name",company:"company",email:"email",website:"website",city:"city",state:"state",postalcode:"postalcode",country:"country"},hiddenKeys:{phone:"phone",street:"street",createddate:"createddate",lastactivitydate:"lastactivitydate",reporting_matched_account__c:"reporting_matched_account__c"},extraHiddenKeys:function extraHiddenKeys(e){var t={},i=[];return _.each(e.attributes,function(e,t){var n=r;-1===s.indexOf(t.toLowerCase())&&-1===n.indexOf(t.toLowerCase())&&i.push(t)}),i.sort(),_.each(i,function(e){t[e]=e}),t},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},constructParsedCondition:Magellan.Util.construct_parsed_condition,getMatchedRecordForLog:function getMatchedRecordForLog(e,t){var i,n,a,o,l=t[e["graph id"]];if(l)return _.each(e.route,function(e){var t=l[e.name];e.chosen&&(o=e.chosen),t.actionType&&(["Account Based Routing","Assign Owner Account","Route to Account","Route to Matched Account"].includes(t.actionType)?(n=e["account id"],i="Matched Account"):["Lead Based Routing","Assign Owner Lead","Route to Matched Lead"].includes(t.actionType)?(n=e["lead id"],i="Matched Lead"):"Opportunity Based Routing"===t.actionType?(n=e["opportunity id"],i="Matched Opportunity"):"Route To Territory"===t.actionType?null!=e["account id"]&&(n=e["account id"],i="Matched Account"):"Merge Dupe Lead"===t.actionType?(n=e["dupe id"],i="Duplicate Lead"):"Merge Dupe Contact"===t.actionType?(n=e["dupe id"],i="Duplicate Contact"):"Convert Lead"===t.actionType&&(n=e["account id"],i="Conversion Account"),a=e["owner id"]||e["contact owner id"]||null)}),o&&n===o.id?{"new owner":a,"matched record id":n,name:o.name,"match type":i,"matched record":o&&n===o.id?o:null}:o&&"tagging deployment"===e["graph id"]?{"new owner":null,"matched record id":o.id,name:o.name,"match type":"Matched Account","matched record":o}:null},logsFormatDate,isValidDate:function isValidDate(e){return"Invalid Date"!=new Date(e)},getAttributesForMatchedRecord:function getAttributesForMatchedRecord(e){var t=[],i=s,n=r;e.hasOwnProperty("owner.name")&&t.push(["Owner Name",'<a target="_blank" href="/'+e.ownerid+'">'+e["owner.name"]+"</a>"]),e.hasOwnProperty("owner.isactive")&&t.push(["Owner.IsActive",e["owner.isactive"]]),e.hasOwnProperty("createddate")&&t.push(["CreatedDate",e.createddate?logsFormatDate(new Date(e.createddate)):e.createddate]),e.hasOwnProperty("lastactivitydate")&&t.push(["LastActivityDate",e.lastactivitydate?logsFormatDate(new Date(e.lastactivitydate)):e.lastactivitydate]),e.hasOwnProperty("firstname")&&t.push(["FirstName",e.firstname]),e.hasOwnProperty("lastname")&&t.push(["LastName",e.lastname]),e.hasOwnProperty("email")&&t.push(["Email",e.email]),e.hasOwnProperty("phone")&&t.push(["Phone",e.phone]),e.hasOwnProperty("stagname")&&t.push(["StageName",e.stagename]),e.hasOwnProperty("amount")&&t.push(["Amount",e.amount?e.amount.format():e.amount]),e.hasOwnProperty("street")&&t.push(["Street",e.street]),e.hasOwnProperty("city")&&t.push(["City",e.city]),e.hasOwnProperty("state")&&t.push(["State",e.state]),e.hasOwnProperty("country")&&t.push(["Country",e.country]),e.hasOwnProperty("postalcode")&&t.push(["PostalCode",e.postalcode]),e.hasOwnProperty("billingstreet")&&t.push(["BillingStreet",e.billingstreet]),e.hasOwnProperty("billingcity")&&t.push(["BillingCity",e.billingcity]),e.hasOwnProperty("billingstate")&&t.push(["BillingState",e.billingstate]),e.hasOwnProperty("billingcountry")&&t.push(["BillingCountry",e.billingcountry]),e.hasOwnProperty("billingpostalcode")&&t.push(["BillingPostalCode",e.billingpostalcode]),e.hasOwnProperty("mailingstreet")&&t.push(["MailingStreet",e.mailingstreet]),e.hasOwnProperty("mailingcity")&&t.push(["MailingCity",e.mailingcity]),e.hasOwnProperty("mailingstate")&&t.push(["MailingState",e.mailingstate]),e.hasOwnProperty("mailingcountry")&&t.push(["MailingCountry",e.mailingcountry]),e.hasOwnProperty("mailingpostalcode")&&t.push(["MailingPostalCode",e.mailingpostalcode]),e.hasOwnProperty("accountid")&&t.push(["Account",'<a target="_blank" href="/'+e.accountid+'">'+(e["account.name"]||e.accountid)+"</a>"]),e.hasOwnProperty("account.website")&&t.push(["Account.Website",e["account.website"]]),e.hasOwnProperty("account.phone")&&t.push(["Account.Phone",e["account.phone"]]),e.hasOwnProperty("account.billingstreet")&&t.push(["Account.BillingStreet",e["account.billingstreet"]]),e.hasOwnProperty("account.billingcity")&&t.push(["Account.BillingCity",e["account.billingcity"]]),e.hasOwnProperty("account.billingstate")&&t.push(["Account.BillingState",e["account.billingstate"]]),e.hasOwnProperty("account.billingcountry")&&t.push(["Account.BillingCountry",e["account.billingcountry"]]),e.hasOwnProperty("account.billingpostalcode")&&t.push(["Account.BillingPostalCode",e["account.billingpostalcode"]]),e.hasOwnProperty("annualrevenue")&&t.push(["AnnualRevenue",e.annualrevenue?e.annualrevenue.format():e.annualrevenue]),e.hasOwnProperty("numberofemployees")&&t.push(["# of Employees",e.numberofemployees?e.numberofemployees.format():e.numberofemployees]),e.hasOwnProperty("routing_action__c")&&t.push([ns+"Routing_Action__c",e.routing_action__c]);var a=[];return _.each(e,function(e,t){-1===i.indexOf(t.toLowerCase())&&-1===n.indexOf(t.toLowerCase())&&a.push([t,e])}),a.sort(),_.each(a,function(e){t.push([e[0],e[1]])}),t},railsPage:!1,sobjLinkPrefix:"/",taggingPreviewPage:!0,objectType:"lead",formatRoutingAction:function(e){var t=e["primary routing action"],i=_.reduce(_.union(["convert error","merge error","update error","fallback error"],["error","convert_error"]),function(t,i){return _.isEmpty(t)?_.isEmpty(e[i])?null:e[i]:t},null),n=i?"red-parameter-font":"green-parameter-font";return{message:i?"ERROR - NO ACTION":e["primary routing action"]?"updated"===t&&"Lead"===routerObject?"UPDATED LEAD FIELD":"updated"===t&&"Contact"===routerObject?"UPDATED CONTACT FIELD":"updated"===t&&"Account"===routerObject?"UPDATED ACCOUNT FIELD":t.toUpperCase():"NO ACTION",fontClass:n}}});$("#routing_table_target").html(o),$(".expand-glyph").css("background-image",'url("'+iconToURLMap["Expand Arrow"]+'")'),$(".collapse-clickable").click(function(){var e=$(this).parent().first(".collapse-toggleable").find(".optional-keys-ul").first(),t=$(this).find(".expand-glyph");e.is(":visible")?(t.css("background-image",'url("'+iconToURLMap["Collapse Arrow"]+'")'),t.css("background-position","0px 0px"),e.hide()):(t.css("background-image",'url("'+iconToURLMap["Expand Arrow"]+'")'),t.css("background-position","0px 5px"),e.show())})}function pad2(e){return(e<10?"0":"")+e}function logsFormatDate(e){return dateObj=new Date(e),dateObj=new Date(dateObj- -1*userTimeZoneOffset+6e4*dateObj.getTimezoneOffset()),"Invalid Date"==dateObj?"":pad2(dateObj.getMonth()+1)+"/"+pad2(dateObj.getDate())+"/"+dateObj.getFullYear()+" "+("0"+dateObj.getHours()).slice(-2)%12+":"+("0"+dateObj.getMinutes()).slice(-2)+":"+("0"+dateObj.getSeconds()).slice(-2)+" "+(dateObj.getHours()>11?"PM ":"AM ")+userTimeZone}},function(e){t.showFeedback(e)})},template:_.template(magellanDocument.getElementById("match").innerHTML),tableTemplate:_.template(magellanDocument.getElementById("logs_table").innerHTML),additionalEvents:{"click #tagging-preview-button":"retrieveMatch"},render:function(){var e=this.template();return this.$el.html(e),this}}),Magellan.Views.DeploymentHistory=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.objectType=e.objectType,this.localStorageName=e.localStorageName,this.hideEmpty=!1,this.showContinuous=!0,this.showOneTime=!0,this.updatedAfterLoad=!1},selectDeploymentRow:function(e){window.chosenGraphIdMap[this.objectType]=$(e.currentTarget).data("graph-id"),$(e.currentTarget).parent().find(".deployment-row-selected").toggleClass("deployment-row-selected"),$(e.currentTarget).addClass("deployment-row-selected"),Magellan.Navigation.navigate("routing/"+this.objectType+"/insights/"+window.chosenGraphIdMap[this.objectType])},openDeploymentGraph:function(e){if(window.chosenGraphIdMap[this.objectType]=e||window.chosenGraphIdMap[this.objectType],!_.isEmpty(window.chosenGraphIdMap[this.objectType])){var t=_.filter(window.deployedGraphs,function(e){return e.id===window.chosenGraphIdMap[this.objectType]},this)[0];if(!_.isEmpty(t)){var i=!_.isEmpty(window.currentDeploymentIdMap[this.objectType])&&window.chosenGraphIdMap[this.objectType]===window.currentDeploymentIdMap[this.objectType],n=new Magellan.Views.GraphEditor({graphType:"deployed",objectType:this.objectType,localStorageName:this.localStorageName});$(".dg_inner-wrapper").html(n.render().$el);var a=60*(new Date).getTimezoneOffset()*1e3,o=new Date(moment(t.date+a+parseInt(userTimeZoneOffset))),l=new Date(moment()),s=null;i||(s=new Date(moment(t.endDate+a+parseInt(userTimeZoneOffset)))),Magellan.Controllers.GUI.refreshFlowBuilder(),$("#metricswrapper-initial-date").datepicker({minDate:o,maxDate:l}),$("#metricswrapper-initial-date").datepicker("setDate",o),$("#metricswrapper-end-date").datepicker({minDate:o,maxDate:l}),$("#metricswrapper-end-date").datepicker("setDate",s),magellanAppState=APP_STATE.IN_GRAPH,Magellan.Controllers.GUI.paramsJSONToCachedStats={};var r=this;Magellan.Controllers.GUI.deploymentToDisplay=chosenGraphIdMap[this.objectType],$("#view-metrics, #stat-type-select, #metricswrapper-initial-date, #metricswrapper-end-date").off("change"),$("#view-metrics, #stat-type-select, #metricswrapper-initial-date, #metricswrapper-end-date").on("change",function(){Magellan.Controllers.GUI.undisplayStats(),$("#view-metrics:checked").length&&Magellan.Controllers.GUI.displayStats(r.objectType)}),$("#one-time-run-list").on("change",function(e){r.handleOneTimeRunChange.call(r,e)}),$(".routing-type-dropdown").on("change",function(e){r.handleRoutingTypeChange.call(r,e)}),$("#nothing-routed-text").html("No "+_.capitalize(this.objectType)+"s Routed"),$("#nothing-routed-modal-text").html("No "+this.objectType+"s have been routed through LeanData Router during the time period you selected."),this.fetchDeploymentFamily(),this.loadDeploymentGraph().then(function(){r.updateRoutingType(r.deploymentGraphType),setTimeout(function(){$("#view-metrics").trigger("click")},200)})}}},loadDeploymentGraph:function(){var e=this;return Magellan.Services.FlowBuilder.retrieveDeploymentGraph(chosenGraphIdMap[this.objectType]).then(function(t,i){var n=t.name;$(".graph-title-container").html('<div class="label-text" title="'+n+'">'+n+"</div>"),"1x Routing"===t.type?e.deploymentGraphType="one-time":e.deploymentGraphType="continuous";var a=JSON.parse(t.graphJSON);Magellan.Migration.savedGraphVersion=a.graphVersion,assembleGraph(t.graphJSON)})},additionalEvents:{"click .deployment-row":"selectDeploymentRow","click .paginate_button.next":"getMoreRecords","change #continuous-checkbox":"toggleContinuousFilter","change #one-time-checkbox":"toggleOneTimeFilter","change #hide-no-lead-graphs-checkbox":"toggleShowEmptyFilter"},navigateToDeploymentGraph:function(e){var t=$(e.currentTarget).data("graph-id");Magellan.Navigation.navigate("routing/"+window.LeanData__PrimarySObjectType.toLowerCase()+"/insights/"+t)},template:_.template(magellanDocument.getElementById("deployment_history").innerHTML),toggleContinuousFilter:function(e){if(!this.showContinuous||this.showOneTime){var t=$(e.currentTarget).is(":checked");this.showContinuous=t,this.handleFilterUpdate()}else $(e.currentTarget).prop("checked",!0)},toggleOneTimeFilter:function(e){if(this.showContinuous||!this.showOneTime){var t=$(e.currentTarget).is(":checked");this.showOneTime=t,this.handleFilterUpdate()}else $(e.currentTarget).prop("checked",!0)},toggleShowEmptyFilter:function(e){var t=$(e.currentTarget).is(":checked");this.hideEmpty=t,this.handleFilterUpdate()},handleFilterUpdate:function(){var e=this;window.deployedGraphs=[],Magellan.Services.FlowBuilder.getMoreRecords(this.objectType,null,null,this.showContinuous,this.showOneTime,this.hideEmpty).then(function(t,i){e.model=t,window.deployedGraphs=e.model,e.processNewRecords(),0===t.length&&e.$el.find(".paginate_button.next").addClass("disabled"),$(".deployment-history-panel").show()})},enableNextButton:function(){this.$el.find(".paginate_button.next").removeClass("disabled")},processNewRecords:function(){this.render()},render:function(){var e=this.template({deployedGraphs:this.model,getDeploymentDuration:this.getDeploymentDuration.bind(this),showContinuous:this.showContinuous,showOneTime:this.showOneTime,hideEmpty:this.hideEmpty});this.$el.html(e),this.model.length>0&&this.showContinuous&&(this.$el.find(".deployment-history-table tr:first-child").addClass("active-deployment"),this.$el.find(".deployment-history-table tr:first-child td:first-child").addClass("active-deployment-cell")),$.fn.dataTable.ext.type.order["deployment-date-pre"]=function(e){var t=$.parseHTML(e)[0].innerHTML;return moment(t,"MM/DD/YYYY HH:mm a").unix()};var t=this.$el.find(".deployment-history-table").DataTable({columnDefs:[{orderable:!1,targets:0},{type:"deployment-date",targets:2},{orderSequence:["desc","asc"],targets:"_all"}],searching:!1,deferRender:!0,pagingType:"simple",bPaginate:!0,lengthChange:!1,pageLength:10,bInfo:!0,columnsDefs:[{width:"200px",targets:2}]});t.on("order.dt search.dt",function(){t.column(0,{search:"applied",order:"applied"}).nodes().each(function(e,t){e.classList.contains("active-deployment-cell")?e.innerHTML='<div><span class="row-number">'+(t+1)+"</span></div><div>Live</div>":e.innerHTML='<div><span class="row-number">'+(t+1)+"</span></div>"})}).draw();var i=this;return this.enableNextButton(),this.$el.find(".deployment-history-table").on("draw.dt",function(){i.enableNextButton()}),this.updatedAfterLoad||(this.handleFilterUpdate(),i.updatedAfterLoad=!0),this},getDeploymentDuration:function(e){var t=e.endDate||Date.now(),i=moment(t).diff(moment(e.date),"days"),n=moment(t).diff(moment(e.date),"hours"),a=moment(t).diff(moment(e.date),"minutes"),o=moment(t).diff(moment(e.date),"seconds");return o<60?o+" seconds":a<60?a+" minutes":n<=48?n+" hours":i+" days"},fetchDeploymentFamily:function(){$.Deferred();var e=window.chosenGraphIdMap[this.objectType],t=this;Magellan.Services.FlowBuilder.retrieveDeploymentGraphFamily(e).then(function(i){t.deploymentFamily=i,i.continuous&&i["one-time"].length>0&&$(".routing-type-dropdown > .routing-type-select-option").prop("disabled",!1).prop("selected",!0),i["one-time"].forEach(function(e){var t=$("<option>",{text:moment(e.CreatedDate).format("MM/DD/YY HH:mm:ss A"),value:e.Id});$("#one-time-run-list").append(t)}),i["one-time"].map(function(e){return e.Id}).includes(e)&&$("#one-time-run-list").val(e)})},handleRoutingTypeChange:function(e){var t=$(e.currentTarget).find(":selected").data("type");this.routingType&&this.routingType===t||(this.routingType=t,this.updateRoutingType(t),this.changeDisplayedDeployment())},handleOneTimeRunChange:function(e){this.changeDisplayedDeployment()},changeDisplayedDeployment:function(){var e;"continuous"===this.routingType?e=this.deploymentFamily.continuous:"one-time"===this.routingType?e=$("#one-time-run-list").val():console.error("Invalid routingType supplied.");var t=window.LeanData__PrimarySObjectType.toLowerCase();window.chosenGraphIdMap[t]=e,Magellan.Controllers.GUI.deploymentToDisplay=e,Magellan.Controllers.GUI.undisplayStats(),Magellan.Controllers.GUI.displayStats()},updateRoutingType:function(e){"1x Routing"===e&&(e="one-time"),this.routingType=e,$(".routing-type-select-option").prop("selected",!1),$(".routing-type-select-option[data-type="+e+"]").prop("selected",!0).prop("disabled",!1),$(".for-one-time-routing-only, .for-continuous-routing-only").hide(),$(".for-"+e+"-routing-only").css("display","flex")}}),Magellan.Views.GraphEditor=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.graphsMenu=e.graphsMenu||null,this.graphType=e.graphType||window.LeanData__PrimarySObjectType.toLowerCase(),this.objectType=e.objectType,this.localStorageName=e.localStorageName,this.errorTypesToErrorResult=null,this.isNewGraph=e.isNewGraph||!1,this.isStillZooming=!1,this.graphSettingsMenu=new Magellan.Views.GraphSettingsMenu({onChange:function(e){"enableGridlines"===e.name&&this.toggleGridlines(e.value)}.bind(this)}),this.partners={partnerList:[{name:"Outreach",authorized:partnerAuthorizations.outreach,iconURL:"/images/outreach-icon_FB_2x.png",disabledIconURL:"/images/outreach-icon_FB_disabled_2x.png",enabled:Magellan.Models.Provisioning.isPartnerEnabled("outreach")},{name:"Salesloft",authorized:partnerAuthorizations.salesloft,iconURL:"/images/salesloft-icon_FB_2x.png",disabledIconURL:"/images/salesloft-icon_FB_disabled_2x.png",enabled:Magellan.Models.Provisioning.isPartnerEnabled("salesloft")}],menuValidity:{lead:["Outreach","Salesloft"],contact:["Outreach","Salesloft"],opportunity:[],account:[]}}},promptCloseGraph:function(){var e=chosenGraphIdMap.contact||chosenGraphIdMap.lead||chosenGraphIdMap.account||chosenGraphIdMap.opportunity;window.upsertLastPaperPosition(e,paperScroller.getVisibleArea(),paper.scale()),"main"!==magellanPage&&"main-contact"!==magellanPage&&"main-account"!==magellanPage&&"main-opportunity"!==magellanPage||!Magellan.Controllers.GUI.graphHasChanged()?(refreshFlowCharts(),magellanAppState=APP_STATE.OUT_GRAPH):$("#dirty-close-graph-modal").modal("show")},navigateToGraphMenu:function(){Magellan.Navigation.navigate("routing/"+this.objectType+"/flowbuilder")},closeDeploymentGraph:function(){var e=chosenGraphIdMap.contact||chosenGraphIdMap.lead||chosenGraphIdMap.account;window.upsertLastPaperPosition(e,paperScroller.getVisibleArea(),paper.scale()),window.chosenGraphIdMap[this.objectType]=null,"deploymentMetrics-lead"===magellanPage||"deploymentHistory-lead"===magellanPage?Magellan.Navigation.navigate("routing/lead/deployment_history"):"deploymentMetrics-contact"===magellanPage||"deploymentHistory-contact"===magellanPage?Magellan.Navigation.navigate("routing/contact/deployment_history"):"deploymentMetrics-account"===magellanPage||"deploymentHistory-account"===magellanPage?Magellan.Navigation.navigate("routing/account/deployment_history"):"deploymentMetrics-opportunity"===magellanPage||"deploymentHistory-opportunity"===magellanPage?Magellan.Navigation.navigate("routing/opportunity/deployment_history"):"lead"===this.objectType?(magellanPage="deploymentHistory",setDeploymentId=null,initializeLeadDeploymentPage(),$("#inner-wrapper-header").text("Lead Flow Deployment History")):"contact"===this.objectType?(magellanPage="deploymentHistory-contact",setDeploymentId=null,initializeContactDeploymentPage(),$("#inner-wrapper-header").text("Contact Flow Deployment History")):"account"===this.objectType?(magellanPage="deploymentHistory-account",setDeploymentId=null,initializeAccountDeploymentPage()):this.objectType,magellanAppState=APP_STATE.OUT_GRAPH},saveGraph:function(e,t,i){e=(e||"").trim();var n=$.Deferred();if($("#save-button").css("pointer-events","none"),this.errorInGraphName(e))return $("#save-button").css("pointer-events",""),$("#graph-name").LDInput("validate"),n.reject(),n;var a=$.Deferred();this.validateGraph().then(function(e){e?a.resolve(e):!0===i?a.reject(e):requestModalResponse("error-in-graph").then(function(){a.resolve(e)}).fail(function(){a.reject(e)})});var o=this;return a.then(function(i){var a={};a.graphVersion=Magellan.Migration.currentGraphVersion,a.businessLogic=graph.flattenedGraph();var l=paperScroller.getVisibleArea();$("#background-grid").hide();var s=paper.getContentBBox(),r=parseInt(s.width)*(165/parseInt(s.height)),d=o.graphSettingsMenu.model.getSetting("createThumbnail"),c=!_.isObject(d)||d.value,u={"graph id":"new"==chosenGraphIdMap[t]?null:chosenGraphIdMap[t],"graph name":e,"graph info":JSON.stringify(a),"base64 image":"","sobject type":Magellan.Util.capitalizeString(t),"is valid":i},p=function(){var e=JSON.stringify(u);Magellan.Services.FlowBuilder.saveRoutingGraph(e).then(function(e,i){if(e||"exception"!==i.type||(alert(i.message),n.reject()),e&&e.isNewMap){chosenGraphIdMap[t]=e.graphId;var a=JSON.parse(window.localStorage.getItem(o.localStorageName));a.unshift(chosenGraphIdMap[t]),window.localStorage.setItem(o.localStorageName,JSON.stringify(a))}e?($(document).trigger("graph-saved"),n.resolve(e)):n.reject(e),$("#save-button").css("pointer-events","")}).fail(function(){n.reject()})};c?paper.toPNG(function(e){e.length>=13e4&&(e=""),u["base64 image"]=e,p()},{width:r,height:165,backgroundColor:"transparent"}):p(),$("#background-grid").show(),paperScroller.center(l.x+l.width/2,l.y+l.height/2),Magellan.Controllers.GUI.startingGraph=JSON.stringify(graph.flattenedGraph())},function(){$("#save-button").css("pointer-events",""),$("#save-as-button").css("pointer-events",""),$("#save-deploy-button").css("pointer-events",""),n.reject()}),n},save:function(){Magellan.Controllers.GUI.clickAction();var e=Magellan.Controllers.GUI.appWaitingScreen.show("Saving Workflow...");this.saveGraph($("#graph-name").val(),this.objectType).always(function(){e.resolve()})},saveAs:function(){var e=this,t=requestModalResponse("save-as",["#save-as-extra input"]);$("#save-as-modal #save-as-button-2").toggleClass("disabled",!0),$("#save-as-modal").find("input").LDInput({validate:e.errorInGraphName,mode:"edit",defaultValue:$(".graph-title-container .label-text").text()}).on("LDInput:isValid",function(){$("#save-as-modal #save-as-button-2").removeClass("disabled")}).on("LDInput:isInvalid",function(){$("#save-as-modal #save-as-button-2").addClass("disabled")}),t.then(function(t){var i=t["#save-as-extra input"][0],n=chosenGraphIdMap[e.objectType];chosenGraphIdMap[e.objectType]=null;var a=Magellan.Controllers.GUI.appWaitingScreen.show('Saving workflow as "'+i+'"...');e.saveGraph(i,e.objectType).always(function(t){t&&t.graphId?(chosenGraphIdMap[e.objectType]=t.graphId,null!==e.graphsMenu&&e.graphsMenu.openGraph(t.graphId)):t&&t[errors]&&t[errors].length>0?($("#paper").noty({text:"Error: "+t.errors.join(", "),type:"error",timeout:1500}),chosenGraphIdMap[e.objectType]=n):($("#paper").noty({text:"Warning: New Graph ID not found.",type:"warning",timeout:3e3}),chosenGraphIdMap[e.objectType]=n),a.resolve()})})},saveAndDeploy:function(){var e=this,t=Magellan.Controllers.GUI.appWaitingScreen.show("Saving workflow...");e.saveGraph($("#graph-name").val(),e.objectType,!0).then(function(){var t=Magellan.Controllers.GUI.appWaitingScreen.show("Deploying workflow...");deployGraph(e.objectType).fail(function(){alert("Deployment failed")}).always(function(){t.resolve()})},function(){var t=Magellan.Validation.generateErrorMessages(e.errorTypesToErrorResult);null!==t?e.updateGraphStatusMessage(t,"Cannot deploy. Graph contains errors."):alert("Save failed!")}).always(function(){t.resolve(),$("#save-deploy-button").css("pointer-events","")})},showDeploymentSaveAsModal:function(){var e=this;requestModalResponse("deployment-save-as",["#deployment-save-as-extra input"]).then(function(t){var i=t["#deployment-save-as-extra input"][0];if(void 0==_.find(graphImages,function(e){return e.name===i})){$("#background-grid").hide();var n=paper.getContentBBox(),a=parseInt(n.width)*(165/parseInt(n.height));paper.toPNG(function(t){e.createGraphFromDeployment(i,t)},{quality:.1,width:a,height:165,backgroundColor:"transparent"})}else requestModalResponse("deployment-save-as-failure-duplicate")})},createGraphFromDeployment:function(e,t){var i=this;Magellan.Services.FlowBuilder.createGraphFromDeployment(chosenGraphIdMap[this.objectType],e,t).then(function(e,t){var n=JSON.parse(window.localStorage.getItem(i.localStorageName));n.unshift(e),window.localStorage.setItem(i.localStorageName,JSON.stringify(n)),requestModalResponse("deployment-save-as-success")})},toggleRadio:function(e){$(e.currentTarget).prop("checked")&&($(e.currentTarget).parent("label").siblings("label").removeClass("checked"),$(e.currentTarget).parent("label").addClass("checked"))},editNode:function(e){e.ctrlKey||e.metaKey||e.shiftKey||Magellan.Controllers.GUI.editNode(graph.getCell($(e.currentTarget).parents(".element").attr("model-id")))},dragLink:function(e){var t=jQuery.Event("click");t.pageX=Magellan.Controllers.GUI.clickX,t.pageY=Magellan.Controllers.GUI.clickY,$(e.currentTarget).parents("g.type-defaultmagellanlink.link").find("path.connection-wrap").trigger(t)},deleteSelected:function(e){$(e.currentTarget).attr("xlink:href",iconToURLMap["Delete Function Icon Selected"])},deleteLeave:function(e){$(e.currentTarget).attr("xlink:href",iconToURLMap["Delete Function Icon"])},editSelected:function(e){$(e.currentTarget).attr("xlink:href",iconToURLMap["Edit Function Icon Selected"])},editLeave:function(e){$(e.currentTarget).attr("xlink:href",iconToURLMap["Edit Function Icon"])},copySelected:function(e){$(e.currentTarget).attr("xlink:href",iconToURLMap["Copy Function Icon Selected"])},copyLeave:function(e){$(e.currentTarget).attr("xlink:href",iconToURLMap["Copy Function Icon"])},validateGraph:function(e){$("#graph-status-container").LoadingOverlay("show"),$("#graph-status-message-icon").hide();var t=$.Deferred();return Magellan.Validation.validateGraph().always(function(i){$("#graph-status-container").LoadingOverlay("hide",!0),this.errorTypesToErrorResult=i;var n=Magellan.Validation.generateErrorMessages(i),a=_.isEmpty(n);if(this.updateGraphStatusMessage(n),Magellan.Controllers.GUI.bindButtons(),a&&e)return $("#validation-successful-modal").modal("show"),void(liveGraphIdMap[this.objectType]==chosenGraphIdMap[this.objectType]&&($("#graph-status-message").text("LIVE"),$("#graph-status-indicator").addClass("graph-deployed")));t.resolve(a),Magellan.Validation.generateErrorStylings(i)}.bind(this)),t},updateGraphStatusMessage:function(e,t){null!==e?($("#graph-status-message").hide(),$("#graph-status-message-icon").show()):($("#graph-status-message").show(),$("#graph-status-message-icon").hide())},displayVerboseErrorModal:function(){displayVerboseErrorModal(this.errorTypesToErrorResult)},zoomToScale:function(){var e=V.decomposeMatrix(V(paper.viewport).transform()),t=$(".zoom-status-text"),i=Number(t.text())/100,n=e.scaleX;paperScroller.zoom(i-n),$(".paper-scroller").css("padding",0),$(".paper-scroller").css("margin",0),paper.$el.css("padding",0),paper.$el.css("margin",0)},updateZoomLabel:function(){var e=$("#zoom-slider-input"),t=$(".zoom-status-text"),i=Number(e.val()),n=this.translateZoomSliderStepsToZoomValue(i);t.text(n),this.zoomToScale()},updateZoomSlider:function(){var e=$("#zoom-slider-input"),t=$(".zoom-status-text"),i=Number(t.text()),n=this.translateZoomValueToZoomSliderSteps(i);e.val(n)},handleZoomWheel:function(e){e.ctrlKey&&(e.originalEvent.wheelDelta>-120&&e.originalEvent.wheelDelta<120||e.preventDefault())},handleZoomButton:function(e){this.isStillZooming=!0;var t=e.currentTarget.classList,i=$(".zoom-status-text"),n=Number(i.text()),a=null;t.contains("zoom-in")?a=10:t.contains("zoom-out")?a=-10:console.error("Unknown zoom direction for handleZoomButton"),n+=a,n=Math.min(n,200),n=Math.max(n,25),i.text(n),this.updateZoomSlider(),this.zoomToScale(),setTimeout(function(){this.isStillZooming&&this.handleZoomButton(e)}.bind(this),100)},cancelZoomButton:function(){this.isStillZooming=!1},showZoomInput:function(){var e=$(".zoom-status-text"),t=$(".zoom-status-input"),i=e.text().trim();t.val(i),e.hide(),t.show(),t.focus()},hideZoomInput:function(){var e=$(".zoom-status-text"),t=$(".zoom-status-input");e.show(),t.hide()},updateZoomInput:function(e){if(13===(e.keyCode?e.keyCode:e.which)){var t=$(".zoom-status-text"),i=$(".zoom-status-input"),n=Number(i.val().trim());_.isNaN(n)||(n=Math.min(n,200),n=Math.max(n,25),t.text(n),this.hideZoomInput(),this.updateZoomSlider(),this.zoomToScale())}},translateZoomSliderStepsToZoomValue:function(e){return e<250?25+Math.round(e/250*75):e>250?100+Math.round((e-250)/250*100):100},translateZoomValueToZoomSliderSteps:function(e){return e<100?Math.round((e-25)/75*250):e>100?250+Math.round((e-100)/100*250):250},showMetricsLegend:function(e){var t=$(e.currentTarget).is(":checked");$("#board-container .metrics-legend-wrapper").toggleClass("hidden",!t)},navigateToDeploymentMenu:function(){Magellan.Navigation.navigate("routing/"+this.objectType+"/deployment_history")},additionalEvents:{"click #close-button.close-builder":"navigateToGraphMenu","click #close-button.close-history":"navigateToDeploymentMenu","click #save-deploy-button":"saveAndDeploy","click #save-button.save-as":"saveAs","click #save-button.save":"save","click #save-button.history-save-as":"showDeploymentSaveAsModal","click #validate-button":"validateGraph","change .control--radio input[type=radio]":"toggleRadio","dblclick image.main-icon":"editNode","click g.type-defaultmagellanlink.link g.label":"dragLink","mouseenter .delete-icon":"deleteSelected","mouseleave .delete-icon":"deleteLeave","mouseenter .edit-icon":"editSelected","mouseleave .edit-icon":"editLeave","mouseenter .copy-icon":"copySelected","mouseleave .copy-icon":"copyLeave","click #graph-status-message-icon":"displayVerboseErrorModal","input #zoom-slider-input":"updateZoomLabel","mousedown .zoom-button":"handleZoomButton","mouseleave .zoom-button":"cancelZoomButton","mouseup .zoom-button":"cancelZoomButton","click .zoom-status-text":"showZoomInput","blur .zoom-status-input":"hideZoomInput","keypress .zoom-status-input":"updateZoomInput","mousewheel .paper-scroller":"handleZoomWheel","change #view-metrics":"showMetricsLegend"},template:_.template(magellanDocument.getElementById("wf_editor").innerHTML),errorInGraphName:function(e){return""===(e=(e||"").trim())?"Graph name cannot be empty.":Magellan.Controllers.FlowBuilder.graphNameExists(e,chosenGraphIdMap[this.objectType])?"Graph name already exists.":""},renderGraphName:function(e){$(".graph-title-container").html('<input id="graph-name" autocomplete="off" />'),$("#graph-name").val(e).LDInput({validate:this.errorInGraphName.bind(this)})},addDraftStatus:function(){$("#graph-status-message").text("DRAFT").addClass("draft-graph")},render:function(){window.addEventListener("beforeunload",dirtyFlowBuilderUnloadEventHandler),$(document).off("graph-saved"),$(document).on("graph-saved",function(){$("#paper").noty({text:"Graph saved!",type:"information",timeout:1500}),$("#paper").find(".noty_inline_layout_container").css({position:"absolute",top:0})}),this.boardClasses=[].join(" ");var e=this.template({graphType:this.graphType,objectType:this.objectType,boardClasses:this.boardClasses,partners:this.partners});if(this.$el.html(e),this.$el.popover({placement:"left",trigger:"hover",container:"#board-container",selector:".metrics-legend-item"}),this.$el.find("#graph-settings-menu").html(this.graphSettingsMenu.render().$el),setTimeout(function(){this.toggleGridlines(this.graphSettingsMenu.model.getSetting("enableGridlines").value),$(".metrics-legend-wrapper").toggleClass("hidden",!this.$(".view-metrics").is(":checked"))}.bind(this),0),this.isNewGraph){var t="Router Graph - "+moment(Date.now()).format("LLL");this.renderGraphName(t),this.addDraftStatus()}return this},toggleGridlines:function(e){var t=paperScroller.$el.find("svg")[0];e?t.insertBefore(parseSVG('<rect id="background-grid" fill="url(#graph-paper-background)" x="0" y="0" width="100%" height="100%"></rect>'),t.firstChild):document.getElementById("background-grid")&&document.getElementById("background-grid").remove()}}),Magellan.Views.GraphsMenu=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.graphs=e.graphs,this.localStorageName=e.localStorageName,this.objectType=e.objectType},graphsMenuTemplate:_.template(magellanDocument.getElementById("magellan_graphs_menu").innerHTML),liveGraphTemplate:_.template(magellanDocument.getElementById("live_graph_template").innerHTML),newGraphTemplate:_.template(magellanDocument.getElementById("new_graph_tile_template").innerHTML),graphTemplate:_.template(magellanDocument.getElementById("graph_template").innerHTML),recoverTileOrder:function(){if(null==window.localStorage.getItem(this.localStorageName)){var e=this.graphs.map(function(e){return e.id});window.localStorage.setItem(this.localStorageName,JSON.stringify(e))}else{var t=this.graphs;try{if((e=JSON.parse(window.localStorage.getItem(this.localStorageName))).length!=this.graphs.length)throw"Order_array is outdated, refreshed it to default order.";for(var i={},n=0;n<this.graphs.length;n++)i[this.graphs[n].id]=this.graphs[n];this.graphs=e.map(function(e){var t=i[e];if(void 0==t)throw"Order_array is erroneous, refreshed it to default order.";return t})}catch(i){e=t.map(function(e){return e.id}),window.localStorage.setItem(this.localStorageName,JSON.stringify(e))}}var a=this,o=_.partition(this.graphs,function(e){return e.id!==liveGraphIdMap[a.objectType]}),l=o[0];0!==o[1].length&&(this.updateGraphValidities(o[1]),this.$el.find(".routing-graphs").append(this.liveGraphTemplate({graph:o[1][0],truncateExcess:a.truncateExcess(78)}))),this.$el.find(".routing-graphs").append(this.newGraphTemplate),_.each(l,function(e){a.$el.find(".routing-graphs").append(a.graphTemplate({graph:e,truncateExcess:a.truncateExcess(40)}))}),this.$el.find(".routing-graphs").sortable({update:function(e,t){var i=j$(this).sortable("toArray");liveGraphIdMap[a.objectType]&&i.unshift(liveGraphIdMap[a.objectType]),window.localStorage.setItem(a.localStorageName,JSON.stringify(i))},items:".sortable-panel"})},updateGraphValidities:function(e){var t=e.map(function(e){return e.id}),i={};Magellan.Controllers.FlowBuilder.fetchGraphsByIds(t).then(function(e){var t=[];_.each(e,function(e,n){if(e.updatedFromServer){var a=e.graphJSON,o=JSON.parse(a.replace(/&quot;/g,'"')),l=e.isValid;try{var s=Magellan.Validation.validateGraph(o).then(function(t){var n=null===Magellan.Validation.generateErrorMessages(t);n!==l&&(e.isValid=i[e.id]=n),$("#"+e.id+" .validation-errors-modal-icon").toggle(!n)});t.push(s)}catch(t){console.log('Failed to validate graph "'+e.name+'".'),console.error(t),$("#"+e.id+" .validation-errors-modal-icon").toggle(!0)}}}),$.when.apply($,t).then(function(){})})},truncateExcess:function(e){return function(t){return t.length>e?t.substring(0,e)+"...":t}},newGraph:function(){chosenGraphIdMap[this.objectType]="new";var e=new Magellan.Views.GraphEditor({graphsMenu:this,graphType:"draft",objectType:this.objectType,isNewGraph:!0,localStorageName:this.localStorageName});j$(".dg_inner-wrapper").html(e.render().$el),Magellan.Initializers.General.adjustGraphPageSize(),Magellan.Controllers.GUI.refreshFlowBuilder(),magellanAppState=APP_STATE.IN_GRAPH,setTriggerNodesOnGraph(),e.addDraftStatus();var t="Router Graph - "+moment(Date.now()).format("LLL");e.renderGraphName(t)},highlightGraph:function(e){j$(".chart-panel-selected").toggleClass("chart-panel-selected"),j$(e.currentTarget).addClass("chart-panel-selected")},selectGraph:function(e){chosenGraphIdMap[this.objectType]=$(e.currentTarget).data("graph-id"),this.highlightGraph(e)},openGraph:function(e){if(chosenGraphIdMap[this.objectType]=e||chosenGraphIdMap[this.objectType],null==chosenGraphIdMap[this.objectType]||"new"==chosenGraphIdMap[this.objectType])this.newGraph();else{var t=new Magellan.Views.GraphEditor({graphsMenu:this,graphType:"draft",objectType:this.objectType,localStorageName:this.localStorageName});$(".dg_inner-wrapper").html(t.render().$el),Magellan.Controllers.GUI.refreshFlowBuilder(),liveGraphIdMap[this.objectType]==chosenGraphIdMap[this.objectType]?($("#graph-status-message").text("LIVE").addClass("live-graph"),$("#graph-status-indicator").addClass("graph-deployed")):t.addDraftStatus();var i=Magellan.Controllers.GUI.appWaitingScreen.show("Loading Workflow...");this.loadGraph().then(function(e){var i=e.name;t.renderGraphName(i)}).always(function(){i.resolve()}),magellanAppState=APP_STATE.IN_GRAPH}window.autoSaveInterval=setInterval(function(){if(!graph&&window.autoSaveInterval)return clearInterval(window.autoSaveInterval),void(window.autoSaveInterval=null);try{localStorage.setItem("FBGraphDraft",JSON.stringify(graph.flattenedGraph()))}catch(e){localStorage.setItem("FBGraphDraft","Exception: "+e)}},3e5)},loadGraph:function(){var e=Magellan.Services.FlowBuilder.retrieveGraph(chosenGraphIdMap[this.objectType]),t=$.Deferred();return e.then(function(e){var i=JSON.parse(e.graphJSON);Magellan.Migration.savedGraphVersion=i.graphVersion,Magellan.Validation.validateGraph(i).then(function(){assembleGraph(e.graphJSON),t.resolve(e)})}),t},deployGraphAndRefresh:function(){that=this;var e=function(){var e=Magellan.Controllers.GUI.appWaitingScreen.show("Deploying Workflow...");Magellan.Services.FlowBuilder.retrieveGraph(chosenGraphIdMap[that.objectType]).then(function(e){var t=JSON.parse(e.graphJSON.replace(/&quot;/g,'"'));Magellan.Validation.validateGraph(t).then(function(e){Magellan.Validation.generateErrorMessages(e)?displayVerboseErrorModal(e,null):window.deployGraph(that.objectType).then(function(){$("#graph-deploy-success-modal").modal("show"),window.refreshFlowCharts()},function(){$("#graph-deploy-failure-modal").modal("show")})})}).always(function(){e.resolve()})}.bind(that),t=chosenGraphIdMap[that.objectType]||null,i=graphImages.find(function(e){return e.id===t});new Magellan.Views.ConfirmationModal({header:"Deployment Confirmation",message:"Are you sure you want to deploy this graph: ",footer:i.name,onConfirmed:e}).open()},deleteGraph:function(){var e=function(){console.log("Delete Graph "+chosenGraphIdMap[this.objectType]);var e=this;null!=chosenGraphIdMap[this.objectType]&&Magellan.Services.FlowBuilder.deleteGraph(chosenGraphIdMap[this.objectType]).then(function(t,i){var n=JSON.parse(window.localStorage.getItem(e.localStorageName));n=n.filter(function(e){return e!=chosenGraphIdMap[this.objectType]}),window.localStorage.setItem(e.localStorageName,JSON.stringify(n)),alert(" Graph Deleted "),chosenGraphIdMap[this.objectType]=null,refreshFlowCharts()})}.bind(this),t=chosenGraphIdMap[this.objectType]||null,i=graphImages.find(function(e){return e.id===t});new Magellan.Views.ConfirmationModal({header:"Confirm Deleting Graph",message:"Are you sure you want to delete this graph: ",footer:i.name,onConfirmed:e}).open()},cloneRoutingGraph:function(){var e=this;if(console.log("Clone Graph "+chosenGraphIdMap[this.objectType]),null!=chosenGraphIdMap[this.objectType]){for(var t=_.find(graphImages,function(t){return t.id==chosenGraphIdMap[e.objectType]}).name;void 0!=_.find(graphImages,function(e){return e.name===t});)t+=" copy",console.log(t);Magellan.Services.FlowBuilder.cloneGraph(chosenGraphIdMap[this.objectType],t).then(function(t,i){var n=JSON.parse(window.localStorage.getItem(e.localStorageName));n.unshift(t),window.localStorage.setItem(e.localStorageName,JSON.stringify(n)),alert(" Graph Copied "),refreshFlowCharts()})}},exportGraph:function(){var e=this;if(null!=chosenGraphIdMap[this.objectType]){var t=_.find(graphImages,function(t){return t.id==chosenGraphIdMap[e.objectType]}).name;Magellan.Services.FlowBuilder.exportGraph(chosenGraphIdMap[this.objectType]).then(function(e,i){download(e,t+" Graph.txt","text/plain")})}},importGraph:function(){var e=this,t=document.getElementById("importSelectGraph").files[0],i=new FileReader;i.onload=function(t){encryptFileContents=i.result,showLoadingOverlay(),Magellan.Services.FlowBuilder.decryptGraphJSON(encryptFileContents).then(function(t,i){"DECRYPT FAIL"==t?(hideLoadingOverlay(),$("#import-graph-failure-modal").modal("show")):Magellan.Services.FlowBuilder.importGraph(t).then(function(t,i){var n=JSON.parse(window.localStorage.getItem(e.localStorageName));n.unshift(t),window.localStorage.setItem(e.localStorageName,JSON.stringify(n)),refreshFlowCharts();var a=t;Magellan.Services.FlowBuilder.retrieveGraph(t).then(function(e,t){Magellan.Validation.validateGraph(JSON.parse(e.graphJSON)).then(function(t){var i={};Magellan.Validation.generateErrorMessages(t)?(displayVerboseErrorModal(t,e.name),i[a]=!1):($("#import-graph-success-modal-text").html('<div>Your flow <span style="font-style:italic;font-weight:500;">'+e.name+"</span> has been successfully imported.</div>"),requestModalResponse("import-graph-success"),i[a]=!0),Magellan.Services.FlowBuilder.updateGraphsIsValid(i),hideLoadingOverlay()})}),$("#"+a+" .validation-errors-modal-icon").show()})})},i.readAsText(t)},additionalEvents:{"dblclick .new-graph-tile":"navigateToGraph","mousedown .new-graph-tile":"highlightGraph","mousedown .chart-panel":"selectGraph","dblclick .chart-panel":"navigateToGraph","click #edit-icon":"navigateToGraph","click #deploy-icon":"deployGraphAndRefresh","click #copy-icon":"cloneRoutingGraph","click #delete-icon":"deleteGraph","click #export-icon":"exportGraph","change #importSelectGraph":"importGraph"},navigateToGraph:function(e){var t,i=$(e.currentTarget);t=i.is(".chart-panel")?e.currentTarget.id:i.closest(".chart-panel").data("graph-id"),_.isEmpty(t)&&(t="new"),Magellan.Navigation.navigate("routing/"+this.objectType+"/flowbuilder/"+t)},render:function(){var e=this.graphsMenuTemplate({capitalizedObjectType:Magellan.Util.capitalizeString(this.objectType)});return this.$el.html(e),this.recoverTileOrder(),this}}),Magellan.Views.FilterRules=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.childViews=[],this.node=e.node||null,this.isUpdateTrigger=e.isUpdateTrigger||!1,this.triggerNode=e.triggerNode||!1,this.hideNumber=e.hideNumber,this.objectType=e.objectType||this.model.objectType||this.node&&this.node.nodeInfo.objectType||"L2A",this.filterTypes={inclusion:Magellan.Migration.emptyLogicRule(),exclusion:Magellan.Migration.emptyLogicRule(),custom:Magellan.Migration.emptyCustomRule()},this.filterTypes[this.model["filter type"]]=this.model.filter,this.parentView=e.parentView},template:_.template(magellanDocument.getElementById("filter_rules_template").innerHTML),additionalEvents:{"change .filter-type-radio":"changeFilterType","change #restrict-l2o-to-chosen-account":"changeRestrictL2OToChosenAccount","change #exclude-inactive-owned":"changeExcludeInactiveOwned"},changeFilterType:function(e){this.filterTypes[this.model["filter type"]]=this.model.filter;var t=$(e.currentTarget).data("filter-type");this.triggerNode?this.parentView._persistedEdges[this.model["filter type"]]=_.cloneDeep(this.model.edges):this.model.filter=this.filterTypes[t],"all"===this.model["filter type"]&&"all"!==t?_.isEmpty(this.model.edges[0])||(this.model.edges[0].target=null):"none"===t?this.model.filter=null:"all"===t&&(this.model.edges[0].target=-1,this.model.filter=null),this.triggerNode&&(this.model.edges=_.cloneDeep(this.parentView._persistedEdges[t])),this.model["filter type"]=t,this.model.filter&&(this.model.filter["filter type"]=t),this.renderFilter(this.node)},changeRestrictL2OToChosenAccount:function(e){this.model["restrict l2o to chosen account"]=$(e.currentTarget).is(":checked")},changeExcludeInactiveOwned:function(e){this.model["exclude inactive owned"]=$(e.currentTarget).is(":checked")},renderFilter:function(e){e&&this.node.trigger("renderAdvancedSettings",this.node,{}),this.render()},render:function(){this.removeAllChildViews();var e="Dupe"===this.objectType||"DupeC"===this.objectType,t=this.template({isDupeNode:e,isUpdateTrigger:this.isUpdateTrigger,triggerNode:this.triggerNode,filterType:this.model["filter type"],node:this.node,pluralObjects:Magellan.Views.getPluralAPIObjectNameFromObjectType(this.objectType),hideNumber:this.hideNumber,magellanClass:this.model.magellanClass,excludeInactiveOwned:this.model["exclude inactive owned"],primaryObject:LeanData__PrimarySObjectType,restrictL2OToChosenAccount:this.model["restrict l2o to chosen account"]});if(this.$el.html(t),"inclusion"===this.model["filter type"]&&this.triggerNode){var i=new Magellan.Views.EdgeSelectionMenu({model:this.node,context:this.node,isUpdateTrigger:this.isUpdateTrigger,triggerNode:this.triggerNode});this.childViews.push(i),i.showDescription=!1,this.$el.find("#criteria-list-partial").html(i.render().$el)}else if("inclusion"===this.model["filter type"])i=new Magellan.Views.ConditionsList({model:this.model.filter,context:this.node,objectType:this.objectType,hideFieldValueColumn:this.triggerNode,isDupeNode:e,isUpdateTrigger:this.isUpdateTrigger}),this.childViews.push(i),i.showDescription=!1,this.$el.find("#inclusion-filter-rules").html(i.render().$el).hide().slideDown();else if("exclusion"===this.model["filter type"]){var n=new Magellan.Views.ConditionsList({model:this.model.filter,context:this.node,objectType:this.objectType,hideFieldValueColumn:this.triggerNode,isDupeNode:e});this.childViews.push(n),n.showDescription=!1,this.$el.find("#exclusion-filter-rules").html(n.render().$el).hide().slideDown()}else if("custom"===this.model["filter type"]){var a=new Magellan.Views.CustomRule({model:this.model.filter,objectType:this.objectType});this.childViews.push(a),this.$el.find("#custom-filter-rules").html(a.render().$el).hide().slideDown(),this.$el.find("#inclusion-filter-rules, #exclusion-filter-rules").empty()}else this.$el.find("#inclusion-filter-rules, #exclusion-filter-rules").empty();return this}}),Magellan.Views.EdgeSelectionMenu=Magellan.Views.ButtonHandler.extend({invalidChildren:null,nextNodeNames:null,initialize:function(e){this.childViews=[],this.context=this.model instanceof Magellan.Models.Node?this.model:e.context||new Backbone.Model,this.objectType=e.objectType,this.nextNodeNames=this._getNextNodeNames(),this.isTrigger=e.triggerNode||!1,this.isUpdateTrigger=e.isUpdateTrigger||!1,this.$el.on("LD_SoqlRule:changed",function(e,t){t.$el.closest(".criteria-list-item").find(".decision-criteria-column .warning-sign").toggleClass("hidden",t.model.isValid)})},_getNextNodeNames:function(){if(!(this.model instanceof Magellan.Models.Node))return[];var e=Magellan.Util.getNodeNamesToNodesMap(),t=Magellan.Util.getTriggerNodeNames(e),i=_.sortBy(Object.keys(e)),n=_.filter(i,function(e){var i=e!==this.model.nodeInfo.name,n=!_.includes(t,e);return i&&n},this);return this.model instanceof Magellan.Models.RerouteNode&&n.push(0),n.push(-1),n.unshift(null),n},deleteRule:function(e){var t=$(e.currentTarget).data("criteria-number");if(this.model instanceof Magellan.Models.Node){var i=!this.model.nodeInfo.edges[t].target||-1===this.model.nodeInfo.edges[t].target,n=this.model.nodeInfo.edges[t];this.model.nodeInfo.edges.splice(t,1),this.render(),i?paper.findViewByModel(this.model).render():this.model.linkHandler.removeLinkForEdge(n,null)}else this.model.splice(t,1),this.render()},showRuleTypeSelection:function(){$(".rule-type-selection").css("display","inline-flex")},hideRuleTypeSelection:function(){$(".rule-type-selection").css("display","none")},addRule:function(e){var t=$(e.currentTarget).data("rule-type");if(this.model instanceof Magellan.Models.Node){t="logic"===t?"conditions":t;var i=new Set,n=0;_.each(this.model.nodeInfo.edges,function(e,t){"system"!==e.type&&"default"!==e.type&&(n=t+1,i.add(e.name))});for(var a=1,o="Edge "+a;i.has(o);)o="Edge "+ ++a;this.model.nodeInfo.edges.splice(n,0,Magellan.Migration.emptyEdge(this.model,t,o)),this.render(),paper.findViewByModel(this.model).render()}else{var l=null;"logic"===t?l=Magellan.Migration.emptyLogicRule():"soql"===t?l=Magellan.Migration.emptySoqlCondition():"optima"===t&&(l=Magellan.Migration.emptyMinMaxRule()),null!==l&&(l.isNew=!0,this.model.push(l),this.render(),delete l.isNew)}},editRule:function(e){if(!(this.model instanceof Magellan.Models.TrueFalseNode)){var t=e.currentTarget,i=$(t).data("criteria-number");if($(".conditions-edit-partial-wrapper").empty(),this.toggledCriteria===i)return this.toggledCriteria=null,void this.render();this.toggledCriteria=i;var n=$(t).parents(".criteria-list-item").find(".conditions-edit-partial-wrapper"),a=this.model instanceof Magellan.Models.Node?this.model.nodeInfo.edges[i]:this.model[i],o=this.isTrigger||this.model instanceof Magellan.Models.RerouteNode;if("conditions"===a.type){var l=new Magellan.Views.ConditionsList({model:a,context:this.context,objectType:this.objectType,hideFieldValueColumn:o,isUpdateTrigger:this.isUpdateTrigger});this.listenTo(l,"validated",this.handleConditionListValidationEvent.bind(this,l)),this.childViews.push(l),n.html(l.render().$el)}else if("optima"===a.type){var s=new Magellan.Views.OptimaView({model:a,objectType:this.objectType});this.childViews.push(s),n.html(s.render().$el)}else if("soql"===a.type){var r=new Magellan.Views.SoqlRule({model:a,objectType:this.objectType});this.childViews.push(r),n.html(r.render().$el),r.callValidateSOQL()}else{if("custom"!==a.type)return;var d=new Magellan.Views.CustomRule({model:a,objectType:this.objectType});this.childViews.push(d),n.html(d.render().$el)}}},updateEdgeName:function(e,t){var i=$(e.currentTarget),n=i.data("criteria-number");this.criteriaList[n].name=this.criteriaList[n].formattedName=t,i.prop("title",""),this.$(".edge-label-column .edge-name-input").not(i).LDInput("validate"),(this.model.refreshLinks||_.noop).apply(this.model)},validateEdgeName:function(e,t){if(_.isEmpty(t)||(t=t.trim()),_.isEmpty(t))return"Required";var i=_.some(this.criteriaList,function(i){return e!==i&&"string"==typeof i.name&&i.name.trim().toLowerCase()===t.toLowerCase()},this);return e.name=t,i?"Duplicate Name":""},validateEdge:function(e){if(e.isNew)return!0;var t=!0;if("conditions"===e.type){var i=new Magellan.Views.ConditionsList({model:e,context:this.context,objectType:this.objectType});t=i.validate(),i.remove()}else if("soql"===e.type)t=e.isValid;else if("optima"===e.type){var n=Magellan.Views.getAPIObjectNameFromObjectType(this.objectType);t=Magellan.Validation.metadataFieldExists(n,e.field)}return t},handleConditionListValidationEvent:function(e,t){e.$el.closest(".criteria-list-item").find(".decision-criteria-column .warning-sign").toggleClass("hidden",t)},additionalEvents:{"click .minus-icon-div":"deleteRule","click .edit-icon-div":"editRule","click .rule-type":"addRule","LDInput:updated .edge-name-input":"updateEdgeName","mouseenter .new-rule-container .add-rule-div":"showRuleTypeSelection","mouseenter .new-rule-container .empty-row-space":"hideRuleTypeSelection","mouseleave .new-rule-container":"hideRuleTypeSelection"},changeNextNode:function(e,t){if(e.target!==t){var i=e.target;null===t?this.model.linkHandler.removeLinkForEdge(e):-1===t||0===t?this.model.linkHandler.removeLinkForEdge(e):this.model.linkHandler.changeEdgeTargetFromMenu(e,t,i),e.target=t}},bindSorting:function(e){this.$el.find("#criteria-sortable, .criteria-sortable").sortable({handle:".drag-column > img",cursor:"grabbing, -moz-grabbing, -webkit-grabbing",items:"li:not(.criteria-list-default)"});var t=this;this.$el.find("#criteria-sortable, .criteria-sortable").on("sortstop",function(i){oldCriteria=JSON.parse(JSON.stringify(e)),e.length=0,$(this).children().each(function(t,i){e.push(oldCriteria[$(this).data("criteria-number")])}),t.render()})},formattedConditionTextTemplate:_.template(magellanDocument.getElementById("formatted_condition_text").innerHTML),template:_.template(magellanDocument.getElementById("edge_menu").innerHTML),render:function(){this.removeAllChildViews();var e=this,t=this.criteriaList=this.model instanceof Magellan.Models.Node?this.model.getEdgesForSelection():this.model,i=_.reduce(t,function(e,t){if(t.hasOwnProperty("name"))return e[t.name]=e[t.name]?e[t.name]+1:1,e},{}),n=!(this.model instanceof Magellan.Models.DecisionNode||this.model instanceof Magellan.Models.RerouteNode),a=Magellan.Views.getAPIObjectNameFromObjectType(this.objectType),o=LeanData__PrimarySObjectType,s=this.isTrigger||this.model instanceof Backbone.Model&&this.model.get("reversed-condition-operands");if(this.model instanceof Magellan.Models.Node)var r=this.model instanceof Magellan.Models.MatchNode,d=this.template({edges:t,mapNameCounts:i,formattedConditionTextTemplate:this.formattedConditionTextTemplate,hideDragColumn:this.hideDragColumn,isAccountSettingsPage:!1,hideLabel:r,allowOptimaNode:n,trueFalseNode:this.model instanceof Magellan.Models.TrueFalseNode,getFieldLabel:this._getFieldLabel.bind(this,s?o:a),getOperandFieldLabel:this._getFieldLabel.bind(this,s?a:o),getOperandValueLabel:this._getOperandValueLabel.bind(this),validateEdge:this.validateEdge.bind(this),isTrigger:this.isTrigger});else d=this.template({edges:t,mapNameCounts:i,formattedConditionTextTemplate:this.formattedConditionTextTemplate,hideDragColumn:!1,isAccountSettingsPage:!0,hideLabel:!0,allowOptimaNode:n,trueFalseNode:!1,getFieldLabel:this._getFieldLabel.bind(this,s?o:a),getOperandFieldLabel:this._getFieldLabel.bind(this,s?a:o),getOperandValueLabel:this._getOperandValueLabel.bind(this),validateEdge:this.validateEdge.bind(this),isTrigger:this.isTrigger});this.$el.html(d),this.bindSorting(t);var c=this.model instanceof Magellan.Models.DecisionNode||this.model instanceof Magellan.Models.TriggerNode||this.model instanceof Magellan.Models.RerouteNode||_.isArray(this.model);return this.$(".criteria-list-item").each(function(){var i=$(this).hasClass("criteria-list-default"),n=$(this).data("criteria-number"),a=t[n];c=c&&(!i||e.model instanceof Magellan.Models.TrueFalseNode);var o=$(this).find(".edge-label-column .edge-name-input");if(c)o.LDInput({validate:e.validateEdgeName.bind(e,a)});else{var s=Magellan.Migration.getFormattedEdgeName(o.val());o.replaceWith("<span>"+_.escape(s)+"</span>")}$(this).find(".next-node-column").each(function(){var t=new Magellan.Views.LDDropdown({value:a.target,options:e.nextNodeNames,required:!0,alignMenuRight:!0,placeholder:"None",optionTemplate:function(e){if(l[e])return l[e];if(-1===e)var t=_.template('<div class="dropdown-choice node-choice-end">END OF FLOW</div>');else t=null===e?_.template('<span class="text-muted">None</span>'):0===e?_.template('<div class="dropdown-choice node-choice-end">RESCHEDULE</div>'):_.template("<span><%=option%></span>");return l[e]=t({option:e})},onChange:e.changeNextNode.bind(e,a)});t._filterByItems=function(e){e.push(-1),e.push(null),Magellan.Views.LDDropdown.prototype._filterByItems.call(this,e)},$(this).html(t.$el)})}),this},_getFieldLabel:function(e,t){if("string"!=typeof t)return"";var i="Opportunity"===e?Magellan.Migration.OPPORTUNITY_OPTIMA_FIELDS:Magellan.Migration.OPTIMA_FIELDS,n=t.split("."),a=n[n.length-1],o=i.find(function(e){return e.name===a});return o?o.label:Magellan.Util.convertFieldSelectionStringToArray(t,e,Magellan.Controllers.FlowBuilder.getFieldMetaDataMap()).reduce(function(e,t){var i=t.hasOwnProperty("parent")&&t.parent.length>0?t.label.replace(" ID",""):t.label;return e+(""!==e?".":"")+htmlDecode(i)},"")},_getOperandValueLabel:function(e){switch(e.type){case"DATE":case"DATETIME":var t=moment.utc(e.operand);return t.isValid()?t.local().format(Magellan.Validation.DATETIME_FORMAT):e.operand;default:var i=e.operand;return _.isString(i)&&i.length>250?i=i.substring(0,250)+" ...":_.isUndefined(i)||_.isNull(i)?i="":i+="",i.replace(/\,/g,",&#8203;")}}}),Magellan.Views.ConditionsList=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.childViews=[],this.context=e.context||new Backbone.Model,this.hideFieldValueColumn=e.hideFieldValueColumn||!1,this.isTrueFalseNode=e.isTrueFalseNode||!1,this.objectType=e.objectType,this.showDescription=!0,this.model.conditions&&0!==this.model.conditions.length||this.isTrueFalseNode||(this.model.conditions=[Magellan.Migration.emptyCondition()],this.model.rpnLogic=[1],this.model.logic="1"),this.isUpdateTrigger=e.isUpdateTrigger||!1,this.isValid=!0,this.rpnLogicIsValid=!0},template:_.template(magellanDocument.getElementById("condition_set_template").innerHTML),defaultLogic:function(){return _.range(1,this.model.conditions.length+1).join(" AND ")},addRule:function(e){var t=this.defaultLogic()===this.model.logic;this.model.conditions.push(Magellan.Migration.emptyCondition()),t||this.isUpdateTrigger?this.resetDefaultLogic():this.model.logic=this.model.logic+" AND "+this.model.conditions.length,this.render()},deleteRule:function(e){if(this.model.conditions.length>1){var t=this.defaultLogic()===this.model.logic,i=$(e.currentTarget).data("rule-number");this.model.conditions.splice(i,1),this.render(),t||this.isUpdateTrigger?this.resetDefaultLogic():this.updateAndParseLogic()}},updateLogic:function(){this.model.logic=this.$(".rule-logic-input").val()},parseLogic:function(){if(0===this.model.conditions.length)return this.model.logic="",this.model.rpnLogic=[],void(this.rpnLogicIsValid=!0);if(1===this.model.conditions.length)return this.model.logic="1",this.model.rpnLogic=[1],void(this.rpnLogicIsValid=!0);var e=Magellan.Util.parseLogic(this.model.conditions.length,this.model.logic);this.model.rpnLogic=e.RPNTokens,this.rpnLogicIsValid=0===e.feedbackMessage.length,e.feedbackMessage.length>0?(this.$(".rule-logic-input").css("box-shadow","0px 0px 2px 1px #d91e18"),this.$(".rule-logic-feedback").text(e.feedbackMessage[0]),this.$(".warning-sign").show()):(this.$(".rule-logic-input").css("box-shadow","none"),this.$(".rule-logic-feedback").text(""),this.$(".warning-sign").hide())},resetDefaultLogic:function(){this.model.logic=this.defaultLogic(),this.$(".rule-logic-input").val(this.model.logic),this.updateAndParseLogic()},updateAndParseLogic:function(){this.updateLogic(),this.parseLogic()},additionalEvents:{"click .add-rule-div":"addRule","click .delete-column":"deleteRule","change .rule-logic-input":"updateAndParseLogic","LD_SingleCondition:changed":function(){this.$el.trigger("LD_ConditionsList:changed",this)},"click .reset-default-logic":"resetDefaultLogic"},validate:function(){var e=!0;return this.childViews&&0!==this.childViews.length||this.render(),this.childViews.forEach(function(t){t instanceof Magellan.Views.SingleCondition&&(e=e&&t.isValid)}),this.parseLogic(),e=e&&this.rpnLogicIsValid,this.isValid=e,this.trigger("validated",e),e},render:function(){this.removeAllChildViews();var e=this.template({showLogic:!this.isUpdateTrigger&&this.model.conditions.length>1,logic:this.model.logic,description:this.model.description,showDescription:this.showDescription});this.$el.html(e);var t=this.$el.find("#edit-rules-div");return _.each(this.model.conditions,function(e,i){var n=new Magellan.Views.SingleCondition({context:this.context,model:e,ruleNum:i,objectType:this.objectType,hideFieldValueColumn:this.hideFieldValueColumn,isUpdateTrigger:this.isUpdateTrigger,isLastCondition:i===this.model.conditions.length-1,isFirstCondition:0===i,isOnlyCondition:1==this.model.conditions.length});this.listenTo(n,"validated",this.validate.bind(this)),this.childViews.push(n),t.append(n.render().$el)},this),this}}),Magellan.Views.SingleCondition=Magellan.Views.ButtonHandler.extend({isValid:!0,initialize:function(e){this.isUpdateTrigger=e.isUpdateTrigger||!1,this.objectType=e.objectType,this.model=e.model,this.node=e.node||null,this.context=e.context||new Backbone.Model,this.ruleNum=e.ruleNum,this.fieldValueMap={field:null,value:null,operator:null,"picklist field":null,"picklist object":null},this.model["value/field"]||(this.model["value/field"]="value"),this.isLastCondition=e.isLastCondition||!1,this.isFirstCondition=e.isFirstCondition||!1,this.isOnlyCondition=e.isOnlyCondition||!1,this.doFlattenFields=e.hideFieldValueColumn||e.doFlattenFields||this.node&&this.node.doFlattenFields||!1,this.hideFieldValueColumn=e.hideFieldValueColumn||"Primary"===this.objectType||"Lead"===this.objectType||!1,this.matchedObjectType=this.context.get("secondary-object"),this.matchedObjectType=this.matchedObjectType||Magellan.Views.getAPIObjectNameFromObjectType(this.objectType),this.matchedObjectType=this.matchedObjectType||"",this.conditionObjects={leftOperand:{objectName:null,label:null},operator:{label:"Operator"},rightOperand:{objectName:null,label:null}};var t=this.context.get("primary-object")||LeanData__PrimarySObjectType,i=this.context.get("primary-object-label")||t,n=this.matchedObjectType;this.context.get("secondary-object-label")?n=this.context.get("secondary-object-label"):this.hideFieldValueColumn||(n="Matched "+n),this.context.get("reversed-condition-operands")||this.hideFieldValueColumn||!this.matchedObjectType?(this.conditionObjects.leftOperand.objectName=t,this.conditionObjects.leftOperand.label=i,this.conditionObjects.rightOperand.objectName=this.matchedObjectType,this.conditionObjects.rightOperand.label=n):(this.conditionObjects.leftOperand.objectName=this.matchedObjectType,this.conditionObjects.leftOperand.label=n,this.conditionObjects.rightOperand.objectName=t,this.conditionObjects.rightOperand.label=i),this.isValid=!0},validateDropdownSelection:function(){var e=!0,t="";return"value"===this.model["value/field"]?(e=null!==this.model.field&&Magellan.Validation.validateValueTypeCondition(this.model,this.conditionObjects.leftOperand.objectName),this.$(".change-condition-value").toggleClass("input-invalid",!e)):e=e&&Magellan.Validation.validateFieldTypeCondition(this.model,this.conditionObjects.leftOperand.objectName,this.conditionObjects.rightOperand.objectName),e||(t="Invalid condition: check for valid fields and compatible data types."),this.$(".error-message").html(t),e},changeMatchType:function(e){this.fieldValueMap[this.model["value/field"]]=this.model.operand,this.fieldValueMap.operator=this.model.operator,this.model["value/field"]=$(e.currentTarget).val(),this.model.operand=this.fieldValueMap[this.model["value/field"]],this.model.operator=this.fieldValueMap.operator,this.render()},changeValue:function(e,t){var i=$(e.currentTarget).val();if(t instanceof Magellan.Views.NestedTypeaheadSelector)i=_.isEmpty(t.selection)?"":t.selection[0].label;else if(t instanceof Magellan.Views.LDDropdown)i=t.val();else if(i&&this.compareByValue&&("DATETIME"===this.model.type||"DATE"===this.model.type)){var n=moment(i).utc();i=n.isValid()?n.format(Magellan.Validation.DATETIME_FORMAT):i}this.model.operand=i,this.validate()},updateModelOnNestedDropdownChange:function(e,t){var i=t[t.length-1];if(_.isUndefined(i)||"REFERENCE"===i.type)return!1;var n=!1,a=t.reduce(function(e,i,a){return""!==e&&(e+="."),n=n||"ownerid"===i.name&&i.parent.length>1&&a<t.length-1,"REFERENCE"===i.type?e+Magellan.Util.flattenReferenceAPIs(i.name):e+i.name},"");e.attributes&&e.attributes.isMatchedField?(this.model.field=a,this.model.type=i.type,this.model["picklist field"]=i.name,this.model["picklist object"]=i.objectType,n?this.model["left polymorphic"]=!0:delete this.model["left polymorphic"]):(this.model.operand=a,this.model["operand type"]=i.type,n?this.model["right polymorphic"]=!0:delete this.model["right polymorphic"]),this.render(),this.$el.trigger("LD_SingleCondition:changed",this)},updateModelOnMultiNestedDropdownChange:function(e,t){var i=t[t.length-1];if(_.isUndefined(i)||"REFERENCE"===i.type)return!1;var n=", ",a=this.model.type;"MULTIPICKLIST"===a&&(n="; ");var o=t.reduce(function(e,t){return""!==e&&(e+=n),"REFERENCE"===t.type?e+Magellan.Util.flattenReferenceAPIs(t.name):e+("PICKLIST"==a&&t.name.includes(",")?JSON.stringify(t.name):t.name)},"");e.attributes&&e.attributes.isMatchedField?(this.model.field=o,this.model.type=i.type,this.model["picklist field"]=i.name,this.model["picklist object"]=i.objectType):(this.model.operand=o,this.model["operand type"]=i.type),this.$el.trigger("LD_SingleCondition:changed",this)},updateOperator:function(e,t){var i=t.val(),n=new Set(["has changed","is null","not null"]);n.has(i)?(this.oldOperand=this.model.operand,delete this.model.operand):n.has(this.model.operator)&&!_.isEmpty(this.oldOperand)&&(this.model.operand=this.oldOperand),this.model.operator=i,this.render()},additionalEvents:{"change input[type=radio].match-type":"changeMatchType","change .change-condition-value":"changeValue","LDDropdown:change .operator-dropdown":"updateOperator","LDDropdown:change .right-operand-dropdown":"changeValue","nestedTypeaheadSelector:select .value-field-column .right-operand-dropdown":"changeValue"},validate:function(){var e=this.validateDropdownSelection();return this.matchedFieldDropdown&&this.matchedFieldDropdown.validate(),this.operatorDropdown&&this.operatorDropdown.validate(),this.rightOperandDropdown&&this.rightOperandDropdown.validate(),this.isValid=e,this.trigger("validated",e),e},template:_.template(magellanDocument.getElementById("single_condition_template").innerHTML),render:function(){this.matchedFieldDropdown&&this.matchedFieldDropdown.remove(),this.operatorDropdown&&this.operatorDropdown.remove(),this.rightOperandDropdown&&this.rightOperandDropdown.remove(),this.compareByValue="value"===this.model["value/field"];var e=this.template({condition:this.model,ruleNum:this.ruleNum,dropdownValid:this.validateDropdownSelection(),matchedObjectType:this.matchedObjectType,hideFieldValueColumn:this.hideFieldValueColumn,useBooleanDropdown:this.compareByValue&&("BOOLEAN"===this.model.type||("PICKLIST"==this.model.type||"MULTIPICKLIST"==this.model.type)&&("equals"==this.model.operator||"not equal to"==this.model.operator)),isUpdateTrigger:this.isUpdateTrigger,isLastCondition:this.isLastCondition,isFirstCondition:this.isFirstCondition,isOnlyCondition:this.isOnlyCondition,conditionObjects:this.conditionObjects});this.$el.html(e);var t,i,n=this.conditionObjects.leftOperand.objectName;this.doFlattenFields?(i={},(t={})[n]=Magellan.Controllers.FlowBuilder.getFlattenedFieldsByObject(n),i[n]=Magellan.Controllers.FlowBuilder.getFlattenedFieldsMapByObject(n)):(t=fieldMetaData,i=Magellan.Controllers.FlowBuilder.getFieldMetaDataMap()),this.isUpdateTrigger&&(t[n]=_.filter(t[n],function(e){return!0!==e.isFormula}));var a=Magellan.Util.createOwnerToOwnerMappingFilter(),o=this.matchedFieldDropdown=new Magellan.Views.NestedTypeaheadSelector({data:t,root:n,onSelect:this.updateModelOnNestedDropdownChange.bind(this),required:!0,aliases:{"User.id":"Group/User.id","Group.id":"Group/User.id"},attributes:{isMatchedField:!0},selection:Magellan.Util.convertFieldSelectionStringToArray(this.model.field,n,i),filter:function(e){let t=Magellan.Util.getObjectTypeFromCurrentSuggestions(e);return e=Magellan.Util.createBlacklistFilter(t)(e),e=a(e)}});this.$(".matched-field-column .nested-dropdown-container").html(o.$el);var l=(this.isUpdateTrigger||this.context instanceof Magellan.Models.RerouteNode?Magellan.Views.UT_GROUPING_TO_OPERATORS:Magellan.Views.GROUPING_TO_OPERATORS)[Magellan.Validation.SFDC_TYPE_TO_GROUPING[this.model.type]]||[],s=this.model.operator;if(this.$(".operator-column .operator-dropdown").LDDropdown({options:l,value:s,required:!0}),this.compareByValue)switch(this.model.type){case"BOOLEAN":this.$(".value-field-column .right-operand-dropdown").LDDropdown({options:[!0,!1],value:this.model.operand,required:!0}),this.operatorDropdown=this.$(".value-field-column .right-operand-dropdown").LDDropdown("LDDropdown");break;case"MULTIPICKLIST":case"PICKLIST":if("equals"===this.model.operator||"not equal to"===this.model.operator){var r=_.isEmpty(this.model["picklist object"])?n:this.model["picklist object"],d=_.isEmpty(this.model["picklist field"])?this.model.field:this.model["picklist field"],c=Magellan.Controllers.FlowBuilder.getCachedPicklistValues(r+d);null!=c&&(c=JSON.parse(c));var u={};u[r]=[];var p=this.rightOperandDropdown=new Magellan.Views.MultiNestedTypeaheadSelector({type:this.model.type,data:null==c?u:c,root:r,onSelect:this.updateModelOnMultiNestedDropdownChange.bind(this),disableBreadcrumbs:!0,requireSelectionFromData:!1,required:!0,fetchData:null==c?Magellan.Controllers.FlowBuilder.getPicklistFields.bind(null,r,d):null,selection:null==this.model.operand?Magellan.Util.convertStringSelectionToArray(""):Magellan.Util.convertStringSelectionToArray(this.model.operand)});this.$el.find("#right-operand-dropdown").html(p.$el)}else"is null"!==this.model.operator&&"not null"!==this.model.operator&&this.$(".input-message").html("Reminder: input API Name into the value field.");break;case"DATE":case"DATETIME":var h=moment.utc(this.model.operand);if(h.isValid()){var g=h.local().format(Magellan.Validation.DATETIME_FORMAT);this.$(".value-field-column input.change-condition-value").val(g)}else this.$(".value-field-column input.change-condition-value").toggleClass("input-invalid",!0).val(this.model.operand);"DATE"===this.model.type?this.$(".value-field-column input.change-condition-value").datepicker({dateFormat:"yy-mm-dd"}):this.$(".value-field-column input.change-condition-value").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss",timeInput:!0,showHour:!1,showMinute:!1,showSecond:!1})}else if("field"===this.model["value/field"]){var m=this.conditionObjects.rightOperand.objectName,f=Magellan.Validation.SFDC_TYPE_TO_GROUPING[this.model.type],v=Magellan.Util.createBlacklistFilter(m),y=Magellan.Util.createFieldsFilter(f);a=Magellan.Util.createOwnerToOwnerMappingFilter(),p=this.rightOperandDropdown=new Magellan.Views.NestedTypeaheadSelector({data:t,root:m,onSelect:this.updateModelOnNestedDropdownChange.bind(this),required:!0,aliases:{"User.id":"Group/User.id","Group.id":"Group/User.id"},attributes:{isMatchedField:!1},filter:function(e){return e=v(e),e=y(e),e=a(e)},selection:Magellan.Util.convertFieldSelectionStringToArray(this.model.operand,m,Magellan.Controllers.FlowBuilder.getFieldMetaDataMap())}),this.$(".value-field-column .right-operand-dropdown").html(p.$el)}return this.validate(),this}}),Magellan.Views.SoqlRule=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.objectType=e.objectType,this.errorMessage=""},additionalEvents:{"blur .change-parameter-input":"callValidateSOQL"},callValidateSOQL:function(){var e=this;if(_.isEmpty(this.model.soqlCondition))return e.model.isValid=!1,e.errorMessage="",void e.$el.find(".soqlFeedback").text(e.errorMessage);Magellan.Services.FlowBuilder.validateSOQL(this.model.soqlCondition,this.objectType,LeanData__PrimarySObjectType).then(function(){e.model.isValid=!0,e.render(),e.$el.find(".soqlFeedback").text(""),e.errorMessage="",e.$el.trigger("LD_SoqlRule:changed",e)}).fail(function(t,i){var n=i.message;e.model.isValid=!1,e.render(),e.$el.find(".soqlFeedback").text(n),e.errorMessage=n,e.$el.trigger("LD_SoqlRule:changed",e)})},template:_.template(magellanDocument.getElementById("soql_rule_template").innerHTML),render:function(){var e=this.template({soqlCondition:this.model.soqlCondition,description:this.model.description,isValid:this.model.isValid});return this.$el.html(e),this}}),Magellan.Views.OptimaView=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.objectType=e.objectType},template:_.template(magellanDocument.getElementById("min_max_rule_template").innerHTML),update:function(e,t){var i=t.reduce(function(e,t){return""!==e&&(e+="."),"REFERENCE"===t.type?e+Magellan.Util.flattenReferenceAPIs(t.name):e+t.name},"");this.model.field=i},render:function(){var e=Magellan.Views.getAPIObjectNameFromObjectType(this.objectType),t=Magellan.Controllers.FlowBuilder.getOptimaFieldMetaData(),i=Magellan.Util.convertFieldSelectionStringToArray(this.model.field,e,Magellan.Controllers.FlowBuilder.getOptimaFieldMetaDataMap()),n=this.template({condition:this.model,optimaFields:t});this.$el.html(n);var a=new Magellan.Views.NestedTypeaheadSelector({data:t,root:e,onSelect:this.update.bind(this),required:!0,selection:i});return this.$(".nested-dropdown-container").html(a.$el),this}}),Magellan.Views.CustomRule=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.objectType=e.objectType},template:_.template(magellanDocument.getElementById("custom_rule_template").innerHTML),render:function(){var e=this.template({customParameter:null!=this.model?this.model.parameter:""});return this.$el.html(e),this}}),Magellan.Views.MultipleLinksMenu=Backbone.View.extend({template:_.template(magellanDocument.getElementById("multiple_links_menu_template").innerHTML),initialize:function(e){this.link=e.link,this.sourceNode=e.sourceNode,this.selectedEdgeIdx=0,this.originalEdges=JSON.parse(JSON.stringify(this.link.edges)),this.newLink=new Magellan.Models.DefaultLink({edges:[this.link.edges[this.selectedEdgeIdx]]}),this.newLink.set("source",{id:this.sourceNode.id}),this.newLink.set("target",{id:this.link.getTargetElement().id}),this.newLink.addTo(graph),this.newLink.multiLink=!0,this.newLink.styleAsSelected(),$("g.marker-arrowheads").on("mousedown",Magellan.Controllers.GUI.listenForLink),this.newLink.label(0,{attrs:{text:{text:Magellan.Util.breakLabelText(this.newLink.edges[0].name)}}}),Magellan.Controllers.GUI.nextLink=paper.findViewByModel(this.newLink)},remove:function(){Backbone.View.prototype.remove.call(this),this.link.getTargetElement()==this.newLink.getTargetElement()?this.newLink.remove():this.link.edges.splice(this.selectedEdgeIdx,1),this.sourceNode.linkHandler.labelLink(this.link)},events:{"click li":"selectLink"},render:function(){this.sourceNode.linkHandler.clearLabel(this.link),this.newLink.toFront();var e=this.template({edges:this.link.edges,selectedEdgeIdx:this.selectedEdgeIdx});return this.$el.html(e),this},selectLink:function(e){this.individualLink&&this.individualLink.remove(),this.selectedEdgeIdx=Number($(e.currentTarget).data("edge-idx")),this.newLink.edges=[this.link.edges[this.selectedEdgeIdx]],this.newLink.label(0,{attrs:{text:{text:Magellan.Util.breakLabelText(this.newLink.edges[0].name)}}}),$(".edge-selector").attr("src",iconToURLMap["Empty Anchor"]);var t=$(e.currentTarget).find("img.edge-selector");setTimeout(function(){console.log("delay")},0,this),t.data("edge-name"),setTimeout(function(){t.attr("src",iconToURLMap["Unselected Anchor"])},0,this)}}),Magellan.Views.EdgeMenu=Backbone.View.extend({template:_.template(magellanDocument.getElementById("dangling_edge_dropdown_template").innerHTML),initialize:function(e){this.node=e.node,this.node.refreshLinkHandler()},events:{"mousedown li":"emulateJointJsLinkHandle"},remove:function(){Backbone.View.prototype.remove.call(this)},render:function(){var e=this.node.nodeInfo.edges.map(function(e){return e.formattedName=Magellan.Migration.getFormattedEdgeName(e.name),e}),t=this.template({edges:e});return this.$el.html(t),this},emulateJointJsLinkHandle:function(e){this.$el.remove();var t=$(e.currentTarget).data("edge-idx"),i=new Magellan.Models.DefaultLink({edges:[this.node.nodeInfo.edges[t]]});i.name=$(e.currentTarget).data("edge-name"),i.get("labels")[0].attrs.text.text=i.name,Magellan.Controllers.GUI.listenForLink(),Magellan.Controllers.GUI.startDraggingLink(e,i,this.node)},emulateDoLink:function(e){this.halo&&this.halo.doLink(e)},emulateStopLinking:function(e){this.halo&&(this.halo.stopLinking(e),this.$el.remove())}}),Magellan.Views.StencilDropdown=Backbone.View.extend({template:_.template(magellanDocument.getElementById("magellan_stencil_dropdown_template").innerHTML),render:function(){var e=this.template({stencilTypes:this.collection,stencilName:this.model});return this.$el.html(e),this}}),Magellan.Views.CreateTask=Backbone.View.extend({initialize:function(e){$("#inspector").LoadingOverlay("show")},template:_.template(i(379)),render:function(){var e=this.template({});this.$el.html(e);var t=Magellan.Validation.getNodesToCurrentNode(this.model.nodeInfo.name,!0);this.model.set("matchedObjectTypes",t.matched),this.model.set("createdObjectTypes",t.created);var i=new Magellan.Views.CreateTaskRadioOptions({model:this.model});this.$el.find("#create-task-radio-options-wrapper").html(i.render().$el).append('<hr class="horizontal-line-separator">'),Magellan.Services.FlowBuilder.getTaskFieldValues().then(function(e){var t=new Magellan.Views.OtherCreateTaskFields({model:this.model,taskFieldValues:e});this.$el.find("#other-task-fields-wrapper").html(t.render().$el).append('<hr class="horizontal-line-separator">'),$("#inspector").LoadingOverlay("hide",!0)}.bind(this));var n=new Magellan.Views.AdditionalCreateTaskFields({model:this.model});this.$el.find("#additional-task-fields-wrapper").html(n.render().$el).append('<hr class="horizontal-line-separator">');var a=new Magellan.Views.AdvancedSettings({model:this.model});return this.$el.find("#advanced-settings-wrapper").html(a.render().$el),this}}),Magellan.Views.OutreachAddToSequence=Backbone.View.extend({initialize:function(e){$("#inspector").LoadingOverlay("show")},events:{"click #refresh-sequences-typeahead":"refreshSequencesData","click #refresh-users-typeahead":"refreshUsersData"},template:_.template(i(387)),initializeSequencesTypeahead:function(){const e=this.$el.find(".sequences-error-text");this.sequencesTypeahead=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,selection:this.model.nodeInfo.sequenceSelection,placeholder:"Find and Select a Sequence",asyncServiceCall:Magellan.Controllers.FlowBuilder.outreach_getSequencesForTypeahead,onSelect:(e,t)=>{this.model.nodeInfo.sequenceSelection=t},requireSelectionFromData:!0,customValidationFunction:t=>{var i=!t.required,n=$.Deferred().done(function(e){i=e}).fail(function(){i=!1}).always(function(){t.$(".typeahead-input").toggleClass("input-invalid",!i),e.toggle(!i)});return 0===t.selection.length?t.required?n.resolve(!1):n.resolve(!0):t.requireSelectionFromData?(null===t.bloodHound.remote?(_.each(t.bloodHound.local,function(e){if(t.selection[0].label===e.label&&t.selection[0].name===e.name)return n.resolve(!0),!1}),n.reject()):t.cachedValidValues.includes(t.selection[0].Id)?n.resolve(!0):t.asyncServiceCall(t.selection[0].Id).then(function(e){_.each(e,function(e){if(t.selection[0].Id===e.Id)return t.cachedValidValues.push(e.Id),n.resolve(!0),!1}),n.reject()}).fail(function(e,t){n.reject()}),n):n.resolve(!0)}})},checkSequenceRenaming:function(){const e=this.model.nodeInfo.sequenceSelection[0]&&this.model.nodeInfo.sequenceSelection[0].id||"";return Magellan.Controllers.FlowBuilder.outreach_getSequencesForTypeahead(e).then(e=>{if(e.length>0&&this.model.nodeInfo.sequenceSelection.length>0){const t=e[e.length-1];this.model.nodeInfo.sequenceSelection[0].id===t.id&&(this.model.nodeInfo.sequenceSelection[0].label=this.model.nodeInfo.sequenceSelection[0].name=t.name)}})},checkUserRenaming:function(){const e=this.model.nodeInfo.userSelection[0]&&this.model.nodeInfo.userSelection[0].id||"";return Magellan.Controllers.FlowBuilder.outreach_getUsersForTypeahead(e).then(e=>{if(e.length>0&&this.model.nodeInfo.userSelection.length>0){const t=e[e.length-1];this.model.nodeInfo.userSelection[0].id===t.id&&(this.model.nodeInfo.userSelection[0].label=this.model.nodeInfo.userSelection[0].name=t.name)}})},initializeUsersTypeahead:function(){const e=this.$el.find(".users-error-text");this.usersTypeahead=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,selection:this.model.nodeInfo.userSelection||[],placeholder:"Find and Select a User",asyncServiceCall:Magellan.Controllers.FlowBuilder.outreach_getUsersForTypeahead,onSelect:(e,t)=>{this.model.nodeInfo.userSelection=t},requireSelectionFromData:!0,customValidationFunction:t=>{var i=!t.required,n=$.Deferred().done(function(e){i=e}).fail(function(){i=!1}).always(function(){t.$(".typeahead-input").toggleClass("input-invalid",!i),e.toggle(!i)});return 0===t.selection.length?t.required?n.resolve(!1):n.resolve(!0):t.requireSelectionFromData?(null===t.bloodHound.remote?(_.each(t.bloodHound.local,function(e){if(t.selection[0].label===e.label&&t.selection[0].name===e.name)return n.resolve(!0),!1}),n.reject()):t.cachedValidValues.includes(t.selection[0].Id)?n.resolve(!0):t.asyncServiceCall(t.selection[0].Id).then(function(e){_.each(e,function(e){if(t.selection[0].Id===e.Id)return t.cachedValidValues.push(e.Id),n.resolve(!0),!1}),n.reject()}).fail(function(e,t){n.reject()}),n):n.resolve(!0)}})},render:function(){const e=this.template({authorized:partnerAuthorizations.outreach});this.$el.html(e),Magellan.Validation.getNodesToCurrentNode(this.model.nodeInfo.name);var t=new Magellan.Views.AdvancedSettings({model:this.model});return this.$el.find("#advanced-settings-wrapper").html(t.render().$el),this.checkSequenceRenaming().then(()=>{this.initializeSequencesTypeahead(),this.$el.find(".outreach-sequences-typeahead").html(this.sequencesTypeahead.$el)}),this.checkUserRenaming().then(()=>{this.initializeUsersTypeahead(),this.$el.find(".outreach-users-typeahead").html(this.usersTypeahead.$el)}),"specific"!==this.model.nodeInfo.mailboxSelection&&this.$el.find("#outreach-users-typeahead-container").hide(),"customField"!==this.model.nodeInfo.mailboxSelection&&this.$el.find("#outreach-user-field-typeahead-container").hide(),this.customUserFieldDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:fieldMetaData,root:"Lead",required:!0,filter:function(e){return e=Magellan.Util.createBlacklistFilter("Lead")(e),e=Magellan.Util.createUserFieldsFilter()(e)},selection:Magellan.Util.convertFieldSelectionStringToArray(this.model.nodeInfo.customUserField,"Lead",Magellan.Controllers.FlowBuilder.getFieldMetaDataMap()),placeholder:"Find and Select a User Field",onSelect:(e,t)=>{this.model.nodeInfo.customUserField=Magellan.Util.convertFieldSelectionArrayToString(t)}}),this.$el.find(".custom-user-field-typeahead").html(this.customUserFieldDropdownView.$el),this.$el.find("#radio-record-owner").LDRadioButton({label:"Lead Owner",checked:"owner"===this.model.nodeInfo.mailboxSelection,name:"mailbox-selection",value:"owner",onSelectCallback:(e,t)=>{this.model.nodeInfo.mailboxSelection=e,this.$el.find("#outreach-users-typeahead-container").hide(),this.$el.find("#outreach-user-field-typeahead-container").hide()}}),this.$el.find("#radio-specific-user").LDRadioButton({label:"Specific User",checked:"specific"===this.model.nodeInfo.mailboxSelection,name:"mailbox-selection",value:"specific",onSelectCallback:(e,t)=>{this.model.nodeInfo.mailboxSelection=e,this.$el.find("#outreach-users-typeahead-container").show(),this.$el.find("#outreach-user-field-typeahead-container").hide()}}),this.$el.find("#radio-custom-user-field").LDRadioButton({label:"User Field on Lead",checked:"customField"===this.model.nodeInfo.mailboxSelection,name:"mailbox-selection",value:"customField",onSelectCallback:(e,t)=>{this.model.nodeInfo.mailboxSelection=e,this.$el.find("#outreach-user-field-typeahead-container").show(),this.$el.find("#outreach-users-typeahead-container").hide()}}),Magellan.Util.initializeTooltip(this.$el.find(".mailbox-user-tooltip.ld-tooltip-hint"),{title:"Select Corresponding User",body:"Select the user who will communicate with the prospect and whose mailbox will send automated emails (if applicable).   If the selected user does not exist in Outreach or does not have a default mailbox with sending enabled, the Add to Sequence action will fail.  Note that queue ownership is not supported at this time."}),$("#inspector").LoadingOverlay("hide",!0),this},refreshSequencesData:function(){$("#inspector").LoadingOverlay("show"),partnerAuthorizations.outreach?Magellan.Controllers.FlowBuilder.outreach_refreshSequencesData().then(function(){this.initializeSequencesTypeahead(),Magellan.Controllers.FlowBuilder.resetMetadataCache("outreach_sequences"),$("#inspector").LoadingOverlay("hide",!0)}.bind(this)):$("#inspector").LoadingOverlay("hide",!0)},refreshUsersData:function(){$("#inspector").LoadingOverlay("show"),partnerAuthorizations.outreach?Magellan.Controllers.FlowBuilder.outreach_refreshUsersData(!0).then(function(){this.usersTypeahead.refreshBloodhoundData(),$("#inspector").LoadingOverlay("hide",!0)}.bind(this)):$("#inspector").LoadingOverlay("hide",!0)}}),Magellan.Views.SalesloftAddToCadence=Backbone.View.extend({initialize:function(e){$("#inspector").LoadingOverlay("show")},events:{"click #refresh-cadences-typeahead":"refreshCadencesData","click #refresh-users-typeahead":"refreshUsersData"},template:_.template(i(390)),initializeCadencesTypeahead:function(){const e=this.$el.find(".cadences-error-text");this.cadencesTypeahead=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,selection:this.model.nodeInfo.cadenceSelection,placeholder:"Find and Select a Cadence",asyncServiceCall:Magellan.Controllers.FlowBuilder.salesloft_getCadencesForTypeahead,onSelect:(e,t)=>{this.model.nodeInfo.cadenceSelection=t},requireSelectionFromData:!0,customValidationFunction:t=>{var i=!t.required,n=$.Deferred().done(function(e){i=e}).fail(function(){i=!1}).always(function(){t.$(".typeahead-input").toggleClass("input-invalid",!i),e.toggle(!i)});return 0===t.selection.length?t.required?n.resolve(!1):n.resolve(!0):t.requireSelectionFromData?(null===t.bloodHound.remote?(_.each(t.bloodHound.local,function(e){if(t.selection[0].label===e.label&&t.selection[0].name===e.name)return n.resolve(!0),!1}),n.reject()):t.cachedValidValues.includes(t.selection[0].id)?n.resolve(!0):t.asyncServiceCall(t.selection[0].name).then(function(e){_.each(e,function(e){if(console.log(e),t.selection[0].id===e.id)return t.cachedValidValues.push(e.id),n.resolve(!0),!1}),n.reject()}).fail(function(e,t){n.reject()}),n):n.resolve(!0)}}),this.cadencesTypeahead.validate()},initializeUsersTypeahead:function(){const e=this.$el.find(".users-error-text");this.usersTypeahead=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,selection:this.model.nodeInfo.userSelection||[],placeholder:"Find and Select a User",asyncServiceCall:Magellan.Controllers.FlowBuilder.salesloft_getUsersForTypeahead,onSelect:(e,t)=>{this.model.nodeInfo.userSelection=t},requireSelectionFromData:!0,customValidationFunction:t=>{var i=!t.required,n=$.Deferred().done(function(e){i=e}).fail(function(){i=!1}).always(function(){t.$(".typeahead-input").toggleClass("input-invalid",!i),e.toggle(!i)});return 0===t.selection.length?t.required?n.resolve(!1):n.resolve(!0):t.requireSelectionFromData?(null===t.bloodHound.remote?(_.each(t.bloodHound.local,function(e){if(t.selection[0].label===e.label&&t.selection[0].name===e.name)return n.resolve(!0),!1}),n.reject()):t.cachedValidValues.includes(t.selection[0].Id)?n.resolve(!0):t.asyncServiceCall(t.selection[0].name).then(function(e){_.each(e,function(e){if(t.selection[0].Id===e.Id)return t.cachedValidValues.push(e.Id),n.resolve(!0),!1}),n.reject()}).fail(function(e,t){n.reject()}),n):n.resolve(!0)}}),this.usersTypeahead.validate()},render:function(){const e=this.template({authorized:partnerAuthorizations.salesloft});this.$el.html(e);var t=new Magellan.Views.AdvancedSettings({model:this.model});return this.$el.find("#advanced-settings-wrapper").html(t.render().$el),this.checkCadenceRenaming().then(()=>{this.initializeCadencesTypeahead(),this.$el.find(".salesloft-cadences-typeahead").html(this.cadencesTypeahead.$el)}),this.initializeUsersTypeahead(),this.$el.find(".salesloft-users-typeahead").html(this.usersTypeahead.$el),"specific"!==this.model.nodeInfo.assigneeSelection&&this.$el.find("#salesloft-users-typeahead-container").hide(),"customField"!==this.model.nodeInfo.assigneeSelection&&this.$el.find("#salesloft-user-field-typeahead-container").hide(),this.customUserFieldDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:fieldMetaData,root:"Lead",required:!0,filter:function(e){return e=Magellan.Util.createBlacklistFilter("Lead")(e),e=Magellan.Util.createUserFieldsFilter()(e)},selection:Magellan.Util.convertFieldSelectionStringToArray(this.model.nodeInfo.customUserField,"Lead",Magellan.Controllers.FlowBuilder.getFieldMetaDataMap()),placeholder:"Find and Select a User Field",onSelect:(e,t)=>{this.model.nodeInfo.customUserField=Magellan.Util.convertFieldSelectionArrayToString(t)}}),this.$el.find(".custom-user-field-typeahead").html(this.customUserFieldDropdownView.$el),this.$el.find("#radio-record-owner").LDRadioButton({label:"Lead Owner",checked:"owner"===this.model.nodeInfo.assigneeSelection,name:"assignee-selection",value:"owner",onSelectCallback:(e,t)=>{this.model.nodeInfo.assigneeSelection=e,this.$el.find("#salesloft-users-typeahead-container").hide(),this.$el.find("#salesloft-user-field-typeahead-container").hide()}}),this.$el.find("#radio-specific-user").LDRadioButton({label:"Specific User",checked:"specific"===this.model.nodeInfo.assigneeSelection,name:"assignee-selection",value:"specific",onSelectCallback:(e,t)=>{this.model.nodeInfo.assigneeSelection=e,this.$el.find("#salesloft-users-typeahead-container").show(),this.$el.find("#salesloft-user-field-typeahead-container").hide()}}),this.$el.find("#radio-custom-user-field").LDRadioButton({label:"User Field on Lead",checked:"customField"===this.model.nodeInfo.assigneeSelection,name:"assignee-selection",value:"customField",onSelectCallback:(e,t)=>{this.model.nodeInfo.assigneeSelection=e,this.$el.find("#salesloft-user-field-typeahead-container").show(),this.$el.find("#salesloft-users-typeahead-container").hide()}}),Magellan.Util.initializeTooltip(this.$el.find(".assignee-user-tooltip.ld-tooltip-hint"),{title:"Select Corresponding User",body:"The Assignee is the rep accountable for running the email, call, or other steps associated to those people in the cadence. In other words, whatever cadence step is due gets assigned to that rep. Automated emails will come from the assignee selected."}),$("#inspector").LoadingOverlay("hide",!0),this},checkCadenceRenaming:function(){const e=this.model.nodeInfo.cadenceSelection[0]&&this.model.nodeInfo.cadenceSelection[0].id||"";return Magellan.Controllers.FlowBuilder.salesloft_getCadencesForTypeahead(e).then(e=>{if(e.length>0&&this.model.nodeInfo.cadenceSelection.length>0){const t=e[e.length-1];this.model.nodeInfo.cadenceSelection[0].id===t.id&&(this.model.nodeInfo.cadenceSelection[0].label=this.model.nodeInfo.cadenceSelection[0].name=t.name)}})},refreshCadencesData:function(){$("#inspector").LoadingOverlay("show"),partnerAuthorizations.salesloft?Magellan.Controllers.FlowBuilder.salesloft_refreshCadencesData().then(function(){this.initializeCadencesTypeahead(),Magellan.Controllers.FlowBuilder.resetMetadataCache("salesloft_cadences"),$("#inspector").LoadingOverlay("hide",!0)}.bind(this)):$("#inspector").LoadingOverlay("hide",!0)},refreshUsersData:function(){$("#inspector").LoadingOverlay("show"),partnerAuthorizations.salesloft?Magellan.Controllers.FlowBuilder.salesloft_refreshUsersData().then(function(){this.initializeUsersTypeahead(),$("#inspector").LoadingOverlay("hide",!0)}.bind(this)):$("#inspector").LoadingOverlay("hide",!0)}}),Magellan.Views.CreateTaskRadioOptions=Backbone.View.extend({initialize:function(e){this.relatedToValue_matchedObject=null,this.relatedToValue_createdObject=null,"relatedToMatched"===this.model.nodeInfo.relatedToType&&(this.relatedToValue_matchedObject=this.model.nodeInfo.relatedToValue),"relatedToCreated"===this.model.nodeInfo.relatedToType&&(this.relatedToValue_createdObject=this.model.nodeInfo.relatedToValue),this.assignedToValue_primaryObject=null,this.assignedToValue_matchedObject=null,this.assignedToValue_userField={},this.assignedToValue_explicitOwner=null,"assignedToPrimary"===this.model.nodeInfo.assignedToType&&(this.assignedToValue_primaryObject=null,this.assignedToValue_userField[this.model.nodeInfo.assignedToType+"."+LeanData__PrimarySObjectType]=this.model.nodeInfo.userField||"owner.id"),"assignedToMatched"===this.model.nodeInfo.assignedToType&&(this.assignedToValue_matchedObject=this.model.nodeInfo.assignedToValue,this.assignedToValue_userField[this.model.nodeInfo.assignedToType+"."+this.model.nodeInfo.assignedToValue]=this.model.nodeInfo.userField||"owner.id"),"assignedToExplicitOwner"===this.model.nodeInfo.assignedToType&&(this.assignedToValue_explicitOwner=this.model.nodeInfo.assignedToValue)},template:_.template(i(356)),events:{"change input[type=radio]":"updateTypeAndValue","nestedTypeaheadSelector:select #explicitOwnerListDropdown":"updateSelectedOwner"},updateTypeAndValue:function(e){var t=$(e.target),i=t.data("category"),n=t.data("type"),a=t.data("value");"relatedTo"===i&&(this.model.nodeInfo.relatedToType=n,this.model.nodeInfo.relatedToValue=null,n.startsWith("relatedToMatched")?(this.model.nodeInfo.relatedToType="relatedToMatched",this.model.nodeInfo.relatedToValue=this.relatedToValue_matchedObject=a||this.relatedToValue_matchedObject||this.setSubOption("matched","relatedToMatched",null)):n.startsWith("relatedToCreated")&&(this.model.nodeInfo.relatedToType="relatedToCreated",this.model.nodeInfo.relatedToValue=this.relatedToValue_createdObject=a||this.relatedToValue_createdObject||this.setSubOption("created","relatedToCreated",null))),"assignedTo"===i&&(this.model.nodeInfo.assignedToType=n,this.model.nodeInfo.assignedToValue=null,this.model.nodeInfo.userField=null,"assignedToPrimary"===n?this.model.nodeInfo.userField=this.assignedToValue_userField[this.model.nodeInfo.assignedToType+"."+LeanData__PrimarySObjectType]||"owner.id":n.startsWith("assignedToMatched")?(this.model.nodeInfo.assignedToType="assignedToMatched",this.model.nodeInfo.assignedToValue=this.assignedToValue_matchedObject=a||this.assignedToValue_matchedObject||this.setSubOption("matched","assignedToMatched",null),this.model.nodeInfo.userField=this.assignedToValue_userField[this.model.nodeInfo.assignedToType+"."+this.model.nodeInfo.assignedToValue]||"owner.id"):"assignedToExplicitOwner"===n&&(this.model.nodeInfo.assignedToValue=this.assignedToValue_explicitOwner))},setSubOption:function(e,t,i){var n={matched:this.model.get("matchedObjectTypes"),created:this.model.get("createdObjectTypes")}[e];if(!_.isEmpty(i)||0!==n.length)return _.isEmpty(i)&&n.length>0&&(i=n[0]),this.selectSubOption(t,i),i},selectSubOption:function(e,t){var i=this.$el.find("input[type=radio][data-type='"+e+"Object'][data-value='"+t+"']");i.prop("checked",!0),i.parent("label").addClass("checked")},_renderRelatedToSelection:function(){"relatedToMatched"===this.model.nodeInfo.relatedToType?-1===this.model.get("matchedObjectTypes").indexOf(this.model.nodeInfo.relatedToValue)?(this.$el.find("#invalidRelatedToMatchedObject").text('Previously selected matched object "'+this.model.nodeInfo.relatedToValue+'" is no longer available').show(),this.model.nodeInfo.relatedToType="relatedToPrimary",this.model.nodeInfo.relatedToValue=null):this.setSubOption("matched",this.model.nodeInfo.relatedToType,this.model.nodeInfo.relatedToValue):"relatedToCreated"===this.model.nodeInfo.relatedToType&&(-1===this.model.get("createdObjectTypes").indexOf(this.model.nodeInfo.relatedToValue)?(this.$el.find("#invalidRelatedToCreatedObject").text('Previously selected created object "'+this.model.nodeInfo.relatedToValue+'" is no longer available').show(),this.model.nodeInfo.relatedToType="relatedToPrimary",this.model.nodeInfo.relatedToValue=null):this.setSubOption("created",this.model.nodeInfo.relatedToType,this.model.nodeInfo.relatedToValue));var e=this.model.nodeInfo.relatedToType?this.$el.find("input[type=radio][data-type='"+this.model.nodeInfo.relatedToType+"']"):this.$el.find("input[type=radio][data-type='relatedToPrimary']");e.prop("checked",!0),e.parent("label").addClass("checked")},_renderAssignedToSelection:function(){"assignedToMatched"===this.model.nodeInfo.assignedToType&&(-1===this.model.get("matchedObjectTypes").indexOf(this.model.nodeInfo.assignedToValue)?(this.$el.find("#invalidAssignedToMatchedUser").text('Previously selected matched object "'+this.model.nodeInfo.assignedToValue+'" is no longer available').show(),this.model.nodeInfo.assignedToType="assignedToPrimary",this.model.nodeInfo.assignedToValue=null):this.setSubOption("matched",this.model.nodeInfo.assignedToType,this.model.nodeInfo.assignedToValue));var e=this.model.nodeInfo.assignedToType?this.$el.find("input[type=radio][data-type='"+this.model.nodeInfo.assignedToType+"']"):this.$el.find("input[type=radio][data-type='assignedToPrimary']");e.prop("checked",!0),e.parent("label").addClass("checked")},updateSelectedOwner:function(e,t){this.model.nodeInfo.assignedToValue=t.selection[0].Id,this.assignedToValue_explicitOwner=t.selection[0].Id},_renderExplicitOwnerTypeahead:function(){var e=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,selection:[],asyncServiceCall:Magellan.Controllers.FlowBuilder.searchUsers});e.validate(),this.$el.find("#explicitOwnerListDropdown").html(e.$el),"assignedToExplicitOwner"===this.model.nodeInfo.assignedToType&&Magellan.Controllers.FlowBuilder.searchOwners("",[this.model.nodeInfo.assignedToValue]).then(function(t){var i=this.model.nodeInfo.assignedToValue?t:[];e.setSelection(i),"assignedToExplicitOwner"!==this.model.nodeInfo.assignedToType||_.isEmpty(this.model.nodeInfo.assignedToValue)||0!==i.length||(this.$el.find("#invalidExplicitOwner").text('User Id "'+this.model.nodeInfo.assignedToValue+'" is inactive or does not exist').show(),this.model.nodeInfo.assignedToValue=null)}.bind(this)).fail(function(e){console.error("_renderExplicitOwnerTypeahead error",e),$("#inspector").LoadingOverlay("hide",!0)})},_renderUserFieldDropdowns:function(e,t,i){var n,a=Magellan.Controllers.FlowBuilder.getCustomUserFieldsByObject(e).filter(function(e){return"owner.id"===e.name&&(n=e),-1===Magellan.Validation.FIELD_BLACKLIST_MAP.USER_FIELDS.indexOf(e.name)}),o=this.assignedToValue_userField[t+"."+e],l=_.isEmpty(o)?n:_.filter(a,"name",o)[0];if(!_.isEmpty(o)&&_.isEmpty(l)){var s='Previously selected user field "'+o+'" for '+("assignedToPrimary"===t?"primary":"matched")+' object "'+e+'" is no longer available';this.$el.find("assignedToPrimary"===t?"#invalidAssignedToPrimaryUser":".invalidAssignedToMatchedUser-"+e).text(s).show(),this.model.nodeInfo.userField=n.name,this.assignedToValue_userField[t+"."+e]=n.name}var r=new Magellan.Views.LDDropdown({required:!0,value:l,options:a,optionTemplate:function(e){return _.template("<span><%=option ? option.label : null%></span>")({option:e})},onChange:function(i){this.model.nodeInfo.userField=i.name,this.assignedToValue_userField[t+"."+e]=i.name}.bind(this)});r.validate(),this.$el.find(i).html(r.$el)},render:function(){var e=this.template({primarySObjectType:LeanData__PrimarySObjectType,matchedObjectTypes:this.model.get("matchedObjectTypes"),createdObjectTypes:this.model.get("createdObjectTypes")});return this.$el.html(e),this._renderRelatedToSelection(),this._renderAssignedToSelection(),this._renderExplicitOwnerTypeahead(),this._renderUserFieldDropdowns(LeanData__PrimarySObjectType,"assignedToPrimary","#primaryUserFieldDropdown"),_.each(this.model.get("matchedObjectTypes"),function(e){var t='.matchedUserFieldDropdown[data-value="'+e+'"]';this._renderUserFieldDropdowns(e,"assignedToMatched",t)},this),0===this.model.get("matchedObjectTypes").length&&this.$el.find(".matched-object-label").addClass("disabled-label"),0===this.model.get("createdObjectTypes").length&&this.$el.find(".created-object-label").addClass("disabled-label"),Magellan.Util.initializeTooltip(this.$el.find(".related-matched-obj-tooltip"),{title:"Requires Matched Object",body:"No matched object edges were found leading to the current Task Creation node."}),Magellan.Util.initializeTooltip(this.$el.find(".related-created-obj-tooltip"),{title:"Requires Created Object",body:"No created objects were found leading to the current Task Creation node."}),Magellan.Util.initializeTooltip(this.$el.find(".assigned-matched-obj-tooltip"),{title:"Requires Matched Object",body:"No matched object edges were found leading to the current Task Creation node."}),this}}),Magellan.Views.OtherCreateTaskFields=Backbone.View.extend({initialize:function(e){var t=e.taskFieldValues;this.taskStatuses=t.statuses,this.taskSubjects=t.subjects,this.taskPriorities=t.priorities,_.each(this.taskStatuses,function(e){e.name=e.value},this),_.each(this.taskSubjects,function(e){e.name=e.value},this),_.each(this.taskPriorities,function(e){e.name=e.value},this)},template:_.template(i(366)),events:{'change input[type=radio][name="oc-date-radio-control"]':"updateDueDateType","input #dueDateDays":"updateTaskDays","change #dueDatePicker":"updateDueDate","nestedTypeaheadSelector:select .createTaskTypeahead":"updateOtherTaskFieldSelection"},updateDueDateType:function(e){var t=$(e.currentTarget).data("dateType");"specificDate"===t?(this.model.nodeInfo.taskDays=-1,this.model.nodeInfo.dueDate=$("#dueDatePicker").val()):"taskDays"===t?(this.model.nodeInfo.taskDays=$("#dueDateDays").val(),this.model.nodeInfo.dueDate=""):(this.model.nodeInfo.taskDays=-1,this.model.nodeInfo.dueDate=""),console.log("closeDateType",t,this.model.nodeInfo)},updateTaskDays:function(e){Number(e.currentTarget.value)?(e.currentTarget.value=parseInt(e.currentTarget.value),$(e.target).addClass("input-invalid")):(e.currentTarget.value=e.currentTarget.value.replace(/[^0-9]/g,""),$(e.target).removeClass("input-invalid")),this.model.nodeInfo.taskDays=e.currentTarget.value,0===e.currentTarget.value.length?$(e.target).addClass("input-invalid"):$(e.target).removeClass("input-invalid")},updateDueDate:function(e){this.model.nodeInfo.dueDate=e.currentTarget.value,0!==e.currentTarget.value.length&&this.isValidDate(e.currentTarget.value)?$(e.target).removeClass("input-invalid"):$(e.target).addClass("input-invalid")},isValidDate:function(e){return e==moment(e).format("MM/DD/YYYY")},updateOtherTaskFieldSelection:function(e,t){var i=_.isEmpty(t.selection)?null:t.selection[0].name;"status"===t.root&&(this.model.nodeInfo.taskStatus=i),"subject"===t.root&&(this.model.nodeInfo.taskSubject=i),"priority"===t.root&&(this.model.nodeInfo.taskPriority=i)},render:function(){var e,t=this.template({taskDays:this.model.nodeInfo.taskDays,dueDateInvalid:!this.isValidDate(this.model.nodeInfo.dueDate)});this.$el.html(t);var i=!1,n=_.filter(this.taskStatuses,function(t){return t.defaultValue&&t.active&&(e=t),t.active||t.value!==this.model.nodeInfo.taskStatus||(i=!0),t.active&&t.value===this.model.nodeInfo.taskStatus},this)[0];!_.isEmpty(this.model.nodeInfo.taskStatus)&&i?this.$el.find("#invalidTaskStatus").text('Previously selected task status option "'+this.model.nodeInfo.taskStatus+'" is inactive').show():!_.isEmpty(this.model.nodeInfo.taskStatus)&&_.isEmpty(n)&&this.$el.find("#invalidTaskStatus").text('Previously selected task status option "'+this.model.nodeInfo.taskStatus+'" does not exist').show(),this.model.nodeInfo.taskStatus=n?n.value:e?e.value:null;var a=new Magellan.Views.NestedTypeaheadSelector({required:!1,disableBreadcrumbs:!0,requireSelectionFromData:!0,data:{status:this.taskStatuses},root:"status",selection:_.isEmpty(n)?[]:[n]});this.$el.find("#taskStatusDropdown").html(a.$el);var o,l=_.isEmpty(this.model.nodeInfo.taskSubject)?[]:[{active:!0,defaultValue:!1,name:this.model.nodeInfo.taskSubject,label:_.escape(this.model.nodeInfo.taskSubject),value:this.model.nodeInfo.taskSubject}],s=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!1,data:{subject:this.taskSubjects},root:"subject",selection:_.isEmpty(l)?[]:l});this.$el.find("#taskSubjectDropdown").html(s.$el);var r=!1,d=_.filter(this.taskPriorities,function(e){return e.defaultValue&&e.active&&(o=e),e.active||e.value!==this.model.nodeInfo.taskPriority||(r=!0),e.active&&e.value===this.model.nodeInfo.taskPriority},this)[0];!_.isEmpty(this.model.nodeInfo.taskPriority)&&r?this.$el.find("#invalidTaskPriority").text('Previously selected task priority option "'+this.model.nodeInfo.taskPriority+'" is inactive').show():!_.isEmpty(this.model.nodeInfo.taskPriority)&&_.isEmpty(d)&&this.$el.find("#invalidTaskPriority").text('Previously selected task priority option "'+this.model.nodeInfo.taskPriority+'" does not exist').show(),this.model.nodeInfo.taskPriority=d?d.value:o?o.value:null;var c=new Magellan.Views.NestedTypeaheadSelector({required:!1,disableBreadcrumbs:!0,requireSelectionFromData:!0,data:{priority:this.taskPriorities},root:"priority",selection:_.isEmpty(d)?[]:[d]});return this.$el.find("#taskPriorityDropdown").html(c.$el),this.$el.find("#dueDatePicker").datepicker({dateFormat:"mm/dd/yy",minDate:new Date}),this.model.nodeInfo.taskDays>=0?dateRadioOption=this.$el.find("input[type=radio][data-date-type='taskDays']"):_.isEmpty(this.model.nodeInfo.dueDate)?dateRadioOption=this.$el.find("input[type=radio][data-date-type='noDueDate']"):(dateRadioOption=this.$el.find("input[type=radio][data-date-type='specificDate']"),this.$el.find("#dueDatePicker").val(this.model.nodeInfo.dueDate)),dateRadioOption.prop("checked",!0),dateRadioOption.parent("label").addClass("checked"),this}}),Magellan.Views.AdditionalCreateTaskFields=Backbone.View.extend({initialize:function(e){this.fieldMetaData=fieldMetaData,this.relatedObjectTypes=Magellan.Validation.getNodesToCurrentNode(this.model.nodeInfo.name,!0),this.relatedObjectTypes.routed=[LeanData__PrimarySObjectType],this.ownerMappingFilter=Magellan.Util.createOwnerToOwnerMappingFilter(),_.isEmpty(this.relatedObjectTypes)?this.filter=_.noop:this.filter=function(e){return"created contact"!==e.name&&(!e.contextType||(e.contextType?this.relatedObjectTypes[e.contextType.toLowerCase()]:[]).includes(e.objectType)&&this.ownerMappingFilter(e))}},template:_.template(i(352)),events:{"click .add-rule-div":"addRule","click .delete-column":"deleteRule"},addRule:function(){this.model.nodeInfo.taskFields.push({type:"value",readFieldOrValue:"",writeField:null,isValid:!0,dataType:"",readFieldObjectType:"",readFieldObjectContext:""}),this.renderRows()},deleteRule:function(e){var t=$(e.currentTarget).data("rule-number");this.model.nodeInfo.taskFields.splice(t,1),this.renderRows()},renderRows:function(){var e=this.$el.find("#edit-task-fields-wrapper");e.html(""),_.each(this.model.nodeInfo.taskFields,function(t,i){if("name"!==t.writeField){var n=new Magellan.Views.SingleMappingRow({field:t,ruleNum:i,writeType:"Task",readType:"Object",readFieldHeader:"Routed/Matched/Created Object Field",nestedFields:this.fieldMetaData,blacklist:Magellan.Validation.FIELD_BLACKLIST_MAP.TASK_FIELDS,filter:this.filter.bind(this)});e.append(n.render().$el)}},this)},render:function(){var e=this.template({});return this.$el.html(e),this.renderRows(),this}}),Magellan.Views.Reroute=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.listenTo(this.model,"change:days",this.updateNodeInfo),this.listenTo(this.model,"change:hours",this.updateNodeInfo),this.listenTo(this.model,"change:minutes",this.updateNodeInfo)},updateNodeInfo:function(e){_.each(e.changed,function(t,i){e.nodeInfo[i]=t})},template:_.template(i(388)),validate:function(){var e=this.model.isValidRerouteTimeFrame(this.model),t=e?"":"Minimum of 10 minutes";return this.$el.find(".time-frame-error").html(t),e},render:function(){var e=this.template({model:this.model});this.$el.html(e),this.daysDropdown=new Magellan.Views.LDDropdown({required:!0,value:this.model.get("days")||0,options:_.range(0,31),enableSearch:!1,isValid:this.validate.bind(this),onChange:function(e){this.model.set("days",e),this.daysDropdown.validate(),this.hoursDropdown.validate(),this.minutesDropdown.validate()}.bind(this)}),this.$el.find(".time-days-container").html(this.daysDropdown.render().$el),this.hoursDropdown=new Magellan.Views.LDDropdown({required:!0,value:this.model.get("hours")||0,options:_.range(0,24),enableSearch:!1,isValid:this.validate.bind(this),onChange:function(e){this.model.set("hours",e),this.daysDropdown.validate(),this.hoursDropdown.validate(),this.minutesDropdown.validate()}.bind(this)}),this.$el.find(".time-hours-container").html(this.hoursDropdown.render().$el),this.minutesDropdown=new Magellan.Views.LDDropdown({required:!0,value:this.model.get("minutes")||0,options:_.range(0,60),enableSearch:!1,isValid:this.validate.bind(this),onChange:function(e){this.model.set("minutes",e),this.daysDropdown.validate(),this.hoursDropdown.validate(),this.minutesDropdown.validate()}.bind(this)}),this.$el.find(".time-minutes-container").html(this.minutesDropdown.render().$el);var t=new Magellan.Views.EdgeSelectionMenu({model:this.model,objectType:this.model.nodeInfo.objectType});return this.$el.find(".reroute-edges-config-container").html(t.render().$el),this}})}},function(e,t,i){e.exports=function(){var e={account_based_routing:i(374),advanced_settings_view:i(354),condition_set_template:i(355),convert:i(376),create_new_account:i(377),custom_interface:i(9),custom_rule_template:i(357),dangling_edge_dropdown_template:i(340),deployment_history:i(341),edge_menu:i(358),explicit_owner_assignment:i(381),filter_rules_template:i(359),formatted_condition_text:i(360),graph_template:i(342),label_markup:i(400),lead_based_routing:i(382),live_graph_template:i(344),logs_table:i(345),magellan_graphs_menu:i(343),magellan_stencil_dropdown_template:i(396),match:i(346),merge_contact:i(384),merge_lead:i(385),min_max_rule_template:i(362),modal_template:i(348),multiple_links_menu_template:i(351),new_decision_node:i(380),new_graph_tile_template:i(373),new_match_node:i(383),new_node_template:i(363),node_chooser_dropdown:i(364),node_markdown:i(401),opportunity_based_routing:i(386),option_div:i(365),round_robin:i(389),single_condition_template:i(369),soql_rule_template:i(371),stats_markup:i(402),svg_defs:i(397),territory_routing:i(391),trigger_node:i(392),true_false_node:i(393),update_lead:i(395),update_contact:i(394),wf_editor:i(399),stencil_dropdown_item:i(403),metrics_detail_view:i(6),metrics_table:i(7),metrics_table_row:i(8),territory_create:i(349),territory_rename:i(350)};for(var t in e){var n=e[t];$('<script class="dynamic-template" id="'+t+'" type="text/template">').text(n).appendTo("body")}}},function(e,t,i){function initializeMagellanUtil(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Util&&(Magellan.Util={}),Magellan.Util.objectTypes=["Lead","Contact","Account","Opportunity"],Magellan.Util.isValidEmail=function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())},Magellan.Util.fetchNodeAuxMaps=function(){getScriptCachable(resourceURL+"/json/TriggerAuxMap.js"),getScriptCachable(resourceURL+"/json/DecisionAuxMap.js"),getScriptCachable(resourceURL+"/json/MatchAuxMap.js"),getScriptCachable(resourceURL+"/json/ActionAuxMap.js"),getScriptCachable(resourceURL+"/json/ReRouteAuxMap.js"),getScriptCachable(resourceURL+"/json/PartnerAuxMap.js")},Magellan.Util.getAllNodes=function(e){if(_.isObject(e)&&_.isArray(e.businessLogic))return Magellan.Util.constructGraphFromJSON(e);var t=e||window.graph;if(!(t instanceof joint.dia.Graph))throw new Error("Require graph to get all nodes!");var i=t.getElements();return _.filter(i,function(e){return e instanceof Magellan.Models.Node})},Magellan.Util.getNodeNamesToNodesMap=function(){var e={},t=Magellan.Util.getAllNodes(window.graph);return _.each(t,function(t){e[t.nodeInfo.name]=t}),e},Magellan.Util.getNodeNamesToNodesMapFromJSON=function(e){var t={},i=Magellan.Util.constructGraphFromJSON(e);return _.each(i,function(e){t[e.nodeInfo.name]=e}),t},Magellan.Util.constructGraphFromJSON=function(e){var t=[];return _.each(e.businessLogic,function(e){var i=e[0],n=e[1],a=new(Magellan.Models.getObjectByName(i.magellanClass))({position:n,nodeInfo:i,fromJSON:!0});t.push(a)}),t},Magellan.Util.getEdges=function(){var e=Magellan.Util.getAllNodes(window.graph),t=Magellan.Util.getNodeNamesToNodesMap(),i=[];return _.each(e,function(e){i=i.concat(_.map(_.select(_.uniq(_.map(e.nodeInfo.edges,function(e){return e.target})),function(e){return-1!==e&&null!==e&&void 0!==e}),function(i){return{target:t[i],source:e}}))}),i},Magellan.Util.getEdgesFromJSON=function(e){var t=Magellan.Util.constructGraphFromJSON(e),i=Magellan.Util.getNodeNamesToNodesMapFromJSON(e),n=[];return _.each(t,function(e){n=n.concat(_.map(_.select(_.uniq(_.map(e.nodeInfo.edges,function(e){return e.target})),function(e){return-1!==e&&null!==e&&void 0!==e}),function(t){return{target:i[t],source:e}}))}),n},Magellan.Util.getTriggerNodeNames=function(e){var t=_.filter(e,function(e,t){return e instanceof Magellan.Models.TriggerNode});return _.map(t,function(e){return e.nodeInfo.name})},Magellan.Util.getStartNodeNames=function(e){var t={TriggerNode:[],RerouteNode:[]};return _.each(e,function(e,i){e instanceof Magellan.Models.TriggerNode?t.TriggerNode.push(e.nodeInfo.name):e instanceof Magellan.Models.RerouteNode&&t.RerouteNode.push(e.nodeInfo.name)}),t},Magellan.Util.getEdgeName=function(e,t){var i=e.getNameToEdgeMap()[t];if("MATCH"===e.nodeInfo.type||"DECISION"===e.nodeInfo.type){var n=!1;if(_.each(e.getNameToEdgeMap(),function(t){-1===t.target&&void 0!==e.edgeToMetrics[t.name]&&(n=!0)}),n)return"End Of Flow"}return i&&-1===i.target&&"Next Node"===i.name?e.nodeInfo.name:i&&-1!==i.target||"Round Robin"===e.nodeInfo.actionType?Magellan.Migration.getFormattedEdgeName(i.name):e.getDefaultName(!0)},Magellan.Util.getContiguousNodeNames=function(e,t){return function BFS(t,i){if(0===i.length)return t;t=_.union(t,i);var n=_.map(i,function(t){return e[t]}),a=_.uniq(_.flatten(_.map(n,function(e){return _.map(e.nodeInfo.edges,function(e){return e.target})}))),o=_.filter(a,function(e){return!_.isNull(e)&&!_.isUndefined(e)&&-1!==e&&0!==e});return BFS(t,_.difference(o,t))}([],t)},Magellan.Util.getIntersectionFromAngle=function(e,t){t%=360;var i=Math.round(3600*t/360);return"action"===(e=e.toLowerCase())?Magellan.Util.actionAuxMap[i]:"decision"===e?Magellan.Util.decisionMap[i]:"match"===e?Magellan.Util.matchMap[i]:"trigger"===e?Magellan.Util.triggerMap[i]:"reroute"===e?Magellan.Util.rerouteAuxMap[i]:"partner"===e?Magellan.Util.partnerAuxMap[i]:void 0},Magellan.Util.getAngleForLinkAndNode=function(e,t){var i=t.id==e.get("source").id,n=t.getAbsoluteCenter(),a=n.x,o=n.y;a&&o||console.log(" "+a+" "+o);var l=i?e.get("target").id?e.getTargetElement().getAbsoluteCenter():e.get("target"):e.get("source").id?e.getSourceElement().getAbsoluteCenter():e.get("source"),s=l.x,r=l.y;s&&r||console.log(" "+s+" "+r);var d=Math.atan((o-r)/(s-a))/(Math.PI/180);return d=-1*(d-90),s<a?d+=180:r<o&&(d+=360),d},Magellan.Util.getLinkConnectionPoint=function(e,t){var i,n=e.model,a=t.model,o=a.getAbsoluteCenter();a.id,n.get("source").id;a instanceof Magellan.Models.ActionNode?i="action":a instanceof Magellan.Models.TriggerNode?i="trigger":a instanceof Magellan.Models.MatchNode?i="match":a instanceof Magellan.Models.DecisionNode?i="decision":a instanceof Magellan.Models.RerouteNode?i="reroute":(a instanceof Magellan.Models.OutreachNode||a instanceof Magellan.Models.SalesloftNode)&&(i="partner");var l,s=Magellan.Util.getAngleForLinkAndNode(n,a);return s||console.log("angle = "+s),i&&(l=Magellan.Util.getIntersectionFromAngle(i,s)),l||console.log("offset = "+l),l=l||[0,0],a instanceof Magellan.Models.RerouteNode?g.point(o.x+l[0],o.y+l[1]):g.point(o.x+l[0]/2,o.y+l[1]/2)},Magellan.Util.scaleCoordinates=function(e,t){return function(i,n){return e(i,n).map(function(e){return Math.round(e*t)})}},Magellan.Util.measureText=function(e){var t=t||document.getElementsByClassName("dummy-tspan")[0];return t.innerHTML=e,t.getComputedTextLength()},Magellan.Util.breakLabelText=function(e){return Magellan.Util.wrapText(e,5,120).join("\n")},Magellan.Util.wrapText=function(e,t,i,n){for(var a=e.split(" "),o=[],l=0,s=0;l<a.length;)if(_.isEmpty(o[s]))o[s]=a[l++];else{var r=o[s]+a[l];joint.util.breakText(r,{width:i})===r?o[s]+=" "+a[l++]:o[++s]=a[l++]}return o.length>t&&(o[t-1]+="..."),o.slice(0,t)},Magellan.Util.formatDate=function(e){return dateObj=new Date(e),"Invalid Date"==dateObj?"":pad2(dateObj.getUTCMonth()+1)+"/"+pad2(dateObj.getUTCDate())+"/"+dateObj.getUTCFullYear()},Magellan.Util.getBrokenWord=function(e,t,i){for(var n=0,a=0;n<t;)(n=Magellan.Util.measureText(e.slice(0,a)))<t&&a++;return[e.slice(0,a),e.slice(a,e.length)]},Magellan.Util.identifyToken=function(e){return Number.isInteger(e)||!isNaN(parseInt(e))&&String(parseInt(e))===e?"Integer":"("===e?"Open Parenthesis":")"==e?"Close Parenthesis":" "===e?"White Space":"string"!=typeof e||"AND"!==e.toUpperCase()&&"OR"!==e.toUpperCase()?"Unknown":"Logical Operator"},Magellan.Util.tokenize=function(e,t){t+=" ";for(var i={tokens:[],feedbackMessage:[]},n=["Open Parenthesis","Integer"],a="",o="",l=void 0,s=[],r=0;r<t.length;r++)if(o=t[r],"Open Parenthesis"===(l=Magellan.Util.identifyToken(o))||"Close Parenthesis"===l||"White Space"===l){if(a.length>0){if(l=Magellan.Util.identifyToken(a),n.includes(l)?"Open Parenthesis"===l||"Logical Operator"===l?n=["Open Parenthesis","Integer"]:"Close Parenthesis"!==l&&"Integer"!==l||(n=["Close Parenthesis","Logical Operator"]):i.feedbackMessage.push("Expecting "+n.join("/")+" but got "+a),"Integer"===l){var d=parseInt(a,10);d>0&&d<=e?(s.includes(d)||s.push(d),i.tokens.push(d),a=""):i.feedbackMessage.push("No such condition: "+a)}else i.tokens.push(a.toUpperCase()),a="";l=Magellan.Util.identifyToken(o)}"White Space"!==l&&("Open Parenthesis"===l&&n.includes(l)?n=["Open Parenthesis","Integer"]:"Close Parenthesis"===l&&n.includes(l)?n=["Close Parenthesis","Logical Operator"]:i.feedbackMessage.push("Expecting "+n.join("/")+" but got "+o),i.tokens.push(o),o="")}else a+=o;return s.length<e&&i.feedbackMessage.push("Not all rules have been included in logic yet!"),i},Magellan.Util.dijkstraShuntingYard=function(e){for(var t=[],i=void 0,n=void 0,a={},o=[],l=!1,s=!1,r=0;r<e.length;r++)if(i=e[r],"Integer"===(n=Magellan.Util.identifyToken(i)))o.push(i);else if("Logical Operator"===n){for(;t.length>0;){if("Logical Operator"!==Magellan.Util.identifyToken(t[t.length-1]))break;o.push(t.pop())}t.push(i)}else if("Open Parenthesis"===n)t.push(i);else if("Close Parenthesis"===n){for(var d=!1;t.length>0&&!d;){var c=t.pop();"Open Parenthesis"===(u=Magellan.Util.identifyToken(c))?d=!0:o.push(c)}0!==t.length||d||(s=!0)}else l=!0;for(;t.length>0;){var u;c=t.pop();"Open Parenthesis"===(u=Magellan.Util.identifyToken(c))||"Close Parenthesis"===u?s=!0:o.push(c)}return a.RPNTokens=o,a.hasMismatchedParenthesis=s,a.hasUnknownTokens=l,a},Magellan.Util.parseLogic=function(e,t){var i={tokens:void 0,RPNTokens:void 0,feedbackMessage:[]},n=Magellan.Util.tokenize(e,t);i.tokens=n.tokens,i.feedbackMessage=i.feedbackMessage.concat(n.feedbackMessage);var a=Magellan.Util.dijkstraShuntingYard(i.tokens);return i.RPNTokens=a.RPNTokens,a.hasMismatchedParenthesis&&i.feedbackMessage.push("Parenthesis mismatch found!"),a.hasUnknownTokens&&i.feedbackMessage.push("Unknown tokens found in formula!"),i.tokens.length>0&&"Logical Operator"===Magellan.Util.identifyToken(_.last(i.tokens))&&i.feedbackMessage.push("Cannot end with a logical operator!"),i},Magellan.Util.formatTupleCriterionHtml=function(e){var t="",i=Magellan.Util.parseLogic(e.conditions.length,e.logic).feedbackMessage;if(0===i.length){var n=Magellan.Util.tokenize(e.conditions.length,e.logic).tokens;_.each(n,function(i){var n=Magellan.Util.identifyToken(i);if("Integer"===n){var a=e.conditions[i-1],o=a.field,l=a.operator,s=a.operand;t+='<span class="ld-green">['+o+"</span> "+l+' <span class="ld-green">'+s+"]</span>"}else t+="Logical Operator"===n?"<span> "+i+" </span>":"<span>"+i+" </span>"})}else t=i.join("\n");return t},Magellan.Util.flattenReferenceLabels=function(e){return e.replace(" ID","")},Magellan.Util.flattenReferenceAPIs=function(e){var t=e.replace(new RegExp("__c$"),"__r");return t===e&&(t=t.replace(new RegExp("id$"),"")),t},Magellan.Util.createFlattenedFields=function(e){return _.map(e,function(e){return Magellan.Util.flattenField(e)})},Magellan.Util.flattenField=function(e){var t={};return $.extend(!0,t,e),"REFERENCE"==t.type&&(t.type="ID"),t},Magellan.Util.capitalizeString=function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},Magellan.Util.unset=function(e){for(var t in e)delete e[t];return e},Magellan.Util.getFieldFromAPIName=function(e,t){return _.filter(t,function(t){return t.name===e})},Magellan.Util.filterTypeaheadResults=((e,t)=>{void 0!==t&&null!==t||(t=""),t=t.toLowerCase();const i={prefix:[],substring:[],id:[]};return e.forEach(e=>{const n=e.label.toLowerCase();n.startsWith(t)?i.prefix.push(e):n.indexOf(t)>=0?i.substring.push(e):e.id===t&&i.id.push(e)}),[].concat(i.prefix,i.substring,i.id)}),Magellan.Util.convertStringSelectionToArray=function(e){return _.isEmpty(e)?[]:[{label:e,name:e}]},Magellan.Util.convertFieldSelectionStringToArray=function(e,t,i){if("string"==typeof e&&""!==e&&(e=e.toLowerCase().split(".")),_.isEmpty(e))return[];var n=e[0],a=[],o=[n,n+"id",n.replace(new RegExp("__r$"),"__c")],l=null,s=i[t];_.isArray(s)&&(s=_.indexBy(s,"name"));for(var r=0;r<o.length;r++)if(l=s[o[r]]){a.push(l);break}if(l)l.hasOwnProperty("parent")&&l.parent.length>0&&_.each(l.parent,function(t){var n=Magellan.Util.convertFieldSelectionStringToArray(e.slice(1),t,i);if(Array.prototype.push.apply(a,n),n&&n.length>0)return!1});else{var d={message:"Warning: field "+e+" not found for object "+t+" in dataset. Previous value is probably not the same type as items in the dataset. Ignore this message if that's the case."};d.context={Fields:e,Dataset:i},console.warn(d)}return a},Magellan.Util.convertFieldSelectionArrayToString=function(e){var t=e[e.length-1],i="";return _.isUndefined(t)||"REFERENCE"===t.type?i:i=e.reduce(function(e,t){return""!==e&&(e+="."),"REFERENCE"===t.type?e+Magellan.Util.flattenReferenceAPIs(t.name):e+t.name},"")},Magellan.Util.getObjectTypeFromCurrentSuggestions=function(e){if(0===e.length)return null;let t;for(let i=0;i<e.length;i++)if(e[i].objectType){t=e[i].objectType;break}return t},Magellan.Util.createBlacklistFilter=function(e,t="name"){return function(i){var n=e?e.toUpperCase()+"_FIELDS":"",a=!!Magellan.Validation.FIELD_BLACKLIST_SETS[n];return _.filter(i,function(e){return!a||!Magellan.Validation.FIELD_BLACKLIST_SETS[n].has(e[t])})}},Magellan.Util.createFieldsFilter=function(e){return function(t){return _.filter(t,function(t){if(!t.type)return!1;var i=Magellan.Validation.SFDC_TYPE_TO_GROUPING[t.type]===e;return i=i||"REFERENCE"===t.type})}},Magellan.Util.typeaheadDataFilter=function(e,t){return function(i){return _.filter(i,function(i){return!_.isEmpty(i[t])&&!e.includes(i[t])})}},Magellan.Util.createMappingFieldsFilter=function(e){var t=e?Magellan.Validation.SFDC_VALID_TYPE_MAPPING[e.type]:[],i=e?e.objectType.split("/"):[];return function(e){return _.filter(e,function(e){var n=t.includes(e.type)||!1;return"REFERENCE"===e.type||!(!n||"ID"==e.type&&_.isEmpty(_.intersection(e.parent,i)))})}},Magellan.Util.createMappingFlattenedFieldsFilter=function(e){var t=[],i=[];return e&&(t=Magellan.Validation.SFDC_VALID_TYPE_MAPPING[e.type],i=e.objectType.split("/")),function(n){return _.filter(n,function(n){var a=t.includes(n.type);if(e.parent.length>0&&n.parent.length>0){var o=!1;return e.parent.forEach(function(e){n.parent.forEach(function(t){e==t&&(o=!0)})}),a&&o}if(e.parent.length>0&&0==n.parent.length){var l=e.parent.includes(n.objectType);return a&&l}if(0==e.parent.length&&n.parent.length>0){var s=n.parent.includes(e.objectType);return a&&s}var r=i.includes(n.objectType);return!(!a||"ID"==n.type&&!r)})}},Magellan.Util.createUserFieldsFilter=function(){return function(e){return _.filter(e,function(e){return"REFERENCE"===e.type||"User"===e.objectType&&"id"===e.name})}},Magellan.Util.createFlattenedUserFieldsFilter=function(){return function(e){return _.filter(e,function(e){return e.parent.includes("User")})}},Magellan.Util.createOwnerToOwnerMappingFilter=function(){return function(e){return _.filter(e,function(e){return"Group"===e.objectType||"Group/User"===e.objectType?!Magellan.Validation.FIELD_BLACKLIST_SETS.GROUP_FIELDS.has(e.name):"User"!==e.objectType||!Magellan.Validation.FIELD_BLACKLIST_SETS.USER_FIELDS.has(e.name)})}},Magellan.Util.construct_parsed_condition=function(e){var t=e.type,i="";if("conditions"===t){var n=e.logic;if(void 0===n||null===n)i="<b>No Logic For Filter Condition</b>";else{for(var a=1;a<=e.conditions.length;a++){var o=e.conditions[a-1],l=[o.field,o.operator,o.operand].join(" "),s=new RegExp("\\b"+a+"\\b");n=n.replace(s,l)}i="("+n+")"}}else"soql"===t?i=e.soqlCondition:"optima"===t&&(i=e.direction+" "+e.field);return i},Magellan.Util.getPluralObjectName=function(e){return"Opportunity"===e?"Opportunities":e+"s"},Magellan.Util.getUrlParams=function(){Array.prototype.slice.call(arguments);var e={};return location.search.substr(1).split("&").forEach(function(t){var i=t.split("=");e[i[0]]=i[1]}),Array.prototype.slice.call(arguments).forEach(function(t){e[t[0]]=t[1]}),e},Magellan.Util.checkIfReadOnlyGraph=function(){return magellanPage.includes("deploymentMetrics")||magellanPage.includes("deploymentHistory")},Magellan.Util.expandNestedDropdownFieldSelections=function(e,t,i){var n=[];if(!e||0===e.length)return n;var a=_.map(e.split("."),function(e){return e.replace(new RegExp("__r$"),"__c")});return _.each(a,function(e){var a=_.find(i[t],"name",e.toLowerCase()),o=_.find(i[t],"name",e.toLowerCase()+"id"),l=a||o;l&&(n.push(l),"REFERENCE"===l.type&&(t=l.parent[0]))}),n},Magellan.Util.convertMSToHoursMinutes=function(e){return minutes=Math.floor(e/1e3/60),hours=Math.floor(minutes/60),minutes%=60,(hours<10?"0"+hours:hours)+":"+(minutes<10?"0"+minutes:minutes)},Magellan.Util.convertSecondsToHoursMinutes=function(e){return minutes=Math.floor(e/60),hours=Math.floor(minutes/60),minutes%=60,(hours<10?"0"+hours:hours)+":"+(minutes<10?"0"+minutes:minutes)},Magellan.Util.formatMomentDate=function(e,t,i){var n=i?0:6e4*(new Date).getTimezoneOffset(),a=new Date(new Date(e).getTime()-n);return moment(a).format(t||"MM/DD/YYYY, h:mm:ss A")},Magellan.Util.convertTo12Hr=function(e){var t=e.split(":")[0],i=e.split(":")[1],n=t>=12?"pm":"am",a=t>12?t-12:t;return a=0===a?12:a,String(a).padStart(2,"0")+":"+i+" "+n},Magellan.Util.initializeTooltip=function(e,t){var n=_.template(i(398))({title:t.title,body:t.body}),a=$(n).appendTo(e);e.click(function(e){$(".dg_inner-wrapper .ld-tooltip").not(a).fadeOut(100),$(e.target).hasClass("ld-tooltip-close-icon")||a.fadeIn(100)}),a.find(".ld-tooltip-close-icon").click(function(e){a.fadeOut(100)}),$(".dg_inner-wrapper").click(function(e){$(e.target).closest(".ld-tooltip-hint").length||$(".ld-tooltip").fadeOut(100)})},Magellan.Util.formatDateToUTCWithTimezoneOffset=function(e,t){var i=Magellan.Util.Timezones.idToTimezone[t];_.isObject(i)||console.error("Invalid timezone Id: "+t);var n=moment(e).format("YYYY-MM-DDTHH:mm:ss")+i.gmtOffset;return moment(n).utc().format(Magellan.Validation.DATETIME_FORMAT)},Magellan.Util.formatGMTDateTimeToTimezone=function(e,t,i){var n=Magellan.Util.Timezones.idToTimezone[t];_.isObject(n)||console.error("Invalid timezone Id: "+t);var a=60*moment().utcOffset(n.gmtOffset)._offset*1e3,o=moment.utc(e).valueOf()+a;return moment.utc(o).format(i||"YYYY-MM-DD HH:mm:ss")},Magellan.Util.Timezones={idToName:{},idToTimezone:{},tokenizer:function(e){var t=Magellan.Util.Timezones.idToTimezone[e];return Bloodhound.tokenizers.whitespace(t.name).concat(e.split(/[/_]/))},datumTokenizer:function(e){return Bloodhound.tokenizers.nonword(e.name).concat(Bloodhound.tokenizers.whitespace(e.name+" "+e.id))},guessUserTimezone:function(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone||null}catch(e){return console.error(e),null}}},Magellan.Util.Timezones.idToName={"Pacific/Kiritimati":"(GMT+14:00) Line Is. Time (Pacific/Kiritimati)","Pacific/Enderbury":"(GMT+13:00) Phoenix Is.Time (Pacific/Enderbury)","Pacific/Tongatapu":"(GMT+13:00) Tonga Time (Pacific/Tongatapu)","Pacific/Chatham":"(GMT+12:45) Chatham Standard Time (Pacific/Chatham)","Pacific/Auckland":"(GMT+12:00) New Zealand Standard Time (Pacific/Auckland)","Pacific/Fiji":"(GMT+12:00) Fiji Time (Pacific/Fiji)","Asia/Kamchatka":"(GMT+12:00) Petropavlovsk-Kamchatski Time (Asia/Kamchatka)","Pacific/Norfolk":"(GMT+11:30) Norfolk Time (Pacific/Norfolk)","Australia/Lord_Howe":"(GMT+11:00) Lord Howe Standard Time (Australia/Lord_Howe)","Pacific/Guadalcanal":"(GMT+11:00) Solomon Is. Time (Pacific/Guadalcanal)","Australia/Adelaide":"(GMT+10:30) Australian Central Standard Time ((South Australia) Australia/Adelaide)","Australia/Sydney":"(GMT+10:00) Australian Eastern StandardTime (New South Wales) (Australia/Sydney)","Australia/Brisbane":"(GMT+10:00) Australian Eastern Standard Time (Queensland) (Australia/Brisbane)","Australia/Darwin":"(GMT+09:30) Australian Central Standard Time (Northern Territory) (Australia/Darwin)","Asia/Seoul":"(GMT+09:00) Korea Standard Time (Asia/Seoul)","Asia/Tokyo":"(GMT+09:00) Japan Standard Time (Asia/Tokyo)","Asia/Hong_Kong":"(GMT+08:00) Hong Kong Time (Asia/Hong_Kong)","Asia/Kuala_Lumpur":"(GMT+08:00) Malaysia Time (Asia/Kuala_Lumpur)","Asia/Manila":"(GMT+08:00) Philippines Time (Asia/Manila)","Asia/Shanghai":"(GMT+08:00) China Standard Time (Asia/Shanghai)","Asia/Singapore":"(GMT+08:00) Singapore Time (Asia/Singapore)","Asia/Taipei":"(GMT+08:00) China Standard Time (Asia/Taipei)","Australia/Perth":"(GMT+08:00) Australian Western Standard Time (Australia/Perth)","Asia/Bangkok":"(GMT+07:00) Indochina Time (Asia/Bangkok)","Asia/Ho_Chi_Minh":"(GMT+07:00) Indochina Time (Asia/Ho_Chi_Minh)","Asia/Jakarta":"(GMT+07:00) West Indonesia Time (Asia/Jakarta)","Asia/Rangoon":"(GMT+06:30) Myanmar Time (Asia/Rangoon)","Asia/Dhaka":"(GMT+06:00) Bangladesh Time (Asia/Dhaka)","Asia/Kathmandu":"(GMT+05:45) Nepal Time (Asia/Kathmandu)","Asia/Colombo":"(GMT+05:30) India Standard Time (Asia/Colombo)","Asia/Kolkata":"(GMT+05:30) India Standard Time (Asia/Kolkata)","Asia/Karachi":"(GMT+05:00) Pakistan Time (Asia/Karachi)","Asia/Tashkent":"(GMT+05:00) Uzbekistan Time (Asia/Tashkent)","Asia/Yekaterinburg":"(GMT+05:00) Yekaterinburg Time (Asia/Yekaterinburg)","Asia/Kabul":"(GMT+04:30) Afghanistan Time (Asia/Kabul)","Asia/Baku":"(GMT+04:00) Azerbaijan Summer Time (Asia/Baku)","Asia/Dubai":"(GMT+04:00) Gulf Standard Time (Asia/Dubai)","Asia/Tbilisi":"(GMT+04:00) Georgia Time (Asia/Tbilisi)","Asia/Yerevan":"(GMT+04:00) Armenia Time (Asia/Yerevan)","Asia/Tehran":"(GMT+03:30) Iran Daylight Time (Asia/Tehran)","Africa/Nairobi":"(GMT+03:00) East African Time (Africa/Nairobi)","Asia/Baghdad":"(GMT+03:00) Arabia Standard Time (Asia/Baghdad)","Asia/Kuwait":"(GMT+03:00) Arabia Standard Time (Asia/Kuwait)","Asia/Riyadh":"(GMT+03:00) Arabia Standard Time (Asia/Riyadh)","Europe/Minsk":"(GMT+03:00) Moscow Standard Time (Europe/Minsk)","Europe/Moscow":"(GMT+03:00) Moscow Standard Time (Europe/Moscow)","Africa/Cairo":"(GMT+03:00) Eastern European Summer Time (Africa/Cairo)","Asia/Beirut":"(GMT+03:00) Eastern European Summer Time (Asia/Beirut)","Asia/Jerusalem":"(GMT+03:00) Israel Daylight Time (Asia/Jerusalem)","Europe/Athens":"(GMT+03:00) Eastern European Summer Time (Europe/Athens)","Europe/Bucharest":"(GMT+03:00) Eastern European Summer Time (Europe/Bucharest)","Europe/Helsinki":"(GMT+03:00) Eastern European Summer Time (Europe/Helsinki)","Europe/Istanbul":"(GMT+03:00) Eastern European Summer Time (Europe/Istanbul)","Africa/Johannesburg":"(GMT+02:00) South Africa Standard Time (Africa/Johannesburg)","Europe/Amsterdam":"(GMT+02:00) Central European Summer Time (Europe/Amsterdam)","Europe/Berlin":"(GMT+02:00) Central European Summer Time (Europe/Berlin)","Europe/Brussels":"(GMT+02:00) Central European Summer Time (Europe/Brussels)","Europe/Paris":"(GMT+02:00) Central European Summer Time (Europe/Paris)","Europe/Prague":"(GMT+02:00) Central European Summer Time (Europe/Prague)","Europe/Rome":"(GMT+02:00) Central European Summer Time (Europe/Rome)","Europe/Lisbon":"(GMT+01:00) Western European Summer Time (Europe/Lisbon)","Africa/Algiers":"(GMT+01:00) Central European Time (Africa/Algiers)","Europe/London":"(GMT+01:00) British Summer Time (Europe/London)","Atlantic/Cape_Verde":"(GMT-01:00) Cape Verde Time (Atlantic/Cape_Verde)","Africa/Casablanca":"(GMT+00:00) Western European Time (Africa/Casablanca)","Europe/Dublin":"(GMT+00:00) Irish Summer Time (Europe/Dublin)",GMT:"(GMT+00:00) Greenwich Mean Time (GMT)","America/Scoresbysund":"(GMT-00:00) Eastern Greenland Summer Time (America/Scoresbysund)","Atlantic/Azores":"(GMT-00:00) Azores Summer Time (Atlantic/Azores)","Atlantic/South_Georgia":"(GMT-02:00) South Georgia Standard Time (Atlantic/South_Georgia)","America/St_Johns":"(GMT-02:30) Newfoundland Daylight Time (America/St_Johns)","America/Sao_Paulo":"(GMT-03:00) Brasilia Summer Time (America/Sao_Paulo)","America/Argentina/Buenos_Aires":"(GMT-03:00) Argentina Time (America/Argentina/Buenos_Aires)","America/Santiago":"(GMT-03:00) Chile Summer Time (America/Santiago)","America/Halifax":"(GMT-03:00) Atlantic Daylight Time (America/Halifax)","America/Puerto_Rico":"(GMT-04:00) Atlantic Standard Time (America/Puerto_Rico)","Atlantic/Bermuda":"(GMT-04:00) Atlantic Daylight Time (Atlantic/Bermuda)","America/Caracas":"(GMT-04:30) Venezuela Time (America/Caracas)","America/Indiana/Indianapolis":"(GMT-04:00) Eastern Daylight Time (America/Indiana/Indianapolis)","America/New_York":"(GMT-04:00) Eastern Daylight Time (America/New_York)","America/Bogota":"(GMT-05:00) Colombia Time (America/Bogota)","America/Lima":"(GMT-05:00) Peru Time (America/Lima)","America/Panama":"(GMT-05:00) Eastern Standard Time (America/Panama)","America/Mexico_City":"(GMT-05:00) Central Daylight Time (America/Mexico_City)","America/Chicago":"(GMT-05:00) Central Daylight Time (America/Chicago)","America/El_Salvador":"(GMT-06:00) Central Standard Time (America/El_Salvador)","America/Denver":"(GMT-06:00) Mountain Daylight Time (America/Denver)","America/Mazatlan":"(GMT-06:00) Mountain Standard Time (America/Mazatlan)","America/Phoenix":"(GMT-07:00) Mountain Standard Time (America/Phoenix)","America/Los_Angeles":"(GMT-07:00) Pacific Daylight Time (America/Los_Angeles)","America/Tijuana":"(GMT-07:00) Pacific Daylight Time (America/Tijuana)","Pacific/Pitcairn":"(GMT-08:00) Pitcairn Standard Time (Pacific/Pitcairn)","America/Anchorage":"(GMT-08:00) Alaska Daylight Time (America/Anchorage)","Pacific/Gambier":"(GMT-09:00) Gambier Time (Pacific/Gambier)","America/Adak":"(GMT-9:00) Hawaii-Aleutian Standard Time (America/Adak)","Pacific/Marquesas":"(GMT-09:30) Marquesas Time (Pacific/Marquesas)","Pacific/Honolulu":"(GMT-10:00) Hawaii-Aleutian Standard Time (Pacific/Honolulu)","Pacific/Niue":"(GMT-11:00) Niue Time (Pacific/Niue)","Pacific/Pago_Pago":"(GMT-11:00) Samoa Standard Time (Pacific/Pago_Pago)"},_.each(Magellan.Util.Timezones.idToName,function(e,t){Magellan.Util.Timezones.idToTimezone[t]={id:t,name:e,gmtOffset:e.substr(1,e.indexOf(") ")-1).replace("GMT",""),label:e}}),Magellan.Util.Timezones.getTimezoneTypeaheadData=function(){var e=Magellan.Util.Timezones.guessUserTimezone(),t=e?[e]:null,i=Object.values(Magellan.Util.Timezones.idToTimezone),n=[];return _.each(t,function(e){i.remove(Magellan.Util.Timezones.idToTimezone[e]),n.push(Magellan.Util.Timezones.idToTimezone[e])}),i=n.concat(i)},Magellan.Util.Timezones.createTimezoneTypeahead=function(e){var t;t=_.isEmpty(e)?[]:[Magellan.Util.Timezones.idToTimezone[e]];var i=Magellan.Util.Timezones.getTimezoneTypeaheadData();return new Magellan.Views.NestedTypeaheadSelector({required:!0,requireSelectionFromData:!0,disableBreadcrumbs:!0,data:{timezones:i},root:"timezones",selection:t,placeholder:"Select one",datumTokenizer:Magellan.Util.Timezones.datumTokenizer,queryTokenizer:function(e){return Bloodhound.tokenizers.nonword(e).concat(Bloodhound.tokenizers.whitespace(e))}})},Magellan.Util.CreateUserListOverflow=function(e,t){if(e.accessLevelAssignments&&e.accessLevelAssignments.length>0){var i=e.accessLevelAssignments[0],n=e.accessLevelAssignments.slice(1),a=i.User__r?i.User__r.Name:i.User__c,o="",l="";return n.length>0&&(o=' style="max-width: '+(t?t+"px":"100%")+';"',l='<div class="counter-bubble ld-body-small">+'+n.length+'<div class="counter-content">',_.each(n,function(e){var t=e.User__r?e.User__r.Name:e.User__c;l+="<div>"+t+"</div>"}),l+="</div></div>"),'<div class="pool-manager-column"'+o+">"+a+"</div>"+l}return""},Magellan.Util.shortenNumbers=function(e){const t=Math.ceil(Math.log10(e+1));if(t<=3)return""+e;const i=["K","M","B","T","Qa","Qi"][Math.ceil(t/3)-2];let n=e/Math.pow(10,t-1-(t-1)%3);return(n=t%3==1?Math.floor(10*n)/10:Math.floor(n))+i},Magellan.Util.formatUsageMetrics=function(e){let t=[],i={total:0,lead:0,contact:0,account:0,opportunity:0},n=[],a={};for(let o in e){let l=new Date(moment(o).format("MMMM D, YYYY")),s=e[o],r={},d={};for(let e of Magellan.Util.objectTypes){let t=e.toLowerCase(),o=s[t];if(o)for(let e in o){let l=o[e];i[t]+=l,i.total+=l,_.isUndefined(a[e])&&(a[e]={total:0,lead:0,contact:0,account:0,opportunity:0}),n.includes(e)||n.push(e),a[e][t]+=l}r[e+"_Routing_Users"]=_.isUndefined(o)?"{}":JSON.stringify(o),r.Date=l;for(let e in o)e in d?d[e]+=o[e]:d[e]=o[e]}let c=Object.keys(d).length;r.All_Routing_User_Count=c,r.All_Routing_Users=d,t.push(r)}return Object.keys(a).map(function(e,t){for(objectType of Magellan.Util.objectTypes)a[e].total+=a[e][objectType.toLowerCase()]}),{usageMetrics:t,recordsRouted:i,uniqueIdCount:n.length,idToRecordTypeCount:a}},Magellan.Util.generateNodeMetricStats=function(e,t){var i=e.getFailureStats()+e.getErrorStats(),n=i>0?_.union(e.getSuccessEdgeNames(),e.getFailureEdgeNames(),e.getErrorEdgeNames()):e.getSuccessEdgeNames(),a=_.reduce(n,function(t,i){return Math.max(t,String(e.getEdgeStats(i)).length)},0),o=void 0;e instanceof Magellan.Models.TriggerNode||(o=_.reduce(_.union(n,[e.getDefaultName(!0)]),function(e,t){return Math.max(e,Magellan.Migration.getFormattedEdgeName(t).length)},0)),i>0&&(a=Math.max(a,String(i).length));var l,s=4.5*a+20.5;l="MATCH"===e.nodeInfo.type||"DECISION"===e.nodeInfo.type||"REROUTING"===e.nodeInfo.type?43:i>0?25*(n.length+1)+28:25*n.length+18;var r="80,37";(e instanceof Magellan.Models.OutreachNode||e instanceof Magellan.Models.SalesloftNode)&&(r="135,35");var d="36,68";e instanceof Magellan.Models.MatchNode?d="38,70":e instanceof Magellan.Models.RerouteNode&&(d="-20,40");var c="120,55";return e instanceof Magellan.Models.OutreachNode||e instanceof Magellan.Models.SalesloftNode?c="175,55":e instanceof Magellan.Models.DecisionNode&&(c="78,85"),{successStats:e.getSuccessStats(),failureAndErrorStats:i,danglingEdges:e.getNumberOfDanglingEdges(),allMetricsEdgeNames:n,longestEdgeMetricLength:a,longestEdgeNameLength:o,metricToNameOffset:s,infoBoxHeight:l,pendingCCIOs:e.pendingCCIOs,metricBubbleTranslate:r,EOFBubbletranslate:d,statBoxTranslate:c}},Magellan.Util.hasNotificationData=function(e){return!_.isEmpty(e)&&(!_.isEmpty(e.template)||Magellan.Util.hasRecipientsData(e.recipients))},Magellan.Util.hasRecipientsData=function(e){var t=!1;return _.each(e,function(e){_.isBoolean(e)&&!0===e?t=!0:_.isEmpty(e)||(t=!0)}),t},Magellan.Util.getDefaultNotificationSettings=function(e){var t={template:null,recipients:{emails:[]}};return e||(t.recipients.notifyPostOwner=!1,t.recipients.notifyPreOwner=!1,t.recipients.notifyNewObjectOwner=!1,t.recipients.additionalObjectUserFields=[]),t}}$.fn.toggleParentRow=function(e,t){$(this).toggleClass("collapsed");var i=$(this).siblings('.child-row[data-id="'+e+'"]');i.children("td, th").children().first().is("div")||i.children("td, th").wrapInner('<div style="display:none" />'),$(this).is(".collapsed")?i.slideUp(t).children("td, th").children().slideUp(t):i.slideDown(t).children("td, th").children().slideDown(t)},SVGElement&&SVGElement.prototype&&(SVGElement.prototype.hasClass=function(e){return new RegExp("(\\s|^)"+e+"(\\s|$)").test(this.getAttribute("class"))},SVGElement.prototype.addClass=function(e){this.hasClass(e)||this.setAttribute("class",this.getAttribute("class")+" "+e)},SVGElement.prototype.removeClass=function(e){var t=this.getAttribute("class").replace(new RegExp("(\\s|^)"+e+"(\\s|$)","g"),"$2");this.hasClass(e)&&this.setAttribute("class",t)},SVGElement.prototype.toggleClass=function(e){this.hasClass(e)?this.removeClass(e):this.addClass(e)}),e.exports=initializeMagellanUtil},function(e,t){e.exports=function initializeMagellanValidation(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Validation&&(Magellan.Validation={}),Magellan.Validation.nodesWithMissingMatchTypes=[],Magellan.Validation.DATE_FORMAT="YYYY-MM-DD",Magellan.Validation.DATETIME_FORMAT="YYYY-MM-DD HH:mm:ss",Magellan.Validation.EMAIL_RECIPIENT_LIMIT=20,Magellan.Validation.doCyclesExist,Magellan.Validation.nodeNameToRelatedObjectTypes={},Magellan.Validation.validateAccountBasedRouting=function(e){var t=_.map(Magellan.Controllers.FlowBuilder.getCustomUserFieldsByObject(LeanData__PrimarySObjectType),function(e){return e.name}),i=!_.isUndefined(e.nodeInfo["abr type"])&&!_.isNull(e.nodeInfo["abr type"])&&(void 0===e.nodeInfo["assignment field"]||"OwnerId"===e.nodeInfo["assignment field"]||_.includes(t,e.nodeInfo["assignment field"]));if(i)if("custom field"===e.nodeInfo["abr type"])i=i&&Magellan.Validation.metadataFieldExists("Account",e.nodeInfo["custom field"]);else if("owner mapping"===e.nodeInfo["abr type"])i=i&&Magellan.Validation.validateOwnerMapping(e.nodeInfo["owner mapping"]);else if("account team"===e.nodeInfo["abr type"]){i=i&&!_.isUndefined(e.nodeInfo["account team rule"])&&!_.isNull(e.nodeInfo["account team rule"]);var n=_.map(actionNodeMetaData.accountTeamRules,function(e){return e.Name.substring(14)});i=i&&_.includes(n,e.nodeInfo["account team rule"])}return i},Magellan.Validation.validateTerritoryRouting=function(e){var t=!!e.nodeInfo.segmentId,i=_.map(actionNodeMetaData.territoryRoutingSegmentsWithTerritories,function(e){return e.Id});return t&&_.includes(i,e.nodeInfo.segmentId)},Magellan.Validation.validateLeadBasedRouting=function(e){var t=_.map(Magellan.Controllers.FlowBuilder.getCustomUserFieldsByObject(LeanData__PrimarySObjectType),function(e){return e.name}),i=!_.isUndefined(e.nodeInfo["a2bbr type"]);return i&=!_.isNull(e.nodeInfo["a2bbr type"]),(i&=void 0===e.nodeInfo["assignment field"]||"OwnerId"===e.nodeInfo["assignment field"]||_.includes(t,e.nodeInfo["assignment field"]))&&"custom field"===e.nodeInfo["a2bbr type"]&&(i=Magellan.Validation.metadataFieldExists("Lead",e.nodeInfo["custom field"])),i},Magellan.Validation.validateOpportunityBasedRouting=function(e){var t=_.map(Magellan.Controllers.FlowBuilder.getCustomUserFieldsByObject(LeanData__PrimarySObjectType),function(e){return e.name}),i=!_.isUndefined(e.nodeInfo["obr type"])&&!_.isNull(e.nodeInfo["obr type"])&&(void 0===e.nodeInfo["assignment field"]||"OwnerId"===e.nodeInfo["assignment field"]||_.includes(t,e.nodeInfo["assignment field"]));if(i&&"custom field"===e.nodeInfo["obr type"]){i=i&&!_.isUndefined(e.nodeInfo["custom field"])&&!_.isNull(e.nodeInfo["custom field"]);var n=_.map(Magellan.Controllers.FlowBuilder.getCustomUserFieldsByObject("Opportunity"),function(e){return e.name});i=i&&_.includes(n,e.nodeInfo["custom field"])}return i},Magellan.Validation.validateConvertedLeadStatus=function(e){var t=!_.isUndefined(e)&&!_.isNull(e),i=_.map(Object.keys(actionNodeMetaData.convertedLeadStatusApiNameToLabel),function(e){return e});return t=t&&_.includes(i,e)},Magellan.Validation.validateCreateAccount=function(e){return!e.nodeInfo.convertLeadToContact||Magellan.Validation.validateConvertedLeadStatus(e.nodeInfo["convert status"])},Magellan.Validation.validateCreateOpportunity=function(e){var t=$.Deferred(),i=!0;if(e.nodeInfo.opportunityFields||(i=!1),!(e.nodeInfo.closeDays<0||""===e.nodeInfo.closeDays)||null!=e.nodeInfo.closeDate&&""!=e.nodeInfo.closeDate&&e.nodeInfo.closeDate.match(/^([0][1-9]|[1][0-2])\/([0][1-9]|[1-2][0-9]|[3][0-1])\/\d{4}$/)||(i=!1),"customUserField"!=e.nodeInfo.ownerAssignmentType||null!=e.nodeInfo.customUserField&&""!=e.nodeInfo.customUserField||(i=!1),"accountTeamAssignment"==e.nodeInfo.ownerAssignmentType){null!=e.nodeInfo.ownerAssignmentValue&&""!=e.nodeInfo.ownerAssignmentValue||(i=!1);var n=!1;_.each(Magellan.Controllers.FlowBuilder.getAccountTeamRules(),function(t){t.Name==="Account Team: "+e.nodeInfo.ownerAssignmentValue&&(n=!0)}),n||(i=!1)}return _.each(e.nodeInfo.opportunityFields,function(e){null!=e.readFieldOrValue&&null!=e.writeField&&""!=e.readFieldOrValue&&0!=e.isValid||(i=!1)}),"explicitOwnerAssignment"==e.nodeInfo.ownerAssignmentType?(null!=e.nodeInfo.ownerAssignmentValue&&""!=e.nodeInfo.ownerAssignmentValue||t.resolve(!1),Magellan.Controllers.FlowBuilder.searchUsers("",[e.nodeInfo.ownerAssignmentValue]).then(function(e){t.resolve(0!==e.length)})):t.resolve(i),t},Magellan.Validation.validateConvert=function(e){var t=Magellan.Validation.validateConvertedLeadStatus(e.nodeInfo["convert status"]),i=1==e.nodeInfo["explicit account conversion"]&&!e.nodeInfo["explicit account id"];return t=t&&!i},Magellan.Validation.validateMergeContact=function(e){return Magellan.Validation.validateConvertedLeadStatus(e.nodeInfo["merge status"])},Magellan.Validation.validateRoundRobin=function(e){var t=window.LeanData__PrimarySObjectType.toLowerCase(),i=e.nodeInfo["round robin group"],n=e.nodeInfo["round robin id"],a={},o={};_.each(actionNodeMetaData.roundRobinGroupingMap[t],function(t){a[t.Id]=t,o[t[actionNodeMetaData.namespace+"Grouping_Name__c"]]=t,(_.isNull(n)||_.isUndefined(n))&&i===t[actionNodeMetaData.namespace+"Grouping_Name__c"]&&(e.nodeInfo["round robin id"]=n=t.Id)},this),valid=!_.isNull(n)&&!_.isUndefined(n),valid=valid&&a[n],a[n]&&(e.nodeInfo["round robin group"]=i=a[n][actionNodeMetaData.namespace+"Grouping_Name__c"]);var l=_.filter(Magellan.Controllers.FlowBuilder.getCustomUserFieldsByObject(LeanData__PrimarySObjectType),function(t){return t.name===e.nodeInfo["assignment field"]});return valid=valid&&o[i]&&(void 0===e.nodeInfo["assignment field"]||"OwnerId"===e.nodeInfo["assignment field"]||l.length>0),valid},Magellan.Validation.validateUpdatePrimary=function(e){var t=!0;_.isEmpty(e.nodeInfo.updates)&&_.isEmpty(e.nodeInfo.assignmentRuleSelection)&&(t=!1);var i=Magellan.Controllers.FlowBuilder.getAssignmentRulesIdMap(LeanData__PrimarySObjectType);return!_.isEmpty(e.nodeInfo.assignmentRuleSelection)&&actionNodeMetaData.allowAssignmentRule&&(t=t&&i.hasOwnProperty(e.nodeInfo.assignmentRuleSelection)),_.each(e.nodeInfo.updates,function(e){if(t=t&&Magellan.Validation.metadataFieldExists(LeanData__PrimarySObjectType,e.field)){var i=Magellan.Controllers.FlowBuilder.getFieldMetaDataMap()[LeanData__PrimarySObjectType][e.field].isNillable&&(null===e.value||""===e.value),n=Magellan.Validation.isValidValueOfType(e.type,e.value);t=t&&(i||n)}}),t},Magellan.Validation.validateExplicitOwnerAssignment=function(e){var t=$.Deferred(),i=_.map(Magellan.Controllers.FlowBuilder.getCustomUserFieldsByObject(LeanData__PrimarySObjectType),function(e){return e.name});if(null==e.nodeInfo.assignmentType||"by user id"==e.nodeInfo.assignmentType){let n="string"==typeof(e.nodeInfo["explicit owner assignment id"]||null)&&(void 0===e.nodeInfo["assignment field"]||"OwnerId"===e.nodeInfo["assignment field"]||_.includes(i,e.nodeInfo["assignment field"]));Magellan.Controllers.FlowBuilder.searchOwners("",[e.nodeInfo["explicit owner assignment id"]],"Lead"!==LeanData__PrimarySObjectType,!0).then(function(e){n=n&&e.length>0,t.resolve(n)})}else if("user field"==e.nodeInfo.assignmentType){let i=!0;i=i&&!_.isEmpty(e.nodeInfo["user field"]),t.resolve(i)}return t},Magellan.Validation.validateEdgeNames=function(e){var t=!0;if(!_.isArray(e.nodeInfo.edges)||e.nodeInfo.edges.length<1)return t;if(!(e instanceof Magellan.Models.DecisionNode))return!0;for(var i={},n=0,a=e.nodeInfo.edges.length;n<a;n++){var o=e.nodeInfo.edges[n];if(o.hasOwnProperty("name")){if(i.hasOwnProperty(o.name)){t=!1;break}i[o.name]=!0}}return t},Magellan.Validation.validateOutreachAddToSequence=function(e){if(partnerAuthorizations.outreach){let t;"specific"===e.nodeInfo.mailboxSelection?t=Magellan.Controllers.FlowBuilder.outreach_validateOutreachUser(e.nodeInfo.userSelection[0]):"owner"===e.nodeInfo.mailboxSelection?(Magellan.Controllers.FlowBuilder.outreach_refreshUsersData(),t=$.Deferred(e=>e.resolve(!0))):"customField"===e.nodeInfo.mailboxSelection&&(t=$.Deferred(t=>t.resolve(""!==e.nodeInfo.customUserField)));const i=Magellan.Controllers.FlowBuilder.outreach_validateOutreachSequence(e.nodeInfo.sequenceSelection[0]);return $.when(t,i).then((e,t)=>e&&t,()=>!1)}return $.Deferred(e=>e.resolve(!1))},Magellan.Validation.validateSalesloftAddToCadence=function(e){if(partnerAuthorizations.salesloft){let t;"specific"===e.nodeInfo.assigneeSelection?t=Magellan.Controllers.FlowBuilder.salesloft_validateSalesloftUser(e.nodeInfo.userSelection[0]):"owner"===e.nodeInfo.assigneeSelection?t=$.Deferred(e=>e.resolve(!0)):"customField"===e.nodeInfo.assigneeSelection&&(t=$.Deferred(t=>t.resolve(""!==e.nodeInfo.customUserField)));const i=Magellan.Controllers.FlowBuilder.salesloft_validateSalesloftCadence(e.nodeInfo.cadenceSelection[0]);return $.when(t,i).then((e,t)=>e&&t,()=>!1)}return $.Deferred(e=>e.resolve(!1))},Magellan.Validation.validateCreateTask=function(e){const t=$.Deferred();if(!e.nodeInfo.assignedToType)return!1;var i=!0,n=!0,a=!0;if(window.graph){var o=Magellan.Validation.getNodesToCurrentNode(e.nodeInfo.name),l=o.matched,s=o.created;i=-1!==l.indexOf(e.nodeInfo.relatedToValue),n=-1!==s.indexOf(e.nodeInfo.relatedToValue),a=-1!==l.indexOf(e.nodeInfo.assignedToValue)}if("relatedToMatched"===e.nodeInfo.relatedToType&&!i)return!1;if("relatedToCreated"===e.nodeInfo.relatedToType&&!n)return!1;if("assignedToMatched"===e.nodeInfo.assignedToType&&!a)return!1;if("assignedToPrimary"===e.nodeInfo.assignedToType||"assignedToMatched"===e.nodeInfo.assignedToType){var r=Magellan.Controllers.FlowBuilder.getCustomUserFieldsByObject(e.nodeInfo.assignedToValue||LeanData__PrimarySObjectType),d=_.isEmpty(e.nodeInfo.userField)?[]:_.filter(r,"name",e.nodeInfo.userField)[0];if(_.isEmpty(e.nodeInfo.userField))return!1;if(!_.isEmpty(e.nodeInfo.userField)&&_.isEmpty(d))return!1}if(!_.isEmpty(e.nodeInfo.dueDate)&&e.nodeInfo.dueDate!==moment(e.nodeInfo.dueDate).format("MM/DD/YYYY"))return!1;var c=!0;_.each(e.nodeInfo.taskFields,function(e){(_.isEmpty(e.readFieldOrValue)||_.isEmpty(e.writeField)||!e.isValid)&&(c=!1)});const u=[];if("assignedToExplicitOwner"===e.nodeInfo.assignedToType){const t=$.Deferred();u.push(t),_.isEmpty(e.nodeInfo.assignedToValue)?(c=!1,t.resolve()):Magellan.Controllers.FlowBuilder.searchUsers("",[e.nodeInfo.assignedToValue],!0).then(function(t){0===(e.nodeInfo.assignedToValue?t:[]).length&&(c=!1)}).always(function(){t.resolve()})}const p=$.Deferred();return u.push(p),Magellan.Controllers.FlowBuilder.getTaskFieldValues().then(function(t){var i=t,n=i.statuses,a=(i.subjects,i.priorities),o=!1,l=_.filter(n,function(t){return t.active||t.value!==e.nodeInfo.taskStatus||(o=!0),t.active&&t.value===e.nodeInfo.taskStatus})[0];_.isEmpty(e.nodeInfo.taskStatus)&&(c=!1),!_.isEmpty(e.nodeInfo.taskStatus)&&o&&(c=!1),!_.isEmpty(e.nodeInfo.taskStatus)&&_.isEmpty(l)&&(c=!1),_.isEmpty(e.nodeInfo.taskSubject)&&(c=!1);var s=!1,r=_.filter(a,function(t){return t.active||t.value!==e.nodeInfo.taskPriority||(s=!0),t.active&&t.value===e.nodeInfo.taskPriority})[0];_.isEmpty(e.nodeInfo.taskPriority)&&(c=!1),!_.isEmpty(e.nodeInfo.taskPriority)&&s&&(c=!1),!_.isEmpty(e.nodeInfo.taskPriority)&&_.isEmpty(r)&&(c=!1)}).always(function(){p.resolve()}),$.when(...u).always(function(){t.resolve(c)}),t},Magellan.Validation.isValidRerouteTimeFrame=function(e,t,i){return e>0||t>0||i>=10},Magellan.Validation.metadataFieldExists=function(e,t){if(_.isEmpty(t))return!1;if(Magellan.Validation._fieldValidationCache||(Magellan.Validation._fieldValidationCache={}),Magellan.Validation._fieldValidationCache[e]||(Magellan.Validation._fieldValidationCache[e]={}),_.isBoolean(Magellan.Validation._fieldValidationCache[e][t]))return Magellan.Validation._fieldValidationCache[e][t];var i=Magellan.Util.convertFieldSelectionStringToArray(t,e,Magellan.Controllers.FlowBuilder.getOptimaFieldMetaDataMap()).length>0;return i=i||Magellan.Util.convertFieldSelectionStringToArray(t,e,Magellan.Controllers.FlowBuilder.getFieldMetaDataMap()).length>0,Magellan.Validation._fieldValidationCache[e][t]=i},Magellan.Models.Node.prototype.isValid=async function(){if(Magellan.Validation.nodeNameToIsValidCache&&Magellan.Validation.nodeNameToIsValidCache.hasOwnProperty(this.nodeInfo.name))return Magellan.Validation.nodeNameToIsValidCache[this.nodeInfo.name];var e=Date.now();if(_.isBoolean(this._isValid)&&e-this._lastValidationTime<1e3)return this._lastValidationTime=e,this._isValid;var t=$.Deferred();const i=[];var n,a,o=!0;if(_.includes(Magellan.Validation.nodesWithMissingMatchTypes,this)&&(o=!1),this instanceof Magellan.Models.AssignOwnerAccount||this instanceof Magellan.Models.ContactRouteToAccount||this instanceof Magellan.Models.OpportunityRouteToAccount)o=o&&Magellan.Validation.validateAccountBasedRouting(this);else if(this instanceof Magellan.Models.AssignOwnerLead)o=o&&Magellan.Validation.validateLeadBasedRouting(this);else if(this instanceof Magellan.Models.AssignOwnerOpportunity)o=o&&Magellan.Validation.validateOpportunityBasedRouting(this);else if(this instanceof Magellan.Models.Convert)o=o&&Magellan.Validation.validateConvert(this);else if(this instanceof Magellan.Models.RoundRobin||this instanceof Magellan.Models.ContactRoundRobin||this instanceof Magellan.Models.AccountRoundRobin||this instanceof Magellan.Models.OpportunityRoundRobin)o=o&&Magellan.Validation.validateRoundRobin(this);else if(this instanceof Magellan.Models.UpdateLead||this instanceof Magellan.Models.UpdateContact||this instanceof Magellan.Models.AccountUpdateAction||this instanceof Magellan.Models.OpportunityUpdateAction)o=o&&Magellan.Validation.validateUpdatePrimary(this);else if(this instanceof Magellan.Models.MergeContact)o=o&&Magellan.Validation.validateMergeContact(this);else if(this instanceof Magellan.Models.CreateAccount)o=o&&Magellan.Validation.validateCreateAccount(this);else if(this instanceof Magellan.Models.CreateOpportunity)o=o&&await Magellan.Validation.validateCreateOpportunity(this);else if(this instanceof Magellan.Models.ExplicitOwnerAssignment||this instanceof Magellan.Models.ContactAssignOwnerAccount||this instanceof Magellan.Models.AccountOwnerAssignment||this instanceof Magellan.Models.OpportunityOwnerAssignment)o=o&&await Magellan.Validation.validateExplicitOwnerAssignment(this);else if(this instanceof Magellan.Models.AccountOwnerMappingRouting)o=o&&Magellan.Validation.validateOwnerMapping(this.nodeInfo["owner mapping"]);else if(this instanceof Magellan.Models.AccountTeamRouting)o=o&&Magellan.Validation.validateAccountTeam(this.nodeInfo["account team rule"]);else if(this instanceof Magellan.Models.AccountUserFieldRouting)o=o&&Magellan.Validation.metadataFieldExists("Account",this.nodeInfo["custom field"]);else if(this instanceof Magellan.Models.TerritoryRouting||this instanceof Magellan.Models.ContactRouteToTerritory||this instanceof Magellan.Models.AccountRouteToTerritory||this instanceof Magellan.Models.OpportunityRouteToTerritory)o=o&&Magellan.Validation.validateTerritoryRouting(this);else if(this instanceof Magellan.Models.CreateTask)o=o&&await Magellan.Validation.validateCreateTask(this);else if(this instanceof Magellan.Models.RerouteNode)o=o&&this.isValidRerouteTimeFrame();else if(this instanceof Magellan.Models.OutreachAddToSequence||this instanceof Magellan.Models.ContactOutreachAddToSequence){const e=$.Deferred();Magellan.Validation.validateOutreachAddToSequence(this).then(function(t){o=o&&t,e.resolve()}),i.push(e)}else if(this instanceof Magellan.Models.SalesloftAddToCadence||this instanceof Magellan.Models.ContactSalesloftAddToCadence){const e=$.Deferred();Magellan.Validation.validateSalesloftAddToCadence(this).then(function(t){o=o&&t,e.resolve()}),i.push(e)}var l=this.get("secondary-object")||Magellan.Views.getAPIObjectNameFromObjectType(this.nodeInfo.objectType);this.get("reversed-condition-operands")?(n=window.LeanData__PrimarySObjectType,a=l):l?(n=l,a=window.LeanData__PrimarySObjectType):n=window.LeanData__PrimarySObjectType,this instanceof Magellan.Models.TriggerNode||!this.nodeInfo.filter||"none"===this.nodeInfo["filter type"]||"conditions"!==this.nodeInfo.filter.type||(o=o&&Magellan.Validation.validateFilterRules(this.nodeInfo.filter,n,a,this.nodeInfo["filter type"])),this.nodeInfo.tiebreakers&&(o=o&&Magellan.Validation.validateTiebreakers(this.nodeInfo.tiebreakers,n,a)),this.nodeInfo.edges&&_.each(this.nodeInfo.edges,function(e){"conditions"===e.type?(o=o&&e.conditions&&e.conditions.length>0,_.each(e.conditions,function(e){o=o&&Magellan.Validation.validateSingleCondition(e,n,a)}),o=o&&0===Magellan.Util.parseLogic(e.conditions.length,e.logic).feedbackMessage.length):"soql"===e.type?o=o&&!_.isEmpty(e.soqlCondition)&&!1!==e.isValid:e.type||(o=!1)}),o=o&&Magellan.Validation.validateEdgeNames(this);var s=function(e){var t=!0;return _.each(e,function(e){Magellan.Util.convertFieldSelectionStringToArray(e.userField,e.objectType,fieldMetaData).length!==e.userField.split(".").length&&(t=!1)},this),t},r=new Set;if(this instanceof Magellan.Models.SendNotification&&!this.nodeInfo.notificationSettings&&(o=!1),this.nodeInfo.notificationSettings&&(this instanceof Magellan.Models.SendNotification?(_.isEmpty(this.nodeInfo.notificationSettings.success)||_.isEmpty(this.nodeInfo.notificationSettings.success.template)||r.add(this.nodeInfo.notificationSettings.success.template),o=o&&!_.isEmpty(this.nodeInfo.notificationSettings.success)&&!_.isEmpty(this.nodeInfo.notificationSettings.success.template)&&Magellan.Util.hasRecipientsData(this.nodeInfo.notificationSettings.success.recipients)&&s(this.nodeInfo.notificationSettings.success.recipients.additionalObjectUserFields)):_.each(["success","failure"],function(e){var t=this.nodeInfo.notificationSettings[e];t&&(_.isEmpty(t.template)||(r.add(t.template),Magellan.Util.hasRecipientsData(t.recipients)||(o=!1)),Magellan.Util.hasRecipientsData(t.recipients)&&(_.isEmpty(t.template)&&(o=!1),o=o&&s(t.recipients.additionalObjectUserFields)))},this),window.graph)){var d=Magellan.Validation.getNodesToCurrentNode(this.nodeInfo.name),c=d.matched,u=d.created;_.each(["success","failure"],function(e){var t=this.nodeInfo.notificationSettings[e];if(t){var i=Magellan.Validation.CREATED_ACTION_TYPE_MAP[this.nodeInfo.actionType];t.recipients.notifyNewObjectOwner&&0===u.length&&!i&&(o=!1),_.each(t.recipients.additionalObjectUserFields,function(e){"matched"===e.contextType?o=o&&-1!==c.indexOf(e.objectType):"created"===e.contextType&&(o=o&&-1!==u.indexOf(e.objectType))},this)}},this)}const p=$.Deferred();return 0===r.size?p.resolve():Magellan.Controllers.FlowBuilder.searchEmailTemplates("",Array.from(r),!0).then(function(e){r.forEach(t=>{let i=_.find(e,e=>e.Id===t);!_.isEmpty(i)&&i.IsActive||(o=!1)})}).always(function(){p.resolve()}),i.push(p),$.when(...i).always(function(){t.resolve(o)}),t},Magellan.Validation.validateFilterRules=function(e,t,i,n){var a=!0;return n=n||e["filter type"],["inclusion","exclusion"].indexOf(n)<0?a:!!(a=a&&!Magellan.Models.criterionEmpty(e)&&!Magellan.Models.criterionInvalid(e))&&(_.each(e.conditions,function(e){a="field"===e["value/field"]?a&&Magellan.Validation.validateFieldTypeCondition(e,t,i):a&&Magellan.Validation.validateValueTypeCondition(e,t)}),a=a&&0===Magellan.Util.parseLogic(e.conditions.length,e.logic).feedbackMessage.length)},Magellan.Validation.validateTiebreakers=function(e,t,i){var n=!0;return _.each(e,function(e){"conditions"===e.type?(n=n&&!Magellan.Models.criterionEmpty(e)&&!Magellan.Models.criterionInvalid(e),_.each(e.conditions,function(e){n=n&&Magellan.Validation.validateSingleCondition(e,t,i)}),n=n&&0===Magellan.Util.parseLogic(e.conditions.length,e.logic).feedbackMessage.length):"soql"===e.type?n=n&&!_.isEmpty(e.soqlCondition)&&!1!==e.isValid:"custom"===e.type?n=n&&Magellan.Validation.validateCustomTiebreaker(e.parameter):"optima"===e.type?n=n&&Magellan.Validation.metadataFieldExists(t,e.field):e.type||(n=!1)}),n},Magellan.Validation.validateSingleCondition=function(e,t,i){var n=!0;return n=n&&e.operator,"value"===e["value/field"]?n=n&&Magellan.Validation.validateValueTypeCondition(e,t):"field"===e["value/field"]&&(n=n&&Magellan.Validation.validateFieldTypeCondition(e,t,i)),n},Magellan.Validation.SFDC_TYPE_TO_GROUPING={ID:"Id",INTEGER:"Number",DOUBLE:"Number",CURRENCY:"Number",PERCENT:"Number",BOOLEAN:"Boolean",STRING:"String",TEXTAREA:"String",PICKLIST:"String",MULTIPICKLIST:"Multipicklist",URL:"String",EMAIL:"String",PHONE:"String",DATE:"Date",DATETIME:"Datetime",ADDRESS:"String",COMBOBOX:"String"},Magellan.Validation.SFDC_VALID_TYPE_MAPPING={FORMULA:["INTEGER","DOUBLE","STRING"],ADDRESS:["STRING"],BOOLEAN:["BOOLEAN"],CURRENCY:["CURRENCY"],DATE:["DATE","DATETIME"],DATETIME:["DATETIME"],EMAIL:["EMAIL","STRING"],GEOLOCATION:["GEOLOCATION"],INTEGER:["INTEGER","DOUBLE"],DOUBLE:["DOUBLE","CURRENCY","PERCENT"],PERCENT:["PERCENT"],PHONE:["PHONE","STRING"],PICKLIST:["PICKLIST","STRING","TEXTAREA"],MULTIPICKLIST:["MULTIPICKLIST"],STRING:["STRING","PICKLIST","EMAIL","URL"],TEXTAREA:["TEXTAREA","STRING","EMAIL","URL"],URL:["URL","STRING"],ID:["ID"],ENCRYPTEDSTRING:["ENCRYPTEDSTRING"]};var e={REPORTING_FIELDS:["reporting_last_run_date__c","reporting_opportunity_source__c","reporting_total_marketing_touches__c","reporting_won_number__c"],LEAD_FIELDS:["a2b_account__c","a2b_group__c","convertedaccountid","convertedcontactid","convertedopportunityid","has_matched__c","marketing_sys_created_date__c","matched_account__c","matched_lead__c","router_status__c","routing_status__c","salesforce_id__c","search_index__c","search__c","reporting_timestamp__c","ld_segment__c","status_info__c","tag__c"],CONTACT_FIELDS:["segment__c","ld_segment__c","tag__c","mailingaddress","otheraddress","leandata__segment__c","leandata__ld_segment__c","leandata__tag__c"],ACCOUNT_FIELDS:["ld_emaildomain__c","ld_emaildomains__c","search__c","reporting_customer__c","reporting_last_marketing_touch_date__c","reporting_last_sales_touch_date__c","scenario_1_owner__c","scenario_2_owner__c","scenario_3_owner__c","scenario_4_owner__c","sla__c","tag__c"],OPPORTUNITY_FIELDS:["reporting_last_run_date__c","ordernumber__c","reporting_won_number__c"],USER_FIELDS:["aboutme","badgetext","defaultgroupnotificationfrequency","digestfrequency","emailencodingkey","fullphotourl","offlinepdatrialexpirationdate","offlinetrialexpirationdate","receivesadmininfoemails","receivesinfoemails","scenario_1_owner__c","scenario_2_owner__c","scenario_3_owner__c","scenario_4_owner__c","scenario_1_owner__r.id","scenario_2_owner__r.id","scenario_3_owner__r.id","scenario_4_owner__r.id","signature","smallphotourl","stayintouchnote","stayintouchsignature","stayintouchsubject","userpermissionscallcenterautologin","userpreferencesapexpagesdevelopermode","userpreferencescachediagnostics","userpreferencescontentemailasandwhen","userpreferencescontentnoemail","userpreferencesdisableallfeedsemail","userpreferencesdisablefeedbackemail","userpreferencesdisableworkemail","userpreferenceseventreminderscheckboxdefault","userpreferenceshidechatteronboardingsplash","userpreferenceshidecsndesktoptask","userpreferenceshidecsngetchattermobiletask","userpreferenceshides1browserui","userpreferenceshidesecondchatteronboardingsplash","userpreferencespathassistantcollapsed","userpreferencesremindersoundoff","userpreferencesshowcitytoguestusers","userpreferencesshowcitytoexternalusers","userpreferencesshowcountrytoexternalusers","userpreferencesshowcountrytoguestusers","userpreferencesshowemailtoguestusers","userpreferencesshowemailtoexternalusers","userpreferencesshowfaxtoexternalusers","userpreferencesshowfaxtoguestusers","userpreferencesshowmanagertoexternalusers","userpreferencesshowmanagertoguestusers","userpreferencesshowpostalcodetoexternalusers","userpreferencesshowpostalcodetoguestusers","userpreferencesshowprofilepictoguestusers","userpreferencesshowstatetoexternalusers","userpreferencesshowstatetoguestusers","userpreferencesshowstreetaddresstoexternalusers","userpreferencesshowstreetaddresstoguestusers","userpreferencesshowtitletoexternalusers","userpreferencesshowtitletoguestusers","userpreferencesshowmobilephonetoexternalusers","userpreferencesshowmobilephonetoguestusers","userpreferencesshowworkphonetoexternalusers","userpreferencesshowworkphonetoguestusers","userpreferencestaskreminderscheckboxdefault"],GROUP_FIELDS:["ownerid","developername","doesincludebosses","doessendemailtomembers"],TASK_FIELDS:["whoid","whatid","subject","status","priority","ownerid","recurrenceregeneratedtype","recurrenceinterval"],CUSTOM_USER_FIELDS:["createdby.id","lastmodifiedby.id","owner.id","createdbyid","lastmodifiedbyid","ownerid"]};if(Magellan.Validation.FIELD_BLACKLIST_SETS={},_.isEmpty(ns))_.each(e,function(t,i){Magellan.Validation.FIELD_BLACKLIST_SETS[i]=new Set(e[i])}),Magellan.Validation.FIELD_BLACKLIST_MAP=e;else{var t={};_.each(e,function(e,i){t[i]=_.map(e,function(e){return e.endsWith("__c")?ns.toLowerCase()+e:e}),Magellan.Validation.FIELD_BLACKLIST_SETS[i]=new Set(t[i])}),Magellan.Validation.FIELD_BLACKLIST_MAP=t}Magellan.Validation.validateValueTypeCondition=function(e,t){if(_.isEmpty(e.field)||!Magellan.Validation.metadataFieldExists(t,e.field))return!1;if("has changed"===e.operator||"is null"===e.operator||"not null"===e.operator)return!0;var i=Magellan.Validation.SFDC_TYPE_TO_GROUPING[e.type],n=Magellan.Views.GROUPING_TO_OPERATORS[i];return!!_.includes(n,e.operator)&&!_.isNull(e.operand)&&!_.isUndefined(e.operand)&&""!==e.operand&&Magellan.Validation.isValidValueOfType(e.type,e.operand)},Magellan.Validation.isValidValueOfType=function(e,t){if(!e)return!1;switch(e.toUpperCase()){case"ID":return _.isString(t)&&_.reduce(t.split(","),function(e,t){var i=t.trim();return e&&(15===i.length||18===i.length)&&/^[a-zA-Z0-9]+$/.test(i)},!0);case"INTEGER":return Math.round(t).toString()===t;case"DOUBLE":return!(_.isString(t)&&_.isEmpty(t.trim())||_.isNaN(Number(t)));case"CURRENCY":case"PERCENT":return/^\d*(?:\.\d*){0,1}$/.test(t);case"BOOLEAN":return _.isBoolean(t)||_.includes(["true","false"],t.toLowerCase());case"STRING":case"COMBOBOX":case"TEXTAREA":case"PICKLIST":case"MULTIPICKLIST":case"URL":case"EMAIL":case"PHONE":case"ADDRESS":return!0;case"DATE":return moment(t,Magellan.Validation.DATE_FORMAT).isValid();case"DATETIME":return moment(t,Magellan.Validation.DATETIME_FORMAT,!0).isValid()}},Magellan.Validation.validateFieldTypeCondition=function(e,t,i){if(_.isEmpty(e.field)||!Magellan.Validation.metadataFieldExists(t,e.field))return!1;var n=Magellan.Validation.SFDC_TYPE_TO_GROUPING[e.type],a=Magellan.Views.GROUPING_TO_OPERATORS[n];return!(!_.includes(a,e.operator)||"is null"!==e.operator&&"not null"!==e.operator&&(_.isEmpty(e.operand)||!Magellan.Validation.metadataFieldExists(i,e.operand)||Magellan.Validation.SFDC_TYPE_TO_GROUPING[e.type]!==Magellan.Validation.SFDC_TYPE_TO_GROUPING[e["operand type"]]))},Magellan.Validation.validateCustomTiebreaker=function(e){return void 0!==e&&null!==e&&""!==e},Magellan.Validation.getRequiredMatchTypes=function(e){var t=[];if(e instanceof Magellan.Models.DecisionNode&&(_.isEmpty(e.nodeInfo.objectType)||"Primary"===e.nodeInfo.objectType||t.push(e.nodeInfo.objectType)),(e instanceof Magellan.Models.AssignOwnerAccount||e instanceof Magellan.Models.Convert&&1!=e.nodeInfo["explicit account conversion"])&&t.push("L2A"),e instanceof Magellan.Models.AssignOwnerLead&&t.push("L2L"),(e instanceof Magellan.Models.TerritoryRouting||e instanceof Magellan.Models.ContactRouteToTerritory||e instanceof Magellan.Models.AccountRouteToTerritory)&&e.nodeInfo.fields){var i=!1,n=!1;_.each(e.nodeInfo.fields,function(e,t){e.startsWith("ld__matched_account")&&(i=!0),e.startsWith("ld__matched_opportunity")&&(n=!0)}),i&&t.push("L2A"),n&&"Lead"===LeanData__PrimarySObjectType&&t.push("L2O"),n&&"Contact"===LeanData__PrimarySObjectType&&t.push("C2O"),n&&"Account"===LeanData__PrimarySObjectType&&t.push("A2O")}return e instanceof Magellan.Models.AssignOwnerOpportunity&&(e instanceof Magellan.Models.ContactRouteToOpportunity?t.push("C2O"):e instanceof Magellan.Models.AccountOpportunityRouting?t.push("A2O"):e instanceof Magellan.Models.OpportunityRouteToOpportunity?t.push("O2O"):t.push("L2O")),e instanceof Magellan.Models.Merge&&t.push("Dupe"),e instanceof Magellan.Models.MergeContact&&t.push("DupeC"),"Lead"===LeanData__PrimarySObjectType&&e instanceof Magellan.Models.MatchNode&&1==e.nodeInfo["restrict l2o to chosen account"]&&t.push("L2A"),e instanceof Magellan.Models.ContactRouteToContact&&t.push("C2C"),e instanceof Magellan.Models.OpportunityRouteToContact&&t.push("O2C"),e instanceof Magellan.Models.CreateOpportunity&&(e instanceof Magellan.Models.ContactCreateOpportunity||e instanceof Magellan.Models.AccountCreateOpportunity||e instanceof Magellan.Models.OpportunityCreateOpportunity||t.push("L2A")),_.uniq(t)},Magellan.Validation.findSetOfCycles=function(e,t){_.each(t,function(t){var i=e.nodeNamesToNodeWrappersMap[t];void 0===i.index&&Magellan.Validation.strongConnect(e,i)});var i=_.filter(e.stronglyConnectedComponents,function(e){return e.length>1}),n=!1,a=_.map(i,function(e){return _.map(e,function(e){return e.nodeReference instanceof Magellan.Models.RerouteNode&&(n=!0),e.nodeReference})});return!0===n?[]:a},Magellan.Validation.strongConnect=function(e,t){t.index=e.index,t.lowLink=e.index,e.index=e.index+1,e.stack.push(t),t.onStack=!0;var i=_.filter(e.edges,function(e){return e.source===t.nodeReference});if(_.each(i,function(i){var n=i.target.nodeInfo.name,a=e.nodeNamesToNodeWrappersMap[n];void 0===a.index?(Magellan.Validation.strongConnect(e,a),t.lowLink=Math.min(t.lowLink,a.lowLink)):a.onStack&&(t.lowLink=Math.min(t.lowLink,a.lowLink))}),t.lowLink===t.index){var n=[];do{var a=e.stack.pop();a.onStack=!1,n.push(a)}while(t!==a);e.stronglyConnectedComponents.push(n)}},Magellan.Validation.findDanglingNodes=function(e,t){var i=Magellan.Util.getContiguousNodeNames(e,t),n=_.difference(_.keys(e),i);return _.map(n,function(t){return e[t]})},Magellan.Validation.MATCH_TYPE_TO_OBJECT_MAP={Primary:"Lead",L2L:"Lead",L2A:"Account",L2O:"Opportunity",Dupe:"Lead",DupeC:"Contact",C2O:"Opportunity",C2C:"Contact",A2O:"Opportunity",O2O:"Opportunity",O2C:"Contact"},Magellan.Validation.MATCH_TYPE_TO_OBJECT_PLURAL_MAP={Primary:"Leads",L2L:"Leads",L2A:"Accounts",L2O:"Opportunities",Dupe:"Leads",DupeC:"Contacts",C2O:"Opportunities",C2C:"Contacts",A2O:"Opportunities",O2O:"Opportunities",O2C:"Contacts"};var i=Object.keys(Magellan.Validation.MATCH_TYPE_TO_OBJECT_MAP),n=Object.assign.apply(null,i.map(function(e){var t={};return t[e]=!1,t})),a=Object.assign.apply(null,i.map(function(e){var t={};return t[e]=!0,t}));Magellan.Validation.CREATED_ACTION_TYPE_MAP={"Account Creation":"Account","Create Opportunity":"Opportunity","Create Task":"Task"};var o=Object.keys(Magellan.Validation.CREATED_ACTION_TYPE_MAP),l=Object.assign.apply(null,o.map(function(e){var t={};return t[e]=!1,t})),s=Object.assign.apply(null,o.map(function(e){var t={};return t[e]=!0,t}));Magellan.Validation.getNodesToCurrentNode=function(e,t){if(!t&&Magellan.Validation.nodeNameToRelatedObjectTypes&&Magellan.Validation.nodeNameToRelatedObjectTypes.hasOwnProperty(e))return Magellan.Validation.nodeNameToRelatedObjectTypes[e];var i={matched:new Set,created:new Set},n=Magellan.Util.getNodeNamesToNodesMap(),a={matchType:void 0,nodeNamesToMatchTypeStatus:{},nodeNamesToCreatedActionTypeStatus:{},nodeNamesToNodesMap:n};return Magellan.Validation.doCyclesExist||Magellan.Validation.findNodesWithMissingMatchTypes(n,a),_.each(a.nodeNamesToMatchTypeStatus[e],function(e,t){e&&i.matched.add(Magellan.Validation.MATCH_TYPE_TO_OBJECT_MAP[t])},this),_.each(a.nodeNamesToCreatedActionTypeStatus[e],function(e,t){e&&i.created.add(Magellan.Validation.CREATED_ACTION_TYPE_MAP[t])},this),i.matched=Array.from(i.matched),i.created=Array.from(i.created),Magellan.Validation.nodeNameToRelatedObjectTypes[e]=i,i},Magellan.Validation.findNodesWithMissingMatchTypes=function(e,t){t=t||{matchType:void 0,nodeNamesToMatchTypeStatus:{},nodeNamesToCreatedActionTypeStatus:{},nodeNamesToNodesMap:e};var i=Magellan.Util.getStartNodeNames(e),a=_.union(i.TriggerNode,i.RerouteNode),o=Magellan.Util.getContiguousNodeNames(e,a),s=[];_.each(a,function(t){var i=e[t],a={nodeNamesToMatchTypeStatus:{},nodeNamesToCreatedActionTypeStatus:{},nodeNamesToNodesMap:e};Magellan.Validation.markMatchTypes(a,i,_.clone(n)),Magellan.Validation.markCreatedActionTypes(a,i,_.clone(l)),s.push(a)}),_.each(s,function(e){_.each(e.nodeNamesToMatchTypeStatus,function(i,n){t.nodeNamesToMatchTypeStatus.hasOwnProperty(n)?_.each(e.nodeNamesToMatchTypeStatus[n],function(e,i){t.nodeNamesToMatchTypeStatus[n][i]=t.nodeNamesToMatchTypeStatus[n][i]&&e}):t.nodeNamesToMatchTypeStatus[n]=e.nodeNamesToMatchTypeStatus[n],!t.nodeNamesToCreatedActionTypeStatus.hasOwnProperty(n)||_.isEmpty(t.nodeNamesToCreatedActionTypeStatus[n])?t.nodeNamesToCreatedActionTypeStatus[n]=e.nodeNamesToCreatedActionTypeStatus[n]:_.each(e.nodeNamesToCreatedActionTypeStatus[n],function(e,i){t.nodeNamesToCreatedActionTypeStatus[n][i]=t.nodeNamesToCreatedActionTypeStatus[n][i]&&e})})});var r=_.filter(o,function(i){var n=e[i],a=Magellan.Validation.getRequiredMatchTypes(n),o=t.nodeNamesToMatchTypeStatus[i];return _.filter(a,function(e){return 0==o[e]}).length>0});return _.map(r,function(t){return e[t]})},Magellan.Validation.markMatchTypes=function(e,t,i){var n=_.isEmpty(e.nodeNamesToMatchTypeStatus);n&&(e.nodeNameToAncestors={});var o=e.nodeNameToAncestors[t.nodeInfo.name]=e.nodeNameToAncestors[t.nodeInfo.name]||new Set,l=_.clone(i);if(e.nodeNamesToMatchTypeStatus[t.nodeInfo.name]||(e.nodeNamesToMatchTypeStatus[t.nodeInfo.name]=_.clone(a)),_.forOwn(l,function(i,n){i||(e.nodeNamesToMatchTypeStatus[t.nodeInfo.name][n]=!1)}),_.each(t.nodeInfo.edges,function(i){var n=e.nodeNameToAncestors[i.target];e.nodeNameToAncestors[i.target]=n=n||new Set,o.forEach(e=>n.add(e)),n.add(t.nodeInfo.name)}),t instanceof Magellan.Models.MatchNode){l[t.nodeInfo.objectType]=!0,"L2O"===t.nodeInfo.objectType&&1!=t.nodeInfo["restrict l2o to chosen account"]&&(l.L2A=!0);var s=_.filter(t.nodeInfo.edges,function(e){return new Set(["Match","Match without Parent","Match (Parent)","Match (Ultimate Parent)"]).has(e.condition)});_.each(s,function(t){var i=t.target;if(!_.isNull(i)&&!_.isUndefined(i)&&-1!==i&&!o.has(i)){var n=e.nodeNamesToNodesMap[i];Magellan.Validation.markMatchTypes(e,n,l)}}),l[t.nodeInfo.objectType]=!1,"L2O"===t.nodeInfo.objectType&&1!=t.nodeInfo["restrict l2o to chosen account"]&&(l.L2A=!1);var r=_.filter(t.nodeInfo.edges,function(e){return"No Match"===e.condition})[0].target;if(!_.isNull(r)&&!_.isUndefined(r)&&-1!==r&&0!==r&&!o.has(r)){var d=e.nodeNamesToNodesMap[r];Magellan.Validation.markMatchTypes(e,d,l)}}else if(!(t instanceof Magellan.Models.RerouteNode)||n){var c={};_.each(t.nodeInfo.edges,function(t){var i=t.target;if(!(c[i]||_.isNull(i)||_.isUndefined(i)||-1===i||0===i||o.has(i))){c[i]=!0;var n=e.nodeNamesToNodesMap[i];Magellan.Validation.markMatchTypes(e,n,l)}})}},Magellan.Validation.markCreatedActionTypes=function(e,t,i){var n=_.isEmpty(e.nodeNamesToCreatedActionTypeStatus);n&&(e.nodeNameToAncestors={});var a=e.nodeNameToAncestors[t.nodeInfo.name]=e.nodeNameToAncestors[t.nodeInfo.name]||new Set,o=_.clone(i);if(e.nodeNamesToCreatedActionTypeStatus[t.nodeInfo.name]||(e.nodeNamesToCreatedActionTypeStatus[t.nodeInfo.name]=_.clone(s)),_.forOwn(o,function(i,n){i||(e.nodeNamesToCreatedActionTypeStatus[t.nodeInfo.name][n]=!1)}),_.each(t.nodeInfo.edges,function(i){var n=e.nodeNameToAncestors[i.target];e.nodeNameToAncestors[i.target]=n=n||new Set,a.forEach(e=>n.add(e)),n.add(t.nodeInfo.name)}),t instanceof Magellan.Models.ActionNode){o[t.nodeInfo.actionType]=!0;var l=_.filter(t.nodeInfo.edges,function(e){return"Next Node"===_.startCase(e.condition)})[0],r=l?l.target:null;if(!_.isNull(r)&&!_.isUndefined(r)&&-1!==r&&0!==r&&!a.has(r)){var d=e.nodeNamesToNodesMap[r];Magellan.Validation.markCreatedActionTypes(e,d,o)}}else if(!(t instanceof Magellan.Models.RerouteNode)||n){var c={};_.each(t.nodeInfo.edges,function(t){var i=t.target;if(!(c[i]||_.isNull(i)||_.isUndefined(i)||-1===i||0===i||a.has(i))){c[i]=!0;var n=e.nodeNamesToNodesMap[i];Magellan.Validation.markCreatedActionTypes(e,n,o)}})}},Magellan.Validation.validateAllNodes=function(e){let t=$.Deferred(),i=[],n={};async function asyncValidateNode(e){let t=$.Deferred();return $.when(...n[e.nodeInfo.name]||[]).then(function(){return e.isValid()}).then(function(n){n.then(function(n){if(n||i.push(e),window.graph instanceof joint.dia.Graph){let t=paper.findViewByModel(e);t&&t.refreshValidationIcons()}Magellan.Validation.nodeNameToIsValidCache&&(Magellan.Validation.nodeNameToIsValidCache[e.nodeInfo.name]=n),t.resolve(n)})}),t}return async function validateNodes(a){let o=new Set,l=new Set,s=$.Deferred(),r=$.Deferred(),d=[];for(const t of a){let i=e[t],a=[];if(i.nodeInfo["explicit owner assignment id"]&&(o.add(i.nodeInfo["explicit owner assignment id"]),a.push(s)),"assignedToExplicitOwner"===i.nodeInfo.assignedToType&&i.nodeInfo.assignedToValue&&(o.add(i.nodeInfo.assignedToValue),a.push(s)),i.nodeInfo.notificationSettings){var c=_.get(i,"nodeInfo.notificationSettings.success.template");c&&l.add(c);var u=_.get(i,"nodeInfo.notificationSettings.failure.template");u&&l.add(u),a.push(r)}_.isEmpty(a)?await asyncValidateNode(i):(n[t]=a,d.push(asyncValidateNode(i)))}Magellan.Controllers.FlowBuilder.searchOwners(null,[...o]).then(function(){return s.resolve()}),Magellan.Controllers.FlowBuilder.searchEmailTemplates(null,[...l]).then(function(){return r.resolve()}),Promise.all(d).then(function(){t.resolve(i),Magellan.Validation.nodeNameToIsValidCache=null})}(Object.keys(e)),t},Magellan.Validation.validateGraph=function(e){Magellan.Validation.nodeNameToIsValidCache={};var t=$.Deferred(),i={},n=[],a=[],o=[],l={},s={},r=[],d=Magellan.Util.getAllNodes(e),c={};if(_.eachRight(d,function(e){var t=e.nodeInfo.name;e instanceof Magellan.Models.TriggerNode&&a.push(t),i[t]=e,s[t]=new function TarjanNodeWrapper(e){this.index=void 0,this.lowLink=void 0,this.onStack=!1,this.nodeReference=e}(e);var l={};_.each(e.nodeInfo.edges,function(e){var t=e.target;if(-1!==t&&0!==t&&!_.isNull(t)&&!_.isUndefined(t)&&!l.hasOwnProperty(t)){var n=l[t]={target:i[t],source:this};_.isObject(i[t])||(_.isArray(c[t])||(c[t]=[]),c[t].push(n)),n.target===n.source&&o.push(n)}},e),Array.prototype.push.apply(n,_.values(l)),c.hasOwnProperty(t)&&(_.each(c[t],function(t){t.target=e,t.target===t.source&&o.push(t)}),delete c[t]),e.getNumberOfDanglingEdges()>0&&r.push(e)}),_.isEmpty(c)||console.warn({message:"Graph JSON contains edges that are targeting non-existing nodes","erroneous edges":c}),o.length>0){var u=o.map(function(e){return e.source.nodeInfo.name});l.specialSelfPointingNodesErrors=u,console.warn("The following nodes have self pointing edges: "+u.join(", "))}var p=new function TarjanContext(e,t){this.index=0,this.stronglyConnectedComponents=[],this.stack=[],this.nodeNamesToNodeWrappersMap=e,this.edges=t}(s,n);if(l.setOfNodeCycles=Magellan.Validation.findSetOfCycles(p,a),l.setOfNodeCycles.length>0)Magellan.Validation.doCyclesExist=!0;else{Magellan.Validation.doCyclesExist=!1,Magellan.Validation.nodeNameToRelatedObjectTypes={};var h=h||{matchType:void 0,nodeNamesToMatchTypeStatus:{},nodeNamesToCreatedActionTypeStatus:{},nodeNamesToNodesMap:i};l.nodesWithMissingMatchTypes=Magellan.Validation.findNodesWithMissingMatchTypes(i,h),_.each(i,function(e,t){var i={matched:new Set,created:new Set};_.each(h.nodeNamesToMatchTypeStatus[t],function(e,t){e&&i.matched.add(Magellan.Validation.MATCH_TYPE_TO_OBJECT_MAP[t])},this),_.each(h.nodeNamesToCreatedActionTypeStatus[t],function(e,t){e&&i.created.add(Magellan.Validation.CREATED_ACTION_TYPE_MAP[t])},this),i.matched=Array.from(i.matched),i.created=Array.from(i.created),Magellan.Validation.nodeNameToRelatedObjectTypes[t]=i}),Magellan.Validation.nodesWithMissingMatchTypes=l.nodesWithMissingMatchTypes}return l.nodesWithDanglingEdges=r,l.danglingNodes=Magellan.Validation.findDanglingNodes(i,a),Magellan.Validation.validateAllNodes(i).then(function(e){l.nodesFailingIsValid=e,t.resolve(l)}),t},Magellan.Validation.generateErrorMessages=function(e){var t=[];if(void 0!==e.danglingNodes&&e.danglingNodes.length>0){var i=_.map(e.danglingNodes,function(e){return e.nodeInfo.name});t.push("Nodes not incorporated into graph: ("+i.join(", ")+")")}if(void 0!==e.specialSelfPointingNodesErrors&&e.specialSelfPointingNodesErrors.length>0&&t.push("Nodes pointing to self: ("+e.specialSelfPointingNodesErrors.join(", ")+")"),void 0!==e.setOfNodeCycles&&e.setOfNodeCycles.length>0){var n=_.map(e.setOfNodeCycles,function(e){return"["+_.map(e,function(e){return e.nodeInfo.name})+"]"}).join("\n");t.push("Nodes in Cycles: ("+n+")")}if(void 0!==e.nodesWithMissingMatchTypes&&e.nodesWithMissingMatchTypes.length>0){var a=_.map(e.nodesWithMissingMatchTypes,function(e){return e.nodeInfo.name});t.push("Nodes without pre-requisite Match Nodes: ["+a.join(", ")+"]")}if(void 0!==e.nodesWithDanglingEdges&&e.nodesWithDanglingEdges.length>0){var o=_.map(e.nodesWithDanglingEdges,function(e){return e.nodeInfo.name});t.push("Nodes with Dangling Edges: ["+o.join(", ")+"]")}if(void 0!==e.nodesFailingIsValid&&e.nodesFailingIsValid.length>0){var l=_.map(e.nodesFailingIsValid,function(e){return e.nodeInfo.name});t.push("Nodes with invalid Node Form Configuration: ["+l.join(", ")+"]")}if(!_.isEmpty(e.nodesWithInvalidTemplates)){var s=_.map(e.nodesWithInvalidTemplates,function(e){var t=e.nodeInfo.notificationSettings;return t.success&&t.success.template?t.success.template:t.failure&&t.failure.template?t.failure.template:void 0});t.push("Email templates are no longer valid: ["+s.join(", ")+"]")}return t.length>0?t.join("\n"):null},Magellan.Validation.generateErrorStylings=function(e){Magellan.Validation.clearHighlightsForEdgesInCycle(),Magellan.Validation.highlightEdgesInCycle(e.setOfNodeCycles)},Magellan.Validation.clearHighlightsForEdgesInCycle=function(){var e=Magellan.Controllers.GUI.getLinks();_.each(e,function(e){e.clearStyles()})},Magellan.Validation.highlightEdgesInCycle=function(e){var t=_.flattenDeep(e),i=Magellan.Controllers.GUI.getLinks();_.each(i,function(e){var i=e.getSourceElement(),n=e.getTargetElement();_.includes(t,i)&&_.includes(t,n)&&e.styleAsError()})},Magellan.Validation.validateOwnerMapping=function(e){var t=Magellan.Controllers.FlowBuilder.getOwnerMappingGroups(),i=_.find(t,function(t){return e===t.Name});return!_.isUndefined(i)&&!_.isNull(i)},Magellan.Validation.validateAccountTeam=function(e){var t=Magellan.Controllers.FlowBuilder.getAccountTeamRules(),i=_.find(t,function(t){return e===t.Name.replace("Account Team: ","")});return!_.isUndefined(i)&&!_.isNull(i)},Magellan.Validation.validateEmailString=function(e){var t=e.match(/[^\s^\n,]+/g),i=!_.isNull(t),n=[],a=[];return i&&(i=t.reduce((e,t)=>{var i=!_.isNull(t.match(new RegExp(".+@.+..+")));return i?n.push(t):a.push(t),e&&i},!0)),{isValid:i&&t.length===n.length,validEmails:n,invalidEmails:a}}}},function(e,t,i){e.exports=function(e,t,n){Magellan.Views.Home=i(243)(),Magellan.Models.Home=i(242)();const a=new Magellan.Views.Home({model:new Magellan.Models.Home,routingMetrics:e,startDate:t,endDate:n});$(".dg_inner-wrapper").html(a.$el)}},function(e,t,i){e.exports=function(){if(i(250)(),i(252)(),i(251)(),i(247)(),i(246)(),i(245)(),Magellan.Views.MatchSettings=i(248)(),Magellan.Models.MatchSettings=i(249)(),"taggingSettings"===magellanPage){var e=window.taggingResources||Magellan.Migration.defaultTaggingSettings,t=new Magellan.Views.TaggingSettings({model:e});j$(".dg_inner-wrapper").empty(),t.delegateEvents(),j$(".dg_inner-wrapper").append(t.render().$el)}else if("matching-mapped-account-fields"===magellanPage){var n=new Magellan.Views.MappedAccountFields({});j$(".dg_inner-wrapper").html(n.render().$el)}else if("matchSettings"===magellanPage){window.LeanData__MatchSettings=new Magellan.Views.MatchSettings,j$(".dg_inner-wrapper").html(window.LeanData__MatchSettings.render().$el);var a=new Magellan.Models.MatchSettings,o=Magellan.Controllers.GUI.appWaitingScreen.show("Loading...");a.fetch().then(function(){window.LeanData__MatchSettings.setModel(a),o.resolve()})}}},function(e,t,i){e.exports=function(e){Magellan.Views.PartnerApps=i(405)(),Magellan.Models.PartnerApps=i(404)();let t=new Magellan.Views.PartnerApps({model:new Magellan.Models.PartnerApps,metadata:e});$(".dg_inner-wrapper").html(t.$el)}},function(e,t,i){e.exports=function(e,t,n){Magellan.Views.RoutingMetrics=i(410)(),Magellan.Models.RoutingMetrics=i(409)();e=new Magellan.Views.RoutingMetrics({model:new Magellan.Models.RoutingMetrics,routingMetrics:e,startDate:t,endDate:n});$(".dg_inner-wrapper").html(e.$el)}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(253)),initialize:function(e){this.listenTo(this.model,"renderErrorView",this.render),this.model.set("nonErrorSet",new Set(["total batches","failed batches","batch size","num records","runtime","run type","start time","end time","num failures","start time string","end time string","batchName","last opp ids"])),this.render()},events:{"click #runSummaryLink":"returnToSummary"},render:function(){var e=this.model.get("history")[this.model.get("viewErrorIndex")],t=0;_.each(e.Batch_Summary__c,function(e,i){t+=e["num failures"]||0});var i=this.template({model:this.model.toJSON(),log:e,numErrors:t,nonErrorSet:this.model.get("nonErrorSet")});this.$el.html(i);var n=Object.keys(e.Batch_Summary__c);return n.unshift("All"),this.batchErrorDropdown=new Magellan.Views.LDDropdown({required:!1,value:null,options:n,size:"large",placeholder:"Batch - All",onChange:function(e){this.filterBatchErrors(e)}.bind(this)}),this.$el.find("#batchErrorDropdown").html(this.batchErrorDropdown.$el),_.defer(this.renderTable.bind(this),e),this},renderTable:function(e){var t=[],i=this.model.get("nonErrorSet");_.each(e.Batch_Summary__c,function(e,n){_.each(e,function(e,a){i.has(a)||t.push({batchName:n,errorMsg:a,numOccurences:e})})}),delete e.Attribution_Errors__c["last opp ids"],_.each(e.Attribution_Errors__c,function(e,i){t.push({batchName:"Opportunity Attribution",oppId:i,errorMsg:e,numOccurences:1})}),this.errorViewTable=this.$el.find("#errorViewTable").DataTable({searching:!0,ordering:!1,paging:!0,pageLength:100,info:!0,dom:"tip",createdRow:function(e,t,i){$(e).attr("data-batch",t.batchName),$(e).attr("data-index",i)},columns:[{title:"Batch Name",data:"batchName"},{title:"Opportunity Id",data:"oppId",render:function(e,t,i,n){return e||""}},{title:"Error Message",data:"errorMsg"},{title:"Number Occurences",data:"numOccurences"}],data:t})},filterBatchErrors:function(e){"All"===e?this.errorViewTable.columns(0).search("").draw():this.errorViewTable.columns(0).search(e).draw()},returnToSummary:function(){this.model.trigger("returnToSummary")}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({})}},function(e,t,i){e.exports=function(){const e=i(65)(),t="MM/DD/YYYY, h:mm A",n=_.template(i(254));return Backbone.View.extend({template:_.template(i(255)),events:{"click .summaryRow":"toggleSubrows","click .viewErrorButton":"viewErrors","click #oneTimeAttributionButton":"startOneTimeAttribution","click #emailNotificationCheckbox":"toggleEmailInput","click .cancelRunButton":"abortCurrentOneTimeRun"},initialize:function(){this.processLogs(),this.model.set("onSummaryView",!0),this.listenTo(this.model,"returnToSummary",this.returnToSummary)},render:function(){var e=this.template({model:this.model.toJSON()});this.$el.html(e),this.runTypeDropdown=new Magellan.Views.LDDropdown({required:!1,options:["All","One-Time","Scheduled"],placeholder:"Run Type - All",value:null,size:"large",onChange:function(e){this.filterRunType(e)}.bind(this)}),this.$el.find("#runTypeDropdown").html(this.runTypeDropdown.$el);const t=this.model.get("emailList");return t.length>0&&t[0].Value__c&&(this.$el.find("#emailNotificationCheckbox").prop("checked",!0),this.$el.find("#emailInput").val(t[0].Value__c),this.$el.find("#emailInput").show()),_.defer(this.renderTable.bind(this)),this},renderTable:function(){this.runSummaryTable=this.$el.find("#attributionRunSummaryTable").DataTable({ordering:!1,paging:!0,pageLength:10,info:!0,dom:"tip",createdRow:function(e,t,i){$(e).attr("data-type",t.Run_Type__c),$(e).attr("data-index",i),$(e).attr("class","hover-row summaryRow")},columns:[{title:"",width:"30px",className:"expandArrow",render:function(){return""}},{title:"Type",data:"Run_Type__c",render:function(e,t,i,n){return e||""}},{title:"Start",width:"160px",data:"Run_Start__c"},{title:"End",width:"160px",data:"Run_End__c"},{title:"Run Time",data:"Run_Time"},{title:"Errors",width:"100px",data:"Batches_With_Errors__c"},{title:"User",data:"User__r.Name"},{render:function(e,t,i,n){return 0===n.row&&this.model.get("hasActiveJobs")?'<div class="cancelRunButton ld-secondary-small-button">Cancel Run</div>':'<div class="viewErrorButton ld-secondary-small-button" data-index="'+n.row+'">View Errors</div>'}.bind(this)}],data:this.model.get("history")}),this.$el.find("#attributionRunSummaryTable").on("page.dt search.dt",function(){this.$el.find("#attributionRunSummaryTable tr.summaryRow td.expandedArrow").removeClass("expandedArrow").addClass("expandArrow")}.bind(this))},renderErrorView:function(){this.errorView?this.model.trigger("renderErrorView"):(this.errorView=new e({model:this.model}),this.$el.find("#runErrorView").html(this.errorView.$el))},filterRunType:function(e){"All"===e?this.runSummaryTable.columns(1).search("").draw():this.runSummaryTable.columns(1).search(e).draw()},toggleEmailInput:function(e){this.$el.find("#emailInput").slideToggle()},toggleSubrows:function(e){var i=$(e.currentTarget),a=i.attr("data-index");if(!i.next("tr").hasClass("summarySubrow")){var o=this.model.get("history")[a].Batch_Summary__c;_.each(o,function(e,i){e.batchName=i,e["start time string"]=e["start time"]?Magellan.Util.formatMomentDate(1e3*e["start time"],t,!0):"-",e["start time"]?e["end time string"]=e["end time"]?Magellan.Util.formatMomentDate(1e3*e["end time"],t,!0):"-":e["end time string"]="-"});var l=Object.values(o);l.sort(function(e,t){return e["start time"]-t["start time"]}),_.each(l,function(e,t){var o;o=e["num failures"]&&e["num failures"]>0,i.after(n({hasFailures:o,batch:e,summaryIndex:a}))})}i.find("td.expandArrow").length?(i.find("td.expandArrow").removeClass("expandArrow").addClass("expandedArrow"),i.siblings("tr[data-index='"+a+"']").show()):(i.find("td.expandedArrow").removeClass("expandedArrow").addClass("expandArrow"),i.siblings("tr[data-index='"+a+"']").hide())},viewErrors:function(e){e.stopImmediatePropagation();const t=$(e.currentTarget);this.model.set("viewErrorIndex",t.attr("data-index")),this.renderErrorView(),this.$el.find("#runSummaryView").hide(),this.$el.find("#runErrorView").show()},returnToSummary:function(){this.$el.find("#runErrorView").hide(),this.$el.find("#runSummaryTable tr.summarySubrow").hide(),this.$el.find("#runSummaryTable tr.summaryRow td.expandedArrow").removeClass("expandedArrow").addClass("expandArrow"),this.$el.find("#runSummaryView").show()},processLogs:function(){_.each(this.model.get("history"),function(e,i){e.Run_Time=e.Run_End__c?Magellan.Util.convertMSToHoursMinutes(e.Run_End__c-e.Run_Start__c):"&mdash;",e.Run_Start__c=Magellan.Util.formatMomentDate(e.Run_Start__c,t,!0),e.Run_End__c?e.Run_End__c=e.Run_End__c?Magellan.Util.formatMomentDate(e.Run_End__c,t,!0):"IN PROGRESS":e.Run_End__c=0!=i?"ABORTED/ERRORED":this.model.get("hasActiveJobs")?"IN PROGRESS":"ABORTED/ERRORED",e.Batches_With_Errors__c?e.Batches_With_Errors__c=e.Batches_With_Errors__c+(1===e.Batches_With_Errors__c?" Batch":" Batches"):e.Batches_With_Errors__c="0 Batches",e.Batch_Summary__c=e.Batch_Summary__c?JSON.parse(e.Batch_Summary__c):{},e.Attribution_Errors__c=e.Attribution_Errors__c?JSON.parse(e.Attribution_Errors__c):{}},this)},startOneTimeAttribution:function(){var e=null;if(this.$el.find("#emailNotificationCheckbox").prop("checked"))for(var t of e=this.$el.find("#emailInput").val().replace(/\s/g,"").split(",")){if(!Magellan.Util.isValidEmail(t))return void new Magellan.Views.ConfirmationModal({header:"Attribution One-Time Run",message:"Invalid email list",primaryButtonText:"Ok",hideSecondaryButton:!0}).open()}new Magellan.Views.ConfirmationModal({header:"Start One-Time Run?",message:"Begin a full Multi-Touch Attribution run based on current product settings. This will recalculate all current Attribution and Marketing Touch object values.",primaryButtonText:"Yes, Continue with Run",hideSecondaryButton:!1,onConfirmed:function(){Magellan.Services.Attribution.startOneTimeAttribution(e).then(function(e,t){new Magellan.Views.ConfirmationModal({header:"Attribution One-Time Run",message:"One-Time run has started",primaryButtonText:"Ok",hideSecondaryButton:!0}).open()}.bind(this))}}).open()},abortCurrentOneTimeRun:function(e){e.stopImmediatePropagation(),Magellan.Services.Attribution.abortCurrentOneTimeRun().then(function(e,t){var i="";i=e?"Attribution Run successfully Aborted":"Cannot abort current Attribution Run, deletion of old Marketing Touch Rows may have begun.",new Magellan.Views.ConfirmationModal({header:"Abort Attribution Run",message:i,primaryButtonText:"Ok",hideSecondaryButton:!0}).open()}.bind(this))}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(256)),initialize:function(e){this.listenTo(this.model,"renderDetailView",this.render),this.render()},events:{"click .categoryLink":"viewCategoryDetail","click #detailViewLink":"returnToDetailView"},render:function(){var e=this.template({model:this.model.toJSON(),formatMomentDate:Magellan.Util.formatMomentDate,dateFormat:"MM/DD/YYYY, h:mm A"});return this.$el.html(e),this},viewCategoryDetail:function(e){var t=$(e.currentTarget);this.model.set("selectedComparisonObj",this.model.get("settingsComparisonObjs")[t.attr("index")]),this.model.set("viewSpecificSettingCategory",!0),this.render()},returnToDetailView:function(){this.model.set("viewSpecificSettingCategory",!1),this.render()}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({defaults:{viewSpecificSettingCategory:!1,descriptionMap:{"Campaign Type Weighting":"Campaign Type Weight","Campaign Member Status Weighting":"Campaign Member Status Weight","Custom Field Mappings":"Field Mappings","Opportunity Stage Mappings":"Opportunity Stage Mappings","Campaign Costs":"Default Costs","Dashboard Attribution Settings":"Sales Task Type<br>Sales Task Status<br>Sales Events<br>Opportunity Stage Mapping","Wizard Unchecked Campaigns":"Excluded Campaigns<br>Excluded Campaign Member Status","Attribution Wizard":"Campaign Type<br>Lead Status<br>Opportunity Type<br>Opportunity Stage<br>Campaign Member Status<br>Scheduling","Custom Filters":"Custom Filters","Reporting Scheduler":"Scheduled Attribution Run Time","Custom Tuples":"Custom Tuples"}}})}},function(e,t,i){e.exports=function(){var e=i(68)();return Backbone.View.extend({template:_.template(i(257)),events:{"click .ld-secondary-small-button.viewLog":"viewLogDetail","click #summaryViewLink":"returnToSummary"},initialize:function(){},render:function(){var e=this.template({model:this.model.toJSON(),formatMomentDate:Magellan.Util.formatMomentDate,dateFormat:"MM/DD/YYYY, h:mm A"});this.$el.html(e);var t=Object.keys(this.model.get("descriptionMap")).sort();return t.unshift("All"),this.settingsPageDropdown=new Magellan.Views.LDDropdown({required:!1,options:t,placeholder:"Display - All Settings",onChange:function(e){this.filterSettingsPage(e)}.bind(this)}),this.$el.find("#settingsPageDropdown").html(this.settingsPageDropdown.$el),_.defer(this.renderTable.bind(this)),this},renderTable:function(){var e=this.model.get("descriptionMap");this.settingsSummaryTable=this.$el.find("#settingsSummaryTable").DataTable({ordering:!1,paging:!0,pageLength:10,info:!0,dom:"tip",createdRow:function(e,t,i){$(e).addClass("hover-row summaryRow")},columns:[{title:"Setting Page",data:"Settings_Page__c"},{title:"Description",render:function(t,i,n,a){return e[n.Settings_Page__c]||""}},{title:"User",width:"150px",data:"User__r.Name"},{title:"Date",width:"150px",render:function(e,t,i,n){return Magellan.Util.formatMomentDate(i.CreatedDate,"MM/DD/YYYY, h:mm A",!0)}},{title:"",width:"120px",render:function(e,t,i,n){return'<div class="viewLog ld-secondary-small-button" data-index="'+n.row+'">View Logs</div>'}}],data:this.model.get("history")})},filterSettingsPage:function(e){"All"===e?this.settingsSummaryTable.columns(0).search("").draw():this.settingsSummaryTable.columns(0).search(e).draw()},viewLogDetail:function(e){var t=$(e.currentTarget);this.parseSettingsLogRow(this.model.get("history")[t.attr("data-index")])},renderDetailView:function(){this.detailView?(this.model.set("viewSpecificSettingCategory",!1),this.model.trigger("renderDetailView")):(this.detailView=new e({model:this.model}),this.$el.find("#logDetailView").html(this.detailView.$el)),this.$el.find("#logSummaryView").hide(),this.$el.find("#logDetailView").show()},returnToSummary:function(){this.$el.find("#logSummaryView").show(),this.$el.find("#logDetailView").hide()},parseSettingsLogRow:function(e){this.model.set("selectedLog",e);const t=JSON.parse(e.Old_Settings__c.replace(/LeanData__/g,"")),i=JSON.parse(e.Updated_Settings__c.replace(/LeanData__/g,""));var n={},a={};if(-1!==e.Settings_Page__c.indexOf("Campaign Type Weighting")){for(var o=0;o<t.length;o++)-1!==t[o].Category__c.indexOf("Setting Switch")?n[t[o].Category__c]=t[o].Value__c:n[t[o].Category__c]=JSON.parse(t[o].Value__c);for(o=0;o<i.length;o++)-1!==i[o].Category__c.indexOf("Setting Switch")?a[i[o].Category__c]=i[o].Value__c:a[i[o].Category__c]=JSON.parse(i[o].Value__c)}else if(-1!==e.Settings_Page__c.indexOf("Campaign Member Status Weighting")){for(o=0;o<t.length;o++)-1!==t[o].Category__c.indexOf("Setting Switch")?n[t[o].Category__c]=t[o].Value__c:Object.assign(n,JSON.parse(t[o].Value__c));for(o=0;o<i.length;o++)-1!==i[o].Category__c.indexOf("Setting Switch")?a[i[o].Category__c]=i[o].Value__c:Object.assign(a,JSON.parse(i[o].Value__c))}else if(-1!==e.Settings_Page__c.indexOf("Custom Field Mappings")){for(o=0;o<t.length;o++)t[o].Value__c&&("Campaign Member To Marketing Touch Mapping"===t[o].Category__c?n[t[o].Category__c]=JSON.stringify(t[o].Value__c):n[t[o].Category__c]=t[o].Value__c);for(o=0;o<i.length;o++)i[o].Value__c&&("Campaign Member To Marketing Touch Mapping"===i[o].Category__c?a[i[o].Category__c]=JSON.stringify(i[o].Value__c):a[i[o].Category__c]=i[o].Value__c)}else if(-1!==e.Settings_Page__c.indexOf("Opportunity Stage Mappings")){for(o=0;o<t.length;o++)n[t[o].Value__c]?n["Stages that map to "+t[o].Value__c]=n[t[o].Value__c].concat(JSON.parse(t[o].Value_2__c)):n["Stages that map to "+t[o].Value__c]=JSON.parse(t[o].Value_2__c);for(o=0;o<i.length;o++)a[i[o].Value__c]?a["Stages that map to "+i[o].Value__c]=a[i[o].Value__c].concat(JSON.parse(i[o].Value_2__c)):a["Stages that map to "+i[o].Value__c]=JSON.parse(i[o].Value_2__c)}else if(-1!==e.Settings_Page__c.indexOf("Campaign Costs"))t[0]&&(n=JSON.parse(t[0].Value__c)),i[0]&&(a=JSON.parse(i[0].Value__c));else if(-1!==e.Settings_Page__c.indexOf("Custom Filters")){for(o=0;o<t.length;o++)t[o].Value__c&&(n[t[o].Category__c.slice(7)]=t[o].Value__c.slice(6));for(o=0;o<i.length;o++)i[o].Value__c&&(a[i[o].Category__c.slice(7)]=i[o].Value__c.slice(6))}else if(-1!==e.Settings_Page__c.indexOf("Dashboard Attribution Settings")){var l=[];for(o=0;o<t.length;o++)if(-1!==t[o].Category__c.indexOf("Include"))n[t[o].Category__c]="null"!==t[o].Value__c?JSON.parse(t[o].Value__c):[];else if("Custom Opportunity Stage"===t[o].Category__c)for(var s=JSON.parse(t[o].Value_2__c),r=0;r<s.length;r++)l.push(s[r]+" -> "+t[o].Value__c);else n[t[o].Category__c]=t[o].Value__c;n["Opportunity Stage Mappings"]=l,l=[];for(o=0;o<i.length;o++)if(-1!==i[o].Category__c.indexOf("Include"))a[i[o].Category__c]="null"!==i[o].Value__c?JSON.parse(i[o].Value__c):[];else if("Custom Opportunity Stage"===i[o].Category__c)for(s=JSON.parse(i[o].Value_2__c),r=0;r<s.length;r++)l.push(s[r]+" -> "+i[o].Value__c);else a[i[o].Category__c]=i[o].Value__c;a["Opportunity Stage Mappings"]=l}else if(-1!==e.Settings_Page__c.indexOf("Wizard Unchecked Campaigns")){for(o=0;o<i.length;o++)if("Exclude Campaign"===i[o].Category__c)a[i[o].Category__c]=JSON.parse(i[o].Value__c);else if("Campaign Member Status By Campaign Type Exclusion"===i[o].Category__c){var d=[];for(var c in cmsExclusionMap=JSON.parse(i[o].Value__c),cmsExclusionMap){var u=cmsExclusionMap[c];for(r=0;r<u.length;r++)d.push(u[r]+": "+c)}a["Campaign Member Status Exclusions"]=d}else a[i[o].Category__c]=i[o].Value__c;for(o=0;o<t.length;o++)if("Exclude Campaign"===t[o].Category__c)n[t[o].Category__c]=JSON.parse(t[o].Value__c);else if("Campaign Member Status By Campaign Type Exclusion"===t[o].Category__c){d=[];for(var c in cmsExclusionMap=JSON.parse(t[o].Value__c),cmsExclusionMap)for(u=cmsExclusionMap[c],r=0;r<u.length;r++)d.push(u[r]+": "+c);n["Campaign Member Status Exclusions"]=d}else n[t[o].Category__c]=t[o].Value__c;this.queryCampaignsAndCompare(n,a)}else if(-1!==e.Settings_Page__c.indexOf("Attribution Wizard")){for(o=0;o<i.length;o++)-1!==i[o].Category__c.indexOf("Include")||-1!==i[o].Category__c.indexOf("Exclude")?a[i[o].Category__c]=JSON.parse(i[o].Value__c):i[o].Value__c?a[i[o].Category__c]=i[o].Value__c:a[i[o].Category__c]="empty";for(o=0;o<t.length;o++)-1!==t[o].Category__c.indexOf("Include")||-1!==t[o].Category__c.indexOf("Exclude")?n[t[o].Category__c]=JSON.parse(t[o].Value__c):t[o].Value__c?n[t[o].Category__c]=t[o].Value__c:n[t[o].Category__c]="empty"}else if(-1!==e.Settings_Page__c.indexOf("Custom Tuples")){for(o=0;o<t.length;o++)if(t[o].Value__c){let e=JSON.parse(t[o].Value__c);e.conditions=JSON.stringify(e.conditions),e.rpnLogic=JSON.stringify(e.rpnLogic),n[t[o].Category__c]=e}for(o=0;o<i.length;o++)if(i[o].Value__c){let e=JSON.parse(i[o].Value__c);e.conditions=JSON.stringify(e.conditions),e.rpnLogic=JSON.stringify(e.rpnLogic),a[i[o].Category__c]=e}}else{for(o=0;o<t.length;o++)t[o].Value__c&&(n[t[o].Category__c]=t[o].Value__c);for(o=0;o<i.length;o++)i[o].Value__c&&(a[i[o].Category__c]=i[o].Value__c)}-1===e.Settings_Page__c.indexOf("Wizard Unchecked Campaigns")&&this.compareSettings(n,a)},compareSettings:function(e,t){var i=[],n=[],a=[],o=[];for(var l in t)if(t[l]instanceof Array){var s=[],r=[],d=[];if(void 0!==e[l]&&null!==e[l]){t[l];this.arrayDiff(e[l],t[l],r,s,d)}else for(var c=0;c<t[l].length;c++)s.push(t[l][c]);o.push({addedSettings:s,removedSettings:r,overlapSettings:d,name:l})}else if("object"==typeof t[l]&&null!==t[l]){var u=t[l],p=[],h=[],g=[];for(var m in u)e[l]&&void 0!==e[l][m]&&null!==e[l][m]?t[l][m]!==e[l][m]?(h.push(m+": "+e[l][m]),p.push(m+": "+t[l][m])):g.push(m+": "+t[l][m]):p.push(m+": "+t[l][m]);o.push({addedSettings:p,removedSettings:h,overlapSettings:g,name:l})}else void 0!==e[l]&&null!==e[l]?t[l]!==e[l]?(i.push(l+": "+t[l]),n.push(l+": "+e[l])):a.push(l+": "+t[l]):i.push(l+": "+t[l]);for(var l in e)if(void 0===t[l]||null===t[l])if(e[l]instanceof Array){for(r=[],c=0;c<e[l].length;c++)r.push(e[l][c]);o.push({addedSettings:[],removedSettings:r,overlapSettings:[],name:l})}else if("object"==typeof e[l]){u=e[l],h=[];for(var m in u)h.push(m+": "+e[l][m]);o.push({addedSettings:[],removedSettings:h,overlapSettings:[],name:l})}else n.push(l+": "+e[l]);o.sort(function(e,t){return e.name.localeCompare(t.name)}),o.push({addedSettings:i,removedSettings:n,overlapSettings:a,name:"General"}),this.model.set("settingsComparisonObjs",o),this.renderDetailView()},queryCampaignsAndCompare:function(e,t){var i=Magellan.Controllers.GUI.appWaitingScreen.show("Loading Data...");Magellan.Services.Attribution.queryCampaigns(e["Exclude Campaign"]||[],t["Exclude Campaign"]||[]).then(function(n,a){e["Excluded Campaigns"]=n["old campaigns"],delete e["Exclude Campaign"],t["Excluded Campaigns"]=n["updated campaigns"],delete t["Exclude Campaign"],this.compareSettings(e,t),i.resolve()}.bind(this))},arrayDiff:function(e,t,i,n,a){for(var o,l={},s={},r=0;r<e.length;r++)l[e[r]]?l[e[r]]++:l[e[r]]=1;for(r=0;r<t.length;r++)s[t[r]]?s[t[r]]++:s[t[r]]=1;for(var d in l)if(s[d])if((o=s[d]-l[d])>0){for(r=0;r<o;r++)n.push(d);for(r=0;r<l[d];r++)a.push(d)}else if(o<0){for(r=0;r<-o;r++)i.push(d);for(r=0;r<s[d];r++)a.push(d)}else for(r=0;r<l[d];r++)a.push(d);else for(r=0;r<l[d];r++)i.push(d);for(var d in s)if(!l[d])for(r=0;r<s[d];r++)n.push(d)}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({defaults:{cardInfo:[],legendInfo:[],lineClasses:["primary-line","tertiary-line"]}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({className:"additional-recipients-wrapper",template:_.template(i(260)),events:{"click .add-additional-recipient-button":"_addAdditionalRecipientRow","click .remove-additional-recipient-row":"_removeAdditionalRecipientRow"},initialize:function(e){this.additionalObjects=e.additionalObjects,this._getAdditionalObjectsLabels=e._getAdditionalObjectsLabels;var t=_.map(Magellan.Controllers.FlowBuilder.getObjectContextDropdownOptions(this.model.get("primaryObjectType"),this.model.get("matchedObjectTypes"),this.model.get("createdObjectTypes")),function(e){return e.label},this);this.contextOptionsSet=new Set(t),this.render()},getSelections:function(){return this.additionalObjects},_addAdditionalRecipientRow:function(e){if(this.additionalObjectsTypeahead.validate()){var t=_.cloneDeep(this.additionalObjectsTypeahead.selection);this.additionalObjects.push({userField:Magellan.Util.convertFieldSelectionArrayToString(t.slice(1)),objectType:t[0].objectType,contextType:t[0].contextType.toLowerCase()}),this.render()}},_removeAdditionalRecipientRow:function(e){var t=$(e.target).data("index");this.additionalObjects.splice(t,1),this.model.set("additionalObjectUserFields",this.additionalObjects),this.render()},render:function(){var e=this.template({additionalObjectsLabels:this._getAdditionalObjectsLabels(this.additionalObjects)});this.$el.html(e);var t=Magellan.Util.createUserFieldsFilter(),i=Magellan.Util.createOwnerToOwnerMappingFilter();return this.additionalObjectsTypeahead=new Magellan.Views.NestedTypeaheadSelector({required:!1,root:"Object",data:this.model.get("fieldMetaData"),filter:e=>{var n=e[0]?e[0].objectType:"";return e=Magellan.Util.createBlacklistFilter(n)(e=_.filter(e,e=>!e.contextType||this.contextOptionsSet.has(e.label),this)),e=t(e),e=i(e)},customValidationFunction:function(){var e=this.selection[this.selection.length-1],t=e&&e.parent&&e.parent.length>0&&"REFERENCE"===e.type;return this.selection.length>1&&!t}}),this.$el.find(".additional-recipient-typeahead").html(this.additionalObjectsTypeahead.$el),this}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({initialize:function(e){this.set(Magellan.Util.getDefaultNotificationSettings().recipients),this.set(e),this.set("matchedObjectTypes",e.matchedObjectTypes||[]),this.set("showOwnerOptions",!_.isBoolean(e.notifyOwners)||e.notifyOwners),this.set("showAdditionalObjectUserOptions",!_.isBoolean(e.notifyAdditionalObjectUsers)||e.notifyAdditionalObjectUsers),this.set("emails",e.emails||[]),this.originalModel=_.cloneDeep(this.toJSON());var t=Object.keys(Magellan.Util.getDefaultNotificationSettings().recipients);this.on("change",()=>{Magellan.Validation.hasDirtyFormComponent=!t.reduce((e,t)=>e&&_.isEqual(this.originalModel[t],this.get(t)),!0)})}})}},function(e,t,i){e.exports=function(){var e=i(72)();return Backbone.View.extend({className:"email-recipient-selector-wrapper",template:_.template(i(261)),events:{"click .edit-recipients-button":"_showEditor","click .save-receipients-button":"_hideEditor","click .notif-owner-checkbox":"_toggleOwner","input .emails-text-area":"_emailTextareaHandler","click .subcontent-toggle":"_toggleSubcontentForm"},initialize:function(e){e=e||{},this.editMode=e.editMode||!1,this.onSaveCallback=_.isFunction(e.onSave)?e.onSave:_.noop,this.emailRecipientLimit=Magellan.Validation.EMAIL_RECIPIENT_LIMIT||20,this.model=new Magellan.Models.EmailRecipientSelector(e),this.model.set("fieldMetaData",fieldMetaData),this._processAdditionalObjectUserFields()},_processAdditionalObjectUserFields:function(){var e={},t={};_.each(Magellan.Util.objectTypes,function(i){var n=_.cloneDeep(Magellan.Controllers.FlowBuilder.getFlattenedFieldsByObject(i));e[i]=_.filter(n,function(e){if(!Magellan.Validation.FIELD_BLACKLIST_SETS.USER_FIELDS.has(e.name)&&_.contains(e.parent,"User")){if(e.name.endsWith("id")){var t=e.name.length-2;e.name=e.name.substr(0,t)+"."+e.name.substr(t)}else e.name=e.name.replace("__c","__r.id");return!0}return!1}),t[i]=_.indexBy(e[i],"name")},this),this.model.set("userFieldOptions",e),this.model.set("userFieldOptionsMap",t),this.matchedObjectData=new Set,this.matchedObjectDropdownViews={},this.additionalObjects=[],_.each(this.model.get("additionalObjectUserFields"),function(e){var t=2===e.userField.split(".").length&&e.userField.endsWith(".id");"matched"===e.contextType&&_.isEmpty(this.matchedObjectDropdownViews[e.objectType])&&t?(this._createMatchedUserFieldDropdown(e.objectType,e.userField),this.matchedObjectData.add(e.objectType)):this.additionalObjects.push(e)},this),_.each(this.model.get("matchedObjectTypes"),function(e){_.isEmpty(this.matchedObjectDropdownViews[e])&&this._createMatchedUserFieldDropdown(e)},this),this.render()},_createMatchedUserFieldDropdown:function(e,t){var i=new Magellan.Views.LDDropdown({required:!0,options:this.model.get("userFieldOptions")[e],value:this.model.get("userFieldOptionsMap")[e][t],optionTemplate:function(e){return _.template("<span><%=option ? option.label : null%></span>")({option:e})}});i.validate(),this.matchedObjectDropdownViews[e]={selector:".matched-"+e+"-dropdown",view:i}},_setAdditionalObjectUserFieldsInModel:function(){var e=[],t=this;this.$el.find(".matched-object-toggle").prop("checked")?this.$el.find(".matched-object-checkbox").each(function(){var i=$(this),n=i.data("objectType"),a=i.prop("checked"),o=t.matchedObjectDropdownViews[n].view.val();a&&!_.isEmpty(o)?(e.push({userField:o.name,objectType:n,contextType:"matched"}),t.matchedObjectData.add(n)):t.matchedObjectData.delete(n)}):this.matchedObjectData.clear(),this.$el.find(".additional-recipients-toggle").prop("checked")&&(e=e.concat(this.additionalRecipientRowsView.getSelections())),this.model.set("additionalObjectUserFields",e)},_showEditor:function(){this.editMode=!0,this._processAdditionalObjectUserFields()},_hideEditor:function(){this._setAdditionalObjectUserFieldsInModel(),this.validate().then(function(e){if(_.isEmpty(e)){var t={emails:this.model.get("emails")};this.model.get("showOwnerOptions")&&(t.notifyPostOwner=this.model.get("notifyPostOwner"),t.notifyPreOwner=this.model.get("notifyPreOwner"),t.notifyNewObjectOwner=this.model.get("notifyNewObjectOwner")),this.model.get("showAdditionalObjectUserOptions")&&(t.additionalObjectUserFields=this.model.get("additionalObjectUserFields")),this.trigger("savedRecipients",t),this.onSaveCallback(t),this.editMode=!1,this._processAdditionalObjectUserFields()}else this.$el.find(".email-recipients-error-messages").html(Object.values(e).join("<br>"))}.bind(this))},_toggleOwner:function(e){var t=$(e.target);this.model.set(t.data("ownerType"),t.prop("checked"))},_toggleSubcontentForm:function(e){var t=$(e.target),i=t.prop("checked");t.closest(".recipient-editor-row").find(".recipient-editor-subcontent").toggleClass("hidden",!i)},_getAdditionalObjectsLabels:function(e){return _.map(e,function(e){var t=`${e.contextType} ${e.objectType}.${e.userField}`.toLowerCase();return _.map(Magellan.Util.convertFieldSelectionStringToArray(t,"Object",this.model.get("fieldMetaData")),function(e,t,i){return t===i.length-1?e.label:e.label.replace(" ID","")},this).join(" > ")},this)},_createRecipientCards:function(){this.recipientCards=[],this.model.get("notifyPostOwner")&&this.recipientCards.push("New Owner"),this.model.get("notifyPreOwner")&&this.recipientCards.push("Previous Owner"),this.model.get("notifyNewObjectOwner")&&this.recipientCards.push("Created Object Owner"),_.each(this.model.get("emails"),function(e){this.recipientCards.push(e)},this),_.each(this.model.get("additionalObjectUserFields"),function(e){Magellan.Util.convertFieldSelectionStringToArray(e.userField,e.objectType,this.model.get("fieldMetaData")).length!==e.userField.split(".").length?this.recipientCards.push(_.capitalize(e.contextType)+" "+e.objectType+" > "+e.userField+" (DELETED)"):this.recipientCards.push(this._getAdditionalObjectsLabels([e]))},this)},_getElementClasses:function(){var e={"edit-recipients-button":new Set(["edit-recipients-button"]),"email-recipients-wrapper":new Set(["email-recipients-wrapper"]),"email-recipients-editor":new Set(["email-recipients-editor","hidden"]),"empty-recipients-message":new Set(["empty-recipients-message"]),"next-owner-row":new Set(["next-owner-row","hidden"]),"previous-owner-row":new Set(["previous-owner-row","hidden"]),"new-object-owner-row":new Set(["new-object-owner-row","hidden"]),"matched-object-row":new Set(["matched-object-row","hidden"]),"additional-recipients-row":new Set(["additional-recipients-row","hidden"])};return this.editMode&&(e["edit-recipients-button"].add("invisible"),e["email-recipients-wrapper"].add("hidden"),e["email-recipients-editor"].delete("hidden")),this.model.get("showOwnerOptions")&&(this.model.get("showNewPreviousOwnerOptions")&&(e["next-owner-row"].delete("hidden"),e["previous-owner-row"].delete("hidden")),this.model.get("showNewObjectOption")&&e["new-object-owner-row"].delete("hidden")),this.model.get("showAdditionalObjectUserOptions")&&(e["matched-object-row"].delete("hidden"),e["additional-recipients-row"].delete("hidden")),this.recipientCards.length>0&&e["empty-recipients-message"].add("hidden"),e},_emailTextareaHandler:function(e){this.model.set("emails",$(e.target).val())},validate:function(e){var t=$.Deferred(),i={},n=Magellan.Validation.validateEmailString(this.$el.find(".emails-text-area").val()),a=n.isValid,o=n.validEmails,l=n.invalidEmails,s=this.$el.find(".emails-toggle").prop("checked"),r=!s||s&&a;this.$el.find(".emails-text-area").toggleClass("input-invalid",!r),r?o.length>this.emailRecipientLimit?i.emailRecipientCountExceedsLimit="Number of valid email recipients exceeds limit of "+this.emailRecipientLimit:this.model.set("emails",s?o:[]):i.invalidEmailRecipients="Invalid email recipients listed: "+l.join(", "),e&&this.model.set("emails",o),!this.model.get("showNewObjectOption")&&this.model.get("notifyNewObjectOwner")&&(i.missingCreatedObject="Created object node no longer exists",this.model.set("notifyNewObjectOwner",!1));var d=[];return _.each(this.model.get("additionalObjectUserFields"),function(e,t){var n=Magellan.Util.convertFieldSelectionStringToArray(e.userField,e.objectType,this.model.get("fieldMetaData")).length,a=e.userField.split(".").length;"matched"!==e.contextType||this.model.get("matchedObjectTypes").includes(e.objectType)?"created"!==e.contextType||this.model.get("createdObjectTypes").includes(e.objectType)?n!==a?i.invalidMatchedObjectData="Previously selected "+e.contextType+" "+e.objectType+" object field "+e.userField+" no longer exists.":d.push(e):i.missingCreatedObject="Previously selected "+e.contextType+" "+e.objectType+" object node no longer exists (selected user field: "+e.userField+")":(i.missingMatchedObject="Previously selected "+e.contextType+" "+e.objectType+" object node no longer exists (selected user field: "+e.userField+")",this.matchedObjectData.delete(e.objectType))},this),this.model.set("additionalObjectUserFields",d),t.resolve(i)},render:function(){this._createRecipientCards();var t=_.mapValues(this._getElementClasses(),function(e){return Array.from(e).join(" ")}),i=this.template({classes:t,recipientCards:this.recipientCards,recipientData:this.model.toJSON(),matchedObjectTypes:this.model.get("matchedObjectTypes"),matchedObjectData:this.matchedObjectData,hasAdditionalObjectData:this.additionalObjects.length>0});return this.$el.html(i),_.each(this.matchedObjectDropdownViews,function(e){this.$el.find(e.selector).html(e.view.$el),e.view.delegateEvents()},this),this.additionalRecipientRowsView=new e({model:this.model,additionalObjects:this.additionalObjects,_getAdditionalObjectsLabels:this._getAdditionalObjectsLabels}),this.$el.find(".additional-recipients-content").html(this.additionalRecipientRowsView.$el),Magellan.Util.initializeTooltip(this.$el.find(".matched-object-recipient-tooltip"),{title:"Requires Matched Object",body:"No matched object edges were found leading to this Send Notification node."}),this.validate().then(function(e){_.isEmpty(this.recipientCards)&&(e.emptyEmailRecipients="Required: email recipient(s) must be selected"),this.$el.find(".email-recipients-error-messages").html(_.isEmpty(e)?"":Object.values(e).join("<br>"))}.bind(this)),this}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({defaults:{templateId:null,templateName:null}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({className:"email-template-selector-wrapper",template:_.template(i(262)),events:{"click .view-email-template-link":"_viewTemplate","nestedTypeaheadSelector:select .email-template-selector":"_selectTemplate"},initialize:function(e){e=e||{},this.onChangeCallback="function"==typeof e.onChange?e.onChange:_.noop,this.model=new Magellan.Models.EmailTemplateSelector,this.model.set("templateId",e.templateId||null),this.render()},getTemplateInfo:function(){return this.model.get("templateId")},_initializeEmailTypeahead:function(){this.$el.LoadingOverlay("show"),this.emailNestedTypeaheadView=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,selection:[],asyncServiceCall:Magellan.Controllers.FlowBuilder.searchEmailTemplates}),this.$el.find(".email-template-selector").html(this.emailNestedTypeaheadView.$el),this.validate().then(function(e,t){if(_.isEmpty(t)&&!_.isEmpty(e))this.model.set({templateId:e[0].Id,templateName:e[0].Name});else{this.model.set({templateId:null,templateName:null});var i=this.$el.find(".email-template-error-message");i.toggleClass("hidden",!1),i.html(t.invalidTemplateIdMessage)}}.bind(this)).always(function(){this._updateTypeaheadSelection()}.bind(this))},_updateTypeaheadSelection:function(){var e=this.model.get("templateId"),t=this.model.get("templateName")||"",i={Id:e,Name:t,label:t};this.emailNestedTypeaheadView.setSelection(e?[i]:null);var n=!!e;this.emailNestedTypeaheadView.$(".typeahead-input").toggleClass("input-invalid",!n),this.emailNestedTypeaheadView.$(".users-error-text").toggle(!n),this.$el.LoadingOverlay("hide",!0)},_selectTemplate:function(e,t){this.$el.find(".email-template-error-message").toggleClass("hidden",!0);var i=t.selection[0],n=i?{id:i.Id,Name:i.Name}:{};this.model.set("templateId",n.id),this.model.set("templateName",n.Name),this.trigger("selectedTemplate",this.getTemplateInfo()),this.onChangeCallback(this.getTemplateInfo())},_viewTemplate:function(){var e=this.model.get("templateId");_.isNull(e)||window.open("/"+e)},validate:function(){var e=$.Deferred(),t={};return Magellan.Controllers.FlowBuilder.searchEmailTemplates("",[this.model.get("templateId")]).then(function(i){!_.isEmpty(this.model.get("templateId"))&&_.isEmpty(i)?t.invalidTemplateIdMessage="Previously selected template (Id: "+this.model.get("templateId")+") no longer exists":_.isEmpty(i)||i[0].IsActive||(t.invalidTemplateIdMessage="Previously selected template (Id: "+this.model.get("templateId")+") is inactive"),e.resolve(i,t)}.bind(this)),e},render:function(){var e=this.template({});return this.$el.html(e),_.defer(()=>{this._initializeEmailTypeahead()}),this}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({defaults:{tabNames:[],selectedTab:""}})}},function(e,t,i){e.exports=function(){const e=i(77)();return Backbone.View.extend({template:_.template(i(272)),initialize:function(e){this.initializeModel(),this.updateModel(e),this.render()},events:{"click #ld-tabs-container.ld-tabs-div .ld-tab":"changeTabType"},initializeModel:function(){this.model=new e},updateModel:function(e){if(e){const t=_.isUndefined(e[0])?"":e[0];this.model.set({tabNames:e,selectedTab:t})}},render:function(){const e=this.template({model:this.model.toJSON()});return this.$el.html(e),this},changeTabType:function(e){const t=$(e.currentTarget).data("tab-name");this.model.set("selectedTab",t),this.trigger("selectedTab:changed",t),this.render()}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({defaults:{object:"Object",fields:new Backbone.Collection([]),updates:new Backbone.Collection([])},initialize:function(){this.get("fields")instanceof Backbone.Collection||!_.isArray(this.get("fields"))||this.set("fields",new Backbone.Collection(this.get("fields"))),this.get("updates")instanceof Backbone.Collection||!_.isArray(this.get("updates"))||this.set("updates",new Backbone.Collection(this.get("updates")))}})}},function(e,t){e.exports=function(){Magellan.Models.TupleConditions=Backbone.Model.extend({defaults:{},initialize:function(e){this.set({data:e.data||{},selectedRoutingType:e.selectedRoutingType||"New",fieldObjectType:e.fieldObjectType||"Lead",operandObjectType:e.operandObjectType||"Lead",flattenField:e.flattenField||!1,flattenOperand:e.flattenOperand||!1,conditions:e.conditions||[],logic:e.logic||"",rpnLogic:e.rpnLogic||[],rpnLogicIsValid:e.rpnLogicIsValid||!0,rpnLogicErrorMessages:[],hideToggleColumn:e.hideToggleColumn||!1}),this.processData()},processData:function(){var e=this.get("data"),t={},i=this.get("fieldObjectType");this.get("flattenField")?t[i]=Magellan.Util.createFlattenedFields(e[i]):t[i]=e[i],this.set("fieldData",t);var n={},a=this.get("operandObjectType");this.get("flattenOperand")?n[a]=Magellan.Util.createFlattenedFields(e[a]):n[a]=e[a],this.set("operandData",n)},addCondition:function(e,t){_.isEmpty(e)&&(e={"value/field":"value",field:null,type:null,operator:null,operand:null});var i=_.cloneDeep(this.get("conditions"));i.push(e),this.set("conditions",i),this.parseLogic(t),this.trigger("addedCondition")},deleteCondition:function(e){var t=_.cloneDeep(this.get("conditions"));t.splice(e,1),this.set("conditions",t);var i=t.length+1,n=new RegExp(" AND "+i+"| OR "+i,"g");this.set("logic",this.get("logic").replace(n,"")),this.parseLogic(this.get("logic")),this.trigger("deletedCondition")},parseLogic:function(e){var t=this.get("conditions"),i=_.isEmpty(e)?1===t.length?"1":this.get("logic")+" AND "+t.length:e,n=Magellan.Util.parseLogic(t.length,i);this.set("logic",i),this.set("rpnLogic",n.RPNTokens),this.set("rpnLogicIsValid",0===n.feedbackMessage.length),this.set("rpnLogicErrorMessages",n.feedbackMessage)},setDefaultLogic:function(){for(var e=this.get("conditions"),t=[],i=0;i<e.length;i++)t.push(i+1);var n=t.join(" AND ");this.parseLogic(n),this.trigger("resetLogic")},validate:function(){var e=!0,t=this.get("conditions");return this.parseLogic(this.get("logic")),e=(e=e&&this.get("rpnLogicIsValid"))&&t.length>0,_.each(t,function(t,i){var n=Magellan.Validation.validateSingleCondition(t,this.get("fieldObjectType"),this.get("operandObjectType"));e=e&&!0===n},this),e}})}},function(e,t){e.exports=function(){return Magellan.Models.AccountBranchNode.extend({defaults:_.extend({},Magellan.Models.AccountBranchNode.prototype.defaults,{magellanClass:"Magellan.Models.AccountBranchNode.Account2Opportunity","secondary-object":"Opportunity","secondary-object-label":"Matched Opportunity","reversed-condition-operands":!1}),addNodeInfo:function(){Magellan.Models.AccountBranchNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="A2O"}})}},function(e,t){e.exports=function(){return Magellan.Models.BranchNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.AccountBranchNode",magellanClass:"Magellan.Models.AccountBranchNode","secondary-object":"Account","secondary-object-label":"Account","reversed-condition-operands":!0},Magellan.Models.BranchNode.prototype.defaults),addNodeInfo:function(){Magellan.Models.BranchNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="Account"}})}},function(e,t){e.exports=function(){return Backbone.View.extend({template:_.template(Magellan.Views.NewNodeForm.prototype.decisionNodeTemplate()),edgeSelectionMenuView:null,render:function(){return this.$el.html(this.template()),this.edgeSelectionMenuView&&this.edgeSelectionMenuView.remove(),this.edgeSelectionMenuView=new Magellan.Views.EdgeSelectionMenu({model:this.model,objectType:this.model.nodeInfo.objectType}),this.$("#criteria-list-partial").html(this.edgeSelectionMenuView.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Models.CreateOpportunity.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.AccountCreateOpportunity",actionType:"Create Opportunity",magellanClass:"Magellan.Models.AccountCreateOpportunity",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Create Opportunity"]},label:"Create Opportunity"}},Magellan.Models.CreateOpportunity.prototype.defaults)})}},function(e,t){e.exports=function(){return Magellan.Views.CreateOpportunity.extend({render:function(){return Magellan.Views.CreateOpportunity.prototype.render.apply(this,arguments),this}})}},function(e,t){e.exports=function(){return Magellan.Models.CreateTask.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.AccountCreateTask",actionType:"Create Task",magellanClass:"Magellan.Models.AccountCreateTask",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Create Task"]},label:"Create Task"}},Magellan.Models.CreateTask.prototype.defaults)})}},function(e,t){e.exports=function(){return Magellan.Views.CreateTask.extend({})}},function(e,t){e.exports=function(){return Backbone.View.extend({matchedObjectName:null,initialize:function(){this.matchedObjectName=Magellan.Controllers.AccountRouter.getObjectNameFromHatType(this.model.nodeInfo.objectType)}})}},function(e,t){e.exports=function(){var e="Magellan.Models.AccountInsertTriggerNode";return Magellan.Models.TriggerNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.AccountInsertTriggerNode",magellanClass:e},Magellan.Models.TriggerNode.prototype.defaults),isUpdateTrigger:!1,addNodeInfo:function(){this.nodeInfo={type:"TRIGGER",magellanClass:e,name:"New Account",edges:Magellan.Models.TriggerNode.defaultInsertEdges("New Account"),"filter type":"none"}},getFormTitle:function(){return"Account Insert Trigger"},getFormSubtitle:function(){return"Accounts to be sent through the account workflow:"}})}},function(e,t){e.exports=function(){return Magellan.Views.TriggerNode.extend({initialize:function(e){this.isUpdateTrigger=!1,Magellan.Views.TriggerNode.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Models.AccountMatchNode.extend({defaults:_.extend({},Magellan.Models.AccountMatchNode.prototype.defaults,{magellanClass:"Magellan.Models.AccountMatchNode.Account2Opportunity","secondary-object":"Opportunity","secondary-object-label":"Matched Opportunity"}),addNodeInfo:function(){Magellan.Models.AccountMatchNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="A2O",this.nodeInfo.tiebreakers=Magellan.Migration.createDefaultOpportunityTiebreakers()}})}},function(e,t){e.exports=function(){return Magellan.Models.MatchNode.extend({defaults:_.merge(Magellan.Models.MatchNode.prototype.defaults,{magellanClass:"Magellan.Models.AccountMatchNode"})})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({mainNodeFormView:null,advancedSettingsView:null,filerRulesView:null,edgeSelectionMenuView:null,hatTypeOptionView:null,matchedObjectName:null,initialize:function(){this.matchedObjectName=Magellan.Controllers.AccountRouter.getObjectNameFromHatType(this.model.nodeInfo.objectType)},template:_.template(i(283)),render:function(){var e=this.template({pluralObjects:Magellan.Util.getPluralObjectName(this.matchedObjectName),singleObject:this.matchedObjectName});return this.$el.html(e),this.edgeSelectionMenuView&&this.edgeSelectionMenuView.remove(),this.edgeSelectionMenuView=new Magellan.Views.EdgeSelectionMenu({context:this.model,model:this.model.nodeInfo.tiebreakers,objectType:this.model.nodeInfo.objectType}),this.filerRulesView&&this.filterRulesView.remove(),this.filterRulesView=new Magellan.Views.FilterRules({model:this.model.nodeInfo,node:this.model,objectType:this.model.nodeInfo.objectType}),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.$("#criteria-list-partial").html(this.edgeSelectionMenuView.render().$el),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this.$(".filter-div").html(this.filterRulesView.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Views.NewNodeForm.extend({mainNodeFormView:null,initialize:function(){var e=Magellan.Controllers.AccountRouter.getNodeFormViewFromNodeModel(this.model);this.mainNodeFormView=new e({model:this.model}),Magellan.Views.NewNodeForm.prototype.initialize.apply(this,arguments)},render:function(){var e=this.template({currentNode:this.model,optionRequired:!1});if(this.removeAllChildViews(),this.$el.html(e),this.$el.find("#node-partial-wrapper").html(this.mainNodeFormView.render().$el),this.mainNodeFormView.delegateEvents(),this.$("#email-notification-wrapper").length>0){var t=new Magellan.Views.SendNotification({model:this.model});this.$el.find("#email-notification-wrapper").html(t.render().$el)}return this.model.nodeInfo.name!==this.currentName&&this.$el.find("#node-name-input").val(this.currentName),this}})}},function(e,t){e.exports=function(){return Magellan.Models.AssignOwnerOpportunity.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.AccountOpportunityRouting",actionType:"Opportunity Based Routing",magellanClass:"Magellan.Models.AccountOpportunityRouting",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Assign Owner Opportunity"]},label:"Assign Owner"}},Magellan.Models.ActionNode.prototype.defaults),addNodeInfo:function(e){this.nodeInfo={type:"ACTION",actionType:this.attributes.actionType,magellanClass:this.attributes.magellanClass,name:e||this.getDefaultName(),"obr type":"opportunity owner",edges:[{type:"fixed",condition:"Inactive User",name:"Inactive User",target:-1},{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}],"assignment field":"OwnerId"}},getFormTitle:function(){return"Action – Assign to Matched Opportunity Owner"}})}},function(e,t){e.exports=function(){return Magellan.Views.OpportunityBasedRouting.extend({render:function(){return Magellan.Views.OpportunityBasedRouting.prototype.render.apply(this,arguments),this}})}},function(e,t){e.exports=function(){return Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.AccountOwnerAssignment",actionType:"Explicit Owner Assignment",magellanClass:"Magellan.Models.AccountOwnerAssignment",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Explicit Owner Assignment"]},label:"Assign Owner"}},Magellan.Models.ActionNode.prototype.defaults),getFormTitle:function(){return"Action – Assign Selected User as Owner"}})}},function(e,t){e.exports=function(){return Magellan.Views.ExplicitOwnerAssignment.extend({advancedSettingsView:null,initialize:function(e){e.excludeGroups=!0,Magellan.Views.ExplicitOwnerAssignment.prototype.initialize.apply(this,arguments)},render:function(){return Magellan.Views.ExplicitOwnerAssignment.prototype.render.apply(this,arguments),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.AccountOwnerMappingRouting",actionType:"Route to Owner Mapping",magellanClass:"Magellan.Models.AccountOwnerMappingRouting",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Assign Owner Account"]},label:"Route To Owner Mapping"}},Magellan.Models.ActionNode.prototype.defaults),addNodeInfo:function(e){this.nodeInfo={type:"ACTION","abr type":"owner mapping",actionType:this.attributes.actionType,magellanClass:this.attributes.magellanClass,name:e||this.getDefaultName(),edges:[Magellan.Migration.defaultInactiveUserEdge(),Magellan.Migration.defaultEndOfFlowNextNodeEdge(),Magellan.Migration.defaultNoOwnerMappingFoundEdge()]}},getFormTitle:function(){return"Action - Route to Account Owner Mapping"}})}},function(e,t,i){e.exports=function(){var e=i(284);return Magellan.Views.ButtonHandler.extend({emailNotificationView:null,advancedSettingsView:null,initialize:function(e){this.objectType=e.objectType||this.objectType||LeanData__PrimarySObjectType.toLowerCase();var t=Magellan.Controllers.FlowBuilder.getOwnerMappingGroups(),i=_.find(t,function(e){return this.model.nodeInfo["owner mapping"]===e.Name},this);this.vwOwnerMappingSelectableList=new Magellan.Views.LDSelectableList({data:t,itemTemplate:_.template("<span><%=_.escape(Name)%></span>"),notFoundTemplate:_.template('<span class="ld-text-danger"><%=notFound%></span>'),header:"Available Owner Mappings",selected:i||this.model.nodeInfo["owner mapping"],validate:function(e){var i=e.selected;return _.isNull(i)||_.isUndefined(i)?"Required":t.indexOf(i)<0?"This Owner Mapping rule no longer exists.":""}}),this.vwOwnerMappingSelectableList.render(),this.listenTo(this.vwOwnerMappingSelectableList.model,"change:selected",this.updateSelectedAccountTeam)},template:_.template(e),render:function(){var e=this.template();return this.$el.html(e),this.$(".account-owner-mapping-list-wrapper").html(this.vwOwnerMappingSelectableList.delegateEvents().$el),this.alternateFieldAssignmentView&&this.alternateFieldAssignmentView.remove(),this.alternateFieldAssignmentView=new Magellan.Views.AlternateFieldAssignment({model:this.model}),this.$(".alternate-field-assignment-container").html(this.alternateFieldAssignmentView.render().$el),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this},updateSelectedAccountTeam:function(){var e=this.vwOwnerMappingSelectableList.model.get("selected");this.model.nodeInfo["owner mapping"]=e?e.Name:null},remove:function(){this.vwOwnerMappingSelectableList&&(this.vwOwnerMappingSelectableList.remove(),this.vwOwnerMappingSelectableList=null),Backbone.View.prototype.remove.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Models.RerouteNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.AccountRerouteNode",magellanClass:"Magellan.Models.AccountRerouteNode"},Magellan.Models.RerouteNode.prototype.defaults)})}},function(e,t){e.exports=function(){return Magellan.Models.RoundRobin.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.AccountRoundRobin",actionType:"Round Robin",magellanClass:"Magellan.Models.AccountRoundRobin",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Round Robin"]},label:"Round Robin"}},Magellan.Models.RoundRobin.prototype.defaults)})}},function(e,t){e.exports=function(){return Magellan.Views.RoundRobin.extend({})}},function(e,t){e.exports=function(){return Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.TerritoryRouting",actionType:"Route To Territory",graphType:"account",magellanClass:"Magellan.Models.AccountRouteToTerritory",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Route To Territory"]},label:"Route to Territory"}},Magellan.Models.ActionNode.prototype.defaults),getFormTitle:function(){return"Action – Route To Territory"},getSuccessEdgeNames:function(){return["Next Node"]}})}},function(e,t){e.exports=function(){return Magellan.Views.TerritoryRouting.extend({})}},function(e,t){e.exports=function(){return Magellan.Models.SendNotification.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.AccountSendNotification",actionType:"Send Notification",magellanClass:"Magellan.Models.AccountSendNotification",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Send Notification"]},label:"Send Notification"}},Magellan.Models.ActionNode.prototype.defaults)})}},function(e,t){e.exports=function(){return Magellan.Views.SendNotification.extend({initialize:function(e){Magellan.Views.SendNotification.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.AccountTeamRouting",actionType:"Route to Account Team",magellanClass:"Magellan.Models.AccountTeamRouting",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Assign Owner Account"]},label:"Route To Account Team"}},Magellan.Models.ActionNode.prototype.defaults),addNodeInfo:function(e){this.nodeInfo={type:"ACTION","abr type":"account team",actionType:this.attributes.actionType,magellanClass:this.attributes.magellanClass,name:e||this.getDefaultName(),edges:[Magellan.Migration.defaultInactiveUserEdge(),Magellan.Migration.defaultEndOfFlowNextNodeEdge()]}},getFormTitle:function(){return"Action - Route to Account Team"}})}},function(e,t,i){e.exports=function(){var e=i(285);return Magellan.Views.ButtonHandler.extend({advancedSettingsView:null,alternateFieldAssignmentView:null,initialize:function(e){this.objectType=e.objectType||this.objectType||LeanData__PrimarySObjectType.toLowerCase();var t=Magellan.Controllers.FlowBuilder.getAccountTeamRules(),i=_.find(t,function(e){return this.model.nodeInfo["account team rule"]===e.Name.replace("Account Team: ","")},this);this.vwAccountTeamSelectableList=new Magellan.Views.LDSelectableList({data:t,itemTemplate:_.template('<span><%=_.escape(Name.replace("Account Team: ", ""))%></span>'),notFoundTemplate:_.template('<span class="ld-text-danger"><%=notFound%></span>'),header:"Available Account Team Rules",selected:i||this.model.nodeInfo["account team rule"],validate:function(e){var i=e.selected;return _.isNull(i)||_.isUndefined(i)?"Required":t.indexOf(i)<0?"This Account Team rule no longer exists.":""}}),this.vwAccountTeamSelectableList.render(),this.listenTo(this.vwAccountTeamSelectableList.model,"change:selected",this.updateSelectedAccountTeam)},template:_.template(e),render:function(){var e=this.template();return this.$el.html(e),this.$(".account-team-rules-list-wrapper").html(this.vwAccountTeamSelectableList.delegateEvents().$el),this.alternateFieldAssignmentView&&this.alternateFieldAssignmentView.remove(),this.alternateFieldAssignmentView=new Magellan.Views.AlternateFieldAssignment({model:this.model}),this.$(".alternate-field-assignment-container").html(this.alternateFieldAssignmentView.render().$el),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this},updateSelectedAccountTeam:function(){var e=this.vwAccountTeamSelectableList.model.get("selected");this.model.nodeInfo["account team rule"]=e?e.Name.replace("Account Team: ",""):null},remove:function(){this.vwAccountTeamSelectableList&&(this.vwAccountTeamSelectableList.remove(),this.vwAccountTeamSelectableList=null),this.advancedSettingsView&&(this.advancedSettingsView.remove(),this.advancedSettingsView=null),Backbone.View.prototype.remove.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Models.AccountTrueFalseNode.extend({defaults:_.extend({},Magellan.Models.AccountTrueFalseNode.prototype.defaults,{magellanClass:"Magellan.Models.AccountTrueFalseNode.Account2Opportunity","secondary-object":"Opportunity","secondary-object-label":"Matched Opportunity","reversed-condition-operands":!1}),addNodeInfo:function(){Magellan.Models.AccountTrueFalseNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="A2O"}})}},function(e,t){e.exports=function(){return Magellan.Models.TrueFalseNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.AccountTrueFalseNode",magellanClass:"Magellan.Models.AccountTrueFalseNode","secondary-object":"Account","secondary-object-label":"Account","reversed-condition-operands":!0},Magellan.Models.TrueFalseNode.prototype.defaults),addNodeInfo:function(){Magellan.Models.TrueFalseNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="Account"}})}},function(e,t){e.exports=function(){return Magellan.Views.TrueFalseNode.extend({initialize:function(e){Magellan.Views.AccountDecisionNode.prototype.initialize.apply(this,arguments),Magellan.Views.TrueFalseNode.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.AccountUpdateAction",actionType:"Update Account",magellanClass:"Magellan.Models.AccountUpdateAction",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Update Lead"]},label:"Update Account"}},Magellan.Models.ActionNode.prototype.defaults),addNodeInfo:function(e){this.nodeInfo={type:"ACTION",actionType:this.get("actionType"),magellanClass:this.get("magellanClass"),name:e||this.getDefaultName(),edges:[{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}]}},getFormTitle:function(){return"Action – Update Account"}})}},function(e,t,i){e.exports=function(){return Magellan.Views.UpdateLead.extend({template:_.template(i(286))})}},function(e,t){e.exports=function(){var e="Magellan.Models.AccountUpdateTriggerNode";return Magellan.Models.TriggerNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.AccountUpdateTriggerNode",magellanClass:e},Magellan.Models.TriggerNode.prototype.defaults),isUpdateTrigger:!0,addNodeInfo:function(){this.nodeInfo={type:"UPDATE TRIGGER",magellanClass:e,name:"Updated Account",edges:Magellan.Models.TriggerNode.defaultInclusionEdges(),"filter type":"inclusion"}},getFormTitle:function(){return"Account Update Trigger"},getFormSubtitle:function(){return"Accounts to be sent through the account workflow:"}})}},function(e,t){e.exports=function(){return Magellan.Views.TriggerNode.extend({initialize:function(e){this.isUpdateTrigger=!0,Magellan.Views.TriggerNode.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.AccountUserFieldRouting",actionType:"Route to User Field",magellanClass:"Magellan.Models.AccountUserFieldRouting",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Assign Owner Account"]},label:"Route To User Field"}},Magellan.Models.ActionNode.prototype.defaults),addNodeInfo:function(e){this.nodeInfo={type:"ACTION","abr type":"custom field",actionType:this.attributes.actionType,magellanClass:this.attributes.magellanClass,name:e||this.getDefaultName(),edges:[Magellan.Migration.defaultInactiveUserEdge(),Magellan.Migration.defaultEndOfFlowNextNodeEdge()]}},getFormTitle:function(){return"Action - Route to Account's User Field"}})}},function(e,t,i){e.exports=function(){var e=i(287);return Magellan.Views.ButtonHandler.extend({advancedSettingsView:null,initialize:function(e){this.objectType=e.objectType||this.objectType||LeanData__PrimarySObjectType.toLowerCase()},template:_.template(e),render:function(){var e=this.template();this.$el.html(e),this.vwUserFieldSelector&&this.vwUserFieldSelector.remove();var t=Magellan.Util.convertFieldSelectionStringToArray(this.model.nodeInfo["custom field"],"Account",Magellan.Controllers.FlowBuilder.getFieldMetaDataMap());return this.vwUserFieldSelector=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:"Account",data:fieldMetaData,size:"xtra-small",selection:t,onSelect:this.updateNodeInfoCustomUserField.bind(this),filter:Magellan.Util.createUserFieldsFilter()}),this.$(".user-field-selector").html(this.vwUserFieldSelector.$el),this.alternateFieldAssignmentView&&this.alternateFieldAssignmentView.remove(),this.alternateFieldAssignmentView=new Magellan.Views.AlternateFieldAssignment({model:this.model}),this.$(".alternate-field-assignment-container").html(this.alternateFieldAssignmentView.render().delegateEvents().$el),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this},updateNodeInfoCustomUserField:function(){var e=Magellan.Util.convertFieldSelectionArrayToString(this.vwUserFieldSelector.selection);this.model.nodeInfo["custom field"]=e||null},remove:function(){this.vwUserFieldSelector&&(this.vwUserFieldSelector.remove(),this.vwUserFieldSelector=null),Backbone.View.prototype.remove.apply(this,arguments)}})}},function(e,t,i){e.exports=function(){var e=i(288);return Backbone.View.extend({template:_.template(e),events:{"click .delete-custom-row":"deleteRow"},initialize:function(e){this.includeInSave=!0,this.el=e.el,this.field=e.field,this.fieldData=e.fieldData,this.processedDefaultFields=e.processedDefaultFields,this.processedCustomFields=e.processedCustomFields,this.updateCustomBlacklist=e.updateCustomBlacklist,this.leadDropdown={},this.accountDropdown={},this.leadFieldSelection=null,this.accountFieldSelection=null,this.restrictedObjectType=null,this.restrictedObjectTypeParent="Lead",this.flattenedLeadFields={Lead:_.filter(Magellan.Controllers.FlowBuilder.getFlattenedFieldsByObject("Lead"),function(e){return!Magellan.Validation.FIELD_BLACKLIST_MAP.LEAD_FIELDS.includes(e.name)})},this.flattenedAccountFields={Account:_.filter(Magellan.Controllers.FlowBuilder.getFlattenedFieldsByObject("Account"),function(e){return!Magellan.Validation.FIELD_BLACKLIST_MAP.ACCOUNT_FIELDS.includes(e.name)})},this.enableSaveButton=e.enableSaveButton,this.field?(this.leadFieldSelection=this.field.leadField||null,this.accountFieldSelection=this.field.accountField||null,this.restrictedObjectType=this.leadFieldSelection?this.leadFieldSelection.type:null):this.enableSaveButton()},createLeadFieldsDropdown:function(e,t){this.field&&_.each(e.Lead,function(e){this.field.leadField&&e.name==this.field.leadField.name&&(this.field.leadField.type=e.type)},this);var i=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:t,data:e,placeholder:this.field&&this.field.oldLeadField?this.field.oldLeadField:null,selection:this.field&&this.field.leadField?[this.field.leadField]:[],onSelect:this.updateAccountDropdown.bind(this)});return i.validate(),i},updateAccountDropdown:function(e,t){var i=t.length;this.leadFieldSelection=t[i-1],(this.restrictedObjectType!=Magellan.Validation.SFDC_TYPE_TO_GROUPING[this.leadFieldSelection.type]||this.leadFieldSelection.type)&&(this.restrictedObjectType=Magellan.Validation.SFDC_TYPE_TO_GROUPING[this.leadFieldSelection.type]||this.leadFieldSelection.type,this.leadFieldSelection.parent[0]&&(this.restrictedObjectTypeParent=this.leadFieldSelection.parent[0]),this.accountDropdown.setSelection([]),this.accountDropdown.render(),this.accountDropdown.validate()),this.enableSaveButton()},createAccountFieldsDropdown:function(e,t){this.field&&_.each(e.Account,function(e){this.field.accountField&&e.name==this.field.accountField.name&&(this.field.accountField.type=e.type)},this);var i=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:t,data:e,placeholder:this.field&&this.field.oldAccountField?this.field.oldAccountField:null,selection:this.field&&this.field.accountField?[this.field.accountField]:[],onSelect:this.updateLeadFilterItems.bind(this),filter:this.filterFields.bind(this)});return i.validate(),i},updateLeadFilterItems:function(e,t){this.accountFieldSelection&&this.updateCustomBlacklist(null,this.accountFieldSelection.name);var i=t.length;this.accountFieldSelection=t[i-1],this.updateCustomBlacklist(this.accountFieldSelection.name,null),this.enableSaveButton()},filterFields:function(e){if(this.leadFieldSelection)return this.leadFieldSelection.objectType=this.restrictedObjectTypeParent,null===this.restrictedObjectType?e:(e=Magellan.Util.createMappingFlattenedFieldsFilter(this.leadFieldSelection)(e),e=_.filter(e,function(e){var t=!_.some(this.processedDefaultFields,{accountField:{name:e.name}})&&!this.updateCustomBlacklist()[e.name];return this.accountFieldSelection&&(t=t||e.name===this.accountFieldSelection.name),t},this),e=_.filter(e,function(e){return e.isUpdateable&&!e.isUnique}))},deleteRow:function(){this.accountFieldSelection&&this.updateCustomBlacklist(null,this.accountFieldSelection.name),this.enableSaveButton(),this.includeInSave=!1,Backbone.View.prototype.remove.apply(this,arguments)},render:function(){var e=this.template({});return this.setElement(e),this},renderDropdowns:function(){this.leadDropdown=this.createLeadFieldsDropdown(this.flattenedLeadFields,"Lead"),this.accountDropdown=this.createAccountFieldsDropdown(this.flattenedAccountFields,"Account"),this.$el.find(".lead-field-label").html(this.leadDropdown.$el),this.$el.find(".account-field-label").html(this.accountDropdown.$el)}})}},function(e,t,i){e.exports=function(){var e=i(289);return Backbone.View.extend({template:_.template(e),initialize:function(e){this.defaultFields=e.defaultFields},render:function(){var e=this.template({defaultFields:this.defaultFields});return this.setElement(e),this}})}},function(e,t,i){e.exports=function(){var e=i(290),t=i(120)(),n=i(119)();return Backbone.View.extend({className:"account-creation-container",template:_.template(e),events:{"click .add-new-row":"addRowToTable","click #save-mapping-button":"saveMapping"},initialize:function(){setActiveNav("router-lead-AS-NAC","Lead Routing Advanced Settings"),this.allCustomRows=[],this.leadFieldDataMap={},this.accountFieldDataMap={},this.metaData=[],this.defaultFields={},this.customFields={},this.processedDefaultFields=[],this.processedCustomFields=[],this.accountFieldBlacklist={}},updateCustomBlacklist:function(e,t){return e&&(this.accountFieldBlacklist[e]=!0),t&&delete this.accountFieldBlacklist[t],this.accountFieldBlacklist},addRowToTable:function(e,t){var i=new n({field:t,fieldData:this.metaData.Fields,processedDefaultFields:this.processedDefaultFields,processedCustomFields:this.processedCustomFields,updateCustomBlacklist:this.updateCustomBlacklist.bind(this),enableSaveButton:this.enableSaveButton});$("#account-creation-fields").append(i.render().$el),i.renderDropdowns(),this.allCustomRows.push(i)},saveMapping:function(){var e=Magellan.Controllers.GUI.appWaitingScreen.show("Saving Mapping...");if(this.validateForms())return new Magellan.Views.ConfirmationModal({header:"Missing Fields",message:"Ensure that all your fields are populated.",primaryButtonText:"Ok",hideSecondaryButton:!0}).open(),void e.resolve();var t={};_.each(this.allCustomRows,function(e){e.includeInSave&&(t[e.accountDropdown.selection[0].name]=e.leadDropdown.selection[0].name)});var i=_.assign(_.clone(this.defaultFields),t);Magellan.Services.FlowBuilder.setStringSetting("account from lead field map",JSON.stringify(i)).then(function(t){new Magellan.Views.ConfirmationModal({header:"Settings Saved",message:"Your settings have been successfully saved.",primaryButtonText:"Ok",hideSecondaryButton:!0}).open(),e.resolve()}),this.disableSaveButton()},validateForms:function(){var e=!1;return _.each(this.allCustomRows,function(t){t.accountDropdown.validate()&&t.leadDropdown.validate()||!t.includeInSave||(e=!0)}),e},enableSaveButton:function(){$("#save-mapping-button").removeClass("disabled")},disableSaveButton:function(){$("#save-mapping-button").addClass("disabled")},render:function(e){var i=Magellan.Services.FlowBuilder.getAccountFromLeadFieldMap(),n=Magellan.Services.Matching.loadTaggingFieldController();$.when(i,n).done(function(i,n){this.defaultFields=JSON.parse(i[0].defaultFields),this.customFields=JSON.parse(i[0].customFields),this.metaData=n[0];var a=this.metaData.Fields;_.each(a,function(e,t){a[t]=_.sortBy(a[t],"name")}),this.processData();var o=new t({defaultFields:this.processedDefaultFields});$("#account-creation-fields").html(o.render().$el),_.each(this.processedCustomFields,function(e){this.addRowToTable(null,e)},this),e.resolve()}.bind(this)),this.disableSaveButton();var a=this.template({});return this.$el.html(a),this},processData:function(){_.each(this.customFields,function(e,t){this.defaultFields[t]===this.customFields[t]&&delete this.customFields[t]},this),_.each(this.metaData.Fields.Lead,function(e){this.leadFieldDataMap[e.name]=e},this),_.each(this.metaData.Fields.Account,function(e){this.accountFieldDataMap[e.name]=e},this),_.each(this.defaultFields,function(e,t){this.processedDefaultFields.push({leadField:this.leadFieldDataMap[e],accountField:this.accountFieldDataMap[t]})},this),this.processedDefaultFields=_.sortBy(this.processedDefaultFields,function(e){return!!e.leadField&&e.leadField.label}),_.each(this.customFields,function(e,t){var i={leadField:this.leadFieldDataMap[e],accountField:this.accountFieldDataMap[t]};this.leadFieldDataMap[e]||(i.oldLeadField=e),this.accountFieldDataMap[t]?this.accountFieldBlacklist[this.accountFieldDataMap[t].name]=!0:i.oldAccountField=t,this.processedCustomFields.push(i)},this),this.processedCustomFields=_.sortBy(this.processedCustomFields,function(e){return!!e.leadField&&e.leadField.label})}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({initialize:function(){this.set("settingsObject",{})},updateSettingsObject:function(e,t){var i=this.get("settingsObject");i[e]=t,this.set("settingsObject",i)},syncSettings:function(){var e=new Magellan.Views.ConfirmationModal({header:"Settings Saved",message:"Your settings have been successfully saved.",primaryButtonText:"OK",hideSecondaryButton:!0}),t=Magellan.Controllers.GUI.appWaitingScreen.show("Saving Settings...");Magellan.Services.FlowBuilder.setEdgeSettings(JSON.stringify(this.get("settingsObject"))).then(function(i){t.resolve(),e.open()})}})}},function(e,t,i){e.exports=function(){var e=i(124)();return Backbone.View.extend({className:"merge-duplicates-container",template:_.template(i(291)),events:{"click .sync-settings-button":"syncSettings"},initialize:function(){},render:function(){var e=this.template(this.model.get("optionItems"));return this.$el.html(e),this.generateDropdowns(),this},syncSettings:function(){this.model.syncSettings()},generateDropdowns:function(){var t=this.model;e.forEach(function(e){var i,n=t.get("userSettings")[e.name];_.isBoolean(n)&&(n=!0===n?"1":"0"),e.items.forEach(function(e){(_.isNull(n)||_.isUndefined(n))&&e.selected&&(n=e.value),e.value===n&&(i=e)}),t.updateSettingsObject(e.stringField,n),this.$("#"+e.name).LDDropdown({options:e.items,value:i,customValues:{stringField:e.stringField},onChange:function(e){var i=this.model.get("customValues").stringField,n=e.value;t.updateSettingsObject(i,n)},optionTemplate:function(e){return _.template(e?"<span><%=option.text%></span>":"<span></span>")({option:e})}})}.bind(this))}})}},function(e,t){e.exports=function(){return[{name:"overwriteCondition",stringField:"dedupe overwrite condition",items:[{text:"Always",value:"always",selected:!0},{text:"Only if blank",value:"onlyIfBlank",selected:!1},{text:"If new value not blank",value:"ifNewValueNotBlank",selected:!1}]},{name:"isEmailMatchDupes",stringField:"email matches are dupes",items:[{text:"No",value:"0",selected:!0},{text:"Yes",value:"1",selected:!1}]},{name:"emailMergePreference",stringField:"only email matches are dupes",items:[{text:"Merge all duplicates",value:"0",selected:!0},{text:"Only merge same email duplicates",value:"1",selected:!1}]},{name:"dedupePreferenceOperatorLC",stringField:"dedupe preference operator lc",items:[{text:"Oldest",value:"LESS_THAN",selected:!1},{text:"Newest",value:"GREATER_THAN",selected:!0}]},{name:"dedupePreferenceFieldLC",stringField:"dedupe preference field lc",items:[{text:"Created Date",value:"CreatedDate",selected:!0},{text:"Last Activity Date",value:"LastActivityDate",selected:!1},{text:"Last Modified Date",value:"LastModifiedDate",selected:!1}]},{name:"dedupePreferenceOperatorLL",stringField:"dedupe preference operator ll",items:[{text:"Oldest",value:"LESS_THAN",selected:!1},{text:"Newest",value:"GREATER_THAN",selected:!0}]},{name:"dedupePreferenceFieldLL",stringField:"dedupe preference field ll",items:[{text:"Created Date",value:"CreatedDate",selected:!0},{text:"Last Activity Date",value:"LastActivityDate",selected:!1},{text:"Last Modified Date",value:"LastModifiedDate",selected:!1}]}]}},function(e,t){e.exports=function(){return Magellan.Models.CreateOpportunity.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.ContactCreateOpportunity",actionType:"Create Opportunity",magellanClass:"Magellan.Models.ContactCreateOpportunity",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Create Opportunity"]},label:"Create Opportunity"}},Magellan.Models.CreateOpportunity.prototype.defaults)})}},function(e,t){e.exports=function(){return Magellan.Views.CreateOpportunity.extend({})}},function(e,t){e.exports=function(){return Magellan.Models.CreateTask.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.ContactCreateTask",actionType:"Create Task",magellanClass:"Magellan.Models.ContactCreateTask",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Create Task"]},label:"Create Task"}},Magellan.Models.CreateTask.prototype.defaults)})}},function(e,t){e.exports=function(){return Magellan.Views.CreateTask.extend({})}},function(e,t){e.exports=function(){return Magellan.Models.ContactBranchNode.extend({defaults:_.extend({},Magellan.Models.ContactBranchNode.prototype.defaults,{magellanClass:"Magellan.Models.ContactBranchNode.Contact2Contact","secondary-object":"Contact","secondary-object-label":"Matched Contact","reversed-condition-operands":!1}),addNodeInfo:function(){Magellan.Models.ContactBranchNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="C2C"}})}},function(e,t){e.exports=function(){return Magellan.Models.ContactBranchNode.extend({defaults:_.extend({},Magellan.Models.ContactBranchNode.prototype.defaults,{magellanClass:"Magellan.Models.ContactBranchNode.Contact2Opportunity","secondary-object":"Opportunity","secondary-object-label":"Matched Opportunity","reversed-condition-operands":!1}),addNodeInfo:function(){Magellan.Models.ContactBranchNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="C2O"}})}},function(e,t){e.exports=function(){return Magellan.Models.BranchNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.ContactBranchNode",magellanClass:"Magellan.Models.ContactBranchNode","secondary-object":"Account","secondary-object-label":"Contact's Account","reversed-condition-operands":!0},Magellan.Models.BranchNode.prototype.defaults),addNodeInfo:function(){Magellan.Models.BranchNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="Contact"}})}},function(e,t){e.exports=function(){return Magellan.Views.ContactDecisionNode.extend({edgeSelectionMenuView:null,template:_.template(Magellan.Views.NewNodeForm.prototype.decisionNodeTemplate()),render:function(){return this.$el.html(this.template()),this.edgeSelectionMenuView&&this.edgeSelectionMenuView.remove(),this.edgeSelectionMenuView=new Magellan.Views.EdgeSelectionMenu({model:this.model,objectType:this.model.nodeInfo.objectType}),this.$("#criteria-list-partial").html(this.edgeSelectionMenuView.render().$el),this}})}},function(e,t){e.exports=function(){return Backbone.View.extend({matchedObjectName:null,initialize:function(){this.matchedObjectName=Magellan.Controllers.ContactRouter.getObjectNameFromHatType(this.model.nodeInfo.objectType)}})}},function(e,t){e.exports=function(){return Magellan.Models.ContactTrueFalseNode.extend({defaults:_.extend({},Magellan.Models.ContactTrueFalseNode.prototype.defaults,{magellanClass:"Magellan.Models.ContactTrueFalseNode.Contact2Contact","secondary-object":"Contact","secondary-object-label":"Matched Contact","reversed-condition-operands":!1}),addNodeInfo:function(){Magellan.Models.ContactTrueFalseNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="C2C"}})}},function(e,t){e.exports=function(){return Magellan.Models.ContactTrueFalseNode.extend({defaults:_.extend({},Magellan.Models.ContactTrueFalseNode.prototype.defaults,{magellanClass:"Magellan.Models.ContactTrueFalseNode.Contact2Opportunity","secondary-object":"Opportunity","secondary-object-label":"Matched Opportunity","reversed-condition-operands":!1}),addNodeInfo:function(){Magellan.Models.ContactTrueFalseNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="C2O"}})}},function(e,t){e.exports=function(){return Magellan.Models.TrueFalseNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.ContactTrueFalseNode",magellanClass:"Magellan.Models.ContactTrueFalseNode","secondary-object":"Account","secondary-object-label":"Contact's Account","reversed-condition-operands":!0},Magellan.Models.TrueFalseNode.prototype.defaults),addNodeInfo:function(){Magellan.Models.TrueFalseNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="Contact"}})}},function(e,t){e.exports=function(){return Magellan.Views.TrueFalseNode.extend({initialize:function(e){Magellan.Views.ContactDecisionNode.prototype.initialize.apply(this,arguments),Magellan.Views.TrueFalseNode.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Models.ContactMatchNode.extend({defaults:_.extend({},Magellan.Models.ContactMatchNode.prototype.defaults,{magellanClass:"Magellan.Models.ContactMatchNode.Contact2Contact","secondary-object":"Contact","secondary-object-label":"Matched Contact"}),addNodeInfo:function(){Magellan.Models.ContactMatchNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="C2C",this.nodeInfo.tiebreakers=Magellan.Migration.createDefaultC2CTiebreakers()}})}},function(e,t){e.exports=function(){return Magellan.Models.ContactMatchNode.extend({defaults:_.extend({},Magellan.Models.ContactMatchNode.prototype.defaults,{magellanClass:"Magellan.Models.ContactMatchNode.Contact2Opportunity","secondary-object":"Opportunity","secondary-object-label":"Matched Opportunity"}),addNodeInfo:function(){Magellan.Models.ContactMatchNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="C2O",this.nodeInfo.tiebreakers=Magellan.Migration.createDefaultOpportunityTiebreakers()}})}},function(e,t){e.exports=function(){return Magellan.Models.MatchNode.extend({defaults:_.merge(Magellan.Models.MatchNode.prototype.defaults,{magellanClass:"Magellan.Models.ContactMatchNode"})})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({mainNodeFormView:null,advancedSettingsView:null,filerRulesView:null,edgeSelectionMenuView:null,hatTypeOptionView:null,matchedObjectName:null,initialize:function(){this.matchedObjectName=Magellan.Controllers.ContactRouter.getObjectNameFromHatType(this.model.nodeInfo.objectType)},template:_.template(i(292)),render:function(){var e=this.template({pluralObjects:Magellan.Util.getPluralObjectName(this.matchedObjectName),singleObject:this.matchedObjectName});return this.$el.html(e),this.edgeSelectionMenuView&&this.edgeSelectionMenuView.remove(),this.edgeSelectionMenuView=new Magellan.Views.EdgeSelectionMenu({context:this.model,model:this.model.nodeInfo.tiebreakers,objectType:this.model.nodeInfo.objectType}),this.filerRulesView&&this.filterRulesView.remove(),this.filterRulesView=new Magellan.Views.FilterRules({model:this.model.nodeInfo,node:this.model,objectType:this.model.nodeInfo.objectType}),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.$("#criteria-list-partial").html(this.edgeSelectionMenuView.render().$el),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this.$(".filter-div").html(this.filterRulesView.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Views.NewNodeForm.extend({mainNodeFormView:null,initialize:function(){var e=Magellan.Controllers.ContactRouter.getNodeFormViewFromNodeModel(this.model);this.mainNodeFormView=new e({model:this.model}),Magellan.Views.NewNodeForm.prototype.initialize.apply(this,arguments)},render:function(){var e=this.template({currentNode:this.model,optionRequired:!1});if(this.removeAllChildViews(),this.$el.html(e),this.$el.find("#node-partial-wrapper").html(this.mainNodeFormView.render().$el),this.mainNodeFormView.delegateEvents(),this.model.nodeInfo.name!==this.currentName&&this.$el.find("#node-name-input").val(this.currentName),this.$("#email-notification-wrapper").length>0){var t=new Magellan.Views.SendNotification({model:this.model});this.$el.find("#email-notification-wrapper").html(t.render().$el)}return this}})}},function(e,t){e.exports=function(){return Magellan.Models.OutreachNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.ContactOutreachAddToSequence",actionType:"Outreach - Add to Sequence",magellanClass:"Magellan.Models.ContactOutreachAddToSequence",attrs:{"image.auxiliary-icon":{},label:"Outreach - Add to Sequence"}},Magellan.Models.OutreachNode.prototype.defaults),getFormTitle:function(){return"Action – Add Prospect to Sequence"},getEdgesForSelection:function(){return this.nodeInfo.edges}})}},function(e,t){e.exports=function(){return Magellan.Views.OutreachAddToSequence.extend({render:function(){const e=this.template({authorized:partnerAuthorizations.outreach});this.$el.html(e);Magellan.Validation.getNodesToCurrentNode(this.model.nodeInfo.name);var t=new Magellan.Views.AdvancedSettings({model:this.model});return this.$el.find("#advanced-settings-wrapper").html(t.render().$el),this.checkSequenceRenaming().then(()=>{this.initializeSequencesTypeahead(),this.$el.find(".outreach-sequences-typeahead").html(this.sequencesTypeahead.$el)}),this.checkUserRenaming().then(()=>{this.initializeUsersTypeahead(),this.$el.find(".outreach-users-typeahead").html(this.usersTypeahead.$el)}),"specific"!==this.model.nodeInfo.mailboxSelection&&this.$el.find("#outreach-users-typeahead-container").hide(),"customField"!==this.model.nodeInfo.mailboxSelection&&this.$el.find("#outreach-user-field-typeahead-container").hide(),this.customUserFieldDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:fieldMetaData,root:"Contact",required:!0,filter:function(e){return e=Magellan.Util.createBlacklistFilter("Contact")(e),e=Magellan.Util.createUserFieldsFilter()(e)},selection:Magellan.Util.convertFieldSelectionStringToArray(this.model.nodeInfo.customUserField,"Contact",Magellan.Controllers.FlowBuilder.getFieldMetaDataMap()),placeholder:"Find and Select a User Field",onSelect:(e,t)=>{this.model.nodeInfo.customUserField=Magellan.Util.convertFieldSelectionArrayToString(t)}}),this.$el.find(".custom-user-field-typeahead").html(this.customUserFieldDropdownView.$el),this.$el.find("#radio-record-owner").LDRadioButton({label:"Contact Owner",checked:"owner"===this.model.nodeInfo.mailboxSelection,name:"mailbox-selection",value:"owner",onSelectCallback:(e,t)=>{this.model.nodeInfo.mailboxSelection=e,this.$el.find("#outreach-users-typeahead-container").hide(),this.$el.find("#outreach-user-field-typeahead-container").hide()}}),this.$el.find("#radio-specific-user").LDRadioButton({label:"Specific User",checked:"specific"===this.model.nodeInfo.mailboxSelection,name:"mailbox-selection",value:"specific",onSelectCallback:(e,t)=>{this.model.nodeInfo.mailboxSelection=e,this.$el.find("#outreach-users-typeahead-container").show(),this.$el.find("#outreach-user-field-typeahead-container").hide()}}),this.$el.find("#radio-custom-user-field").LDRadioButton({label:"User Field on Contact",checked:"customField"===this.model.nodeInfo.mailboxSelection,name:"mailbox-selection",value:"customField",onSelectCallback:(e,t)=>{this.model.nodeInfo.mailboxSelection=e,this.$el.find("#outreach-user-field-typeahead-container").show(),this.$el.find("#outreach-users-typeahead-container").hide()}}),Magellan.Util.initializeTooltip(this.$el.find(".mailbox-user-tooltip.ld-tooltip-hint"),{title:"Select Corresponding User",body:"Select the user who will communicate with the prospect and whose mailbox will send automated emails (if applicable).   If the selected user does not exist in Outreach or does not have a default mailbox with sending enabled, the Add to Sequence action will fail.  Note that queue ownership is not supported at this time."}),$("#inspector").LoadingOverlay("hide",!0),this}})}},function(e,t){e.exports=function(){return Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.ContactAssignOwnerAccount",actionType:"Explicit Owner Assignment",magellanClass:"Magellan.Models.ContactAssignOwnerAccount",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Explicit Owner Assignment"]},label:"Assign Owner"}},Magellan.Models.ActionNode.prototype.defaults),getFormTitle:function(){return"Action – Assign Owner"}})}},function(e,t){e.exports=function(){return Magellan.Views.ExplicitOwnerAssignment.extend({advancedSettingsView:null,emailNotificationView:null,initialize:function(e){e.excludeGroups=!0,Magellan.Views.ExplicitOwnerAssignment.prototype.initialize.apply(this,arguments)},render:function(){return Magellan.Views.ExplicitOwnerAssignment.prototype.render.apply(this,arguments),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.updateAccountOwner&&this.updateAccountOwner.remove(),this.updateAccountOwner=new Magellan.Views.UpdatePrimaryAccountOwner({model:this.model}),this.$("#update-account-owner").html(this.updateAccountOwner.render().$el),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Models.RerouteNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.ContactRerouteNode",magellanClass:"Magellan.Models.ContactRerouteNode"},Magellan.Models.RerouteNode.prototype.defaults)})}},function(e,t){e.exports=function(){return Magellan.Models.RoundRobin.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.ContactRoundRobin",actionType:"Round Robin",magellanClass:"Magellan.Models.ContactRoundRobin",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Round Robin"]},label:"Round Robin"}},Magellan.Models.RoundRobin.prototype.defaults)})}},function(e,t){e.exports=function(){return Magellan.Views.RoundRobin.extend({advancedSettingsView:null,emailNotificationView:null,initialize:function(e){Magellan.Views.RoundRobin.prototype.initialize.apply(this,arguments),e.excludeGroups=!0},render:function(){return Magellan.Views.RoundRobin.prototype.render.apply(this,arguments),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.updateAccountOwner&&this.updateAccountOwner.remove(),this.updateAccountOwner=new Magellan.Views.UpdatePrimaryAccountOwner({model:this.model}),this.$("#update-account-owner").html(this.updateAccountOwner.render().$el),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.ContactRouteToAccount",actionType:"Route to Account",magellanClass:"Magellan.Models.ContactRouteToAccount",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Assign Owner Account"]},label:"Assign Owner"}},Magellan.Models.ActionNode.prototype.defaults),getFormTitle:function(){return"Action – Route to Account"}})}},function(e,t){e.exports=function(){return Magellan.Views.AccountBasedRouting.extend({advancedSettingsView:null,emailNotificationView:null,initialize:function(e){Magellan.Views.AccountBasedRouting.prototype.initialize.apply(this,arguments),e.excludeGroups=!0},render:function(){return Magellan.Views.AccountBasedRouting.prototype.render.apply(this,arguments),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.updateAccountOwner&&this.updateAccountOwner.remove(),this.updateAccountOwner=new Magellan.Views.UpdatePrimaryAccountOwner({model:this.model}),this.$("#update-account-owner").html(this.updateAccountOwner.render().$el),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.ContactRouteToContact",actionType:"Route to Contact",magellanClass:"Magellan.Models.ContactRouteToContact",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Assign Owner Lead"]},label:"Assign Owner"}},Magellan.Models.ActionNode.prototype.defaults),addNodeInfo:function(e){this.nodeInfo={type:"ACTION",actionType:this.attributes.actionType,magellanClass:this.attributes.magellanClass,name:e||this.getDefaultName(),"routing type":"contact owner",edges:[{type:"fixed",condition:"Inactive User",name:"Inactive User",target:-1},{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}],"assignment field":"OwnerId"}},getFormTitle:function(){return"Action – Assign to Matched Contact Owner"}})}},function(e,t,i){e.exports=function(){var e=i(293);return Magellan.Views.ButtonHandler.extend({customUserFieldDropdownView:null,advancedSettingsView:null,alternateFieldAssignmentView:null,initialize:function(e){},updateRoutingType:function(e){this.model.nodeInfo["routing type"]=$(e.currentTarget).data("routing-type")},updateUserCustomField:function(e){var t=Magellan.Util.convertFieldSelectionArrayToString(this.customUserFieldDropdownView.selection);this.model.nodeInfo["custom field"]=t||null},additionalEvents:{"change .routing-type-radio":"updateRoutingType","nestedTypeaheadSelector:select #matched-contact-custom-user-field":"updateUserCustomField"},template:_.template(e),render:function(){return this.$el.html(this.template({model:this.model})),this.customUserFieldDropdownView&&this.customUserFieldDropdownView.remove(),this.customUserFieldDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:fieldMetaData,root:"Contact",required:!0,size:"xtra-small",attributes:{id:"matched-contact-custom-user-field"},filter:Magellan.Util.createUserFieldsFilter(),selection:Magellan.Util.convertFieldSelectionStringToArray(this.model.nodeInfo["custom field"],"Contact",Magellan.Controllers.FlowBuilder.getFieldMetaDataMap())}),this.$(".custom-user-field-selector").html(this.customUserFieldDropdownView.$el),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this.alternateFieldAssignmentView&&this.alternateFieldAssignmentView.remove(),this.alternateFieldAssignmentView=new Magellan.Views.AlternateFieldAssignment({model:this.model}),this.$(".alternate-field-assignment-container").html(this.alternateFieldAssignmentView.render().$el),this.updateAccountOwner&&this.updateAccountOwner.remove(),this.updateAccountOwner=new Magellan.Views.UpdatePrimaryAccountOwner({model:this.model}),this.$("#update-account-owner").html(this.updateAccountOwner.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Models.AssignOwnerOpportunity.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.ContactRouteToOpportunity",actionType:"Route to Opportunity",magellanClass:"Magellan.Models.ContactRouteToOpportunity",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Assign Owner Opportunity"]},label:"Assign Owner"}},Magellan.Models.ActionNode.prototype.defaults),addNodeInfo:function(e){this.nodeInfo={type:"ACTION",actionType:this.attributes.actionType,magellanClass:this.attributes.magellanClass,name:e||this.getDefaultName(),"obr type":"opportunity owner",edges:[{type:"fixed",condition:"Inactive User",name:"Inactive User",target:-1},{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}],"assignment field":"OwnerId"}},getFormTitle:function(){return"Action – Route to Opportunity"}})}},function(e,t){e.exports=function(){return Magellan.Views.OpportunityBasedRouting.extend({advancedSettingsView:null,emailNotificationView:null,initialize:function(e){Magellan.Views.OpportunityBasedRouting.prototype.initialize.apply(this,arguments),e.excludeGroups=!0},render:function(){return Magellan.Views.OpportunityBasedRouting.prototype.render.apply(this,arguments),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.updateAccountOwner&&this.updateAccountOwner.remove(),this.updateAccountOwner=new Magellan.Views.UpdatePrimaryAccountOwner({model:this.model}),this.$("#update-account-owner").html(this.updateAccountOwner.render().$el),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.TerritoryRouting",actionType:"Route To Territory",graphType:"contact",magellanClass:"Magellan.Models.ContactRouteToTerritory",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Route To Territory"]},label:"Route to Territory"}},Magellan.Models.ActionNode.prototype.defaults),getFormTitle:function(){return"Action – Route To Territory"},getSuccessEdgeNames:function(){return["Next Node"]}})}},function(e,t){e.exports=function(){return Magellan.Views.TerritoryRouting.extend({})}},function(e,t){e.exports=function(){return Magellan.Models.SalesloftNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.ContactSalesloftAddToCadence",actionType:"Salesloft - Add to Cadence",magellanClass:"Magellan.Models.ContactSalesloftAddToCadence",attrs:{"image.auxiliary-icon":{},label:"Salesloft - Add to Cadence"}},Magellan.Models.SalesloftNode.prototype.defaults),getFormTitle:function(){return"Action – Add Person to Cadence"},getEdgesForSelection:function(){return this.nodeInfo.edges}})}},function(e,t){e.exports=function(){return Magellan.Views.SalesloftAddToCadence.extend({render:function(){const e=this.template({authorized:partnerAuthorizations.salesloft});this.$el.html(e);Magellan.Validation.getNodesToCurrentNode(this.model.nodeInfo.name);var t=new Magellan.Views.AdvancedSettings({model:this.model});return this.$el.find("#advanced-settings-wrapper").html(t.render().$el),this.checkCadenceRenaming().then(()=>{this.initializeCadencesTypeahead(),this.$el.find(".salesloft-cadences-typeahead").html(this.cadencesTypeahead.$el)}),this.initializeUsersTypeahead(),this.$el.find(".salesloft-users-typeahead").html(this.usersTypeahead.$el),"specific"!==this.model.nodeInfo.assigneeSelection&&this.$el.find("#salesloft-users-typeahead-container").hide(),"customField"!==this.model.nodeInfo.assigneeSelection&&this.$el.find("#salesloft-user-field-typeahead-container").hide(),this.customUserFieldDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:fieldMetaData,root:"Contact",required:!0,filter:function(e){return e=Magellan.Util.createBlacklistFilter("Contact")(e),e=Magellan.Util.createUserFieldsFilter()(e)},selection:Magellan.Util.convertFieldSelectionStringToArray(this.model.nodeInfo.customUserField,"Contact",Magellan.Controllers.FlowBuilder.getFieldMetaDataMap()),placeholder:"Find and Select a User Field",onSelect:(e,t)=>{this.model.nodeInfo.customUserField=Magellan.Util.convertFieldSelectionArrayToString(t)}}),this.$el.find(".custom-user-field-typeahead").html(this.customUserFieldDropdownView.$el),this.$el.find("#radio-record-owner").LDRadioButton({label:"Contact Owner",checked:"owner"===this.model.nodeInfo.assigneeSelection,name:"assignee-selection",value:"owner",onSelectCallback:(e,t)=>{this.model.nodeInfo.assigneeSelection=e,this.$el.find("#salesloft-users-typeahead-container").hide(),this.$el.find("#salesloft-user-field-typeahead-container").hide()}}),this.$el.find("#radio-specific-user").LDRadioButton({label:"Specific User",checked:"specific"===this.model.nodeInfo.assigneeSelection,name:"assignee-selection",value:"specific",onSelectCallback:(e,t)=>{this.model.nodeInfo.assigneeSelection=e,this.$el.find("#salesloft-users-typeahead-container").show(),this.$el.find("#salesloft-user-field-typeahead-container").hide()}}),this.$el.find("#radio-custom-user-field").LDRadioButton({label:"User Field on Contact",checked:"customField"===this.model.nodeInfo.assigneeSelection,name:"assignee-selection",value:"customField",onSelectCallback:(e,t)=>{this.model.nodeInfo.assigneeSelection=e,this.$el.find("#salesloft-user-field-typeahead-container").show(),this.$el.find("#salesloft-users-typeahead-container").hide()}}),Magellan.Util.initializeTooltip(this.$el.find(".assignee-user-tooltip.ld-tooltip-hint"),{title:"Select Corresponding User",body:"Select the user who will communicate with the prospect and whose mailbox will send automated emails (if applicable).   If the selected user does not exist in Outreach or does not have a default mailbox with sending enabled, the Add to Sequence action will fail.  Note that queue ownership is not supported at this time."}),$("#inspector").LoadingOverlay("hide",!0),this}})}},function(e,t){e.exports=function(){return Magellan.Models.SendNotification.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.ContactSendNotification",actionType:"Send Notification",magellanClass:"Magellan.Models.ContactSendNotification",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Send Notification"]},label:"Send Notification"}},Magellan.Models.ActionNode.prototype.defaults)})}},function(e,t){e.exports=function(){return Magellan.Views.SendNotification.extend({initialize:function(e){Magellan.Views.SendNotification.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Models.TriggerNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.InsertedContactTriggerNode",magellanClass:"Magellan.Models.InsertedContactTriggerNode"},Magellan.Models.TriggerNode.prototype.defaults),addNodeInfo:function(){this.nodeInfo={magellanClass:this.attributes.magellanClass,type:"TRIGGER",name:"New Contact",edges:Magellan.Models.TriggerNode.defaultInsertEdges("New Contact"),"filter type":"none"}},getFormTitle:function(){return"New Contact Trigger"}})}},function(e,t){e.exports=function(){return Magellan.Views.TriggerNode.extend({initialize:function(e){e.objectType="contact",Magellan.Views.TriggerNode.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Models.UpdateLead.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.UpdateContact",actionType:"Update Contact",magellanClass:"Magellan.Models.UpdateContact",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Update Lead"]},label:"Update Contact"}},Magellan.Models.ActionNode.prototype.defaults),getFormTitle:function(){return"Action – Update Contact"}})}},function(e,t){e.exports=function(){return Magellan.Views.UpdateLead.extend({template:_.template(magellanDocument.getElementById("update_contact").innerHTML)})}},function(e,t){e.exports=function(){return Magellan.Models.TriggerNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.UpdateContactTriggerNode",magellanClass:"Magellan.Models.UpdateContactTriggerNode"},Magellan.Models.TriggerNode.prototype.defaults),addNodeInfo:function(){this.nodeInfo={magellanClass:this.attributes.magellanClass,type:"UPDATE TRIGGER",name:"Updated Contact",edges:Magellan.Models.TriggerNode.defaultInclusionEdges(),"filter type":"inclusion"}},getFormTitle:function(){return"Updated Contact Trigger"}})}},function(e,t){e.exports=function(){return Magellan.Views.TriggerNode.extend({initialize:function(e){e.objectType="contact",Magellan.Views.TriggerNode.prototype.initialize.apply(this,arguments)}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(294)),initialize:function(e){this.info=e.info},render:function(){var e=this.template({orgId:"SFDC Org ID: "+this.info.orgId,versionNumber:"LeanData App Version: "+this.info.versionNumber});return this.$el.html(e),this},events:{"click .help-link":"openURL"},openURL:function(e){new Magellan.Views.ConfirmationModal({header:"Access Passphrase",message:"Use Passphrase: Frictionless Funnel",primaryButtonText:"Open Link",onConfirmed:function(){window.open($(e.target).data("href"))}}).open()}})}},function(e,t){e.exports=function(){return Magellan.Models.OpportunityBranchNode.extend({defaults:_.extend({},Magellan.Models.OpportunityBranchNode.prototype.defaults,{magellanClass:"Magellan.Models.OpportunityBranchNode.Opportunity2Contact","secondary-object":"Contact","secondary-object-label":"Matched Contact","reversed-condition-operands":!1}),addNodeInfo:function(){Magellan.Models.OpportunityBranchNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="O2C"}})}},function(e,t){e.exports=function(){return Magellan.Models.OpportunityBranchNode.extend({defaults:_.extend({},Magellan.Models.OpportunityBranchNode.prototype.defaults,{magellanClass:"Magellan.Models.OpportunityBranchNode.Opportunity2Opportunity","secondary-object":"Opportunity","secondary-object-label":"Matched Opportunity"}),addNodeInfo:function(){Magellan.Models.OpportunityBranchNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="O2O"}})}},function(e,t){e.exports=function(){return Magellan.Models.BranchNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.OpportunityBranchNode",magellanClass:"Magellan.Models.OpportunityBranchNode","secondary-object":"Account","secondary-object-label":"Opportunity's Account","reversed-condition-operands":!0},Magellan.Models.BranchNode.prototype.defaults),addNodeInfo:function(){Magellan.Models.BranchNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="Opportunity"}})}},function(e,t){e.exports=function(){return Backbone.View.extend({template:_.template(Magellan.Views.NewNodeForm.prototype.decisionNodeTemplate()),edgeSelectionMenuView:null,render:function(){return this.$el.html(this.template()),this.edgeSelectionMenuView&&this.edgeSelectionMenuView.remove(),this.edgeSelectionMenuView=new Magellan.Views.EdgeSelectionMenu({model:this.model,objectType:this.model.nodeInfo.objectType}),this.$("#criteria-list-partial").html(this.edgeSelectionMenuView.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Models.CreateOpportunity.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.OpportunityCreateOpportunity",actionType:"Create Opportunity",magellanClass:"Magellan.Models.OpportunityCreateOpportunity",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Create Opportunity"]},label:"Create Opportunity"}},Magellan.Models.CreateOpportunity.prototype.defaults)})}},function(e,t){e.exports=function(){return Magellan.Views.CreateOpportunity.extend({})}},function(e,t){e.exports=function(){return Magellan.Models.CreateTask.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.OpportunityCreateTask",actionType:"Create Task",magellanClass:"Magellan.Models.OpportunityCreateTask",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Create Task"]},label:"Create Task"}},Magellan.Models.CreateTask.prototype.defaults)})}},function(e,t){e.exports=function(){return Magellan.Views.CreateTask.extend({})}},function(e,t){e.exports=function(){return Backbone.View.extend({matchedObjectName:null,initialize:function(){this.matchedObjectName=Magellan.Controllers.OpportunityRouter.getObjectNameFromHatType(this.model.nodeInfo.objectType)}})}},function(e,t){e.exports=function(){var e="Magellan.Models.OpportunityInsertTriggerNode";return Magellan.Models.TriggerNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.OpportunityInsertTriggerNode",magellanClass:e},Magellan.Models.TriggerNode.prototype.defaults),isUpdateTrigger:!1,addNodeInfo:function(){this.nodeInfo={type:"TRIGGER",magellanClass:e,name:"New Opportunity",edges:Magellan.Models.TriggerNode.defaultInsertEdges("New Opportunity"),"filter type":"none"}},getFormTitle:function(){return"Opportunity Insert Trigger"},getFormSubtitle:function(){return"Opportunities to be sent through the account workflow:"}})}},function(e,t){e.exports=function(){return Magellan.Views.TriggerNode.extend({initialize:function(e){this.isUpdateTrigger=!1,Magellan.Views.TriggerNode.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Models.OpportunityMatchNode.extend({defaults:_.extend({},Magellan.Models.OpportunityMatchNode.prototype.defaults,{magellanClass:"Magellan.Models.OpportunityMatchNode.Opportunity2Contact","secondary-object":"Contact","secondary-object-label":"Matched Contact"}),addNodeInfo:function(){Magellan.Models.OpportunityMatchNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="O2C",this.nodeInfo.tiebreakers=Magellan.Migration.createDefaultO2CTiebreakers()}})}},function(e,t){e.exports=function(){return Magellan.Models.OpportunityMatchNode.extend({defaults:_.extend({},Magellan.Models.OpportunityMatchNode.prototype.defaults,{magellanClass:"Magellan.Models.OpportunityMatchNode.Opportunity2Opportunity","secondary-object":"Opportunity","secondary-object-label":"Matched Opportunity"}),addNodeInfo:function(){Magellan.Models.OpportunityMatchNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="O2O",this.nodeInfo.tiebreakers=Magellan.Migration.createDefaultOpportunityTiebreakers()}})}},function(e,t){e.exports=function(){return Magellan.Models.MatchNode.extend({defaults:_.merge(Magellan.Models.MatchNode.prototype.defaults,{magellanClass:"Magellan.Models.OpportunityMatchNode"})})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({matchedObjectName:null,edgeSelectionMenuView:null,filerRulesView:null,advancedSettingsView:null,initialize:function(){this.matchedObjectName=Magellan.Controllers.OpportunityRouter.getObjectNameFromHatType(this.model.nodeInfo.objectType)},template:_.template(i(295)),render:function(){var e=this.template({pluralObjects:Magellan.Util.getPluralObjectName(this.matchedObjectName),singleObject:this.matchedObjectName});return this.$el.html(e),this.edgeSelectionMenuView&&this.edgeSelectionMenuView.remove(),this.edgeSelectionMenuView=new Magellan.Views.EdgeSelectionMenu({context:this.model,model:this.model.nodeInfo.tiebreakers,objectType:this.model.nodeInfo.objectType}),this.$("#criteria-list-partial").html(this.edgeSelectionMenuView.render().$el),this.filerRulesView&&this.filterRulesView.remove(),this.filterRulesView=new Magellan.Views.FilterRules({model:this.model.nodeInfo,node:this.model,objectType:this.model.nodeInfo.objectType}),this.$(".filter-div").html(this.filterRulesView.render().$el),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Views.NewNodeForm.extend({mainNodeFormView:null,initialize:function(){var e=Magellan.Controllers.OpportunityRouter.getNodeFormViewFromNodeModel(this.model);this.mainNodeFormView=new e({model:this.model}),Magellan.Views.NewNodeForm.prototype.initialize.apply(this,arguments)},render:function(){var e=this.template({currentNode:this.model,optionRequired:!1});if(this.removeAllChildViews(),this.$el.html(e),this.$el.find("#node-partial-wrapper").html(this.mainNodeFormView.render().$el),this.mainNodeFormView.delegateEvents(),this.model.nodeInfo.name!==this.currentName&&this.$el.find("#node-name-input").val(this.currentName),this.$("#email-notification-wrapper").length>0){var t=new Magellan.Views.SendNotification({model:this.model});this.$el.find("#email-notification-wrapper").html(t.render().$el)}return this}})}},function(e,t){e.exports=function(){return Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.OpportunityOwnerAssignment",actionType:"Explicit Owner Assignment",magellanClass:"Magellan.Models.OpportunityOwnerAssignment",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Explicit Owner Assignment"]},label:"Assign Owner"}},Magellan.Models.ActionNode.prototype.defaults),getFormTitle:function(){return"Action – Assign Selected User as Owner"}})}},function(e,t){e.exports=function(){return Magellan.Views.ExplicitOwnerAssignment.extend({advancedSettingsView:null,emailNotificationView:null,initialize:function(e){e.excludeGroups=!0,Magellan.Views.ExplicitOwnerAssignment.prototype.initialize.apply(this,arguments)},render:function(){return Magellan.Views.ExplicitOwnerAssignment.prototype.render.apply(this,arguments),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Models.RerouteNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.OpportunityRerouteNode",magellanClass:"Magellan.Models.OpportunityRerouteNode"},Magellan.Models.RerouteNode.prototype.defaults)})}},function(e,t){e.exports=function(){return Magellan.Models.RoundRobin.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.OpportunityRoundRobin",actionType:"Round Robin",magellanClass:"Magellan.Models.OpportunityRoundRobin",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Round Robin"]},label:"Round Robin"}},Magellan.Models.RoundRobin.prototype.defaults)})}},function(e,t){e.exports=function(){return Magellan.Views.RoundRobin.extend({})}},function(e,t){e.exports=function(){return Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.OpportunityRouteToAccount",actionType:"Route to Account",magellanClass:"Magellan.Models.OpportunityRouteToAccount",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Assign Owner Account"]},label:"Assign Owner"}},Magellan.Models.ActionNode.prototype.defaults),getFormTitle:function(){return"Action – Route to Account"}})}},function(e,t){e.exports=function(){return Magellan.Views.AccountBasedRouting.extend({render:function(){return Magellan.Views.AccountBasedRouting.prototype.render.apply(this,arguments),this}})}},function(e,t){e.exports=function(){return Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.OpportunityRouteToContact",actionType:"Route to Contact",magellanClass:"Magellan.Models.OpportunityRouteToContact",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Assign Owner Lead"]},label:"Assign Owner"}},Magellan.Models.ActionNode.prototype.defaults),addNodeInfo:function(e){this.nodeInfo={type:"ACTION",actionType:this.attributes.actionType,magellanClass:this.attributes.magellanClass,name:e||this.getDefaultName(),"routing type":"contact owner",edges:[{type:"fixed",condition:"Inactive User",name:"Inactive User",target:-1},{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}],"assignment field":"OwnerId"}},getFormTitle:function(){return"Action – Assign to Matched Contact Owner"}})}},function(e,t,i){e.exports=function(){return Magellan.Views.ButtonHandler.extend({customUserFieldDropdownView:null,alternateFieldAssignmentView:null,emailNotificationView:null,advancedSettingsView:null,initialize:function(e){},additionalEvents:{"change .routing-type-radio":"updateRoutingType","nestedTypeaheadSelector:select #matched-contact-custom-user-field":"updateUserCustomField"},template:_.template(i(296)),updateRoutingType:function(e){this.model.nodeInfo["routing type"]=$(e.currentTarget).data("routing-type")},updateUserCustomField:function(e){var t=Magellan.Util.convertFieldSelectionArrayToString(this.customUserFieldDropdownView.selection);this.model.nodeInfo["custom field"]=t||null},render:function(){return this.$el.html(this.template({model:this.model})),this.customUserFieldDropdownView&&this.customUserFieldDropdownView.remove(),this.customUserFieldDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:fieldMetaData,root:"Contact",required:!0,size:"xtra-small",attributes:{id:"matched-contact-custom-user-field"},filter:Magellan.Util.createUserFieldsFilter(),selection:Magellan.Util.convertFieldSelectionStringToArray(this.model.nodeInfo["custom field"],"Contact",Magellan.Controllers.FlowBuilder.getFieldMetaDataMap())}),this.$(".custom-user-field-selector").html(this.customUserFieldDropdownView.$el),this.alternateFieldAssignmentView&&this.alternateFieldAssignmentView.remove(),this.alternateFieldAssignmentView=new Magellan.Views.AlternateFieldAssignment({model:this.model}),this.$(".alternate-field-assignment-container").html(this.alternateFieldAssignmentView.render().$el),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.advancedSettingsView.openPanel=this.openPanel,this.$el.find("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Models.AssignOwnerOpportunity.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.OpportunityRouteToOpportunity",actionType:"Opportunity Based Routing",magellanClass:"Magellan.Models.OpportunityRouteToOpportunity",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Assign Owner Opportunity"]},label:"Route to Matched Opportunity"}},Magellan.Models.ActionNode.prototype.defaults),addNodeInfo:function(e){this.nodeInfo={type:"ACTION",actionType:this.attributes.actionType,magellanClass:this.attributes.magellanClass,name:e||this.getDefaultName(),"obr type":"opportunity owner",edges:[{type:"fixed",condition:"Inactive User",name:"Inactive User",target:-1},{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}],"assignment field":"OwnerId"}},getFormTitle:function(){return"Action – Assign to Matched Opportunity Owner"}})}},function(e,t){e.exports=function(){return Magellan.Views.OpportunityBasedRouting.extend({render:function(){return Magellan.Views.OpportunityBasedRouting.prototype.render.apply(this,arguments),this}})}},function(e,t){e.exports=function(){return Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.TerritoryRouting",actionType:"Route To Territory",graphType:"opportunity",magellanClass:"Magellan.Models.OpportunityRouteToTerritory",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Route To Territory"]},label:"Route to Territory"}},Magellan.Models.ActionNode.prototype.defaults),getFormTitle:function(){return"Action – Route To Territory"},getSuccessEdgeNames:function(){return["Next Node"]}})}},function(e,t){e.exports=function(){return Magellan.Views.TerritoryRouting.extend({})}},function(e,t){e.exports=function(){return Magellan.Models.SendNotification.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.OpportunitySendNotification",actionType:"Send Notification",magellanClass:"Magellan.Models.OpportunitySendNotification",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Send Notification"]},label:"Send Notification"}},Magellan.Models.ActionNode.prototype.defaults)})}},function(e,t){e.exports=function(){return Magellan.Views.SendNotification.extend({initialize:function(e){Magellan.Views.SendNotification.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Models.OpportunityTrueFalseNode.extend({defaults:_.extend({},Magellan.Models.OpportunityTrueFalseNode.prototype.defaults,{magellanClass:"Magellan.Models.OpportunityTrueFalseNode.Opportunity2Contact","secondary-object":"Contact","secondary-object-label":"Matched Contact","reversed-condition-operands":!1}),addNodeInfo:function(){Magellan.Models.OpportunityTrueFalseNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="O2C"}})}},function(e,t){e.exports=function(){return Magellan.Models.OpportunityTrueFalseNode.extend({defaults:_.extend({},Magellan.Models.OpportunityTrueFalseNode.prototype.defaults,{magellanClass:"Magellan.Models.OpportunityTrueFalseNode.Opportunity2Opportunity","secondary-object":"Opportunity","secondary-object-label":"Matched Opportunity"}),addNodeInfo:function(){Magellan.Models.OpportunityTrueFalseNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="O2O"}})}},function(e,t){e.exports=function(){return Magellan.Models.TrueFalseNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.OpportunityTrueFalseNode",magellanClass:"Magellan.Models.OpportunityTrueFalseNode","secondary-object":"Account","secondary-object-label":"Opportunity's Account","reversed-condition-operands":!0},Magellan.Models.TrueFalseNode.prototype.defaults),addNodeInfo:function(){Magellan.Models.TrueFalseNode.prototype.addNodeInfo.apply(this,arguments),this.nodeInfo.objectType="Opportunity"}})}},function(e,t){e.exports=function(){return Magellan.Views.TrueFalseNode.extend({initialize:function(e){Magellan.Views.OpportunityDecisionNode.prototype.initialize.apply(this,arguments),Magellan.Views.TrueFalseNode.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Models.ActionNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.OpportunityUpdateAction",actionType:"Update Opportunity",magellanClass:"Magellan.Models.OpportunityUpdateAction",attrs:{"image.auxiliary-icon":{"xlink:href":iconToURLMap["Update Lead"]},label:"Update Opportunity"}},Magellan.Models.ActionNode.prototype.defaults),addNodeInfo:function(e){this.nodeInfo={type:"ACTION",actionType:this.get("actionType"),magellanClass:this.get("magellanClass"),name:e||this.getDefaultName(),edges:[{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}]}},getFormTitle:function(){return"Action – Update Opportunity"}})}},function(e,t,i){e.exports=function(){return Magellan.Views.UpdateLead.extend({template:_.template(i(297)),render:function(){return Magellan.Views.UpdateLead.prototype.render.apply(this,arguments),this}})}},function(e,t){e.exports=function(){var e="Magellan.Models.OpportunityUpdateTriggerNode";return Magellan.Models.TriggerNode.extend({defaults:joint.util.deepSupplement({type:"basic.Generic.OpportunityUpdateTriggerNode",magellanClass:e},Magellan.Models.TriggerNode.prototype.defaults),isUpdateTrigger:!0,addNodeInfo:function(){this.nodeInfo={type:"UPDATE TRIGGER",magellanClass:e,name:"Updated Opportunity",edges:Magellan.Models.TriggerNode.defaultInclusionEdges(),"filter type":"inclusion"}},getFormTitle:function(){return"Opportunity Update Trigger"},getFormSubtitle:function(){return"Opportunities to be sent through the opportunity workflow:"}})}},function(e,t){e.exports=function(){return Magellan.Views.TriggerNode.extend({initialize:function(e){this.isUpdateTrigger=!0,Magellan.Views.TriggerNode.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(e){const t=(t,i)=>null!==e[dashboardController.INTEGRATIONS_ENABLED]&&"0"!==e[dashboardController.INTEGRATIONS_ENABLED]&&("1"===e[dashboardController.INTEGRATIONS_ENABLED]||"ANY"===e[dashboardController.INTEGRATIONS_ENABLED]||("string"==typeof e[dashboardController.INTEGRATIONS_ENABLED]&&(e[dashboardController.INTEGRATIONS_ENABLED]=JSON.parse(e[dashboardController.INTEGRATIONS_ENABLED])),!(!e[dashboardController.INTEGRATIONS_ENABLED][t]||"ANY"!==e[dashboardController.INTEGRATIONS_ENABLED][t])||(e[dashboardController.INTEGRATIONS_ENABLED][t]instanceof Set||(e[dashboardController.INTEGRATIONS_ENABLED][t]=void 0===e[dashboardController.INTEGRATIONS_ENABLED][t]?void 0:new Set(e[dashboardController.INTEGRATIONS_ENABLED][t])),Boolean(e[dashboardController.INTEGRATIONS_ENABLED][t]&&e[dashboardController.INTEGRATIONS_ENABLED][t].has(i)))));return{isPartnerEnabled:t=>null!==e[dashboardController.INTEGRATIONS_ENABLED]&&"0"!==e[dashboardController.INTEGRATIONS_ENABLED]&&("1"===e[dashboardController.INTEGRATIONS_ENABLED]||"ANY"===e[dashboardController.INTEGRATIONS_ENABLED]||("string"==typeof e[dashboardController.INTEGRATIONS_ENABLED]&&(e[dashboardController.INTEGRATIONS_ENABLED]=JSON.parse(e[dashboardController.INTEGRATIONS_ENABLED])),Boolean(e[dashboardController.INTEGRATIONS_ENABLED][t]))),isPartnerNodeEnabled:t,flowBuilderNodes:{"Magellan.Models.MatchNodes.Lead2Lead":e[dashboardController.L2L_NODE]&&e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.MatchNodes.Lead2Account":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.MatchNodes.Lead2Opportunity":e[dashboardController.L2O_NODE]&&e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.MatchNodes.Duplicate":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.MatchNodes.DuplicateContact":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.TrueFalseNodes.Lead":!0,"Magellan.Models.TrueFalseNodes.Lead2Lead":e[dashboardController.L2L_NODE]&&e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.TrueFalseNodes.Lead2Account":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.TrueFalseNodes.Lead2Opportunity":e[dashboardController.L2O_NODE]&&e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.TrueFalseNodes.Duplicate":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.TrueFalseNodes.DuplicateContact":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.BranchNodes.Lead":!0,"Magellan.Models.BranchNodes.Lead2Lead":e[dashboardController.L2L_NODE]&&e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.BranchNodes.Lead2Account":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.BranchNodes.Lead2Opportunity":e[dashboardController.L2O_NODE]&&e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.BranchNodes.Duplicate":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.BranchNodes.DuplicateContact":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.AssignOwnerLead":e[dashboardController.L2L_NODE]&&e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.AssignOwnerAccount":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.AssignOwnerOpportunity":e[dashboardController.L2O_NODE]&&e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.Convert":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.CreateAccount":e[dashboardController.ACCOUNT_CREATION_NODE]&&e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.CreateOpportunity":e[dashboardController.CREATE_OPP_NODE]&&e[dashboardController.MATCHING_IN_ROUTING_ON]&&e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.CreateTask":!0,"Magellan.Models.CustomInterface":!0,"Magellan.Models.Merge":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.MergeContact":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.ExplicitOwnerAssignment":!0,"Magellan.Models.RoundRobin":!0,"Magellan.Models.TerritoryRouting":e[dashboardController.TERRITORY_ROUTING],"Magellan.Models.LeadSendNotification":e[dashboardController.ROUTING_EMAIL_NOTIFICATIONS],"Magellan.Models.UpdateLead":!0,"Magellan.Models.RerouteNode":!0,"Magellan.Models.OutreachAddToSequence":t("outreach","addtosequence"),"Magellan.Models.SalesloftAddToCadence":t("salesloft","addtocadence"),"Magellan.Models.ContactMatchNode.Contact2Contact":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.ContactMatchNode.Contact2Opportunity":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.ContactTrueFalseNode":!0,"Magellan.Models.ContactTrueFalseNode.Contact2Contact":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.ContactTrueFalseNode.Contact2Opportunity":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.ContactBranchNode":!0,"Magellan.Models.ContactBranchNode.Contact2Contact":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.ContactBranchNode.Contact2Opportunity":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.ContactAssignOwnerAccount":!0,"Magellan.Models.ContactRoundRobin":!0,"Magellan.Models.UpdateContact":!0,"Magellan.Models.ContactSendNotification":e[dashboardController.ROUTING_EMAIL_NOTIFICATIONS],"Magellan.Models.ContactCreateOpportunity":e[dashboardController.CREATE_OPP_NODE],"Magellan.Models.ContactCreateTask":!0,"Magellan.Models.ContactRouteToContact":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.ContactRouteToAccount":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.ContactRouteToOpportunity":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.ContactRouteToTerritory":e[dashboardController.TERRITORY_ROUTING],"Magellan.Models.ContactOutreachAddToSequence":t("outreach","addtosequence"),"Magellan.Models.ContactSalesloftAddToCadence":t("salesloft","addtocadence"),"Magellan.Models.ContactRerouteNode":!0,"Magellan.Models.AccountMatchNode.Account2Opportunity":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.AccountTrueFalseNode":!0,"Magellan.Models.AccountTrueFalseNode.Account2Opportunity":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.AccountBranchNode":!0,"Magellan.Models.AccountBranchNode.Account2Opportunity":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.AccountCreateOpportunity":e[dashboardController.CREATE_OPP_NODE],"Magellan.Models.AccountSendNotification":e[dashboardController.ROUTING_EMAIL_NOTIFICATIONS],"Magellan.Models.AccountOpportunityRouting":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.AccountTeamRouting":!0,"Magellan.Models.AccountOwnerMappingRouting":!0,"Magellan.Models.AccountUserFieldRouting":!0,"Magellan.Models.AccountCreateTask":!0,"Magellan.Models.AccountOwnerAssignment":!0,"Magellan.Models.AccountRoundRobin":!0,"Magellan.Models.AccountRouteToTerritory":e[dashboardController.TERRITORY_ROUTING],"Magellan.Models.AccountUpdateAction":!0,"Magellan.Models.AccountRerouteNode":!0,"Magellan.Models.OpportunityMatchNode.Opportunity2Opportunity":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.OpportunityMatchNode.Opportunity2Contact":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.OpportunityTrueFalseNode":!0,"Magellan.Models.OpportunityTrueFalseNode.Opportunity2Opportunity":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.OpportunityTrueFalseNode.Opportunity2Contact":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.OpportunityBranchNode":!0,"Magellan.Models.OpportunityBranchNode.Opportunity2Opportunity":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.OpportunityBranchNode.Opportunity2Contact":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.OpportunityRouteToContact":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.OpportunityRouteToAccount":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.OpportunityRouteToOpportunity":e[dashboardController.MATCHING_IN_ROUTING_ON],"Magellan.Models.OpportunityCreateOpportunity":e[dashboardController.CREATE_OPP_NODE],"Magellan.Models.OpportunityCreateTask":!0,"Magellan.Models.OpportunityOwnerAssignment":!0,"Magellan.Models.OpportunityRoundRobin":!0,"Magellan.Models.OpportunityRouteToTerritory":e[dashboardController.TERRITORY_ROUTING],"Magellan.Models.OpportunityUpdateAction":!0,"Magellan.Models.OpportunitySendNotification":e[dashboardController.ROUTING_EMAIL_NOTIFICATIONS],"Magellan.Models.OpportunityRerouteNode":!0}}}},function(e,t){e.exports=function(){return Backbone.Model.extend({defaults:{},initialize:function(e){this.set("objectType",e.objectType||"Lead"),this.set("selectedRoutingType",_.capitalize(e.selectedRoutingType)||"New"),_.isEmpty(e.rule)?this.set("rule",{source:this.get("selectedRoutingType")+" "+this.get("objectType"),name:"","assignment field":null,target:"","round robin group id":"","round robin group name":"",type:"conditions",conditions:[],logic:"",rpnLogic:[],rpnLogicIsValid:!1}):this.set("rule",e.rule),this.set("originalRule",JSON.stringify(this.get("rule")))},validateRule:function(){var e=this.get("rule");return!(_.isEmpty(e.name)||_.isEmpty(e.target)||_.isEmpty(e["round robin group id"])||_.isEmpty(e.logic))}})}},function(e,t,i){e.exports=function(){var e=i(209)();return Backbone.View.extend({template:_.template(i(298)),initialize:function(t){this.model=new e(t);var i=this.model.get("rule");this.tupleConditionsView=new Magellan.Views.TupleConditions({data:fieldMetaData,selectedRoutingType:this.model.get("selectedRoutingType"),fieldObjectType:this.model.get("objectType"),operandObjectType:this.model.get("objectType"),flattenField:!0,flattenOperand:!0,conditions:i.conditions,logic:i.logic,rpnLogic:i.rpnLogic,rpnLogicIsValid:i.rpnLogicIsValid,hideToggleColumn:!0}),this.render()},events:{"click .cancel-live-routing-rule":"cancelRuleHandler","click .save-live-routing-rule":"saveRuleHandler","click .live-routing-alt-field-checkbox":"altFieldCheckboxHandler","input .live-routing-rule-name-input":"ruleNameInputHandler"},hideRuleEditor:function(e){this.trigger("disableModification",!1),this.remove()},cancelRuleHandler:function(e){this.trigger("cancelRule"),this.hideRuleEditor()},saveRuleHandler:function(e){var t=this.tupleConditionsView.returnModelValues(),i=this.tupleConditionsView.validate();(n=this.model.get("rule")).conditions=t.conditions,n.logic=t.logic,n.rpnLogic=t.rpnLogic,this.model.set("rule",n);var n,a=this.model.validateRule()&&this.routeToDropdown.validate()&&i;(this.$el.find(".live-routing-alt-field-checkbox").prop("checked")&&(a=a&&!_.isNull(n["assignment field"])),this.$el.find(".live-routing-alt-field-checkbox").prop("checked"))||((n=this.model.get("rule"))["assignment field"]=null,this.model.set("rule",n));a?(this.trigger("saveRule",n,this.model.get("selectedRoutingType"),this.model.get("ruleIndex")),this.hideRuleEditor()):console.error("[Invalid rule]",n)},ruleNameInputHandler:function(e){var t=$(e.target),i=t.val();t.toggleClass("input-invalid",_.isEmpty(i));var n=this.model.get("rule");n.name=i,n.target=i,this.model.set("rule",n)},altFieldCheckboxHandler:function(e,t){var i=t||$(e.target).prop("checked");this.$el.find(".live-routing-alt-field-checkbox").prop("checked",i),this.$el.find(".live-routing-alt-field-dropdown").css("visibility",i?"visible":"hidden")},createAltOwnerFieldDropdown:function(){var e,t=this.model.get("objectType"),i=this.model.get("rule"),n=i["assignment field"]?i["assignment field"].replace("__c","__r.id"):null,a=Magellan.Controllers.FlowBuilder.getCustomUserFieldsByObject(t),o=_.filter(a,function(t){return t.name===n&&(e=t),!Magellan.Validation.FIELD_BLACKLIST_SETS.CUSTOM_USER_FIELDS.has(t.name)},this);this.alternateFieldDropdown=new Magellan.Views.LDDropdown({required:!0,options:o,value:e,placeholder:"Select Alternate Field",optionTemplate:function(e){return _.template("<span><%=option.label%></span>")({option:e})},onChange:function(e){var t=this.model.get("rule");t["assignment field"]=e.name.replace(new RegExp("__r.*$"),"__c"),this.model.set("rule",t)}.bind(this)}),this.alternateFieldDropdown.validate(),this.$el.find(".live-routing-alt-field-dropdown").html(this.alternateFieldDropdown.$el);var l=this.$el.find(".alt-field-error-row");_.isEmpty(e)?_.isEmpty(e)&&!_.isEmpty(n)?(this.altFieldCheckboxHandler(null,!0),l.html('Previously selected alternate field "'+n+'" is invalid.'),l.show()):(i["assignment field"]=null,this.model.set("rule",i)):this.altFieldCheckboxHandler(null,!0)},createRouteToDropdown:function(){var e=this.model.get("poolList"),t=_.filter(e,function(e){return e.value===this.model.get("rule")["round robin group id"]},this);this.routeToDropdown=new Magellan.Views.LDDropdown({required:!0,options:e,value:t.length>0?t[0]:null,placeholder:"Select a Round Robin Pool",optionTemplate:function(e){return _.template("<span><%=option.label%></span>")({option:e})},onChange:function(e){var t=this.model.get("rule");t["round robin group name"]=e.label,t["round robin group id"]=e.value,this.model.set("rule",t)}.bind(this)}),this.routeToDropdown.validate(),this.$el.find(".route-to-dropdown").html(this.routeToDropdown.$el)},render:function(){var e=this.template({ruleName:this.model.get("rule").name});return this.$el.html(e),this.$el.find(".rule-conditions").html(this.tupleConditionsView.$el),this.createAltOwnerFieldDropdown(),this.createRouteToDropdown(),this}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({defaults:{},initialize:function(e){var t=e.objectType,i=Magellan.Util.getPluralObjectName(t);console.log(e),this.set("objectType",t),this.set("routingTypes",[{label:"New "+i,value:"new"},{label:"Update "+i,value:"update"}]);var n="Update"===window.liveRoutingTriggerType?this.get("routingTypes")[1]:this.get("routingTypes")[0];this.set("selectedRoutingType",n),window.liveRoutingTriggerType=null,this.set("newRules",e.rules.newRules),this.set("updateRules",e.rules.updateRules),this.set("poolList",e.poolList),this.set("total",e.total),this.set("records",e.records),this.set("createdDate",e.createdDate),this.set("creator",e.creator),this.set("deploymentId",e.deploymentId),this.set("originalNewRules",JSON.stringify(this.get("newRules"))),this.set("originalUpdateRules",JSON.stringify(this.get("updateRules")))},getDurationDeployed:function(){var e=this.get("createdDate");if(null==e)return"No graph deployed";var t=Date.now(),i=moment(t).diff(moment(new Date(e)),"days"),n=moment(t).diff(moment(new Date(e)),"hours"),a=moment(t).diff(moment(new Date(e)),"minutes"),o=moment(t).diff(moment(new Date(e)),"seconds");return o<60?o+" seconds":a<60?a+" minutes":n<=24?n+" hours":1==i?i+" day":i+" days"},getCurrentRules:function(){var e=this.get("selectedRoutingType");return this.get(e.value+"Rules")},updateRules:function(e){var t=this.get("selectedRoutingType");this.set(t.value+"Rules",e)},duplicateRule:function(e){var t=this.getCurrentRules(),i=_.cloneDeep(t[e]);i.name=i.name+" - Copy",i.target=i.target+" - Copy",t.push(i),this.updateRules(t),this.validateChanges()},deleteRule:function(e){var t=this.getCurrentRules();t.splice(e,1),this.updateRules(t),this.validateChanges()},saveRule:function(e,t,i){var n=t.toLowerCase()+"Rules",a=this.get(n);_.isUndefined(i)?a.push(e):a[i]=e,this.set(n,a),this.validateChanges()},invalidRuleIndexes:function(e){var t=new Set,i=Magellan.Controllers.FlowBuilder.getCustomUserFieldsByObject(this.get("objectType"));let n={};return _.each(e,function(e,a){var o=_.reduce(e.conditions,function(e,t){return e&&Magellan.Validation.validateSingleCondition(t,this.get("objectType"),this.get("objectType"))},!0,this),l=_.filter(this.get("poolList"),function(t){return t.value===e["round robin group id"]},this);if(o=(o=o&&l.length>0)&&!_.isEmpty(e.name)&&!_.isEmpty(e.target)&&!_.isEmpty(e["round robin group id"])&&0===Magellan.Util.parseLogic(e.conditions.length,e.logic).feedbackMessage.length,!_.isNull(e["assignment field"])){var s=_.filter(i,function(t){return t.name===e["assignment field"].replace("__c","__r.id")});o=o&&s.length>0}n[e.name]=null==n[e.name]?1:n[e.name]+1,o||t.add(a)},this),_.each(e,function(e,i){n[e.name]>1&&t.add(i)}),t},invalidRulesets:function(){var e=this.get("newRules"),t=this.get("updateRules"),i=new Set,n=this.invalidRuleIndexes(e);_.each(Array.from(n),function(t){i.add("New: "+e[t].name)},this);var a=this.invalidRuleIndexes(t);return _.each(Array.from(a),function(e){i.add("Update: "+t[e].name)},this),i},revertChanges:function(){var e=JSON.parse(this.get("originalNewRules")),t=JSON.parse(this.get("originalUpdateRules"));this.set("newRules",e),this.set("updateRules",t),this.validateChanges()},validateChanges:function(){var e=$(".live-routing-save-bar");this.hasChanged()?e.slideDown(100):e.slideUp(100),this.trigger("renderAfterValidate")},hasChanged:function(){return this.get("originalNewRules")!==JSON.stringify(this.get("newRules"))||this.get("originalUpdateRules")!==JSON.stringify(this.get("updateRules"))},saveToServer:function(){var e=$.Deferred(),t={},i=this.get("objectType").toLowerCase();t[i]={},t[i].insert=JSON.stringify(this.get("newRules")),t[i].update=JSON.stringify(this.get("updateRules"));var n=JSON.stringify(t),a=Magellan.Controllers.GUI.appWaitingScreen.show("Saving rules...");return Magellan.Services.FlowBuilder.saveLiveRoundRobinSettings(n).then(function(n){this.set("originalNewRules",t[i].insert),this.set("originalUpdateRules",t[i].update),this.trigger("renderAfterValidate"),e.resolve()}.bind(this)).fail(function(){Magellan.Views.LiveRoutingErrorBanner.show("An error occured when trying to save rules. See console for more details."," "),e.reject()}).always(function(){a.resolve()}),e}})}},function(e,t,i){e.exports=function(){var e=i(210)();return Backbone.View.extend({template:_.template(i(299)),initialize:function(){this.listenTo(this.model,"renderAfterValidate",this.render),this.editMode=!1,this.currentRuleEditorView,this.currentRuleRow,this.render()},events:{"click .add-live-routing-rule":"addRule","click .delete-live-routing-rule":"deleteRule","click .rules-table-row":"editRule","click .duplicate-live-routing-rule":"duplicateRule","click .live-routing-rule-metrics":"goToLiveRuleMetric"},disableModification:function(e){this.editMode=e,this.$el.find(".routing-type-filter .ld-dropdown").toggleClass("disabled",e),this.$el.find(".add-live-routing-rule").toggleClass("disabled",e),this.$el.find(".duplicate-live-routing-rule").toggleClass("disabled",e),this.$el.find(".delete-live-routing-rule").toggleClass("disabled",e),this.$el.find(".live-routing-rule-metrics").toggleClass("disabled",e),$(".live-routing-tab").toggleClass("disabled",e),$(".live-routing-save-rules-btn").toggleClass("disabled",e),$(".live-routing-cancel-rules-btn").toggleClass("disabled",e),e?(this.$el.find(".rules-sortable").sortable("disable"),this.listenToOnce(this.currentRuleEditorView,"disableModification",this.disableModification),this.listenToOnce(this.currentRuleEditorView,"saveRule",this.model.saveRule.bind(this.model)),this.listenToOnce(this.currentRuleEditorView,"cancelRule",this.model.validateChanges.bind(this.model))):(this.$el.find(".rules-sortable").sortable("enable"),this.currentRuleRow&&(this.currentRuleRow.show(),this.currentRuleRow=null))},addRule:function(t){this.editMode||(this.currentRuleEditorView=new e({objectType:this.model.get("objectType"),selectedRoutingType:this.model.get("selectedRoutingType").value,poolList:this.model.get("poolList")}),this.$el.find(".new-rule-table-row").append(this.currentRuleEditorView.$el),this.disableModification(!0))},duplicateRule:function(e){if(!this.editMode){var t=$(e.target).closest(".rules-list-item").data("ruleNumber");this.model.duplicateRule(t)}},goToLiveRuleMetric:function(e){if(!this.editMode){var t=$(e.target).closest(".rules-list-item").data("ruleNumber"),i=this.model.getCurrentRules()[t],n=this.model.get("createdDate"),a=new Date(n).getTime(),o=this.model.get("selectedRoutingType").value,l="update"==o?"updated":o,s=this.model.get("objectType").toLowerCase(),r=this.model.get("deploymentId");if(null!=r){var d="/apex/Dashboard?deploymentId="+r+"&nodeName="+encodeURIComponent(i.name)+"&userStartDate="+a+"&userEndDate=null&objectType="+s+"&statType="+l;window.open(d+"&statusKey=success#routing/"+s+"/metrics")}}},deleteRule:function(e){this.editMode||new Magellan.Views.ConfirmationModal({header:"Delete Rule",message:"Are you sure you want to delete this rule?",onConfirmed:function(){var t=$(e.target).closest(".rules-list-item").data("ruleNumber");this.model.deleteRule(t)}.bind(this)}).open()},editRule:function(t){var i=$(t.target);if(!(this.editMode||i.hasClass("duplicate-live-routing-rule")||i.hasClass("delete-live-routing-rule")||i.hasClass("live-routing-rule-metrics"))){var n=i.closest(".rules-list-item"),a=n.data("ruleNumber"),o=this.model.getCurrentRules()[a];this.currentRuleEditorView=new e({objectType:this.model.get("objectType"),selectedRoutingType:this.model.get("selectedRoutingType").value,rule:o,ruleIndex:a,poolList:this.model.get("poolList")}),n.after(this.currentRuleEditorView.$el),n.hide(),this.currentRuleRow=n,this.disableModification(!0)}},createRoutingTypeDropdown:function(){this.routingTypeDropdown=new Magellan.Views.LDDropdown({options:this.model.get("routingTypes"),value:this.model.get("selectedRoutingType"),optionTemplate:function(e){return _.template("<span><%=option.label%></span>")({option:e})},onChange:function(e){this.model.set("selectedRoutingType",e),this.disableModification(!1),this.model.validateChanges(),this.render()}.bind(this)}),this.$el.find(".routing-type-filter").html(this.routingTypeDropdown.$el)},createSortableList:function(){this.$el.find(".rules-sortable").sortable({handle:".drag-column",cursor:"grabbing, -moz-grabbing, -webkit-grabbing"}),this.$el.find(".rules-sortable").on("sortstop",function(e){var t=[],i=this.model.getCurrentRules();_.each($(e.target).children(),function(e){t.push(i[$(e).data("rule-number")])}),this.model.set(this.model.get("selectedRoutingType").value+"Rules",t),this.model.validateChanges()}.bind(this))},render:function(){var e=this.model.getCurrentRules(),t=this.model.invalidRuleIndexes(e),i=this.template({rules:e,invalidRuleIndexes:t,poolIdToPoolMap:this.model.get("poolIdToPoolMap"),duration:this.model.getDurationDeployed(),createdDate:this.model.get("createdDate"),totalRecords:this.model.get("total"),records:this.model.get("records"),creator:this.model.get("creator")});return this.$el.html(i),this.createRoutingTypeDropdown(),this.createSortableList(),this}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({defaults:{objectType:"Lead",viewModels:{},rules:{Lead:{newRules:[],updateRules:[]},Contact:{newRules:[],updateRules:[]},Account:{newRules:[],updateRules:[]},Opportunity:{newRules:[],updateRules:[]}},pools:{Lead:[],Contact:[],Account:[],Opportunity:[]},records:{Lead:{},Contact:{},Account:{},Opportunity:{}},total:{Lead:0,Contact:0,Account:0,Opportunity:0},creator:{Lead:"",Contact:"",Account:"",Opportunity:""},createdDate:{Lead:null,Contact:null,Account:null,Opportunity:null},deploymentId:{Lead:null,Contact:null,Account:null,Opportunity:null},poolIdToPoolMap:{}},fetchData:function(){var e=$.Deferred(),t=Magellan.Services.FlowBuilder.getRoundRobinPoolSettings({}),i=Magellan.Services.FlowBuilder.getLiveRoundRobinSettings(),n=Magellan.Services.FlowBuilder.getLiveRoundRobinMetrics();return $.when(t,i,n).then(function(e,t,i){var n=this.get("pools"),a={};_.each(e[0],function(e){e=e.attributes,_.isEmpty(e.Pool_Type__c)||"live"!==e.Pool_Type__c.toLowerCase()||(n[e.Object_Type__c].push({label:e.Grouping_Name__c,value:e.Id}),a[e.Id]=e)},this),this.set("pools",n),this.set("poolIdToPoolMap",a);var o=this.get("rules");_.each(t[0],function(e,t){var i=_.capitalize(t);o[i].newRules=JSON.parse(_.unescape(e.insert)),o[i].updateRules=JSON.parse(_.unescape(e.update))},this);var l=this.get("records"),s=this.get("total"),r=this.get("createdDate"),d=this.get("creator"),c=this.get("deploymentId");_.each(i[0],function(e,t){var i=_.capitalize(t);s[i]=e.TotalRecords,e.metrics.forEach(function(e){"Next Node"!=e.edge&&"Not Available For Routing"!=e.edge&&"Invalid Group"!=e.edge||(l[i][e.node]?l[i][e.node]+=e.count:l[i][e.node]=e.count)}),d[i]=e.Creator,r[i]=e.CreatedDate,c[i]=e.deploymentId},this),this.set("deploymentId",c),this.set("createdDate",r),this.set("creator",d),this.set("total",s),this.set("records",l)}.bind(this)).fail(function(){Magellan.Views.LiveRoutingErrorBanner.show("Error fetching live routing data."," ")}).always(function(){e.resolve()}),e}})}},function(e,t,i){e.exports=function(){var e=i(211)(),t=i(212)();return Backbone.View.extend({id:"round-robin-live-routing-container",template:_.template(i(300)),events:{"click .live-routing-tab.ld-tab":"handleTabClick","click .live-routing-cancel-rules-btn":"revertRules","click .live-routing-save-rules-btn":"saveRules"},initialize:function(e){this.fetchData()},fetchData:function(){var e=Magellan.Controllers.GUI.appWaitingScreen.show("Loading Data...");this.model.fetchData().then(function(){e.resolve(),this.loadTabContent(window.liveRoutingSObjectType||"Lead"),window.liveRoutingSObjectType=null}.bind(this))},handleTabClick:function(e){var t=$(e.target);this.checkIfPageDirty(t.data("view"))},checkIfPageDirty:function(e){var t=this.model.get("viewModels"),i=this.model.get("objectType");i!==e&&!_.isEmpty(t[i])&&t[i].hasChanged()?new Magellan.Views.ConfirmationModal({header:"Changes Detected",message:"Are you sure you want to leave this page? ",footer:"",onConfirmed:function(){t[i].revertChanges(),this.loadTabContent(e)}.bind(this)}).open():this.loadTabContent(e)},loadTabContent:function(i){var n=this.model.get("viewModels");n[i]||(n[i]=new e({objectType:i,rules:this.model.get("rules")[i],poolList:this.model.get("pools")[i],poolIdToPoolMap:this.model.get("poolIdToPoolMap"),total:this.model.get("total")[i],records:this.model.get("records")[i],createdDate:this.model.get("createdDate")[i],creator:this.model.get("creator")[i],deploymentId:this.model.get("deploymentId")[i]}));var a=new t({model:n[i]});this.$el.find(".rules-table-container").html(a.$el),this.model.set("viewModels",n),this.$el.find(".ld-tab").removeClass("active"),this.$el.find(".ld-tab.lr-"+i.toLowerCase()+"-tab").addClass("active"),this.model.set("objectType",i)},revertRules:function(){this.model.get("viewModels")[this.model.get("objectType")].revertChanges()},saveRules:function(){var e=this.model.get("viewModels")[this.model.get("objectType")],t=e.invalidRulesets();t.size>0?new Magellan.Views.ConfirmationModal({header:"Error",message:"The following rules contain errors that must be resolved before being saved: <br/>"+Array.from(t).join("<br/>"),primaryButtonText:"Ok",hideSecondaryButton:!0}).open():e.saveToServer().then(function(){this.$el.find(".live-routing-save-bar").slideUp(100)}.bind(this))},render:function(){var e=this.template({viewStatus:dashboardController.viewObject.statuses});return this.$el.html(e),Magellan.Views.LiveRoutingErrorBanner=new Magellan.Views.ErrorBanner({container:".error-banner-wrapper",hideCloseButton:!1}),this}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(301)),initialize:function(){this.listenTo(this.model,"deletedMemberFromPools",this.render)},events:{"click .remove-from-all-pools-button":"removeFromAllPools"},removeFromAllPools:function(e){new Magellan.Views.ConfirmationModal({header:"Remove From All Pools",message:"Are you sure you want to remove this user from all pools? (This action cannot be undone)",onConfirmed:function(){this.model.removeFromAllPools()}.bind(this)}).open()},renderTable:function(){var e=this.model.get("memberPools");this.poolsTable=new Magellan.Views.LDTable({columns:[{name:"Pool Name",editor:new Magellan.Views.LDTableCellEditors.ReadOnly({}),readOnly:!0},{name:"Pool Type",editor:new Magellan.Views.LDTableCellEditors.ReadOnly({}),readOnly:!0},{name:"Object Type",editor:new Magellan.Views.LDTableCellEditors.ReadOnly({}),readOnly:!0},{name:"Working Hours",editor:new Magellan.Views.LDTableCellEditors.ReadOnly({}),readOnly:!0},{name:"Capping",editor:new Magellan.Views.LDTableCellEditors.ReadOnly({}),readOnly:!0},{name:"Weighting",editor:new Magellan.Views.LDTableCellEditors.ReadOnly({}),readOnly:!0}],data:e,isInlineEditorEnabled:!1,datatableOptions:{searching:!1,language:{emptyTable:this.model.get("memberName")+" is not a part a port of any existing pools."},order:[[0,"asc"]],disableRowHover:!0,columnDefs:[{targets:0,width:"325px"},{targets:1,width:"100px"},{targets:2,width:"100px"},{targets:3,width:"250px"},{targets:4,width:"130px"}],paginate:!0,pageLength:10}}),this.$el.find("#member-pools-table").html(this.poolsTable.$el),this.poolsTable.render()},render:function(){var e=this.template({isEmpty:0===this.model.get("memberPools").length});return this.$el.html(e),_.defer(this.renderTable.bind(this)),this}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(302)),initialize:function(){this.listenTo(this.model,"refreshVacationsTableData",this.renderTable),this.vacationsToDelete=[],this.rowData,this.vacationData},events:{"click .add-vacation-button":"addVacationRow","click .delete-button":"handleDeleteRowClick"},addVacationRow:function(e){$(e.target).hasClass("disabled-by-edit")||(this.vacationsTable.addRow(),this.disableTabs(!0))},disableTabs:function(e){$(".member-detail-pools-tab").toggleClass("disabled",e)},cleanupVacations:function(){var e=_.filter(this.model.get("memberVacations"),function(e){var t=Date.now(),i=+moment(e[1]),n=+moment(e[2]),a=i<n&&n+864e5>t;return a||this.vacationsToDelete.push(e.Id),a},this);this.model.set("memberVacations",e)},saveVacations:function(){this.model.updateVacationChanges(this.rowData,this.vacationData,this.vacationsToDelete)},renderTable:function(){this.cleanupVacations();var e=this.model.get("memberVacations");this.vacationsTable=new Magellan.Views.LDTable({columns:[{name:"Vacation Name",editor:new Magellan.Views.LDTableCellEditors.Text({placeholder:"Enter Vacation Name"})},{name:"Start Date/time",editor:new Magellan.Views.LDTableCellEditors.DateTime({placeholder:"Start Date/Time"})},{name:"End Date/time",editor:new Magellan.Views.LDTableCellEditors.DateTime({placeholder:"End Date/Time",isEndDate:!0})},{name:"Timezone",editor:new Magellan.Views.LDTableCellEditors.ReadOnly({placeholder:this.model.get("memberTimezone")})}],data:e,isInlineEditorEnabled:!0,datatableOptions:{searching:!1,language:{emptyTable:"Click 'Add Vacation' to begin."},order:[[1,"asc"]],ordering:!0,additionalRowDataAttributes:[{prop:"data-vacation-id",dataVal:"Id"}]}}),this.$el.find("#member-vacations-table").html(this.vacationsTable.$el),this.vacationsTable.render(),this.listenTo(this.vacationsTable,"change delete cancel",function(e){this.disableTabs(!1);var t=this.vacationsTable.getData();this.model.set("memberVacations",t),this.rowData=this.vacationsTable.table.rows().nodes().to$(),this.vacationData=this.vacationsTable.getNamedData()}.bind(this)),this.listenTo(this.vacationsTable,"change",function(e){this.trigger("showDirtyBar",!0)}.bind(this)),this.listenTo(this.vacationsTable,"delete",function(e){_.isEmpty(e.Id)?console.warn("invalid rowId requested for deletion"):(this.vacationsToDelete.push(e.Id),this.trigger("showDirtyBar",!0))}.bind(this))},render:function(){var e=this.template({});return this.$el.html(e),_.defer(this.renderTable.bind(this)),this}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({defaults:{isQueue:!1,memberId:"",memberName:null,memberTimezone:null,memberPools:[],memberVacations:[],tab:""},initialize:function(e){this.set("memberId",e.memberId),this.set("tab",e.tab)},fetchData:function(){var e,t=$.Deferred(),i=Magellan.Services.FlowBuilder.getRoundRobinMembers({});e=autoNavigateToMembers?Magellan.Services.FlowBuilder.getRoundRobinPoolSettings('{"memberView" : true}'):Magellan.Services.FlowBuilder.getRoundRobinPoolSettings();var n=Magellan.Services.FlowBuilder.getRoundRobinScheduleSettings();return $.when(i,e,n).then(function(e,i,n){var a={};_.each(i[0],function(e){a[e.attributes.Id]=e.attributes,a[e.attributes.Id].memberCount=e.memberCount},this);var o={},l=[];_.each(n[0],function(e){"workingHours"===e.type?o[e.attributes.Id]=e.attributes:"vacation"===e.type&&e.attributes.Vacation_User__c===this.get("memberId")&&l.push(e)},this);var s=e[0].splice(1),r={};_.each(s,function(e){var t=e.attributes.Grouping__c,i=e.attributes.Weighting_Value__c;r[t]||(r[t]=0),r[t]+=i});var d=s.filter(function(e){return!_.isEmpty(a[e.attributes.Grouping__c])&&e.attributes.OwnerId__c===this.get("memberId")}.bind(this)).map(function(e){_.isEmpty(e.attributes.User_Owner__r)?(this.set("memberName",e.queueInfo?e.queueInfo.Name:e.attributes.OwnerId__c),this.set("memberTimezone",""),this.set("isQueue",!0)):(this.set("memberName",e.attributes.User_Owner__r.Name),this.set("memberTimezone",e.attributes.User_Owner__r.TimeZoneSidKey));var t=e.attributes.Grouping__c,i=a[t],n=[];n.push(i.Grouping_Name__c||""),n.push(_.isEmpty(i.Pool_Type__c)?"Standard":_.capitalize(i.Pool_Type__c)),n.push(i.Object_Type__c||""),n.push(o[i.Working_Hours__c]?_.unescape(o[i.Working_Hours__c].Name):"");var l="";if(_.isEmpty(i.Capping_Type__c))l="None";else{var s=e.attributes.Current_Cap_Value__c||0,d=i.Capping_Limit__c||"";l=_.capitalize(i.Capping_Type__c)+"  "+s+"/"+d}return n.push(l),n.push(i.Weighting_Enabled__c?(e.attributes.Weighting_Value__c/r[t]*100).toFixed(0)+"%":"None"),n}.bind(this));if(this.set("memberPools",d),!this.get("isQueue")){var c=[];_.each(l,function(e){console.log("actual vacation info",e.attributes);var t=JSON.parse(_.unescape(e.attributes.Schedule_Data__c)),i=[];i.push(_.unescape(e.attributes.Name)),i.push(Magellan.Util.formatGMTDateTimeToTimezone(t.startDate,this.get("memberTimezone"))),i.push(Magellan.Util.formatGMTDateTimeToTimezone(t.endDate,this.get("memberTimezone"))),i.push(this.get("memberTimezone")||""),i.Id=e.attributes.Id,c.push(i)},this),this.set("memberVacations",c)}t.resolve()}.bind(this)),t},removeFromAllPools:function(){if(this.get("memberPools").length>0){var e=this.get("memberId"),t=Magellan.Controllers.GUI.appWaitingScreen.show("Clearing member from pools");Magellan.Services.FlowBuilder.deleteRoundRobinMembersByOwnerId(e).then(function(e){this.set("memberPools",[]),this.trigger("deletedMemberFromPools")}.bind(this)).always(function(){t.resolve()})}},updateVacationChanges:function(e,t,i){var n=_.map(e,function(e,i){var n=$(e).data("vacationId"),a=t[i],o={Name:a["Vacation Name"],Vacation_User__c:this.get("memberId"),Schedule_Data__c:JSON.stringify({startDate:Magellan.Util.formatDateToUTCWithTimezoneOffset(a["Start Date/time"],this.get("memberTimezone")),endDate:Magellan.Util.formatDateToUTCWithTimezoneOffset(a["End Date/time"],this.get("memberTimezone"))}),Timezone__c:a.Timezone,Schedule_Type__c:"vacation"};return _.isEmpty(n)||(o.Id=n),o},this),a=_.map(n,function(e){var t={attributes:e},i=JSON.stringify(t);return Magellan.Services.FlowBuilder.upsertRoundRobinScheduleSettings(i)},this);if(i.length>0){var o=JSON.stringify({settingsToDelete:i});a.push(Magellan.Services.FlowBuilder.deleteRoundRobinScheduleSettings(o))}var l=Magellan.Controllers.GUI.appWaitingScreen.show("Applying Changes to Vacation Settings...");$.when.apply($,a).then(function(){return this.fetchData()}.bind(this)).then(function(){l.resolve(),this.trigger("refreshVacationsTableData")}.bind(this))}})}},function(e,t,i){e.exports=function(){var e=i(215)(),t=i(216)();return Backbone.View.extend({id:"round-robin-member-details-container",template:_.template(i(303)),initialize:function(e){this.fetchUserDetails()},events:{"click #member-details-breadcrumb":"handleBreadcrumbClick","click .member-detail-pools-tab.ld-tab":"handleTabClick","click .member-details-vacation-btn.save":"saveButtonHandler","click .member-details-vacation-btn.cancel":"cancelButtonHandler"},handleBreadcrumbClick:function(e){Magellan.Navigation.navigate("routing/round_robin_members")},handleTabClick:function(e){var t=$(e.target).data("view");this.model.set("tab",t.replace("View","")),this.loadTabContent(t)},loadTabContent:function(i){this[i]||(this[i]="vacationsView"===i?new t({model:this.model}):new e({model:this.model}),this.listenTo(this[i],"showDirtyBar",this.showDirtyBar)),this[i].delegateEvents(),this[i].render(),this.$el.find(".ld-tab").removeClass("active"),this.$el.find(".ld-tab."+i).addClass("active"),this.$el.find(".tab-content").html(this[i].$el)},saveButtonHandler:function(){this.vacationsView.saveVacations(),this.showDirtyBar(!1)},cancelButtonHandler:function(){this.showDirtyBar(!1)},showDirtyBar:function(e){var t=this.$el.find(".save-bar");Magellan.Navigation.promptAreYouSure=e,e?t.slideDown(100):t.slideUp(100)},fetchUserDetails:function(){var e=Magellan.Controllers.GUI.appWaitingScreen.show("Loading Data...");this.model.fetchData().then(function(){e.resolve(),this.render()}.bind(this))},hideSidebarForMembers:function(){var e=Magellan.Util.getUrlParams();e.blinders&&"true"===e.blinders&&($(".left-sidebar, .breadcrumb-container, .remove-from-all-pools-button").hide(),$(".bs .main-content").css("padding-left","30px"))},render:function(){var e=this.template({name:this.model.get("memberName"),memberId:this.model.get("memberId"),invalidMember:null===this.model.get("memberName"),isQueue:this.model.get("isQueue"),hideBreadcrumb:autoNavigateToMembers});this.$el.html(e),this.hideSidebarForMembers();var t=this.model.get("tab");return this.loadTabContent(t?t+"View":"poolsView"),this}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({defaults:{objectTypes:Magellan.Util.objectTypes,membersList:[],poolIdToPoolMap:{}},initialize:function(e){this.set("filteredObjectTypeList",this.get("objectTypes")),this.set("filteredPoolTypeList",this.get("poolTypes"));var t=["Standard"];dashboardController.viewObject.statuses.hasLiveRouting&&t.push("Live"),this.set("poolTypes",t)},fetchData:function(){var e=$.Deferred(),t=Magellan.Services.FlowBuilder.getRoundRobinMembers({}),i=Magellan.Services.FlowBuilder.getRoundRobinPoolSettings({}),n=Magellan.Services.FlowBuilder.getRoundRobinScheduleSettings();return $.when(t,i,n).then(function(t,i,n){var a={};_.each(n[0],function(e){"vacation"===e.type&&(_.isEmpty(a[e.attributes.Vacation_User__c])&&(a[e.attributes.Vacation_User__c]={},a[e.attributes.Vacation_User__c].vacations=[],a[e.attributes.Vacation_User__c].isOnVacation=!1,a[e.attributes.Vacation_User__c].vacationText=""),a[e.attributes.Vacation_User__c].vacations.push(JSON.parse(_.unescape(e.attributes.Schedule_Data__c))))},this);var o={};_.each(i[0],function(e){e=e.attributes,o[e.Id]=e},this);var l={};_.each(t[0][0].recordCounts,function(e){_.isEmpty(l[e.Post_Owner__c])&&(l[e.Post_Owner__c]={}),l[e.Post_Owner__c][e.Round_Robin_Pool__c]=e.cnt}),l={"0051I000001yoaqQAA":{a111I000000xqhRQAQ:1}},console.log("ownerIdToPoolIdCountMap",l);var s={};_.each(t[0],function(e){if(!_.isEmpty(e.attributes)){var t=e.queueInfo;if(e=e.attributes,o[e.Grouping__c]&&(e.Grouping__r=o[e.Grouping__c],!_.isEmpty(e.OwnerId__c)||!_.isEmpty(e.User_Owner__c)&&!_.isEmpty(e.User_Owner__r))){if(_.isEmpty(s[e.OwnerId__c])){var i=e.User_Owner__r?e.User_Owner__r:{Id:e.OwnerId__c,Name:t?t.Name:e.OwnerId__c,IsActive:!_.isEmpty(t)};s[e.OwnerId__c]=i,s[e.OwnerId__c].roundRobinSettings=[]}var n=0;_.isEmpty(l[e.OwnerId__c])||(n=l[e.OwnerId__c][e.Grouping__c]||0);var a={attributes:e,insights:{totalRoutedInPool:n}};s[e.OwnerId__c].roundRobinSettings.push(a)}}},this),console.log("memberIdMap",s),_.each(a,function(e,t){var i=s[t];if(i){var n=Date.now(),o=e.vacations;o.sort(function(e,t){return+moment(e.startDate)-+moment(t.startDate)});var l=0;_.each(o,function(e,o){n>+moment(e.startDate)&&n<+moment(e.endDate)&&!a[t].isOnVacation&&(a[t].isOnVacation=!0,a[t].vacationText="Returns "+Magellan.Util.formatGMTDateTimeToTimezone(e.endDate,i.TimeZoneSidKey)),+moment(e.startDate)<n&&(l=o)}),!a[t].isOnVacation&&o.length>0&&(a[t].vacationText=Magellan.Util.formatGMTDateTimeToTimezone(o[l].startDate,i.TimeZoneSidKey)+" to <br>"+Magellan.Util.formatGMTDateTimeToTimezone(o[l].endDate,i.TimeZoneSidKey))}});var r=[];for(var d in s){var c=s[d],u=c.TimeZoneSidKey?"<br />("+c.TimeZoneSidKey+")":"";c.isOnVacation=!!a[c.Id]&&a[c.Id].isOnVacation,c.vacationText=a[c.Id]?a[c.Id].vacationText+u:"",r.push(c)}this.set("membersList",r),e.resolve()}.bind(this)),e},filterData:function(){var e=this.get("membersList"),t=this.get("filteredObjectTypeList"),i=this.get("filteredPoolTypeList")||["Standard","Live"],n=[];return _.each(_.cloneDeep(e),function(e){var a=_.filter(e.roundRobinSettings,function(e){var n=e.attributes.Grouping__r,a=!0;return a=_.isEmpty(n.Pool_Type__c)?i.includes("Standard"):i.includes(_.capitalize(n.Pool_Type__c)),t.includes(n.Object_Type__c)&&a},this);a.length>0&&(e.roundRobinSettings=a,n.push(e))},this),n}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({id:"round-robin-members-container",template:_.template(i(304)),events:{"click .clear-search-filter-btn":"clearInput","click #members-list-table tbody tr":"handleRowClick","keyup #rr-members-search-filter-input":"handleInputChange"},initialize:function(){this.fetchData()},handleInputChange:function(e){var t=$(e.currentTarget).val();this.searchMembers(t)},clearInput:function(e){e.stopPropagation(),e.preventDefault(),this.$el.find("#rr-members-search-filter-input").val(""),this.searchMembers("")},searchMembers:function(e){this.userTable.search(e).draw()},handleRowClick:function(e){var t=$(e.target).closest("div");if(t.hasClass("pool"))return Magellan.Navigation.navigate("routing/round_robin_pools/creator/"+t.data("poolId"));var i=$(e.target).closest("tr").data("memberId");if(!_.isEmpty(i)){var n=$(e.target).closest("span").hasClass("vacation-col");Magellan.Navigation.selectedRoundRobinMemberTab=n?"vacations":"pools",Magellan.Navigation.navigate("routing/round_robin_members/"+i)}},renderFilterDropdowns:function(){var e=this.model.get("objectTypes"),t=this.model.get("poolTypes");this.$el.find(".object-type-filter").MultiSelectDropdown({selectAll:!0,dropdownType:"Object Types",options:e.map(function(e){return{label:e,value:e}}),onChange:function(e,t){this.model.set("filteredObjectTypeList",t),this.redrawTable()}.bind(this),generatePlaceholder:this.generatePlaceholders}),this.$el.find(".pool-type-filter").MultiSelectDropdown({selectAll:!0,dropdownType:"Pool Types",options:t.map(function(e){return{label:e,value:e}}),onChange:function(e,t){this.model.set("filteredPoolTypeList",t),this.redrawTable()}.bind(this),generatePlaceholder:this.generatePlaceholders})},generatePlaceholders:function(e,t,e,i,n){return t.length===i?n+': <span class="semi-bold">All</span>':0===t.length?n+': <span class="semi-bold">None</span>':1===t.length?n+': <span class="semi-bold">'+t[0]+"</span>":n+': <span class="semi-bold">'+t.length+" Types</span>"},fetchData:function(){var e=Magellan.Controllers.GUI.appWaitingScreen.show("Loading Data...");this.model.fetchData().then(function(){e.resolve(),this.renderTable()}.bind(this))},redrawTable:function(){var e=this.model.filterData(),t=this.userTable;t.clear(),t.rows.add(e),t.draw()},renderTable:function(){console.log("[members.view] membersList: ",this.model.get("membersList"));var e=this.model.get("membersList");this.userTable=this.$el.find("#members-list-table").DataTable({order:[[2,"asc"],[1,"asc"]],ordering:!0,paging:!0,pageLength:10,info:!0,dom:"tip",language:{emptyTable:"No members available in Round Robin pools",info:"Showing _START_ to _END_ of _TOTAL_ members"},createdRow:function(e,t,i){$(e).attr("data-member-id",t.Id)},columns:[{title:"",width:"20px",data:"isOnVacation",render:function(e,t,i,n){return e?'<div class="vacation-icon"></div>':""}},{title:"Member Name",width:"200px",render:function(e,t,i,n){return'<span class="'+(i.IsActive?"":"red")+'">'+((i.Name||"")+(i.IsActive?"":" (Inactive)"))+"</span>"}},{title:"Vacation",width:"200px",data:"vacationText",type:"html",render:function(e,t,i,n){return'<span style="display:none;">'+(e.includes("Return")?0:0===e.length?2:1)+'</span><span class="vacation-col">'+e+"</span>"}},{title:"Pools",data:"roundRobinSettings",render:function(e,t,i,n){var a="";return _.each(e,function(e){var t=e.attributes.Grouping__r;a+='<div class="pool" data-pool-id="'+t.Id+'">'+t.Grouping_Name__c+"</div>"},this),a}.bind(this)}],data:e})},render:function(){var e=this.template({});return this.$el.html(e),_.defer(this.renderFilterDropdowns.bind(this)),this}})}},function(e,t,i){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),Magellan.Views.RoundRobinPoolsCreatorTabs.AdvancedSettings=Backbone.View.extend({template:_.template(i(305)),initialize:function(e){this.hoursCreatorView=new Magellan.Views.RoundRobinSchedulesHoursCreator({parentView:this,inlineMode:!0}),this.hoursCreatorView.model.on("change",this.handleHoursCreatorChange,this)},events:{"click .ld-tab":"handleTabClick","change input[name=capping]":"handleCappingTypeChange","change .cap-limit-input":"handleCapLimitChange","click .inline-working-hours .revert-button":"handleWorkingHoursRevert","nestedTypeaheadSelector:select .capping-timezone-dropdown":"handleTimezoneChange"},handleTimezoneChange:function(e,t){this.model.set({Timezone__c:t.selection[0].id}),this.renderCappingSettings()},handleHoursCreatorChange:function(e){this.model.hoursCreatorData={model:this.hoursCreatorView.model},this.model.set("Timezone__c",this.hoursCreatorView.model.get("Timezone__c")),this.renderCappingSettings(),this.model.trigger("change")},handleWorkingHoursRevert:function(e){this.workingHoursDropdown.model.set("value",null),this.workingHoursDropdown.render()},handleCapLimitChange:function(e){var t=$(e.target),i=t.val();t.toggleClass("input-invalid",!parseInt(i)),this.model.set("Capping_Limit__c",i),this.renderCappingSettings()},handleTabClick:function(e){var t=$(e.target);["schedules","capping"].forEach(function(e){t.hasClass(e)&&this.switchTab(e)}.bind(this))},handleCappingTypeChange:function(e){var t=$(e.target).val();t=["hourly","daily","weekly"].includes(t)?t:null;var i=this.model.originalAttributes.Capping_Type__c,n=_.bind(function(t){this.$el.find(".capping-section").removeClass("selected"),$(e.target).parents(".capping-section:not(:first-child)").addClass("selected"),this.model.set("Capping_Type__c",t),this.model.trigger("change"),this.renderCappingSettings()},this);if(_.isEmpty(i)||"none"===i||i===t)return n(t);new Magellan.Views.ConfirmationModal({header:"Confirm Capping Change",message:"Are you sure you want to change the capping model?",footer:"This will reset capping for all members.",onConfirmed:function(){n(t)}.bind(this),onCancelled:function(){var e=null===this.model.get("Capping_Type__c")?"none":this.model.get("Capping_Type__c");this.$el.find('input[name="capping"][value="'+e+'"]').prop("checked",!0)}.bind(this)}).open()},switchTab:function(e){this.$el.find(".sub-tab-content").hide(),this.$el.find(".sub-tab-content."+e).show()},render:function(){var e=this.template({Capping_Type__c:this.model.get("Capping_Type__c"),Capping_Limit__c:this.model.get("Capping_Limit__c")});return this.$el.html(e),function initDropdowns(){var e=this,t=this.model.scheduleSettings.workingHours.filter(function(e){return!0===e.attributes.Is_Template__c}).map(function(e){return e.attributes.Id});t.unshift("new"),t.unshift(null);var i=this.model.get("Working_Hours__c"),n=_.find(this.model.scheduleSettings.workingHours,function(e){return e.attributes.Id===i},this);!_.isEmpty(n)&&n.attributes.Id.startsWith(n.attributes.Name)&&this.$el.find("#working-hours-dropdown").hide();var a=this.workingHoursDropdown=new Magellan.Views.LDDropdown({value:this.model.get("Working_Hours__c"),options:t,placeholder:"Default (24/7)",preferredOptions:["new"],hidePreferredOptions:!0,size:"large",optionTemplate:function(t){if("new"===t)return _.template("<span>Create Working Hours</span>")();if(null===t)return _.template("<span>Default (24/7)</span>")();var i=_.find(e.model.scheduleSettings.workingHours,function(e){return e.attributes.Id===t}),n=i.attributes.Name;return _.template("<span><%= name %></span>")({name:n})},onChange:function(t){var i=this;if(!0!==i.ignoreNextChange)if(t!==e.model.get("Working_Hours__c")&&!e.hoursCreatorView.readOnly&&e.model.get("Working_Hours__c")){var n=new Magellan.Views.ConfirmationModal({header:"Discard working hours",message:"Are you sure you want to discard these working hours? ",footer:"",onConfirmed:runDropdownAction,onCancelled:function(){i.ignoreNextChange=!0,i.model.set("value",e.model.get("Working_Hours__c"))}});n.open()}else runDropdownAction();else i.ignoreNextChange=!1;function runDropdownAction(){if("new"===t)return e.$el.find("#working-hours-dropdown").hide(),e.model.set("Working_Hours__c","new"),e.hoursCreatorView.sideloadData({Description__c:"Custom work hours"},"editable"),void e.renderHoursCreator();null===t&&(e.model.hoursCreatorData=null),e.model.hoursCreatorData&&!0===e.model.hoursCreatorData.model.get("Is_Template__c")&&(e.model.hoursCreatorData=null),e.model.set("Working_Hours__c",t),e.model.setTimezoneFromWorkingHours(),e.renderCappingSettings(),e.renderHoursCreator(),e.$el.find("#working-hours-dropdown").show()}}});a.validate(),this.$el.find("#working-hours-dropdown").html(a.$el);var o=this.model.scheduleSettings.holidays.map(function(e){return e.attributes.Id});o.unshift(null);var l=new Magellan.Views.LDDropdown({value:this.model.get("Holidays__c"),options:o,placeholder:"No Holidays",size:"large",optionTemplate:function(e){if(null===e)return _.template("<span>None</span>")();var t=_.find(this.model.scheduleSettings.holidays,function(t){return t.attributes.Id===e}),i=t.attributes.Name;return _.template("<span><%= name %></span>")({name:i})}.bind(this),onChange:function(e){this.model.set("Holidays__c",e)}.bind(this)});l.validate(),this.$el.find("#holidays-dropdown").html(l.$el)}.call(this),function initTooltips(){Magellan.Util.initializeTooltip(this.$el.find(".working-hours-field.ld-tooltip-hint"),{title:"Working Hours",body:"Apply a set of Working Hours to a pool to indicate when the Members of this pool are available for routing. Records that reach this pool outside of these hours will follow the 'Not Available for Routing' path in routing graphs, allowing for contingency planning."}),Magellan.Util.initializeTooltip(this.$el.find(".holidays-field.ld-tooltip-hint"),{title:"Holidays",body:"Apply a set of Holidays to a Pool to prevent routing to Members on those days & times. Records that reach this pool on a Holiday will follow the 'Not Available for Routing' path in routing graphs, allowing for contingency planning."}),Magellan.Util.initializeTooltip(this.$el.find(".capping.ld-tooltip-hint"),{title:"Capping",body:"Setting a cap on this pool will limit each Member to a certain amount of records per day or week. The cap number entered here will apply to all Members in this pool. This capping limit will reset on the time interval you select (daily, weekly)."}),Magellan.Util.initializeTooltip(this.$el.find(".save-as-template-checkbox.ld-tooltip-hint"),{title:"Save As Template",body:"Saving this new set of Working Hours as a template will make it available in the Schedules page. From there, you can apply it to other pools that have the same hours."})}.call(this),function initTimezoneDropdown(){var e=this,t=(this.model.get("Timezone__c"),Magellan.Util.Timezones.guessUserTimezone(),function(){return Magellan.Util.Timezones.createTimezoneTypeahead(e.model.get("Timezone__c"))});this.hourlyTimezoneDropdown=t(),this.hourlyTimezoneDropdown.validate(),this.$el.find(".hourly-timezone-dropdown").html(this.hourlyTimezoneDropdown.$el),this.dailyTimezoneDropdown=t(),this.dailyTimezoneDropdown.validate(),this.$el.find(".daily-timezone-dropdown").html(this.dailyTimezoneDropdown.$el),this.weeklyTimezoneDropdown=t(),this.weeklyTimezoneDropdown.validate(),this.$el.find(".weekly-timezone-dropdown").html(this.weeklyTimezoneDropdown.$el)}.call(this),this.renderHoursCreator(),this.renderCappingSettings(),this},renderCappingSettings:function(){var e;this.$el.find(".cap-limit-input").val(this.model.get("Capping_Limit__c"));var t=this.model.get("Timezone__c")?[Magellan.Util.Timezones.idToTimezone[this.model.get("Timezone__c")]]:[];[this.hourlyTimezoneDropdown,this.dailyTimezoneDropdown,this.weeklyTimezoneDropdown].forEach(function(e){e.model.set("value",this.model.get("Timezone__c")),e.setSelection(t)}.bind(this)),e=_.isUndefined(_.find(this.model.scheduleSettings.workingHours,function(e){return e.attributes.Id===this.model.get("Working_Hours__c")},this))?!_.isEmpty(this.hoursCreatorView.model.get("Timezone__c")):!_.isEmpty(this.model.get("Working_Hours__c")),$(".hourly-timezone-dropdown .nested-typeahead-selector, .daily-timezone-dropdown .nested-typeahead-selector, .weekly-timezone-dropdown .nested-typeahead-selector").toggleClass("disabled",e)},renderHoursCreator:function(){var e=this.model.get("Working_Hours__c");if(e){var t=_.find(this.model.scheduleSettings.workingHours,function(t){return t.attributes.Id===e});if(this.readOnly=!!t&&t.attributes.Is_Template__c,_.isUndefined(t))this.hoursCreatorView.render();else{var i=this.readOnly?"readonly-template":"editable";this.hoursCreatorView.sideloadData(t.attributes,i)}}else this.hoursCreatorView.sideloadData({Timezone__c:this.model.get("Timezone__c")},"readonly-show-default");this.$el.find(".inline-working-hours").html(this.hoursCreatorView.$el),this.model.trigger("change"),this.hoursCreatorView.render(),this.hoursCreatorView.delegateEvents()}})}},function(e,t,i){var n=Backbone.View.extend({initialize:function(e){this.model=e.model,this.idToOwnerMap=e.idToOwnerMap},events:{"click .delete-icon":"handleDeleteIconClick"},handleDeleteIconClick:function(e){var t=$(e.target).closest(".pool-manager").data("id");this.trigger("deleteManager",t)},render:function(){this.delegateEvents();var e=this.model.get("Managers__c").map(function(e){var t=this.idToOwnerMap[e]?this.idToOwnerMap[e].Name:"(Inactive Manager)";return _.template('<div class="pool-manager" data-id=<%= userId %>><div><%= name %></div><div><%= userId %></div><div class="ld-cross-icon-grey-large delete-icon"></div></div>')({name:t,userId:e})}.bind(this)).join("");return this.$el.html(e),this}});e.exports=function(){return Backbone.View.extend({template:_.template(i(306)),initialize:function(e){this.model=e.model,this.idToOwnerMap={},this.managerListView=new n({model:this.model,idToOwnerMap:this.idToOwnerMap}),this.createIdToOwnerMap(),this.listenTo(this.managerListView,"deleteManager",this.handleManagerDelete)},_getOptions:function(){return Object.keys(this.idToOwnerMap).filter(function(e){return!this.model.get("Managers__c").includes(e)}.bind(this))},handleManagerDelete:function(e){_.pull(this.model.get("Managers__c"),e),this.render(),this.managerListView.render(),this.model.trigger("change")},events:{"change input.write-to-model":"handleInputChange","change textarea.write-to-model":"handleInputChange","nestedTypeaheadSelector:select #manager-dropdown":"handleManagerSelect"},createIdToOwnerMap:function(){this.$el.find("#manager-list").LoadingOverlay("show"),Magellan.Controllers.FlowBuilder.searchUsers("",this.model.get("Managers__c")).then(function(e){_.each(e,function(e){this.idToOwnerMap[e.Id]=e},this),this.managerListView.render()}.bind(this)),this.$el.find("#manager-list").LoadingOverlay("hide",!0)},handleInputChange:function(e){var t=$(e.target),i=t.val(),n=t.data("fieldName");"Grouping_Name__c"===n&&t.toggleClass("input-invalid",_.isEmpty(i)||this.model.poolNameAndObjectTypeExist(i)),this.model.set(n,i)},handleManagerSelect:function(e,t){let i=t.selection[0];this.model.addManager(i.Id),this.model.set("value",void 0),this.model.set("options",this._getOptions()),this.render(),this.createIdToOwnerMap(),t.setSelection([])},render:function(){var e=this.template();return this.$el.html(e),function initializeUserDropdown(){this.$el.find("#manager-list").html(this.managerListView.render().$el);var e=new Magellan.Views.NestedTypeaheadSelector({required:!1,disableBreadcrumbs:!0,requireSelectionFromData:!0,selection:[],filter:Magellan.Util.typeaheadDataFilter(this.model.get("Managers__c"),"Id"),asyncServiceCall:Magellan.Controllers.FlowBuilder.searchUsers});this.$el.find("#manager-dropdown").html(e.$el)}.call(this),function initializeInfoDropdowns(){var e=["standard"];dashboardController.viewObject.statuses.hasLiveRouting&&e.push("live");var t=Magellan.Util.objectTypes,i=new Magellan.Views.LDDropdown({required:!0,value:this.model.get("Pool_Type__c"),options:e,placeholder:"Select Pool Type",size:"large",optionTemplate:function(e){return _.template("<span><%= name %></span>")({name:_.capitalize(e)})},onChange:function(e){this.model.set("Pool_Type__c",e)}.bind(this)});i.validate(),this.$el.find("#pool-type-dropdown").html(i.$el);var n=new Magellan.Views.LDDropdown({required:!0,value:this.model.get("Object_Type__c"),options:t,placeholder:"Select Object Type",size:"large",optionTemplate:function(e){return _.template("<span><%= name %></span>")({name:e})},onChange:function(e){this.model.set("Object_Type__c",e)}.bind(this)});n.validate(),this.$el.find("#object-type-dropdown").html(n.$el),_.isEmpty(this.model.get("Id"))||this.model.copyMode||(i.$el.toggleClass("disabled",!0),n.$el.toggleClass("disabled",!0))}.call(this),function initializeTooltip(){Magellan.Util.initializeTooltip(this.$el.find(".pool-field.ld-tooltip-hint"),{title:"Pool Type",body:"Choose the type of routing (Standard or Live) that this pool will be used in. Example: Only Live Routing pools will be available in Live Routing. This setting cannot be changed later."}),Magellan.Util.initializeTooltip(this.$el.find(".object-field.ld-tooltip-hint"),{title:"Object Type",body:"Choose the standard Salesforce object that this pool is associated with. Example: Only Lead pools will be available in Lead routing graphs. This setting cannot be changed later."}),Magellan.Util.initializeTooltip(this.$el.find(".managers-field.ld-tooltip-hint"),{title:"Pool Managers",body:"Select the team Manager(s) for this pool that can edit the membership and settings of this pool. Note that Managers are not able to access or edit other sections of LeanData, such as routing graphs."})}.call(this),function populateInputs(){this.$el.find(".write-to-model").each(function(e,t){var i=$(t),n=i.data("fieldName"),a=_.unescape(this.model.get(n));i.val(a),"Grouping_Name__c"===n&&i.toggleClass("input-invalid",_.isEmpty(a))}.bind(this))}.call(this),this}})}},function(e,t,i){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={});var e=Backbone.View.extend({template:_.template(i(307)),initialize:function(e){this.model=e.model},events:{"click .delete-member-card-button":"handleDeleteButtonClick","click .row-action":"handleRowActionClick"},handleRowActionClick:function(e){var t=$(e.target).closest(".member").data("ownerId");this.model.setNextMember(t),this.model.trigger("change",{e})},handleDeleteButtonClick:function(e){var t=$(e.target).closest(".member").data("ownerId");this.model.removeMember(t),this.model.trigger("change",{e})},render:function(){var e=this,t=this.template({members:this.model.memberList,groupsMap:this.model.groupsMap,Capping_Limit__c:this.model.get("Capping_Limit__c"),Capping_Type__c:this.model.get("Capping_Type__c"),nextOwnerId:this.model.nextOwnerId});return this.$el.html(t),this.$el.find(".member-list").hasClass("ui-sortable")&&this.$el.find(".member-list").sortable("destroy"),this.$el.find(".slider").slider({value:1,min:0,max:2,step:.25,range:"min",slide:function(t,i){var n=$(t.target).closest(".member").data("ownerId");_.find(e.model.memberList,{OwnerId__c:n}).Weighting_Value__c=i.value,e.model.trigger("weightingChange")},stop:function(t,i){e.model.trigger("change weightingChange")}}),this.$el.find(".parts input").change(function(t){var i=$(t.target).closest(".member").data("ownerId"),n=_.find(e.model.memberList,{OwnerId__c:i}),a=parseFloat($(t.target).val());_.isNaN(a)&&(a=1),a>2&&(a=2),a<0&&(a=0),n.Weighting_Value__c=a,e.model.trigger("change weightingChange")}),this.$el.find(".member-list").sortable({placeholder:"member-sort-placeholder",handle:".drag-handle",start:function(e,t){t.item.startPos=t.item.index()},over:function(t,i){e.$el.find(".empty-placeholder").hide()},out:function(t,i){e.$el.find(".empty-placeholder").show()},stop:function(t,i){if(e.$el.find(".empty-placeholder").remove(),$(i.item).hasClass("member")){console.log("--\x3e sort members",t,i,i.item.index());var n=i.item.startPos,a=i.item.index(),o=e.model.memberList,l=o.splice(n,1)[0];o.splice(a,0,l),e.model.trigger("change",{e:t,ui:i})}},receive:function(t,i){console.log("--\x3e add member",t,i,"index: ",i.helper.index());var n=e.model.memberList,a=i.helper.index(),o=i.helper.data("id"),l=e.model.getUserById(o),s={Weighting_Value__c:1,Name:l.Name,OwnerId__c:l.Id,type:l.type,User_Owner__r:{IsActive:l.IsActive}};n.splice(a,0,s),e.model.set("memberList",n),e.model.trigger("change",{e:t,ui:i})}}),this.$el.find(".member-list").hasClass("ui-droppable")&&this.$el.find(".member-list").droppable("destroy"),this.$el.find(".member-list").droppable({}),this.$el.find(".weighting").toggleClass("disabled",!this.model.get("Weighting_Enabled__c")),this.model.get("Weighting_Enabled__c")?(this.$el.find(".weighting .slider").slider("enable"),this.$el.find(".weighting .parts input").removeAttr("disabled")):(this.$el.find(".weighting .parts input").attr("disabled","disabled"),this.$el.find(".weighting .slider").slider("disable")),this.renderWeightings(),$("#pool-member-count").text(this.model.memberList.length),this},renderWeightings:function(){var e=this,t=this.model.get("Weighting_Enabled__c");if(t)var i=_.reduce(e.model.memberList,function(e,t){return e+(_.isNumber(t.Weighting_Value__c)&&!_.isNaN(t.Weighting_Value__c)?t.Weighting_Value__c:1)},0);else i=e.model.memberList.length;e.model.memberList.forEach(function(n){var a=t&&_.isNumber(n.Weighting_Value__c)&&!_.isNaN(n.Weighting_Value__c)?n.Weighting_Value__c:1,o=e.$el.find('.member[data-owner-id="'+n.OwnerId__c+'"]');o.find(".parts input").val(a),o.find(".slider").slider("value",a),o.find(".percentage").html(Math.round(a/i*100)+"%")})}}),t=Backbone.View.extend({template:_.template(i(310)),initialize:function(e){this.model=e.model},render:function(){var e=this.template({users:this.model.filteredUserList});return this.$el.html(e),this.$el.find(".user-list .user").hasClass("ui-draggable")&&this.$el.find(".user-list .user").draggable("destroy"),this.$el.find(".user-list .user").draggable({connectToSortable:".member-list",helper:"clone",revert:!0,revertDuration:0,start:function(e,t){$(t.helper).addClass("ui-helper")}}),this.refreshDisabled(),this},refreshDisabled:function(){var e=this;this.$el.find("li.user").toggleClass("disabled",!1),_.each(this.model.memberList,function(t){e.$el.find('li.user[data-id="'+t.OwnerId__c+'"]').toggleClass("disabled",!0)})}});Magellan.Views.RoundRobinPoolsCreatorTabs.Members=Backbone.View.extend({template:_.template(i(308)),initialize:function(i){this.model=i.model,this.memberListView=new e({model:this.model}),this.userListView=new t({model:this.model}),this.model.on("change",this.memberListView.render,this.memberListView),this.model.on("change",this.userListView.refreshDisabled,this.userListView),this.model.on("weightingChange",this.memberListView.renderWeightings,this.memberListView),this.render()},events:{"click .reset-weights-button":"handleResetWeightsButtonClick","change .weighted-distribution-checkbox":"handleWeightedDistributionCheckboxChange","keyup #search-filter-input":"handleSearchFilterInputKeyup","click .search-filter .clear-search-filter-btn":"handleSearchFilterInputKeyup","click .include-inactive-users":"toggleInactiveUserFilter"},toggleInactiveUserFilter:function(e){this.model.userFilterOption=$(e.target).prop("checked")?"showInactive":null,console.log("this.model.userFilterOption",this.model.userFilterOption),this.model.updateUserList().then(function(e){this.userListView.render()}.bind(this))},handleSearchFilterInputKeyup:function(e){var t=this,i=$(e.target).val();this.model.userFilterQueryString=i,this.model.updateUserList().then(function(e){t.userListView.render()})},handleWeightedDistributionCheckboxChange:function(e){var t=$(e.target).is(":checked"),i=t?"enable":"disable";new Magellan.Views.ConfirmationModal({header:"Confirm Weighting Change",message:"Are you sure you want to "+i+" weighting?",footer:"This will reset the pool pointer.",onConfirmed:function(){this.model.set("Weighting_Enabled__c",t),this.model.memberList.forEach(function(e){e.Weighting_Next_Pointer__c=0}),this.render()}.bind(this),onCancelled:function(){$(e.target).prop("checked",!t)}.bind(this)}).open()},handleResetWeightsButtonClick:function(e){_.each(this.model.memberList,function(e){e.Weighting_Value__c=1}),this.render()},render:function(){var e=this.template({userFilterKey:this.model.userFilterKey,userFilterOption:this.model.userFilterOption,queryString:this.model.queryString,users:this.model.filteredUserList,members:this.model.memberList,Weighting_Enabled__c:this.model.get("Weighting_Enabled__c")});return this.$el.html(e),this.memberListView.setElement(this.$el.find(".members-container")).render(),this.userListView.setElement(this.$el.find(".users-container")).render(),this.$el.find(".weighted-distribution-checkbox").prop("checked",this.model.get("Weighting_Enabled__c")),function initDropdowns(){var e=this,t={Role:"userRoles",Profile:"profiles",Queue:"queues"}[e.model.userFilterKey],i=e.model.userFilterMetaData[t],n=new Magellan.Views.LDDropdown({value:this.model.userFilterValue,placeholder:"Select One",options:i,enableSearch:!1,size:"large",optionTemplate:function(e){return _.template("<span><%=option%></span>")({option:e.Name})},onChange:function(t){console.log(t),e.model.userFilterValue=t,console.log("--\x3e get filtered users by",e.model.userFilterKey,e.model.userFilterValue),e.model.updateUserList().then(function(t){e.userListView.render()})}}),a=["All","Role","Profile"];"Lead"===this.model.get("Object_Type__c")&&a.push("Queue");var o=new Magellan.Views.LDDropdown({placeholder:"Filter by",value:e.model.userFilterKey,options:a,size:"large",optionTemplate:function(e){return _.template("<span><%=option%></span>")({option:e})},onChange:function(t){if(e.model.userFilterQueryString="","All"===t)return e.model.userFilterKey=null,e.render(),void e.model.updateUserList().then(function(t){e.userListView.render()});if("Queue"===t)return e.model.userFilterKey="Queue",e.render(),void e.model.updateUserList().then(function(t){e.userListView.render()});if(!_.isNull(t)){e.model.userFilterMetaData[{Role:"userRoles",Profile:"profiles",Queue:"queues"}[t]];e.model.userFilterKey=t,e.model.userFilterValue=void 0,e.render()}}});o.validate(),this.$el.find(".user-filter-key-dropdown").html(o.$el),n.validate(),this.$el.find(".user-filter-value-dropdown").html(n.$el)}.call(this),this}})}},function(e,t){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),Magellan.Models.RoundRobinPoolData=Backbone.Model.extend({initialize:function(e,t){if(Magellan.Models.roundRobinPoolCopyMode&&(this.copyMode=!0,Magellan.Models.roundRobinPoolCopyMode=!1),t.existing||this.copyMode){this.set(t.pool.attributes),this.nextOwnerId=null;var i=_.map(t.members,function(e){return e.isNextOwner&&(this.nextOwnerId=e.attributes.OwnerId__c),e.attributes},this);i=_.sortBy(i,function(e){return e.Owner_Order__c}),_.each(i,function(e){e.type=e.hasOwnProperty("User_Owner__c")?"User":"Queue"}),this.memberList=i,this.translateMemberWeightingFromServer()}if(this.copyMode&&(this.set("Id",null),this.set("Grouping_Name__c",this.get("Grouping_Name__c")+" - copy")),this.set("Capping_Type__c",this.get("Capping_Type__c")||null),this.set("Pool_Type__c","live"===this.get("Pool_Type__c")?"live":"standard"),t.pool&&t.pool.accessLevelAssignments){var n=[];t.pool.accessLevelAssignments.forEach(function(e){n.push(e.User__c)}),this.set("Managers__c",n)}else this.set("Managers__c",[]);this.memberList=this.memberList||[],this.userFilterMetaData=t.userFilterMetaData||[],this.filteredUserList=t.filteredUserList||[],this.filteredUserList=_.filter(t.filteredUserList||[],function(e){return("Lead"===this.get("Object_Type__c")||"Queue"!==e.Type)&&e},this),this.groupsMap=t.groupsMap,this.scheduleSettings=_.groupBy(t.scheduleSettings,function(e){return e.type}),["workingHours","vacations","holidays"].forEach(function(e){this.scheduleSettings[e]=this.scheduleSettings[e]||[]}.bind(this)),this.setTimezoneFromWorkingHours(!0),this.originalAttributes=_.cloneDeep(this.attributes),this.originalMemberList=_.cloneDeep(this.memberList),this.set("poolNameToPoolTypeMap",t.poolNameToPoolTypeMap),this.set("original_Grouping_Name__c",this.get("Grouping_Name__c")||"")},translateMemberWeightingFromServer:function(){this.memberList.forEach(function(e){e.Weighting_Value__c=e.Weighting_Value__c/50}.bind(this))},addManager:function(e){this.has("Managers__c")||this.set("Managers__c",[]),this.get("Managers__c").push(e)},originalMemberWeightsHasChanged:function(){var e=!1,t={};for(var i of(this.originalMemberList.forEach(function(e){t[e.Id]=e.Weighting_Value__c}),this.memberList))if(null!=t[i.Id]&&t[i.Id]!=i.Weighting_Value__c){e=!0;break}return e},hasChanged:function(){return!_.isEqual(this.attributes,this.originalAttributes)||!_.isEqual(this.memberList,this.originalMemberList)||this.hoursCreatorData&&this.hoursCreatorData.model.checkHasChanged()},saveToServer:function(){var e=$.Deferred(),t=!this.get("Id"),i={adminToAssign:[],adminToRevoke:[]};if(this.get("Managers__c").forEach(function(e){i.adminToAssign.push({userId:e,roundRobinPoolId:this.get("Id")})}.bind(this)),!t){_.difference(this.originalAttributes.Managers__c,this.get("Managers__c")).forEach(function(e){i.adminToRevoke.push({userId:e,roundRobinPoolId:this.get("Id")})}.bind(this));var n=JSON.stringify(i),a=Magellan.Services.FlowBuilder.assignOrRevokeAdminsForRoundRobinPools(n)}var o=$.Deferred();return _.isEmpty(this.hoursCreatorData)||_.isEmpty(this.get("Working_Hours__c"))?o.resolve():this.hoursCreatorData.model.saveToServer().then(function(e){console.log(e),this.set("Working_Hours__c",e),o.resolve()}.bind(this)),o.then(function(){var t={attributes:{Id:this.get("Id"),Description__c:this.get("Description__c"),Grouping_Name__c:_.unescape(this.get("Grouping_Name__c")),Object_Type__c:this.get("Object_Type__c"),Weighting_Enabled__c:this.get("Weighting_Enabled__c"),Capping_Type__c:this.get("Capping_Type__c")||null,Capping_Limit__c:parseInt(this.get("Capping_Limit__c"))||null,Timezone__c:this.get("Timezone__c")||"",Holidays__c:this.get("Holidays__c"),Working_Hours__c:this.get("Working_Hours__c"),Manual_Next_OwnerId__c:this.get("Manual_Next_OwnerId__c"),Pool_Type__c:"live"===this.get("Pool_Type__c")?"live":null}},n=this.get("Weighting_Enabled__c"),o=function(e,t,i){var a={action:e,attributes:{Id:t.Id||null,User_Owner__c:"Queue"===t.type?null:t.OwnerId__c,OwnerId__c:t.OwnerId__c,Owner_Order__c:i}};return n&&_.isNumber(t.Weighting_Value__c)?a.attributes.Weighting_Value__c=50*t.Weighting_Value__c:a.attributes.Weighting_Value__c=50,a},l=[],s={};_.each(this.memberList,function(e,t){_.isString(e.Id)&&(s[e.Id]=e),l.push(o("upsert",e,t))},this),_.each(this.originalMemberList,function(e){_.isObject(s[e.Id])||l.push(o("delete",e,null))},this);var r=Magellan.Services.FlowBuilder.saveRoundRobinPoolConfigurations({"round robin pool":t,"round robin pool members":l,adminToAssign:i.adminToAssign});$.when(r,a).then(function(){e.resolve()})}.bind(this)),e},setTimezoneFromWorkingHours:function(e){if(this.get("Working_Hours__c")){var t=this.get("Working_Hours__c"),i=_.find(this.scheduleSettings.workingHours,function(e){return e.attributes.Id===t}.bind(this));this.set("Timezone__c",i.attributes.Timezone__c)}else e||this.set("Timezone__c",null)},getUserById:function(e){return _.find(this.filteredUserList,{Id:e})},updateUserList:function(){var e=$.Deferred(),t=JSON.stringify({filterKey:this.userFilterKey,filterValue:this.userFilterValue&&this.userFilterValue.Id,queryString:this.userFilterQueryString,userFilterOption:this.userFilterOption});return this.pendingUserListPromise&&this.pendingUserListPromise.reject(),this.pendingUserListPromise=Magellan.Services.FlowBuilder.getFilteredUserList(t),this.pendingUserListPromise.then(function(t,i){this.filteredUserList=[],t.forEach(function(e){"Queue"===e.Type?(e.IsActive=!0,e.type="Queue"):e.type="User","Lead"!==this.get("Object_Type__c")&&"Queue"===e.type||this.filteredUserList.push(e)}.bind(this)),this.pendingUserListPromise=null,e.resolve()}.bind(this)),e},removeMember:function(e){var t=this.memberList.filter(function(t){return t.OwnerId__c!==e});this.memberList=t},setNextMember:function(e){this.set("Manual_Next_OwnerId__c",e),this.nextOwnerId=e},poolNameAndObjectTypeExist:function(e){return!_.isUndefined(this.get("poolNameToPoolTypeMap")[e])&&!_.isUndefined(this.get("Object_Type__c"))&&this.get("poolNameToPoolTypeMap")[e]===this.get("Object_Type__c")&&this.get("original_Grouping_Name__c")!==e},validate:function(){var e=!0;if(e=(e=(e=(e=e&&!_.isEmpty(_.unescape(this.get("Grouping_Name__c"))))&&!this.poolNameAndObjectTypeExist(this.get("Grouping_Name__c")))&&!_.isEmpty(this.get("Pool_Type__c")))&&!_.isEmpty(this.get("Object_Type__c")),!_.isEmpty(this.get("Working_Hours__c"))&&"new"===this.get("Working_Hours__c")&&!_.isEmpty(this.hoursCreatorData)){var t=this.hoursCreatorData.model.toJSON();e=e&&!_.isEmpty(t.Timezone__c),t.Is_Template__c&&(e=e&&!_.isEmpty(t.Name))}return _.isNull(this.get("Capping_Type__c"))||(e=e&&!!parseInt(this.get("Capping_Limit__c"))&&!_.isEmpty(this.get("Timezone__c"))),e}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(309)),initialize:function(e){window.rrpoolmodel=this.model=new Magellan.Models.RoundRobinPoolData(null,e),this.infoView=new Magellan.Views.RoundRobinPoolsCreatorTabs.Info({model:this.model}),this.membersView=new Magellan.Views.RoundRobinPoolsCreatorTabs.Members({model:this.model}),this.advancedSettingsView=new Magellan.Views.RoundRobinPoolsCreatorTabs.AdvancedSettings({model:this.model}),e.waitingScreen&&e.waitingScreen.resolve(),this.defaultView=this.infoView,this.model.on("change",this.handleModelChange,this)},events:{"click .clear-search-filter-btn":"clearInput","click .ld-tab":"handleTabClick","click .close-pool-editor":"handleCancelClick","click .save-pool":"handleSaveClick"},handleSaveClick:function(){if(console.log("--\x3e save",this.model),!this.model.validate())return console.error("Complete all required fields before saving");this.model.originalMemberWeightsHasChanged()?new Magellan.Views.ConfirmationModal({header:"Weighting Changes Detected",message:"You have changed the weight of one or more members in your pool. Please note this will cause the pool to reset.",footer:"",onConfirmed:function(){this.save()}.bind(this)}).open():this.save()},save:function(){var e=Magellan.Controllers.GUI.appWaitingScreen.show("Saving Pool...");this.model.saveToServer().then(function(){e.resolve(),Magellan.Navigation.promptAreYouSure=!1,Magellan.Navigation.navigate("routing/round_robin_pools")})},handleCancelClick:function(e){this.model.hasChanged()?requestModalResponse("dirty").then(function(){Magellan.Navigation.promptAreYouSure=!1,Magellan.Navigation.navigate("routing/round_robin_pools")}):Magellan.Navigation.navigate("routing/round_robin_pools")},handleModelChange:function(e){console.log("--\x3e change: ",this.model),Magellan.Navigation.promptAreYouSure=this.model.hasChanged();var t=!this.model.hasChanged()||!this.model.validate();this.$el.find(".save-pool").toggleClass("disabled",t),this.model.changed&&this.model.changed.hasOwnProperty("Object_Type__c")&&this.model.updateUserList().then(_.bind(function(){this.membersView.userListView.render()},this))},handleTabClick:function(e){var t=this,i=$(e.target);i.siblings(".ld-tab").removeClass("active"),i.addClass("active");["info","members","advanced-settings"].forEach(function(e){i.hasClass(e)&&t.switchTab(e)})},switchTab:function(e,t){var i={info:this.infoView,members:this.membersView,"advanced-settings":this.advancedSettingsView};this.$el.find("#tab-content").empty();var n=i[e];n&&this.switchView(n)},switchView:function(e){var t=this.$el.find("#tab-content");t.empty(),e.delegateEvents(),t.append(e.$el),e.render()},render:function(){var e=this.template({Grouping_Name__c:this.model.get("Grouping_Name__c")});return this.$el.html(e),this.switchView(this.defaultView),this.model.copyMode&&this.$el.find(".save-pool").toggleClass("disabled",!1),this}})}},function(e,t){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),Magellan.Models.RoundRobinPoolsData=Backbone.Model.extend({initialize:function(e,t){this.collections=null,t.data&&this.initializeCollectionsFromRemote(t.data)},initializeCollectionsFromRemote:function(e){this.collections={}},getCollection:function(e){return this.collections[e]}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(311)),initialize:function(e){window.rrpoolsview&&window.rrpoolsview.close(),window.rrpoolsview=this,this.poolData=e.poolData,this.allPoolData=e.poolData,this.scheduleData=_.groupBy(e.scheduleData,function(e){return e.attributes.Schedule_Type__c}),this.initTableData(),this.setScheduleState={displayed:!1,selectedWorkingHours:null,selectedHolidays:null,selectedPoolsIds:new Set},this.tableFilterState={Object_Type__c:Magellan.Util.objectTypes,Pool_Type__c:["Standard","Live"]},this.defaultSetScheduleState=_.cloneDeep(this.setScheduleState)},events:{"click .ld-tab":"handleTabClick","click #add-pool-button":"handleAddPoolClick","click .pools-table-container tr":"handlePoolRowClick","click .delete-pool-button":"handleDeleteRowClick","click #set-schedule-button":"handleSetScheduleClick","click .ld-table td, .ld-table th":function(e){var t=$(e.target).find('input[type="checkbox"]');t.length>0&&(e.stopPropagation(),t.trigger("click"))},'click .ld-table tbody input[type="checkbox"]':"handlePoolRowCheckboxClick","click #all-pools-checkbox":"handleAllPoolsCheckboxClick","click .bulk-actions .controls .close-btn":"handleSetScheduleCloseClick","click .bulk-actions .controls .apply-btn":"handleSetScheduleApplyClick","click .pools-table-container .segment-action":"handlePoolSegmentActionClick","click .copy-action":"handleCopyActionClick","mouseenter .pools-table-container tr":"handlePoolRowMouseenter","click .clear-search-filter-btn":"clearInput","keyup #rr-members-search-filter-input":"handleInputChange"},handleInputChange:function(e){var t=$(e.currentTarget).val();this.searchPools(t)},clearInput:function(e){e.stopPropagation(),e.preventDefault(),this.$el.find("#rr-members-search-filter-input").val(""),this.searchPools("")},searchPools:function(e){var t=this.tableView.table;this.poolData=_.filter(this.allPoolData,function(t){return t.attributes.Grouping_Name__c.includes(e)},this),this.initTableData(),t.clear(),t.rows.add(this.tableData),t.draw()},handleCopyActionClick:function(e){e.stopPropagation();var t=$(e.target),i=t.closest("tr").attr("id");console.log("copy",t,i),Magellan.Models.roundRobinPoolCopyMode=!0,this.close(),Magellan.Navigation.navigate("routing/round_robin_pools/creator/"+i)},handlePoolRowMouseenter:function(e){this.$el.find(".segment-action").removeClass("active")},handlePoolSegmentActionClick:function(e){e.stopPropagation();var t=$(e.target),i=t.closest("tr").attr("id");this.$el.find(".segment-action").removeClass("active"),t.closest(".segment-action").toggleClass("active",!0),console.log(t,i)},handleSetScheduleApplyClick:function(e){if(0!==this.setScheduleState.selectedPoolsIds.size&&(null!==this.setScheduleState.selectedHolidays||null!==this.setScheduleState.selectedWorkingHours)){var t=[];this.setScheduleState.selectedPoolsIds.forEach(function(e){var i={Id:e};null!==this.setScheduleState.selectedWorkingHours&&(i.Working_Hours__c="remove"===this.setScheduleState.selectedWorkingHours?null:this.setScheduleState.selectedWorkingHours.attributes.Id),null!==this.setScheduleState.selectedHolidays&&(i.Holidays__c="remove"===this.setScheduleState.selectedHolidays?null:this.setScheduleState.selectedHolidays.attributes.Id),t.push(i)}.bind(this));var i=JSON.stringify(t),n=Magellan.Controllers.GUI.appWaitingScreen.show("Saving Data...");Magellan.Services.FlowBuilder.upsertRoundRobinPools(i).then(function(e){this.setScheduleState=_.cloneDeep(this.defaultSetScheduleState),this.renderSetSchedule(),n.resolve()}.bind(this)).always(function(){n.resolve()})}},handleSetScheduleCloseClick:function(e){this.setScheduleState.displayed=!1,this.renderSetSchedule()},handleAllPoolsCheckboxClick:function(e){var t=$(e.target);if(t.is(":checked")||t.is(":indeterminate"))for(var i=this.tableView.table.data(),n=0;n<i.length;n++)this.setScheduleState.selectedPoolsIds.add(i[n].Id);else this.setScheduleState.selectedPoolsIds.clear();this.renderSetSchedule()},handlePoolRowCheckboxClick:function(e){e.stopPropagation();var t=$(e.target),i=t.closest("tr").attr("id");t.is(":checked")?this.setScheduleState.selectedPoolsIds.add(i):this.setScheduleState.selectedPoolsIds.delete(i),this.renderSetSchedule()},handleSetScheduleClick:function(e){this.setScheduleState.displayed=!this.setScheduleState.displayed,this.renderSetSchedule()},handleDeleteRowClick:function(e){e.stopPropagation();var t=this,i=$(e.target).closest("tr").attr("id");requestModalResponse("delete-setting").then(function(){var e=Magellan.Controllers.GUI.appWaitingScreen.show("Deleting setting..."),n=JSON.stringify({settingsToDelete:[i]});Magellan.Services.FlowBuilder.deleteRoundRobinPools(n).then(function(n){e.resolve(),"Success"===n&&t.tableView.table.row("[id="+i+"]").remove().draw()}).always(function(){e.resolve()})})},handlePoolRowClick:function(e){var t=$(e.target);if(!t.is("input")){var i=t.closest("tr").attr("id");i&&(this.close(),Magellan.Navigation.navigate("routing/round_robin_pools/creator/"+i))}},close:function(){this.undelegateEvents(),this.unbind()},initTableData:function(){var e={};_.each(this.scheduleData.workingHours||[],function(t){var i=t.attributes.Name,n=t.attributes.Id;n.startsWith(i)?e[n]="Custom":e[n]=i},this);var t=[function(e){return'<input type="checkbox"/>'},function(e){return e.attributes.Grouping_Name__c||""},function(e){return _.isEmpty(e.attributes.Pool_Type__c)?"Standard":_.capitalize(e.attributes.Pool_Type__c)},function(e){return e.attributes.Object_Type__c||""},function(e){var t=e.memberCount||"0";return e.hasInactiveUsers&&(t+='<div class="alert-icon" style="margin-left: 5px;"></div>'),t},function(t){return e[t.attributes.Working_Hours__c]||"Default (24/7)"},function(e){return Magellan.Util.CreateUserListOverflow(e,105)},function(e){var t="0";return e.numberOfNodesUsingPool>0&&(t=e.numberOfNodesUsingPool+'<div class="live-icon" style="margin-left:5px"></div>'),t},function(e){return e.attributes.LastModifiedDate},function(e){return'<div class="segment-action">Actions<div class="ld-select-dropdown"><div class="copy-action">Copy</div></div></div>'},function(e){return'<div class="delete-pool-button ld-cross-icon-large"></div>'}];this.tableData=[],_.each(this.poolData,function(e){if(dashboardController.viewObject.statuses.hasLiveRouting||"live"!==e.attributes.Pool_Type__c){var i=t.map(function(t){return t(e)});i.Id=e.attributes.Id,dashboardController.viewObject.statuses.hasLiveRouting||i.splice(2,1),this.tableData.push(i)}},this)},handleAddPoolClick:function(){this.close(),Magellan.Navigation.navigate("routing/round_robin_pools/creator")},render:function(){var e=this.template();return this.$el.html(e),this.tableView=function initializeTable(){var e=[{name:'<input id="all-pools-checkbox" type="checkbox" />'},{name:"Pool Name"},{name:"Pool Type"},{name:"Object Type"},{name:"Members"},{name:"Working Hours"},{name:"Pool Manager"},{name:"Nodes"},{name:"Modified Date"},{name:""},{name:""}];dashboardController.viewObject.statuses.hasLiveRouting||e.splice(2,1);return new Magellan.Views.LDTable({columns:e,data:this.tableData,isInlineEditorEnabled:!1,datatableOptions:{bFilter:!1,language:{emptyTable:"No Pools to display.",searchPlaceholder:"Search Pools"},rowId:"Id",order:[[8,"desc"]],columnDefs:[{targets:0,orderable:!1,width:"10px"},{targets:2,width:"85px"},{targets:-8,width:"75px"},{targets:-7,width:"65px"},{targets:-6,width:"110px"},{targets:-5,width:"135px"},{targets:-4,width:"60px"},{targets:-3,width:"90px",type:"date",render:function(e,t,i,n){return Magellan.Util.formatDate(e)}},{targets:-2,orderable:!1,width:"80px"},{targets:-1,orderable:!1,width:"30px"}],paginate:!0,pageLength:9}})}.call(this),function initializeMultiselects(){var e=this,t=["Standard","Live"];t=t.map(function(e){return{label:e,value:e}}),this.$el.find(".pool-type-multiselect").MultiSelectDropdown({selectAll:!0,dropdownType:"Pool Types",options:t,onChange:function(t,i){e.tableFilterState.Pool_Type__c=i,e.applyTableFilters()}.bind(this),generatePlaceholder:function(e,t,e,i){return t.length===i?'Pool Types: <span class="semi-bold">All</span>':0===t.length?'Pool Types: <span class="semi-bold">None</span>':1===t.length?'Pool Types: <span class="semi-bold">'+t[0]+"</span>":'Pool Types: <span class="semi-bold">'+t.length+" Types</span>"}}),this.$el.find(".object-type-multiselect").MultiSelectDropdown({selectAll:!0,dropdownType:"Object Types",options:["Lead","Contact","Account","Opportunity"].map(function(e){return{label:e,value:e}}),onChange:function(t,i){e.tableFilterState.Object_Type__c=i,e.applyTableFilters()},generatePlaceholder:function(e,t,e,i){return t.length===i?'Object Types: <span class="semi-bold">All</span>':0===t.length?'Object Types: <span class="semi-bold">None</span>':1===t.length?'Object Types: <span class="semi-bold">'+t[0]+"</span>":'Object Types: <span class="semi-bold">'+t.length+" Types</span>"}})}.call(this),function initializeDropdowns(){var e=this.scheduleData.holidays||[];e.unshift("remove"),e.unshift(null);var t=new Magellan.Views.LDDropdown({value:null,options:e,placeholder:"No Change",size:"large",optionTemplate:function(e){return null===e?_.template("<span>No Change</span>")():"remove"===e?_.template("<span>Remove Holidays</span>")():_.template("<span><%= name %></span>")({name:e.attributes.Name})}.bind(this),onChange:function(e){this.setScheduleState.selectedHolidays=e}.bind(this)});t.validate(),this.$el.find(".holiday-set-dropdown").html(t.$el);var i=this.scheduleData.workingHours?this.scheduleData.workingHours.filter(function(e){return e.attributes.Is_Template__c}):[];i.unshift("remove"),i.unshift(null);var n=new Magellan.Views.LDDropdown({value:null,options:i,placeholder:"No Change",size:"large",optionTemplate:function(e){return null===e?_.template("<span>No Change</span>")():"remove"===e?_.template("<span>Default (24/7)</span>")():_.template("<span><%= name %></span>")({name:e.attributes.Name})}.bind(this),onChange:function(e){this.setScheduleState.selectedWorkingHours=e}.bind(this)});n.validate(),this.$el.find(".working-hours-dropdown").html(n.$el)}.call(this),function initializeTooltip(){Magellan.Util.initializeTooltip(this.$el.find(".working-hours-tooltip"),{title:"Working Hours",body:"Apply a set of Working Hours to a pool to indicate when the Members of this pool are available for routing. Records that reach this pool outside of these hours will follow the 'Not Available for Routing' path in routing graphs, allowing for contingency planning."}),Magellan.Util.initializeTooltip(this.$el.find(".holidays-tooltip"),{title:"Holidays",body:"Apply a set of Holidays to a Pool to prevent routing to Members on those days & times. Records that reach this pool on a Holiday will follow the 'Not Available for Routing' path in routing graphs, allowing for contingency planning."})}.call(this),this.tableView.setElement(this.$el.find(".pools-table-container")),this.tableView.render(),this.renderSetSchedule(),this},renderSetSchedule:function(){console.log(this.setScheduleState),this.$el.find(".bulk-actions").toggle(this.setScheduleState.displayed),this.setScheduleState.displayed?this.$el.find('#roundrobin-pools .pools-table-container input[type="search"]').css("top","-273px"):this.$el.find('#roundrobin-pools .pools-table-container input[type="search"]').css("top",""),this.$el.find('.ld-table tr input[type="checkbox"]').prop("checked",!1),this.setScheduleState.selectedPoolsIds.forEach(function(e){this.$el.find(".ld-table tr[id="+e+'] input[type="checkbox"]').prop("checked",!0)}.bind(this)),this.$el.find("#set-schedule-button").toggleClass("disabled",0===this.setScheduleState.selectedPoolsIds.size),0===this.setScheduleState.selectedPoolsIds.size?(this.$el.find("#all-pools-checkbox").prop("checked",!1),this.$el.find("#all-pools-checkbox").prop("indeterminate",!1)):this.setScheduleState.selectedPoolsIds.size===this.poolData.length?(this.$el.find("#all-pools-checkbox").prop("checked",!0),this.$el.find("#all-pools-checkbox").prop("indeterminate",!1)):this.$el.find("#all-pools-checkbox").prop("indeterminate",!0)},applyTableFilters:function(){var e=this.tableView.table;this.poolData=_.filter(this.allPoolData,function(e){return this.tableFilterState.Object_Type__c.includes(e.attributes.Object_Type__c)&&this.tableFilterState.Pool_Type__c.includes(_.capitalize(e.attributes.Pool_Type__c||"Standard"))},this),this.initTableData(),e.clear(),e.rows.add(this.tableData),e.draw()}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(312)),initialize:function(e){this.parentView=e.parentView,this.collection=Magellan.Models.roundRobinSchedulesData.getCollection("holidays"),e.Id?(this.model=this.collection.get(e.Id),this.affectedPools=Magellan.Models.roundRobinSchedulesData.get("scheduleToPoolMap")[this.model.get("Id")]||[]):(this.model=new Magellan.Models.RoundRobinSchedulesHolidays,this.affectedPools=[]),this.model.on("change",this.handleModelChange,this)},events:{"click #create-holiday-set":"handleCreateHolidaySetClick","change #name-field":"handleNameChange","change #description-field":"handleDescriptionChange","click .holiday-creator-button.cancel":"handleExitCreatorClick","click .holiday-creator-button.save":"handleSaveButtonClick","click .holiday-creator-button.revert":"handleRevertButtonClick"},handleTabClick:function(e){var t=$(e.target);this.$(".tab-content").hide(),t.hasClass("editor")&&this.$(".tab-content.editor").show(),t.hasClass("pools")&&(this.$(".tab-content.pools").show(),this.affectedPoolsTableView.render())},handleRevertButtonClick:function(){var e=this;new Magellan.Views.ConfirmationModal({header:"Revert Changes",message:"Are you sure you want to revert the changes you've made?",footer:"",onConfirmed:function(){e.tableView.revert(),e.model.revert(),e.render()}}).open()},handleExitCreatorClick:function(){var e=this;this.model.checkHasChanged()?requestModalResponse("dirty").then(function(){Magellan.Navigation.promptAreYouSure=!1,e.model.revert(),e.parentView.switchTab("holidays")}):this.parentView.switchTab("holidays")},handleSaveButtonClick:function(e){var t=this.affectedPools,i=t.length,n=t.map(function(e){return e.Grouping_Name__c}).join(", ");i>0?new Magellan.Views.ConfirmationModal({header:i+" pools will be affected",message:"The following pools will be affected by this change: ",footer:n,onConfirmed:this.attemptSave.bind(this)}).open():this.attemptSave()},attemptSave:function(){var e=this;if(!_.isEmpty(this.model.get("Name"))){Magellan.Navigation.promptAreYouSure=!1;var t=Magellan.Controllers.GUI.appWaitingScreen.show("Saving Data...");this.model.saveToServer().then(function(t){return e.collection.refreshData()}).then(function(i){e.parentView.switchTab("holidays"),t.resolve()})}},handleModelChange:function(e){var t=this.model.checkHasChanged();Magellan.Navigation.promptAreYouSure=t,this.$el.find(".dirty-bar .holiday-creator-button.revert").toggleClass("disabled",!t),this.$el.find(".dirty-bar .holiday-creator-button.save").toggleClass("disabled",!t)},refreshMetadata:function(e){this.$el.find("#name-field").val(this.model.get("Name")),this.$el.find("#description-field").val(this.model.get("Description__c"))},handleNameChange:function(e){var t=$(e.target),i=t.val();t.toggleClass("input-invalid",_.isEmpty(i)),this.model.set({Name:i})},handleDescriptionChange:function(e){var t=$(e.target).val();this.model.set({Description__c:t})},handleCreateHolidaySetClick:function(){this.tableView.addRow()},render:function(){var e=this.template({Name:this.model.get("Name"),Description__c:this.model.get("Description__c")}),t=this;return this.$el.html(e),this.tableView=new Magellan.Views.LDTable({columns:[{name:"Holiday Name",editor:new Magellan.Views.LDTableCellEditors.Text({placeholder:"Enter Holiday Name"})},{name:"Start Date/time",editor:new Magellan.Views.LDTableCellEditors.DateTime({placeholder:"Select Start Date/Time"})},{name:"End Date/time",editor:new Magellan.Views.LDTableCellEditors.DateTime({placeholder:"Select End Date/Time",isEndDate:!0})}],data:this.model.getDataForTable(),isInlineEditorEnabled:!0,datatableOptions:{searching:!1,language:{emptyTable:"There are no Holidays in this set"}}}),this.$el.find("#table-container").html(this.tableView.$el),this.tableView.render(),this.affectedPoolsTableView=function initializeTable(){console.log(this.affectedPools);var e=[{name:"Pool Name",getter:function(e){return e.attributes.Grouping_Name__c}},{name:"Pool Type",getter:function(e){return e.attributes.Pool_Type__c&&"live"===e.attributes.Pool_Type__c?"Live":"Standard"}},{name:"Object Type",getter:function(e){return e.attributes.Object_Type__c||""}},{name:"No. of Members",getter:function(e){return e.memberCount||""}},{name:"Pool Managers",getter:function(e){return Magellan.Util.CreateUserListOverflow(e,105)}}],t=this.affectedPools.map(function(t){return e.map(function(e){return e.getter(t)})}),i=new Magellan.Views.LDTable({columns:e,data:t,isInlineEditorEnabled:!1,datatableOptions:{bFilter:!1,language:{emptyTable:"No pools to display.",searchPlaceholder:"Search Pools"},order:[[1,"desc"]],columnDefs:[]}});return this.$(".pool-table-container").html(i.render().$el),i}.call(this),this.listenTo(this.tableView,"revert delete change",function(e){t.model.getDataFromTable(this.tableView.getData()),t.model.trigger("change",this.model)}),function initializeTooltip(){Magellan.Util.initializeTooltip(this.$el.find(".holiday-name.ld-tooltip-hint"),{title:"Holidays",body:"Apply a set of Holidays to a Pool to prevent routing to Members on those days & times. Records that reach this pool on a Holiday will follow the 'Not Available for Routing' path in routing graphs, allowing for contingency planning."})}.call(this),this}})}},function(e,t){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),Magellan.Models.RoundRobinSchedulesHolidays=Backbone.Model.extend({initialize:function(e,t){this.indexToAttributeName=["name","startDate","endDate"],e||(e={Id:null,Name:"",Description__c:"",Schedule_Data__c:[],Schedule_Type__c:"holidays"},this.set(e)),this.set("id",e.Id),this.originalAttributes=_.cloneDeep(e)},getDataForTable:function(){var e=this;return this.get("Schedule_Data__c").map(function(t){return e.indexToAttributeName.map(function(e){return t[e]})})},getDataFromTable:function(e){var t=this,i=[];e.forEach(function(e){var n={};e.forEach(function(e,i){n[t.indexToAttributeName[i]]=e}),i.push(n)}),this.set("Schedule_Data__c",i)},saveToServer:function(){var e=this,t=($.Deferred(),{attributes:{}});_.each(["Id","Name","Timezone__c","Description__c","Schedule_Data__c","Schedule_Type__c"],function(i){t.attributes[i]=e.get(i)}),null===t.attributes.Id&&delete t.attributes.Id,t.attributes.Schedule_Data__c=JSON.stringify(t.attributes.Schedule_Data__c);var i=JSON.stringify(t);return Magellan.Services.FlowBuilder.upsertRoundRobinScheduleSettings(i).then(function(t){var i=Magellan.Models.roundRobinSchedulesData.getCollection("holidays");i.contains(e)||i.add(e)})},checkHasChanged:function(){return!_.isEqual(this.attributes.Name,this.originalAttributes.Name)||!_.isEqual(this.attributes.Description__c,this.originalAttributes.Description__c)||!_.isEqual(_.clone(this.attributes.Schedule_Data__c).sort(),_.clone(this.originalAttributes.Schedule_Data__c).sort())},revert:function(){this.attributes=_.cloneDeep(this.originalAttributes)}}),Magellan.Models.RoundRobinSchedulesHolidaysCollection=Backbone.Collection.extend({model:Magellan.Models.RoundRobinSchedulesHolidays,initialize:function(){},removeModelById:function(e){var t=this,i=$.Deferred(),n=this.get(e),a=JSON.stringify({settingsToDelete:[e]});return Magellan.Services.FlowBuilder.deleteRoundRobinScheduleSettings(a).then(function(e){"Success"===e?(t.remove(n),i.resolve()):i.reject()}),i},populateWithRemoteData:function(e){this.reset(null);for(var t=e.filter(function(e){return"holidays"===e.type}),i=0;i<t.length;i++)t[i].attributes.Schedule_Data__c&&(t[i].attributes.Schedule_Data__c=JSON.parse(_.unescape(t[i].attributes.Schedule_Data__c))),this.add(new Magellan.Models.RoundRobinSchedulesHolidays(t[i].attributes))},refreshData:function(){var e=this,t=$.Deferred();return Magellan.Services.FlowBuilder.getRoundRobinScheduleSettings().then(function(i){e.populateWithRemoteData(i),t.resolve()})}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(313)),initialize:function(e){this.parentView=e.parentView,this.collection=Magellan.Models.roundRobinSchedulesData.getCollection("holidays"),this.render()},events:{"click #add-holiday-button":"handleAddHolidaysButtonClick","click .holidays-row":"handleHolidaysRowClick","click tr .delete-holiday-set":"handleDeleteRowClick"},handleHolidaysRowClick:function(e){var t=$(e.target).closest("tr").data("id");this.parentView.switchTab("holidays-creator",t)},handleAddHolidaysButtonClick:function(){this.parentView.switchTab("holidays-creator")},handleDeleteRowClick:function(e){e.stopPropagation();var t=this,i=$(e.target).closest("tr").data("id");_.isEmpty(i)?console.warn("invalid rowId requested for deletion"):requestModalResponse("delete-setting").then(function(){var e=Magellan.Controllers.GUI.appWaitingScreen.show("Deleting setting...");t.collection.removeModelById(i).then(function(i){e.resolve(),t.render()}).always(function(){e.resolve()})})},render:function(){var e=this.template({collectionToJson:this.collection.toJSON(),formatMomentDate:Magellan.Util.formatMomentDate,scheduleToPoolMap:Magellan.Models.roundRobinSchedulesData.get("scheduleToPoolMap")});return this.$el.html(e),this}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(315)),initialize:function(e){this.parentView=e.parentView,this.collection=Magellan.Models.roundRobinSchedulesData.getCollection("workingHours"),this.render()},events:{"click #add-hours-button":"handleAddHoursButtonClick","click .working-hour-row":"handleWorkingHourRowClick","click tr .delete-working-hour":"handleDeleteRowClick"},handleWorkingHourRowClick:function(e){var t=$(e.target).closest("tr").data("id");this.parentView.switchTab("working-hours-creator",t)},handleDeleteRowClick:function(e){e.stopPropagation();var t=this,i=$(e.target).closest("tr").data("id");i&&""!==i?requestModalResponse("delete-setting").then(function(){var e=Magellan.Controllers.GUI.appWaitingScreen.show("Deleting setting...");t.collection.removeModelById(i).then(function(i){e.resolve(),t.render()})}):console.warn("invalid rowId requested for deletion")},handleAddHoursButtonClick:function(){this.parentView.switchTab("working-hours-creator")},render:function(){var e=this.collection.toJSON().filter(function(e){return!0===e.Is_Template__c}),t=this.template({collectionToJson:e,formatMomentDate:Magellan.Util.formatMomentDate,scheduleToPoolMap:Magellan.Models.roundRobinSchedulesData.get("scheduleToPoolMap")});return this.$el.html(t),this}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(316)),initialize:function(e){this.parentView=e.parentView,e.Id?this.model=this.collection.get(e.Id):this.model=new Magellan.Models.RoundRobinSchedulesVacations},events:{"click .vacation-creator-button.cancel":"handleExitCreatorClick","click .vacation-creator-button.revert":"handleRevertClick","click .vacation-creator-button.save":"handleSaveClick","click #add-vacation-btn":"handleAddVacationClick"},handleAddVacationClick:function(e){$(e.target).hasClass("disabled-by-edit")||this.tableView.addRow()},handleRevertClick:function(e){var t=this;requestModalResponse("confirm-revert").then(function(){t.tableView.clear(),t.model.revert(),t.render()})},handleSaveClick:function(e){var t=this,i=this.tableView.getNamedData().map(function(e){var t=e["User Name"],i=Magellan.Util.formatDateToUTCWithTimezoneOffset(e["Start Date/time"],t.TimeZoneSidKey),n=Magellan.Util.formatDateToUTCWithTimezoneOffset(e["End Date/time"],t.TimeZoneSidKey);return{Vacation_User__c:t.Id,Name:e["Vacation Name"],Schedule_Data__c:JSON.stringify({startDate:i,endDate:n}),Schedule_Type__c:"vacation"}}).map(function(e){var t={attributes:e},i=JSON.stringify(t);return Magellan.Services.FlowBuilder.upsertRoundRobinScheduleSettings(i)}),n=Magellan.Controllers.GUI.appWaitingScreen.show("Saving Data...");$.when.apply($,i).then(function(){return Magellan.Models.roundRobinSchedulesData.getCollection("vacations").refreshData()}).then(function(e){Magellan.Navigation.promptAreYouSure=!1,t.parentView.switchTab("vacations"),n.resolve()})},handleExitCreatorClick:function(){var e=this,t=this.tableView.getData();t&&t.length>0?requestModalResponse("dirty").then(function(){Magellan.Navigation.promptAreYouSure=!1,e.tableView.clear(),e.parentView.switchTab("vacations")}):this.parentView.switchTab("vacations")},render:function(){var e=this,t=this.template();return this.$el.html(t),this.tableView=new Magellan.Views.LDTable({columns:[{name:"User Name",editor:new Magellan.Views.LDTableCellEditors.AsyncTypeahead({placeholder:"Select a User",asyncServiceCall:Magellan.Controllers.FlowBuilder.searchUsers})},{name:"Vacation Name",editor:new Magellan.Views.LDTableCellEditors.Text({placeholder:"Enter Vacation Name"})},{name:"Start Date/time",editor:new Magellan.Views.LDTableCellEditors.DateTime({placeholder:"Start Date/Time"})},{name:"End Date/time",editor:new Magellan.Views.LDTableCellEditors.DateTime({placeholder:"End Date/Time",isEndDate:!0})}],data:[],isInlineEditorEnabled:!0,datatableOptions:{searching:!1,language:{emptyTable:"Add a vacation to begin"}}}),this.$el.find(".table-container").html(this.tableView.$el),this.tableView.render(),this.listenTo(this.tableView,"reset change remove",function(t){var i=0===e.tableView.getData().length;Magellan.Navigation.promptAreYouSure=!i,this.$el.find(".dirty-bar .vacation-creator-button.revert").toggleClass("disabled",i),this.$el.find(".dirty-bar .vacation-creator-button.save").toggleClass("disabled",i)}),this}})}},function(e,t){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),Magellan.Models.RoundRobinSchedulesVacations=Backbone.Model.extend({initialize:function(e,t){e||(e={Id:null,Name:"",Description__c:"",Schedule_Data__c:[]},this.set(e)),this.set("id",e.Id),this.originalAttributes=_.cloneDeep(e)},checkHasChanged:function(){return!_.isEqual(this.attributes,this.originalAttributes)},revert:function(){this.attributes=_.cloneDeep(this.originalAttributes)}}),Magellan.Models.RoundRobinSchedulesVacationsCollection=Backbone.Collection.extend({model:Magellan.Models.RoundRobinSchedulesVacations,initialize:function(){},getUserToVacationsMap:function(){return _.groupBy(this.models,function(e){return e.get("Vacation_User__c")})},removeModelById:function(e){var t=this,i=$.Deferred(),n=this.get(e),a=JSON.stringify({settingsToDelete:[e]});return Magellan.Services.FlowBuilder.deleteRoundRobinScheduleSettings(a).then(function(e){"Success"===e?(t.remove(n),i.resolve()):i.reject()}),i},populateWithRemoteData:function(e){this.reset(null);for(var t=e.filter(function(e){return"vacation"===e.type}),i=0;i<t.length;i++)t[i].attributes.Schedule_Data__c&&(t[i].attributes.Schedule_Data__c=JSON.parse(_.unescape(t[i].attributes.Schedule_Data__c))),this.add(new Magellan.Models.RoundRobinSchedulesVacations(t[i].attributes))},refreshData:function(){var e=this,t=$.Deferred();return Magellan.Services.FlowBuilder.getRoundRobinScheduleSettings().then(function(i){e.populateWithRemoteData(i),t.resolve()})}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(317)),initialize:function(e){this.parentView=e.parentView,this.collection=Magellan.Models.roundRobinSchedulesData.getCollection("vacations"),this.render()},events:{"click .parent-row":"handleParentRowClick","click #add-vacations-button":"handleAddVacationsClick","click tr .deleteIcon":"handleDeleteRowClick"},handleDeleteRowClick:function(e){e.stopPropagation();var t=this,i=$(e.target).closest("tr").data("vacationid");i&&""!==i?requestModalResponse("delete-setting").then(function(){var e=Magellan.Controllers.GUI.appWaitingScreen.show("Deleting setting...");t.collection.removeModelById(i).then(function(i){e.resolve(),t.render()})}):console.warn("invalid rowId requested for deletion")},handleAddVacationsClick:function(){this.parentView.switchTab("vacations-creator")},handleParentRowClick:function(e){var t=$(e.target).closest("tr").data("id");$(e.target).closest("tr").toggleParentRow(t,100)},render:function(){var e=this.template({userToVacationsMap:this.collection.getUserToVacationsMap(),formatGMTDateTimeToTimezone:Magellan.Util.formatGMTDateTimeToTimezone,formatMomentDate:Magellan.Util.formatMomentDate});return this.$el.html(e),this}})}},function(e,t){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),Magellan.Models.RoundRobinSchedulesData=Backbone.Model.extend({initialize:function(e,t){this.collections=null,this.initializeCollectionsFromRemote(t.data),this.initializePoolsDataFromRemote(t.poolsData)},initializeCollectionsFromRemote:function(e){this.collections={};var t=_.groupBy(e,function(e){return e.type});this.collections.workingHours=new Magellan.Models.RoundRobinSchedulesHoursCollection,this.collections.holidays=new Magellan.Models.RoundRobinSchedulesHolidaysCollection,this.collections.vacations=new Magellan.Models.RoundRobinSchedulesVacationsCollection,"workingHours"in t&&this.collections.workingHours.populateWithRemoteData(t.workingHours),"holidays"in t&&this.collections.holidays.populateWithRemoteData(t.holidays),"vacation"in t&&this.collections.vacations.populateWithRemoteData(t.vacation)},initializePoolsDataFromRemote:function(e){var t={};_.each(e,function(e){var i=e.attributes.Working_Hours__c;_.isEmpty(i)||(_.isEmpty(t[i])&&(t[i]=[]),t[i].push(e));var n=e.attributes.Holidays__c;_.isEmpty(n)||(_.isEmpty(t[n])&&(t[n]=[]),t[n].push(e))},this),this.set("scheduleToPoolMap",t)},getCollection:function(e){return this.collections[e]}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(318)),initialize:function(e){this.hoursView=new Magellan.Views.RoundRobinSchedulesHours({parentView:this}),this.holidaysView=new Magellan.Views.RoundRobinSchedulesHolidays({parentView:this}),this.vacationsView=new Magellan.Views.RoundRobinSchedulesVacations({parentView:this}),this.hoursCreatorView=new Magellan.Views.RoundRobinSchedulesHoursCreator({parentView:this}),this.holidaysCreatorView=new Magellan.Views.RoundRobinSchedulesHolidaysCreator({parentView:this}),this.vacationsCreatorView=new Magellan.Views.RoundRobinSchedulesVacationsCreator({parentView:this})},events:{"click .ld-tab":"handleTabClick"},handleTabClick:function(e){var t=$(e.target);t.siblings(".ld-tab").removeClass("active"),t.addClass("active"),t.hasClass("working-hours")&&this.switchTab("working-hours"),t.hasClass("holidays")&&this.switchTab("holidays"),t.hasClass("vacations")&&this.switchTab("vacations")},switchTab:function(e,t){this.$el.find("#fullscreenDiv").hide(),this.toggleFullscreen(!1),this.$el.find("#tab-content").empty(),"working-hours"===e&&this.switchView(this.hoursView,!1),"holidays"===e&&this.switchView(this.holidaysView,!1),"vacations"===e&&this.switchView(this.vacationsView,!1),"working-hours-creator"===e&&(this.hoursCreatorView=new Magellan.Views.RoundRobinSchedulesHoursCreator({parentView:this,Id:t}),this.switchView(this.hoursCreatorView,!0,t)),"holidays-creator"===e&&(this.holidaysCreatorView=new Magellan.Views.RoundRobinSchedulesHolidaysCreator({parentView:this,Id:t}),this.switchView(this.holidaysCreatorView,!0,t)),"vacations-creator"===e&&this.switchView(this.vacationsCreatorView,!0,t)},switchView:function(e,t,i){if(t)var n=this.$el.find("#fullscreenDiv");else n=this.$el.find("#tab-content");this.toggleFullscreen(t),n.empty(),e.delegateEvents(),n.append(e.$el),e.render()},toggleFullscreen:function(e){this.$el.find(".mainDiv").toggle(!e),this.$el.find("#fullscreenDiv").toggle(e)},render:function(){var e=this.template();return this.$el.html(e),this.$el.find("#tab-content").append(this.hoursView.render().$el),this}})}},function(e,t){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),Magellan.Models.Territory=Backbone.Model.extend({initialize:function(e){this.set(e),this.set({_cid:this.cid})}}),Magellan.Models.Territories=Backbone.Collection.extend({model:Magellan.Models.Territory,initialize:function(e){void 0!==e&&"segmentName"in e||console.error("The Territories collection requires segmentName to be set."),this.segmentName=e.segmentName,this.fetchRemoteData()},fetchRemoteData:function(){var e=this,t=$.Deferred(),i=Magellan.Services.FlowBuilder.getTerritoryRoutingObjects(this.segmentName).then(function(t){0===t.territoryList.length&&Magellan.Navigation.navigate("#territory_segments");var i=[];t.territoryList.forEach(function(e){e[ns+"Original_Owner__c"]=e[ns+"Owner__c"];var t=new Magellan.Models.Territory(e);i.push(t)}),e.reset(i),e.ownerIds=_.keys(t.ownerToTerritoriesMap)}),n=Magellan.Services.FlowBuilder.getAllOwnerDataRemote("",!1).then(function(t){e.ownerIdToNameMap=JSON.parse(t["name map"]),e.owners=JSON.parse(t.owners),e.inactiveOwnerMap={},e.owners.forEach(function(t){t.IsActive||(e.inactiveOwnerMap[t.Id]=t.Name)}),e.dropdownOwnerList=Object.keys(e.ownerIdToNameMap).map(function(t){return{value:t,label:e.ownerIdToNameMap[t]}}),e.dropdownOwnerList=_.sortBy(e.dropdownOwnerList,function(e){return e.label.toLowerCase()})});return $.when(i,n).done(function(){hideLoadingOverlay(),t.resolve()}),t},destroyChanges:function(){this.each(function(e){var t={};t[ns+"Owner__c"]=e.get(ns+"Original_Owner__c"),e.set(t)})},getChangeSet:function(){var e=[];return this.each(function(t){t.get("Id");t.get(ns+"Original_Owner__c")!==t.get(ns+"Owner__c")&&e.push({territoryId:t.get("Id"),newOwnerId:t.get(ns+"Owner__c")})}),e},submitChanges:function(){var e=this.getChangeSet();return 0===e.length?$.Deferred().resolve().promise():Magellan.Services.FlowBuilder.handleApplyTerritoryReassignment(e,this.segmentName)},hasChanges:function(){return this.getChangeSet().length>0}})}},function(e,t,i){function setActiveTab(e){void 0!==e&&($(".ld-tabs-div .ld-tab").toggleClass("active",!1),$(".ld-tab."+e).toggleClass("active",!0))}function populateAssignmentDropdown(e,t){var i="<span style=\"background-image: url('"+resourceURL+'/images/Down_Arrow_Icon.png\'); border-color: var(--ld-green);" class="assign-owner-dropdown ld-secondary-small-button dk-grey-1 bg-white">'+t+"</span>";e.replaceWith(i)}function resetAssignmentDropdown(e){var t="<span style=\"background-image: url('"+resourceURL+'/images/Down_Arrow_Icon.png\'); border-color: var(--lt-grey-2);" class="assign-owner-dropdown ld-secondary-small-button dk-grey-1 bg-white">Select a new owner</span>';e.replaceWith(t)}var n,a;e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Views&&(Magellan.Views={}),Magellan.Views.TerritorySegmentAssignments=Backbone.View.extend({template:_.template(i(320)),initialize:function(e){var t=this;return this.waitingScreen=Magellan.Controllers.GUI.appWaitingScreen.show("Loading Data..."),this.collection=new Magellan.Models.Territories({segmentName:Magellan.Navigation.selectedSegmentId}),this.collection.fetchRemoteData().then(function(){t.render(),t.waitingScreen.resolve(),t.collection.on("all",t.redrawAssignmentDropdowns,t),t.collection.segmentURL=t.collection.segmentName.replace(/\//g,"%2f")}),this},events:{"click #segments-breadcrumb":"handleSegmentsBreadcrumbClick","click #edit-segment-button":"handleEditSegmentClick","click .segment-assignment-btn.save":"handleSaveChangesClick","click .segment-assignment-btn.cancel":"handleCancelChangesClick","click .ld-tab.owners":"switchTabToOwners","click .ld-tab.territories":"switchTabToTerritories","click tr.owner-row td:nth-child(-n+2)":"toggleOwnerRow","click .assign-owner-dropdown":"handleReassignDropdownClick","nestedTypeaheadSelector:select .ownerListTypeahead":"setNewOwner"},handleEditSegmentClick:function(){var e=this;this.collection.hasChanges()?requestModalResponse("dirty").then(function(){Magellan.Navigation.navigate("territory_segments/editor/"+e.collection.segmentURL)}):Magellan.Navigation.navigate("territory_segments/editor/"+e.collection.segmentURL)},handleSegmentsBreadcrumbClick:function(){Magellan.Navigation.navigate("territory_segments")},handleSaveChangesClick:function(){this.collection.submitChanges().then(()=>{Magellan.Navigation.promptAreYouSure=!1,Magellan.Navigation.navigate("territory_segments/assignments/"+this.collection.segmentURL),Backbone.history.loadUrl()})},handleCancelChangesClick:function(){var e=this;requestModalResponse("confirm-undo").then(function(){e.collection.destroyChanges()})},handleReassignDropdownClick:function(e){$(e.target).parent();var t=$(e.target).closest("tr"),i=t.data("ownerid"),n=t.is(".owner-row"),a=n?null:t.data("territoryid"),o=n?i:a,l=$('<div class="ownerListTypeahead" id="'+o+'"></div>');$(e.target).replaceWith(l);var s=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,selection:[],asyncServiceCall:Magellan.Controllers.FlowBuilder.getAllOwnerDataActiveOnlyRemote});this.$el.find("#"+o).html(s.$el),s.$el.find(".typeahead").focus()},setNewOwner:function(e,t){var i=$(e.target).closest("tr"),n=i.data("ownerid"),a=i.is(".owner-row"),o=a?null:i.data("territoryid"),l=[];if(a){var s={};s[ns+"Original_Owner__c"]=n,l=this.collection.where(s)}else l.push(this.collection.findWhere({Id:o}));l.forEach(function(e){var i={};i[ns+"Owner__c"]=t.selection[0].Id,e.set(i)})},handleValidAutocompleteChange:function(e,t,i,n,a){var o=[];if(n){var l={};l[ns+"Original_Owner__c"]=i,o=this.collection.where(l)}else o.push(this.collection.findWhere({Id:a}));o.forEach(function(e){var i={};i[ns+"Owner__c"]=t,e.set(i)})},handleInvalidAutocompleteChange:function(e,t){resetAssignmentDropdown(e)},switchTabToOwners:function(){this.$el.find("#pivotByTerritory").hide(),this.$el.find("#pivotByOwner").show(),setActiveTab("owners")},switchTabToTerritories:function(){this.$el.find("#pivotByTerritory").show(),this.$el.find("#pivotByOwner").hide(),setActiveTab("territories")},toggleOwnerRow:function(e){var t=$(e.target).closest("tr").data("ownerid"),i=$(e.target).closest("tr");i.toggleClass("collapsed");var n=i.siblings('.owner-pivot-row[data-ownerid="'+t+'"]'),a=n.children("td, th");a.children().first().is("div")||n.children("td, th").wrapInner('<div style="display:none" />'),i.is(".collapsed")?(a.animate({paddingTop:0,paddingBottom:0},100),n.slideUp(100).children("td, th").children().slideUp(100)):n.slideDown(100).children("td, th").animate({paddingTop:5,paddingBottom:5},100).children().slideDown(100)},redrawAssignmentDropdowns:function(){var e=this;e.collection.ownerIds.forEach(function(t){e.$el.find(".owner-row[data-ownerid="+t+"] .pivot-table-dropdown-container").each(function(i){var n={};n[ns+"Original_Owner__c"]=t;var a=e.collection.where(n),o=a[0].get(ns+"Owner__c");!function hasSameOwner(e){var t=e[0].get(ns+"Owner__c");return e.filter(function(e){return e.get(ns+"Owner__c")===t}).length===e.length}(a)||o===t?resetAssignmentDropdown($(this).children()):populateAssignmentDropdown($(this).children(),e.collection.ownerIdToNameMap[o])})}),e.collection.models.forEach(function(t){var i=t.get(ns+"Owner__c"),n=t.get(ns+"Original_Owner__c");e.$el.find(".owner-pivot-row[data-territoryid="+t.get("Id")+"] .pivot-table-dropdown-container").each(function(t){i!==n?populateAssignmentDropdown($(this).children(),e.collection.ownerIdToNameMap[i]):resetAssignmentDropdown($(this).children())}),e.$el.find(".territory-row[data-territoryid="+t.get("Id")+"] .pivot-table-dropdown-container").each(function(t){i!==n?populateAssignmentDropdown($(this).children(),e.collection.ownerIdToNameMap[i]):resetAssignmentDropdown($(this).children())})}),e.collection.hasChanges()?(e.$el.find(".dirty-bar").slideDown(),Magellan.Navigation.promptAreYouSure=!0):(e.$el.find(".dirty-bar").slideUp(),Magellan.Navigation.promptAreYouSure=!1)},render:function(){n=this.collection.inactiveOwnerMap,a=this.collection.ownerIdToNameMap,hideLoadingOverlay();var e=this.template({collection:this.collection,territories:this.collection.toJSON(),ownerIds:this.collection.ownerIds,getOwnerName:this.getOwnerName});return this.$el.html(e),this.switchTabToOwners(),this}})},getOwnerName=function(e){return a[e]?a[e]:n[e]?"<span class='ld-text-danger'>"+n[e]+" (INACTIVE)</span>":"<span class='ld-text-danger'> (Deleted Round Robin Pool) </span>"}},function(e,t,i){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Views&&(Magellan.Views={}),Magellan.Views.TerritorySegmentEditor=Backbone.View.extend({template:_.template(i(321)),initialize:function(e){var t=this;return this.colIdxToAttribute=[null,"Territory_Name",ns+"Owner__c",ns+"PostalCode__c",ns+"City__c",ns+"State__c",ns+"Country__c",ns+"Custom_Field__c",null],this.waitingScreen=Magellan.Controllers.GUI.appWaitingScreen.show("Loading Data..."),this.collection=new Magellan.Models.TerritoryGeos(null,{segmentName:Magellan.Navigation.selectedSegmentId}),this.collection.fetchRemoteData().then(function(){t.render(),t.waitingScreen.resolve()}),this.collection.segmentURL=t.collection.segmentName.replace(/\//g,"%2f"),this.listenTo(this.collection,"change",this.updateCellBorders),this.listenTo(this.collection,"change",this.updateValidationCell),this.listenTo(this.collection,"change",this.updateDirtyBar),this.listenTo(this.collection,"remove",this.updateDirtyBar),this},events:{"click #segments-breadcrumb":"handleSegmentsBreadcrumbClick","click #assignments-breadcrumb":"handleAssignmentsBreadcrumbClick","click #add-territory-buttton":"handleAddTerritoryClick","change #territory-routing-editor .territorySegmentsTableBody input":"handleDatatablesInputChange","click .deleteButton":"handleDeleteButtonClick","click .segment-edit-btn.cancel":"handleCancelButtonClick","click .segment-edit-btn.save":"handleSaveButtonClick","click #rename-button":"handleRenameButtonClick","nestedTypeaheadSelector:select .ownerListTypeahead":"setNewOwner"},handleSegmentsBreadcrumbClick:function(){Magellan.Navigation.navigate("territory_segments")},handleAssignmentsBreadcrumbClick:function(){Magellan.Navigation.navigate("territory_segments/assignments/"+this.collection.segmentURL)},handleRenameButtonClick:function(e){var t=this,i=this.collection.segmentName;this.$el.find("#editorSubHeader2").html('<input id="segment-name-editor">'),this.$el.find("#segment-name-editor").val(i).focus().keypress(function(e){13==e.which&&function submitName(e){if(""===e.trim())return;if(t.$el.find("#segment-name-editor").addClass("saving"),e.trim()===t.collection.segmentName)return void t.$el.find("#editorSubHeader2").html(e);Magellan.Services.FlowBuilder.saveSegmentName(e,i).then(function(i){"Success"===i?(t.collection.segmentName=e,t.$el.find("#editorSubHeader2").html(e),window.history.pushState("","","Dashboard#territory_segments/editor/"+e.replace(/\//g,"%2f"))):(requestModalResponse("wildcard"),$("#wildcard-modal-header").html("Failed to rename segment"),$("#wildcard-modal-main").html(i))})}($(this).val())}).blur(function(e){t.$el.find("#editorSubHeader2").html(i)})},handleCancelButtonClick:function(e){requestModalResponse("confirm-undo").then(()=>{Magellan.Navigation.promptAreYouSure=!1,Magellan.Navigation.navigate("territory_segments/editor/"+this.collection.segmentURL),Backbone.history.loadUrl()})},handleSaveButtonClick:function(e){showLoadingOverlay(),this.collection.submitChanges().then(e=>{hideLoadingOverlay(),("Success"===e?requestModalResponse("save-success"):requestModalResponse("save-failure")).then(()=>{Magellan.Navigation.promptAreYouSure=!1,Magellan.Navigation.navigate("territory_segments/editor/"+this.collection.segmentURL),Backbone.history.loadUrl()})})},handleDeleteButtonClick:function(e){var t=this;requestModalResponse("delete-territory").then(function(){var i=$(e.target).closest("tr"),n=i[0].id,a=t.collection.get(n),o=Boolean(i.data("isnewrow"));t.datatable.row(i).remove().draw(),t.collection.remove(n),o||(t.collection.modelsToDelete.add(a),t.collection.trigger("remove",a))})},handleDatatablesInputChange:function(e){var t=this,i=$(e.target).closest("tr"),n=i[0].id,a=this.collection.get(n),o={};i.children("td").each(function(e){var i=$(this).find("input").val(),n=t.colIdxToAttribute[e];null!==n&&n!==ns+"Owner__c"&&(o[n]=i)}),a.set(o)},updateValidationCell:function(e){var t=this.$el.find("tr[id="+e.cid+"]").find("td:first-child"),i=e.getValidationStatus();if(e.hasChanged())if(i.errorMessages.length>0){t.html("");var n=$('<img src="'+resourceURL+'/images/Triangle_Error_Icon_node.png">').appendTo(t),a=$('<div class="error-messages">').appendTo(t);a.html(i.errorMessages.join(",<br> ")),n.on("mouseenter",function(){a.show()}).on("mouseout",function(){a.hide()})}else t.html('<img src="'+resourceURL+'/images/Checkmark_Icon_selected.png">');else t.html("")},updateCellBorders:function(e){var t=this,i=this.$el.find("tr[id="+e.cid+"]"),n=e.getValidationStatus();i.children().find("input").css("border","1px solid var(--lt-grey-2)"),e.fieldsChanged().forEach(function(e){var n=t.colIdxToAttribute.indexOf(e);-1!==n&&i.children(":nth-child("+(n+1)+")").find("input").css("border","1px solid var(--ld-green)")}),n.invalidFields.forEach(function(e){var n=t.colIdxToAttribute.indexOf(e);-1!==n&&i.children(":nth-child("+(n+1)+")").find("input").css("border","1px solid #fb9191")})},updateDirtyBar:function(e){this.collection.modelsToChange.size>0||this.collection.modelsToDelete.size>0?(this.$el.find(".dirty-bar").slideDown(),this.$el.find(".dirty-bar .segment-edit-btn.save").toggleClass("disabled",this.collection.invalidModels.size>0),Magellan.Navigation.promptAreYouSure=!0):(this.$el.find(".dirty-bar").slideUp(),Magellan.Navigation.promptAreYouSure=!1)},handleAddTerritoryClick:function(e){var t=new Magellan.Models.TerritoryGeo(null,{isNewTerritory:!0,collection:this.collection});this.collection.add(t);var i=$('<tr data-isnewrow="true" id="'+t.cid+'">');i.append($("<td></td>"));for(var n=0;n<7;n++)i.append($("<td><input></td>"));i.append($('<td><div class="deleteButton ld-cross-icon-large"></div></td>')),this.datatable.row.add(i).draw();var a=this.colIdxToAttribute.indexOf(ns+"Owner__c");i.find("td:nth-child("+(a+1)+") input");this.datatable.order([1,"asc"]).draw(),i.find("td:nth-child(2) input").focus()},setNewOwner:function(e,t){$(e.target);var i=$(e.target).closest("tr")[0].id,n=this.collection.get(i),a=t.selection[0].Id;if(a in this.collection.ownerIdToNameMap){this.collection.ownerIdToNameMap[a];var o={};o[ns+"Owner__c"]=a,n.set(o)}},render:function(){hideLoadingOverlay();var e=this.template({collection:this.collection,ownerIdToNameMap:this.collection.ownerIdToNameMap});return this.$el.html(e),this.datatable=function initializeDataTablesEditor(){window.alert=function(){var e=window.alert;return function(t){window.alert=e,0===t.indexOf("DataTables warning")?console.warn(t):e(t)}}();var e=this;$.fn.dataTable.ext.order["dom-text"]=function(e,t){return this.api().column(t,{order:"index"}).nodes().map(function(e,t){return $("input",e).val()})};var t=[],i=0;return _.each(this.collection.models,function(n){t.push(["",'<input value="'+n.get("Territory_Name")+'">','<input value="'+e.collection.ownerIdToNameMap[n.get(ns+"Owner__c")]+'">','<input value="'+n.get(ns+"PostalCode__c")+'">','<input value="'+n.get(ns+"City__c")+'">','<input value="'+n.get(ns+"State__c")+'">','<input value="'+n.get(ns+"Country__c")+'">','<input value="'+n.get(ns+"Custom_Field__c")+'">','<div class="deleteButton ld-cross-icon-large"></div>',n.cid]),t[i]["data-cid"]=n.cid,i++}),$("#territoryGeosTable").DataTable({columnDefs:[{targets:[0,8],orderable:!1},{targets:[1,2,3,4,5,6,7],orderDataType:"dom-text",type:"string",orderable:!0},{targets:[0,8],width:"20px"},{targets:[2],width:"200px"},{targets:[1,3,4,5,6,7],width:"100%"}],data:t,order:[[1,"asc"]],paginate:!0,pageLength:10,scrollInfinite:!0,scrollCollapse:!1,searchDelay:0,deferRender:!1,dom:"frtp",select:!0,rowId:"data-cid",language:{search:"",searchPlaceholder:"Search Segment"},drawCallback:function(t){var i=e.colIdxToAttribute.indexOf(ns+"Owner__c");$("#territoryGeosTable .territorySegmentsTableBody tr td:nth-child("+(i+1)+") input").each(function(t,i){var n=$(i);if(""===i.autocomplete){var a,o=n.closest("tr")[0].id,l=e.collection.get(o).get(ns+"Owner__c"),s=e.collection.ownerIdToNameMap[l];l&&s&&(a={Id:l,name:s,label:s});var r=$('<div class="ownerListTypeahead" id="'+t+'"></div>');n.replaceWith(r);var d=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,selection:_.isEmpty(a)?[]:[a],asyncServiceCall:Magellan.Controllers.FlowBuilder.getAllOwnerDataRemote});e.$el.find("#"+t).html(d.$el)}})}})}.call(this),this.collection.segmentName.endsWith(" - Draft")&&$("#rename-button").hide(),this}})}},function(e,t){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),Magellan.Models.TerritorySegment=Backbone.Model.extend({initialize:function(e,t){this.set(e),this.setSegmentType(t),this.setUploadStatus(e),this.set({_cid:this.cid})},setSegmentType:function(e){0===this.get("segmentCount")?this.set({segmentType:"empty"}):e.isDraft?this.set({segmentType:"draft"}):this.set({segmentType:"default"})},setUploadStatus:function(e){var t="";if(null!=e[ns+"Upload_Status__c"]&&e[ns+"Upload_Status__c"].startsWith("Upload")){var i,n=e[ns+"Upload_Status__c"].split(", ");6==n.length||7==n.length||8==n.length?(void 0===n[7]&&(n[7]=""),i='<table class="upload-file-errors on-error-icon no-click"><tbody class="no-click"><tr class="no-hover"><td class="no-click upload-file-header" style="width:500px;">Upload Failed - Errors Below</td><td class="no-click"><tr class="no-hover"><td class="no-click" style="width:500px">Number of rows with PostalCode populated but missing Country: </td><td class="no-click">'+n[1]+'</td></tr><tr class="no-hover"><td class="no-click" style="width:500px">Number of rows with City populated but missing Country (or State/Country for US): </td><td class="no-click">'+n[2]+'</td></tr><tr class="no-hover"><td class="no-click" style="width:500px">Number of rows with missing data: </td><td class="no-click">'+n[3]+'</td></tr><tr class="no-hover"><td class="no-click" style="width:500px">Number of rows with invalid/inactive owners or invalid round robin names: </td><td class="no-click">'+n[4]+'</td></tr><tr class="no-hover"><td class="no-click" style="width:500px">Number of rows with duplicate data: </td><td class="no-click">'+n[5]+'</td></tr><tr class="no-hover"><td class="no-click" style="width:500px">Duplicate Row Pairs: </td><td class="no-click">'+n[6]+'</td></tr><tr class="no-hover"><td class="no-click" style="width:500px">Invalid Owners: </td><td class="no-click">'+n[7]+"</tr></tbody></table>"):i='<table class="upload-file-errors on-error-icon no-click"><tbody class="no-click"><tr class="no-hover"><td class="no-click upload-file-header" style="width:500px;">Upload Failed - Errors Below</td></tr><tr class="no-hover"><td class="no-click" style="width:500px;">'+e[ns+"Upload_Status__c"]+"</td></tr></tbody></table>",t=i}else t="Success";this.set({uploadStatus:t})},deploy:function(){return Magellan.Services.FlowBuilder.deployTerritorySegment(this.get(ns+"Name__c"))},rename:function(e){return Magellan.Services.FlowBuilder.saveSegmentNameById(this.get("Id"),e)},duplicate:function(){var e=$.Deferred(),t=this.get(ns+"Name__c")+" - Copy",i={};return i[ns+"Name__c"]=t,this.collection.findWhere(i)?(e.reject('A segment with the name "'+t+'" already exists.'),e):(Magellan.Services.FlowBuilder.duplicateTerritorySegment(this.get(ns+"Name__c")).then(function(t){"Segment Not Found"===t&&e.reject(t),e.resolve(t)}),e)},exportCSV:function(){var e=this,t=new $.Deferred,i=Magellan.Services.FlowBuilder.getTerritoryRoutingObjects(this.get(ns+"Name__c")),n=this.get(ns+"Version__c");"draft"===this.get("segmentType")&&n++;var a=Magellan.Models.TerritoryGeos.fetchGeoList(this.get(ns+"Name__c"),n);return $.when(i,a).then(function(i,n){var a=n;!function handleTerritorySegmentCSVDownload(e,t,i){if(null!=e){var n="Territory,Owner Id,Round Robin Name,PostalCode,City,State,Country,Custom Field\n",a=i,o=e.roundRobinGroupIdToNameMap;a.forEach(function(e){n+=e[ns+"LD_Territory__r"][ns+"Name__c"]||"",n+=",",void 0===e[ns+"LD_Territory__r"][ns+"Owner__c"]?n+="":e[ns+"LD_Territory__r"][ns+"Owner__c"].startsWith("005")||e[ns+"LD_Territory__r"][ns+"Owner__c"].startsWith("00G")?n+=e[ns+"LD_Territory__r"][ns+"Owner__c"]:n+="",n+=",",void 0===e[ns+"LD_Territory__r"][ns+"Owner__c"]?n+="":e[ns+"LD_Territory__r"][ns+"Owner__c"].startsWith("005")||e[ns+"LD_Territory__r"][ns+"Owner__c"].startsWith("00G")?n+="":n+=o[e[ns+"LD_Territory__r"][ns+"Owner__c"]],n+=",",n+=e[ns+"PostalCode__c"]||"",n+=",",n+=e[ns+"City__c"]||"",n+=",",n+=e[ns+"State__c"]||"",n+=",",n+=e[ns+"Country__c"]||"",n+=",",n+=e[ns+"Custom_Field__c"]||"",n+="\n"});var l="data:text/csv;charset=utf-8,"+encodeURI(n);download(l,t+"-Territory.csv","text/plain")}hideLoadingOverlay()}(i[0],e.get(ns+"Name__c"),a),t.resolve()}),t},remove:function(){var e="draft"===this.get("segmentType");return Magellan.Services.FlowBuilder.deleteTerritorySegment(this.get("Id"),e)}}),Magellan.Models.TerritorySegments=Backbone.Collection.extend({model:Magellan.Models.TerritorySegment,initialize:function(){},fetchRemoteData:function(){var e=this,t=$.Deferred(),i=Magellan.Services.FlowBuilder.getTerritorySegments().then(function(t){var i=t.nameMap,n=t.territorySegments,a=t.territorySegmentDeployedMap,o=t.territorySegmentCounts,l=[];e.territoryList=t.territoryList,e.territorySegments=n,n.forEach(function(t){t.inactiveOwner=!1,e.territoryList.forEach(function(e){i[e.Owner__c]||e.Territory_Segment__c!=t.Id||(t.inactiveOwner=!0)}),t.isDeployed=Boolean(a[t.Id]),t.segmentCount=o[t[ns+"Name__c"]],t.segmentCountDraft=o[t[ns+"Name__c"]+" - Draft"];var n=new Magellan.Models.TerritorySegment(t,{isDraft:!1});if(l.push(n),t[ns+"Draft_FileName__c"]&&""!==t[ns+"Draft_FileName__c"]){var s=new Magellan.Models.TerritorySegment(t,{isDraft:!0});l.push(s)}}),e.reset(l)});return $.when(i).done(function(){t.resolve()}),t}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(322)),initialize:function(e){var t=this;this.waitingScreen=Magellan.Controllers.GUI.appWaitingScreen.show("Loading Data..."),this.initializeModals(),this.delegateEvents(),this.collection=new Magellan.Models.TerritorySegments,this.collection.fetchRemoteData().then(function(){t.render()}),this.collection.on("all",this.render,this),this.hasInitUpload=!1},events:{"click .deploy-action":"handleDeploySegmentClick","click .copy-action":"handleCopySegmentClick","click .export-action":"handleExportSegmentClick","click .upload-action":"handleUploadSegmentClick","click .replace-action":"handleReplaceSegmentClick","click .rename-action":"handleRenameSegmentClick","click #csv-upload-instructions":"showInstructions","click #add-new-modal":"showAddNewModal","click #create-segment":"handleCreateSegmentClick","click #territorySegmentTable tr":"handleSegmentRowClick","mouseenter #territorySegmentTable tr .errorIcon":"handleErrorMouseEnter","mouseout #territorySegmentTable tr .errorIcon":"handleErrorMouseOut","click #territorySegmentTable tr .deleteIcon":"handleSegmentRowDeleteClick","click #territorySegmentTable tr .segment-action":"handleSegmentRowActionClick","mouseenter #territorySegmentTable tr":"handleSegmentRowMouseEnter","click #hide-territory-modal":"hideTerritoryModal"},hideExistingErrorMessages:function(){this.errorMessageTimeout&&clearInterval(this.errorMessageTimeout),this.$el.find(".error-messages").hide()},handleErrorMouseEnter:function(e){e.stopImmediatePropagation(),this.hideExistingErrorMessages(),$(e.target).siblings(".error-messages").show()},handleErrorMouseOut:function(e){e.stopImmediatePropagation(),this.errorMessageTimeout=setTimeout(()=>{$(e.target).siblings(".error-messages").hide()},5e3)},handleDeploySegmentClick:function(e){var t=this;e.stopImmediatePropagation();var i=$(e.currentTarget).closest("tr").data("cid"),n=this.collection.get(i);requestModalResponse("territory-deploy").then(function(){return showLoadingOverlay(),n.deploy()}).then(function(e){requestModalResponse("wildcard"),"New Territory Data has been deployed."===e?($("#wildcard-modal-header").html("Deploy Successful"),$("#wildcard-modal-main").html("Your Draft Territory Segment was successfully deployed. This Segment has overwritten the Live version.")):($("#wildcard-modal-header").html("Deploy Failure"),$("#wildcard-modal-main").html("Your Segment failed to deploy.")),t.collection.fetchRemoteData(),$("#upload").val("")})},handleCopySegmentClick:function(e){var t=this;e.stopImmediatePropagation();var i=$(e.currentTarget).closest("tr").data("cid"),n=this.collection.get(i);showLoadingOverlay(),n.duplicate().then(function(e){t.collection.fetchRemoteData()}).fail(function(e){hideLoadingOverlay();requestModalResponse("wildcard");$("#wildcard-modal-header").html("Failed to Copy Segment"),$("#wildcard-modal-main").html(e)})},handleExportSegmentClick:function(e){e.stopImmediatePropagation();var t=$(e.currentTarget).closest("tr").data("cid");this.collection.get(t).exportCSV()},handleUploadSegmentClick:function(e){this.hasInitUpload||(initUpload(!1,!0),this.hasInitUpload=!0);var t=this;e.stopImmediatePropagation();var i=$(e.currentTarget).closest("tr").data("cid"),n=this.collection.get(i);window.operation="territoryGeo",window.confirmTerritorySegmentReplacement=!1,window.uploadCompletedCallback=function(){t.collection.fetchRemoteData(),$("#upload").val("")},window.getParams=function(){return{operation,segment:n.get(ns+"Name__c")}},$(".selectFile").show(),$("#selectCSVModal").modal("show")},handleReplaceSegmentClick:function(e){this.hasInitUpload||(initUpload(!1,!0),this.hasInitUpload=!0);var t=this;e.stopImmediatePropagation();var i=$(e.currentTarget).closest("tr").data("cid"),n=this.collection.get(i);requestModalResponse("territory-replace").then(function(){window.operation="territoryGeo",window.confirmTerritorySegmentReplacement=!0,window.uploadCompletedCallback=function(){t.collection.fetchRemoteData(),$("#upload").val("")},window.getParams=function(){return{operation,segment:n.get(ns+"Name__c")}},$(".selectFile").show(),$("#selectCSVModal").modal("show")})},handleRenameSegmentClick:function(e){var t=this;e.stopImmediatePropagation();var i=$(e.currentTarget).closest("tr").data("cid"),n=this.collection.get(i),a=requestModalResponse("territory-rename");$("#renameTerritoryInput").on("keyup",function handleKeypress(){return function(e){var i={};i[ns+"Name__c"]=e.target.value;var n=void 0!==t.collection.findWhere(i),a=""===e.target.value;$("#territory-rename-button-div .modal-button-blue").toggleClass("disabled",n||a)}}()),$("#territory-rename-button-div .modal-button-blue").toggleClass("disabled",!0),a.then(function(e){showLoadingOverlay();var i=$("#renameTerritoryInput").val();n.rename(i).then(function(){t.collection.fetchRemoteData()})}),$("#renameTerritoryInput").val(n.get(ns+"Name__c"))},handleSegmentRowMouseEnter:function(e){j$(".segment-action").toggleClass("active",!1)},handleSegmentRowActionClick:function(e){j$(e.target).toggleClass("active")},handleSegmentRowDeleteClick:function(e){var t=this,i=$(e.currentTarget).closest("tr").data("cid"),n=this.collection.get(i);requestModalResponse("delete-territory-segment").then(function(e){showLoadingOverlay(),n.remove().then(function(){t.collection.fetchRemoteData()})})},handleSegmentRowClick:function(e){if(!$(e.target).is(".deleteIcon,.segment-action,.no-click,.error-messages")){var t=$(e.currentTarget).closest("tr").data("cid"),i=this.collection.get(t),n="draft"===i.get("segmentType")?i.get(ns+"Name__c")+" - Draft":i.get(ns+"Name__c");if(i.get("segmentCount")>0)Magellan.Navigation.navigate("territory_segments/assignments/"+n.replace(/\//g,"%2f"));else if(!(i.get(ns+"Version__c")<0)){this.hasInitUpload||(initUpload(!1,!0),this.hasInitUpload=!0);var a=this;window.operation="territoryGeo",window.confirmTerritorySegmentReplacement=!1,window.uploadCompletedCallback=function(){a.collection.fetchRemoteData(),$("#upload").val("")},window.getParams=function(){return{operation,segment:i.get(ns+"Name__c")}},$(".selectFile").show(),$("#selectCSVModal").modal("show")}}},handleCreateSegmentClick:function(){var e=this;requestModalResponse("territory-create").then(function(t){showLoadingOverlay();var i=$("#nameInput").val();Magellan.Services.FlowBuilder.createTerritorySegment(i).then(function(t){hideLoadingOverlay(),gaTrack("Create Territory Segment","Route To Territory Action"),segment=i,j$("#nameInput").val(""),e.collection.fetchRemoteData()})})},hideTerritoryModal:function(){j$("#selectCSVModal").modal("hide")},showInstructions:function(){j$(".selectFile").hide(),j$("#selectCSVModal").modal("show")},showAddNewModal:function(){j$(".selectFile").show(),j$("#createModal").modal("show"),j$("#nameInput").val("")},initializeModals:function(){j$("#modalDiv").append(createModal("edit","Edit Segment",'<div>Edit existing Segment name</div><input style="margin-left:100px; margin-right:80px;width:250px;height:24px" maxlength="30" type="text" id="editInput"/>',"Cancel","OK",null,"saveSegmentName()")),j$("#modalDiv").append(createModal("selectCSV",'<span class="subheader subheader-light">Creating a Segment</span>',_.template(i(319))(),null,null,null,null,null,300)),j$("#modalDiv").append(createModal("uploadFile","File Uploading",'<div id="uploadFileMessage" style="margin-top:40px;margin-bottom:10px; width:400px;text-align:center; color:green;">Upload in progress...</div>',null,"OK",null,null)),j$("#createModalText").css("height","110px"),j$("#createExtra").html('Name<input style="margin-left:10px; width:125px;height:22px" type="text" id="nameInput"/><div class="alert alert-danger" style="display:none" id="sameNameDiv">Territory Segment cannot have the same name as another Segment</div>'),j$("#createButtonDiv").append('<span class="modal-button-blue" style="opacity:0.3;display:none;" data-dismiss="none" id="createButton3">Create<span class="nameHover">Duplicate, Blank, or Too Long</span></span>'),j$("#modalDiv").append(createModal("delete","Delete Territory Segment","Warning: Are you sure you want to delete this Segment? It will no longer be available in FlowBuilder.","Cancel","Delete",null,"deleteTerritorySegment(deleteId)")),j$("#modalDiv").append(createModal("replaceCSV","Replace Territory Segment","Warning: Uploading another CSV will overwrite and replace this one. Are you sure you want to overwrite this Segment?","Cancel","Replace",null,"handleConfirmReplace()")),j$("#modalDiv").append(createModal("deploy","Deploy Draft Version","Are you sure you want to overwrite your deployed territory data with this draft version?","Cancel","OK",null,"handleConfirmDeploy()")),j$("#modalDiv").append(createModal("undo","Undo Changes","Are you sure you want to undo the changes you've made?","Cancel","Undo",null,"undoAction()")),j$("#modalDiv").append(createModal("deploySuccess","Deploy Successful","Your Draft Territory Segment was successfully deployed. This Segment has overwritten the Live version.",null,"OK",null,null)),j$("#modalDiv").append(createModal("deployFailure","Deploy Failure","Your Segment failed to deploy.",null,"OK",null,null)),j$("#modalDiv").append(createModal("copyDupe","Copy Error","A copied territory segment already exists. Please rename your existing copy before trying to copy again.",null,"OK",null,null)),j$("#copyDupeModalText").css("color","red"),j$("#selectCSVModal .section").off(),j$("#selectCSVModal .section").on("click",function(e){j$(this).toggleClass("collapsed"),j$(this).next(".section-body").slideToggle()})},render:function(){hideLoadingOverlay();var e=this.template({segments:this.collection.toJSON(),allOwners:this.collection.allOwners,territoryList:this.collection.territoryList,inactiveOwners:this.collection.inactiveOwners,formatMomentDate:Magellan.Util.formatMomentDate});return this.$el.html(e),this.waitingScreen.resolve(),j$("#nameInput").off(),j$("#nameInput").on("input",function createInputHandler(e){return function(t){var i=j$("#nameInput").val(),n=e.collection.filter(function(e){return e.get(ns+"Name__c")===i}),a=n.length>0;a||j$("#nameInput").val().length<1||j$("#nameInput").val().length>30?$("#territory-create-button-2").toggleClass("disabled",!0):$("#territory-create-button-2").toggleClass("disabled",!1)}}(this)),j$("#territory-create-button-2").addClass("disabled"),this},close:function(){this.unbind(),this.collection.unbind("all",this.render)}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({defaults:{graphLines:{},usageMetrics:[],lineValues:[],firstRowIconNameToPageName:{Matching:"matching-CM",Routing:"router-lead-FB",Attribution:"attribution",View:"view"},secondRowIconNameToPageName:{Admin:"admin",Help:"help"}}})}},function(e,t,i){e.exports=function(){const e=i(0)();return Backbone.View.extend({template:_.template(i(323)),initialize:function(e){this.transitionTime=700,this.firstTimeGraphRender=!1,this.formatUsageMetrics(e.routingMetrics.routingCountMetrics,e.startDate,e.endDate),this.model.set("routingUserLicenseCount",e.routingMetrics.routingUserLicenseCount),this.render()},events:{"click .show_authorization":"showAuthorizationDiv","click .hide_authorization":"hideAuthorizationDiv","click .icon":"handlePageChange","click .detailed-report-button":"redirectToRoutingUsage"},handlePageChange:function(e){const t=$(e.currentTarget).data("page-name");if("matching-CM"===t&&this.hasProductEnabled("Matching"))Magellan.Navigation.navigate("/matching/tagging_finder");else if("router-lead-FB"===t&&this.hasProductEnabled("Routing"))this.hasProductEnabled("LeadRouting")?Magellan.Navigation.navigate("/routing/lead/flowbuilder"):this.hasProductEnabled("ContactRouting")?Magellan.Navigation.navigate("/routing/contact/flowbuilder"):this.hasProductEnabled("AccountRouting")?Magellan.Navigation.navigate("/routing/account/flowbuilder"):this.hasProductEnabled("OpportunityRouting")&&Magellan.Navigation.navigate("/routing/opportunity/flowbuilder");else if("help"===t)Magellan.Navigation.navigate("/help");else{if("attribution"===t&&!this.hasProductEnabled("Attribution"))return;Magellan.Navigation.legacyChangeDashboardPage(t)}},redirectToRoutingUsage:function(){Magellan.Navigation.navigate("admin/usage_metrics")},showAuthorizationDiv:function(){this.$el.find(".show_authorization").slideUp(100,function(){this.$el.find(".authorization-div").slideDown("100")}.bind(this))},hideAuthorizationDiv:function(){this.$el.find(".authorization-div").slideUp(100,function(){this.$el.find(".show_authorization").slideDown("100")}.bind(this))},render:function(){const e=this.template({model:this.model.toJSON()});return this.$el.html(e),this.initDashboardComponent(),this.hasProductEnabled("Routing")&&(this.showGraphTitleAndDateRange(),this.modifySpacingForLineGraph(),this.createGraphData(),this.renderLineGraph()),this},initDashboardComponent:function(){let e;"no token for org"===dashboardController.viewObject.installationPanelStatus?e=this.getCookie("num_of_times_panel_displayed_in_no_token_org"):"no token for user"===dashboardController.viewObject.installationPanelStatus&&(e=this.getCookie("num_of_times_panel_displayed_in_token_org")),"org blind"===dashboardController.viewObject.installationPanelStatus&&this.$el.find(".auth_panel").hide(),"completed installation"===dashboardController.viewObject.installationPanelStatus||"no token for org"===dashboardController.viewObject.installationPanelStatus&&e>9||"no token for user"===dashboardController.viewObject.installationPanelStatus&&e>0?this.hideAuthPanel():this.showAuthPanel(),"completed installation"===dashboardController.viewObject.installationPanelStatus?(this.$el.find(".installation-complete").css("display","block"),this.$el.find(".auth_text").hide()):this.$el.find(".authorization-link").css("display","block"),"no token for org"===dashboardController.viewObject.installationPanelStatus&&e<10?this.setCookie("num_of_times_panel_displayed_in_no_token_org",(parseInt(e)+1).toString()):"no token for user"===dashboardController.viewObject.installationPanelStatus&&e<1&&this.setCookie("num_of_times_panel_displayed_in_token_org",1),this.disableHomeProductButtons()},hasProductEnabled:function(e){const t=dashboardController.viewObject.statuses;return"Matching"===e?t.hasMatching:"Routing"===e?(t.hasRouterProduct||t.hasRouter)&&(t.hasLeadRouting||t.hasContactRouting||t.hasAccountRouting||t.hasOpportunityRouting):"LeadRouting"===e?t.hasLeadRouting:"ContactRouting"===e?t.hasContactRouting:"AccountRouting"===e?t.hasAccountRouting:"OpportunityRouting"===e?t.hasOpportunityRouting:"Attribution"===e&&t.hasAttribution},disableHomeProductButtons:function(){_.each(dashboardController.FEATURE_CONFIG,function(e,t){const i=e.selector;let n="";const a=this.$el.find(".home-component "+i).find(".product-icon-button");dashboardController.viewObject.featureProvisioning[t]||(a.toggleClass("disabled",!0).prop("onclick",null).off("click"),n=dashboardController.viewObject.upsellContainerTemplate(e)),"has routing product"!==t||dashboardController.viewObject.statuses.hasLeadRouting||dashboardController.viewObject.statuses.hasContactRouting||dashboardController.viewObject.statuses.hasAccountRouting||dashboardController.viewObject.statuses.hasOpportunityRouting||(a.toggleClass("disabled",!0).prop("onclick",null).off("click"),n=dashboardController.viewObject.upsellContainerTemplate(e)),this.$el.find(".home-component "+i+" .dg_section-nav-image").parent().popover({placement:"top",container:".home-component-popover-container",content:n,html:!0,trigger:"manual",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}).on("mouseenter",function(){setTimeout(function(){$(this).popover("show"),$("#"+$(this).attr("aria-describedby")).on("mouseleave",function(){$(this).popover("hide")}.bind(this))}.bind(this),50)}).on("mouseleave",function(){setTimeout(function(){$(".popover:hover").length||$(this).popover("hide")}.bind(this),50)})},this)},getCookie:function(e){const t=document.cookie.split(";");for(let i=0;i<t.length;i++){const n=t[i].split("=");if(n[0].replace(/^\s+|\s+$/g,"")===e)return n[1]}return 0},setCookie:function(e,t){const i=e+"="+t;document.cookie=i},hideAuthPanel:function(){this.$el.find(".authorization-div").fadeOut(),this.$el.find(".show_authorization").fadeIn()},showAuthPanel:function(){this.$el.find(".authorization-div").fadeIn(),this.$el.find(".show_authorization").fadeOut()},showAuthorizationDiv:function(){this.$el.find(".show_authorization").slideUp(100,function(){this.$el.find(".authorization-div").slideDown("100")}.bind(this))},hideAuthorizationDiv:function(){this.$el.find(".authorization-div").slideUp(100,function(){this.$el.find(".show_authorization").slideDown("100")}.bind(this))},showGraphTitleAndDateRange:function(){this.$el.find(".graph-name").css("display","inline-block"),this.$el.find(".graph-date-range").css("display","inline-block"),this.$el.find(".detailed-report-button").css("display","inline-block")},modifySpacingForLineGraph:function(){this.$el.find(".icon-container").css({position:"relative"})},formatUsageMetrics:function(e,t,i){const n=Magellan.Util.formatUsageMetrics(e);this.model.set({usageMetrics:n.usageMetrics,userCount:n.uniqueIdCount,recordsRouted:n.recordsRouted,routingUsageRoutedRecordCount:Magellan.Util.shortenNumbers(n.totalRecordsRouted),startDate:moment(t).format("MMMM D, YYYY"),endDate:moment(i).format("MMMM D, YYYY")})},createGraphData:function(){const e=this.model.get("usageMetrics").map(function(e,t){e.All_Routing_Users;return{index:t,date:e.Date,count:e.All_Routing_User_Count,metric:e}});this.model.set("lineValues",e)},getCardInfo:function(e,t,i){return[{title:"Licensed Users",value:numberWithCommas(e)},{title:"Unique Users",value:numberWithCommas(t)},{title:"Records Routed",value:numberWithCommas(i)}]},getLegendInfo:function(){return["Active Users/Queues","Licensed Users"]},renderLineGraph:function(){const t=this.model.get("routingUserLicenseCount"),i=Magellan.Util.shortenNumbers(this.model.get("userCount")),n=this.model.get("recordsRouted").total;this.lineGraphView=new e({cardInfo:this.getCardInfo(t,i,n),legendInfo:this.getLegendInfo(),graphLines:{},params:{width:1050,height:350,margin_top:10,margin_left:15,margin_bottom:30,margin_right:30,tick_format_x:d3.timeFormat("%m/%d"),tick_format_y:function(e){return Math.floor(e)==e?e:void 0},get_data_x:function(e){return e.date},get_data_y:function(e){return e.count},transition_time:this.firstTimeGraphRender?700:0}}),this.$el.find(".line-graph-wrapper").html(this.lineGraphView.$el);const a=this.model.get("lineValues");if(void 0!=a){const e=this.model.get("startDate"),t=this.model.get("endDate"),i=this.model.get("routingUserLicenseCount");this.firstTimeGraphRender=!1,this.lineGraphView.createAndSetGraphLine(e,t,i,a,[]),this.lineGraphView.updateGraph()}}})}},function(e,t,i){window.currentNode,Magellan=window.Magellan=window.Magellan||Magellan||{},Magellan.Models=Magellan.Models||{},Magellan.Views=Magellan.Views||{},Magellan.Controllers=Magellan.Controllers||{},i(58)(),window.initializeHomePage=i(61),window.initializeMagellanUtil=i(59),window.initializeMagellanController=i(54),window.initializeFlowBuilderHelpers=i(52),window.initializeMagellanModels=i(56),window.initializeNewViews=i(57),window.initializeMagellanMigration=i(55),window.initializeMagellanValidation=i(60),window.initializeMetricsDetail=i(35),window.initializeMetricsDetailView=i(39),window.initializeMetricsDetailTable=i(36),window.initializeMetricsDetailTableRow=i(37),window.initializeMetricsDetailTableRowError=i(38),window.initializeMetricsDetailModels=i(40),window.initializeMatchingModule=i(62),window.initializeHelpModule=i(34),window.initializeAdvancedSettingsAccountCreationModule=i(31),window.initializeAdvancedSettingsMergeDuplicatesModule=i(32),window.initializeRunHistoryModule=i(10),window.initializeSettingsHistoryModule=i(11),i(30),i(33),i(41),window.initializeTerritorySegments=i(50),window.initializeTerritorySegmentAssignments=i(48),window.initializeTerritorySegmentEditor=i(49),window.initializeRoundRobinSchedules=i(47),window.initializeRoundRobinPools=i(46),window.initializeRoundRobinPoolsCreator=i(45),window.initializeRoundRobinMembers=i(44),window.initializeRoundRobinMemberDetails=i(43),window.initializeRoundRobinLiveRouting=i(42),window.initializeRoutingMetrics=i(64),window.initializePartnerApps=i(63),i(53)(),i(51)(),i(16)(),i(26)(),i(12)(),i(18)(),i(22)(),i(17)(),i(25)(),i(24)(),i(23)(),i(21)(),i(29)(),i(19)(),i(28)(),i(27)(),i(15)(),i(14)(),i(13)(),i(1)(),i(0)(),i(20)()},function(e,t,i){e.exports=function(){var e=i(324).replace(/#RESOURCEURL#/g,resourceURL);return Magellan.Views.MappedAccountFieldsTableRow=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.fieldsData=e.fieldsData,this.customFields=e.customFields,this.standardFields=e.standardFields,this.includeInSave=!0,this.saved=!1,this.synced=!1,this.mappingPageBlacklist=["reporting_matched_account__c","matched_account_custom_field_1__c"],this.leadDropdown={},this.accountDropdown={},this.restrictedObjectType=null,this.accountFieldSelection=null,this.restrictedObjectTypeParent="Account",this.flattedLeadFields={Lead:Magellan.Controllers.FlowBuilder.getFlattenedFieldsByObject("Lead")}},template:_.template(e),createLeadFieldsDropdown:function(e,t){var i=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:t,data:e,selection:[],onSelect:this.updateAccountDropdown.bind(this),filter:this.filterFields.bind(this)});return i.validate(),i},createAccountFieldsDropdown:function(e,t){var i=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:t,data:e,selection:[],onSelect:this.updateLeadDropdown.bind(this)});return i.validate(),i},filterFields:function(e){this.restrictedObjectType;var t=this.restrictedObjectTypeParent;if(this.accountFieldSelection.objectType=t,null==this.restrictedObjectType)return e;e=Magellan.Util.createMappingFieldsFilter(this.accountFieldSelection)(e);var i=Magellan.Controllers.FlowBuilder.getStandardMappingFields(),n=this.customFields;e=_.filter(e,function(e){return!_.some(n,{leadField:{value:e.name}})&&!_.some(i,{leadField:{name:e.name}})});var a=this.mappingPageBlacklist;return e=_.filter(e,function(e){return!a.includes(e.name)}),e=_.filter(e,function(e){return e.isUpdateable&&!e.isUnique})},render:function(){this.removeAllChildViews();var e=this.template({});return this.setElement(e),this},renderUpdates:function(){var e=this.createAccountFieldsDropdown(this.fieldsData,"Account"),t=this.createLeadFieldsDropdown(this.flattedLeadFields,"Lead");this.leadDropdown=t,this.accountDropdown=e,this.$el.find(".left-dropdown-container").html(e.$el),this.$el.find(".right-dropdown-container").html(t.$el)},updateAccountDropdown:function(e,t){this.saved=!1,this.synced=!1},updateLeadDropdown:function(e,t){var i=t.length;this.saved=!1,this.synced=!1,this.accountFieldSelection=t[i-1],(this.restrictedObjectType!=Magellan.Validation.SFDC_TYPE_TO_GROUPING[t[i-1].type]||t[i-1].type)&&(this.restrictedObjectType=Magellan.Validation.SFDC_TYPE_TO_GROUPING[t[i-1].type]||t[i-1].type,t[i-1].parent[0]&&(this.restrictedObjectTypeParent=t[i-1].parent[0]),this.leadDropdown.setSelection([]),this.leadDropdown.render(),this.leadDropdown.validate())},additionalEvents:{"click .delete-custom-row":"deleteCustomRow"},showSaveButton:function(){$("#save_button").show()},deleteCustomRow:function(){this.includeInSave=!1,this.showSaveButton(),this.remove()},remove:function(){this.includeInSave=!1,this.removeAllChildViews(),Backbone.View.prototype.remove.apply(this,arguments)}})}},function(e,t,i){e.exports=function(){var e=i(325).replace(/#RESOURCEURL#/g,resourceURL);return Magellan.Views.MappedAccountFieldsTable=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.customFields=e.custom_fields,this.standardFields=Magellan.Controllers.FlowBuilder.getStandardMappingFields()},template:_.template(e),render:function(){this.removeAllChildViews();var e=this.template({standard_fields:this.standardFields,custom_fields:this.customFields});return this.setElement(e),this}})}},function(e,t,i){e.exports=function(){var e=i(326).replace(/#RESOURCEURL#/g,resourceURL);return Magellan.Views.MappedAccountFields=Magellan.Views.ButtonHandler.extend({initialize:function(){this.metaData=[],this.tableRows=[],this.customFields=[],this.rowsDeleted=!1},template:_.template(e),addRowToTable:function(e){var t=new Magellan.Views.MappedAccountFieldsTableRow({fieldsData:this.metaData.Fields,customFields:this.customFields});$(document).find("#mapped_account_fields").append(t.render().$el),t.renderUpdates(),this.tableRows.push(t),this.showSaveButton()},deleteRow:function(e){var t=j$(e.currentTarget).closest(".custom-field-row");this.rowsDeleted=!0;for(var i=t.find(".account-field-label").data("value"),n=t.find(".lead-field-label").data("value"),a=0;a<this.customFields.length;a++)this.customFields[a].accountField.value==i&&this.customFields[a].leadField.value==n&&this.customFields.splice(a,1);t.remove(),this.showSaveButton()},additionalEvents:{"click .add-new-row":"addRowToTable","click .delete-row":"deleteRow","click #save_button":"save","click #sync_button":"sync"},showSyncButton:function(){$("#sync_button").show()},hideSyncButton:function(){$("#sync_button").hide()},showSaveButton:function(){$("#save_button").removeClass("disabled")},hideSaveButton:function(){$("#save_button").addClass("disabled")},render:function(){var e=Magellan.Services.Matching.loadTaggingFieldController();e.then(function(e,t){this.metaData=e,this.metaData.Leads=_.sortBy(this.metaData.Leads,["name"]);var i=this.metaData.Fields;_.each(i,function(e,t){i[t]=_.sortBy(i[t],"name")}),e.hasOwnProperty("Custom Fields")&&(this.customFields=JSON.parse(e["Custom Fields"]));var n=new Magellan.Views.MappedAccountFieldsTable({custom_fields:this.customFields});$(document).find("#mapped_account_fields").html(n.render().$el)}.bind(this)),e.fail(function(e){console.log("Error loadingTaggingFieldController. Error Message: "+e)}),this.removeAllChildViews();var t=this.template({});return this.$el.html(t),this},save:function(){mappings=_.clone(this.customFields);var e=this.validateForms();if(e)this.missingFieldsModal=new Magellan.Views.ConfirmationModal({header:"Missing Fields",message:"Ensure that all your fields are populated.",primaryButtonText:"Ok",hideSecondaryButton:!0}),this.missingFieldsModal.open();else if(!e){this.savedModal=new Magellan.Views.ConfirmationModal({header:"Saved",message:"Your settings have been saved.",primaryButtonText:"OK",hideSecondaryButton:!0}),this.savedModal.open();for(var t=0;t<this.tableRows.length;t++)if(this.tableRows[t].includeInSave){this.tableRows[t].saved=!0;this.tableRows[t].accountDropdown.selection;for(var i=this.tableRows[t].leadDropdown.selection[0],n="",a="",o=0;o<this.tableRows[t].accountDropdown.selection.length;o++)o!=this.tableRows[t].accountDropdown.selection.length-1?(n+=this.removeIDFromLabel(this.tableRows[t].accountDropdown.selection[o].label),a+=this.flatten(this.tableRows[t].accountDropdown.selection[o].name),n+=".",a+="."):("id"==this.tableRows[t].accountDropdown.selection[o].name&&0==o?a="id":"id"==this.tableRows[t].accountDropdown.selection[o].name?a=a.slice(0,-1)+".id":a+=this.tableRows[t].accountDropdown.selection[o].name,n+=this.tableRows[t].accountDropdown.selection[o].label);var l={value:a,label:n},s={value:i.name,label:i.label};mappings.push({leadField:s,accountField:l})}var r=this,d=Magellan.Services.Matching.saveTaggingFields(mappings);this.rowsDeleted=!1,this.saveNewRows(),this.hideSaveButton(),d.then(function(e,t){r.checkUnsyncedRows()&&r.showSyncButton()}),d.fail(function(e){console.log("Error saveTaggingFields. Error Message: "+e)})}},sync:function(){if(this.validateForms())this.missingFieldsModal=new Magellan.Views.ConfirmationModal({header:"Missing Fields",message:"Ensure that all your fields are populated.",primaryButtonText:"Ok",hideSecondaryButton:!0}),this.missingFieldsModal.open();else{var e=Magellan.Services.Matching.syncTaggingFields(),t=this;e.then(function(e,i){if(console.log(e),"PROCESSING"==e)new Magellan.Views.ConfirmationModal({header:"Success",message:"Your ABN sync process is in progress. An email will be sent to you upon successful completion.",primaryButtonText:"Ok",hideSecondaryButton:!0}).open();else if("SUCCESS"==e){var n=new Magellan.Views.ConfirmationModal({header:"Success",message:"Your ABN sync process is in progress. An email will be sent to you upon successful completion.",hideSecondaryButton:!0,primaryButtonText:"Ok"});t.hideSyncButton(),t.syncNewRows(),n.open()}else this.errorModal=new Magellan.Views.ConfirmationModal({header:"ERROR!",message:j$("#errorModalText").text(decode(e))}),this.errorModal.open()});t=this;e.fail(function(e){console.log("Error syncTaggingFields. Error Message: "+e)})}},validateForms:function(){var e=!1;return _.each(this.tableRows,function(t){t.accountDropdown.validate()&&t.leadDropdown.validate()||!t.includeInSave||(e=!0)}),e},checkChangesMade:function(){return!(!this.rowsDeleted&&!this.checkNewRowCreated())},checkNewRowCreated:function(){var e=!1;return _.each(this.tableRows,function(t){t.includeInSave&&(e=!0)}),e},checkUnsyncedRows:function(){var e=!1;return _.each(this.tableRows,function(t){t.includeInSave&&0==t.synced&&(e=!0)}),e},saveNewRows:function(){_.each(this.tableRows,function(e){e.saved=!0})},syncNewRows:function(){_.each(this.tableRows,function(e){e.synced=!0})},flatten:function(e){var t=e.replace("__c","__r");return t==e&&(t=t.replace("id","")),t},removeIDFromLabel:function(e){return e.replace(" ID","")}})}},function(e,t,i){e.exports=function(){var e=i(327),t=i(328);return Backbone.View.extend({template:_.template(e),objectLimitSettingsTemplate:_.template(t),tagName:"div",id:"match-settings-container",initialize:function(e){},events:{"click .domain-matching-switch":function(e){var t=_.clone(this.model.get("domainMatching"));$(e.target).hasClass("button-on")?t.alwaysON=!0:t.alwaysON=t.fallbackON=!1,this.model.set({domainMatching:t})},"change .domain-matching-option":function(e){var t=$(e.target).val(),i=_.clone(this.model.get("domainMatching"));i[t]=!0,"alwaysON"===t?i.fallbackON=!i[t]:i.alwaysON=!i[t],this.model.set({domainMatching:i})},"click .pmu-continuous-switch":function(e){var t=_.clone(this.model.get("preserveManualUpdates"));t.preserveManualTaggingInCc=$(e.target).hasClass("button-on"),this.model.set({preserveManualUpdates:t})},"click .pmu-1x-switch":function(e){var t=_.clone(this.model.get("preserveManualUpdates"));t.preserveManualTaggingIn1x=$(e.target).hasClass("button-on"),this.model.set({preserveManualUpdates:t})},"change .limit-number-input":function(e){var t=$(e.target).data("object-type"),i=_.clone(this.model.get("matchLimitSettings")),n=parseInt($(e.target).val());NaN!==n&&(i[t].limit=n,i.__lastModified__=Date.now(),this.model.set("matchLimitSettings",i))}},render:function(){var e=this.template({});return this.$el.html(e),this},setModel:function(e){return this.model=e,this.listenTo(this.model,"change:domainMatching",this.saveDomainMatching),this._applyDomainMatching(),this.listenTo(this.model,"change:preserveManualUpdates",this.savePMU),this._applyPMU(),this.listenTo(this.model,"change:matchLimitSettings",this.saveMatchLimitSettings),this._applyMatchLimitSettings(),this},saveDomainMatching:function(){this._toast("Saving..."),this.model.saveDomainMatching().then(function(){this._toast("Saved")}.bind(this)).fail(function(e,t){createErrorModal("Failed to save Domain Matching settings",t.message).open(),this.model.resync("domainMatching"),this._applyDomainMatching()}.bind(this)),this._applyDomainMatching()},savePMU:function(){this._toast("Saving..."),this.model.savePMU().then(function(){this._toast("Saved")}.bind(this)).fail(function(e,t){createErrorModal("Failed to save Preserve Manual Updates",t.message).open(),this.model.resync("preserveManualUpdates"),this._applyPMU()}.bind(this)),this._applyPMU()},saveMatchLimitSettings:function(){this._toast("Saving...."),this.model.saveMatchLimitSettings().then(function(){this._toast("Saved")}.bind(this)).fail(function(e,t){createErrorModal("Failed to save Routing Match Limits Settings",t.message).open()}.bind(this))},_applyDomainMatching:function(){var e=this.model.get("domainMatching"),t=e.alwaysON||e.fallbackON;$("#domain-matching-section").find(".domain-matching-switch.active").removeClass("active");var i=t?".button-on":".button-off";$("#domain-matching-section").find(".domain-matching-switch"+i).toggleClass("active",!0),t?$("#domain-matching-section").find(".setting-options").slideDown():$("#domain-matching-section").find(".setting-options").slideUp(),$("#domain-matching-section").find("#alwaysON").prop("checked",e.alwaysON),$("#domain-matching-section").find("#fallbackON").prop("checked",e.fallbackON)},_applyPMU:function(){var e=this.model.get("preserveManualUpdates");$("#preserve-manual-updates-section").find(".pmu-continuous-switch.active").removeClass("active");var t=e.preserveManualTaggingInCc?".button-on":".button-off";$("#preserve-manual-updates-section").find(".pmu-continuous-switch"+t).toggleClass("active",!0),$("#preserve-manual-updates-section").find(".pmu-1x-switch.active").removeClass("active");var i=e.preserveManualTaggingIn1x?".button-on":".button-off";$("#preserve-manual-updates-section").find(".pmu-1x-switch"+i).toggleClass("active",!0)},setMatchLimitField:function(e,t){var i=this.model.get("matchLimitSettings");if(i[e]["order by fields"]=[t],t.direction){var n=_.clone(i);n.__lastModified__=Date.now(),this.model.set("matchLimitSettings",n)}else this._applyMatchLimitSettings()},setMatchLimitFieldSortDirection:function(e,t){var i=this.model.get("matchLimitSettings"),n=_.clone(i);e.direction=t,n.__lastModified__=Date.now(),this.model.set("matchLimitSettings",n)},_applyMatchLimitSettings:function(){var e=this.model.get("matchLimitSettings"),t=[];_.each(e,function(e,i){if(0!==i.indexOf("__")){var n=i,a=$(this.objectLimitSettingsTemplate({objectType:n,settings:e,pluralize:Magellan.Util.getPluralObjectName})),o=e["order by fields"];_.each(o,function(e){var t=$('<div><span class="sort-field"></span><span class="sort-direction"></span></div>'),i=function createFieldSelectorDropdown(e,t,i){return new Magellan.Views.LDDropdown({value:t,required:!0,options:e,optionTemplate:function(e){return _.template('<span class="field-name"><%=field.label%></span>')({field:e})},onChange:i||_.noop})}(this.model.getSelectableFields(n),e,this.setMatchLimitField.bind(this,n)),o=function createFieldSortDirectionDropdown(e,t){return new Magellan.Views.LDDropdown({value:e||null,options:["asc","desc"],required:!0,placeholder:"Select one",optionTemplate:function(e){return e?_.template('<span class="field-direction"><%=(direction === "asc" ? "Oldest" : "Most Recent")%></span>')({direction:e}):'<span class="field-direction-placeholder">Select One</span>'},onChange:t})}(e.direction,this.setMatchLimitFieldSortDirection.bind(this,e));t.find(".sort-field").html(i.$el),t.find(".sort-direction").html(o.$el),a.find(".sort-fields").append(t)},this),t.push(a)}},this),$("#matched-objects-limit-section .match-settings-content").html(t)},_toast:function(e){$("#match-settings-container .toast").is(":hidden")||$("#match-settings-container .toast").hide(),$("#match-settings-container .toast").text(e).slideDown(),setTimeout(function(){$("#match-settings-container .toast").slideUp()},2e3)}});function createErrorModal(e,t){return new Magellan.Views.ConfirmationModal({header:"Error: "+(e||""),message:t,primaryButtonText:"Dismiss",hideSecondaryButton:!0})}}},function(e,t){e.exports=function(){var e,t={},i=function(t,i){return _.map(i,function(i){return _.cloneDeep(e[t][i])})},n=function(){return{alwaysON:!0===dashboardController.viewObject.statuses.alwaysON||!1,fallbackON:!0===dashboardController.viewObject.statuses.fallbackON||!1}},a=function(){return{preserveManualTaggingInCc:dashboardController.viewObject.statuses.preserveManualTaggingInCc||!1,preserveManualTaggingIn1x:dashboardController.viewObject.statuses.preserveManualTaggingIn1x||!1}};return Backbone.Model.extend({initialize:function(){},getSelectableFields:function(e){return t[e]},fetch:function(){var o;this.set("domainMatching",n()),this.set("preserveManualUpdates",a());var l=Magellan.Services.FlowBuilder.getMatchedObjectsLimitSettings().then(function(e){o=e}),s=Magellan.Controllers.FlowBuilder.getMetaData(),r=$.when(l,s);return r.then(function(){e||(e||(e=Magellan.Controllers.FlowBuilder.getFieldMetaDataMap()),t.Lead||(t.Lead=i("Lead",["createddate","lastmodifieddate","lastactivitydate"])),t.Contact||(t.Contact=i("Contact",["createddate","lastmodifieddate","lastactivitydate"])),t.Account||(t.Account=i("Account",["createddate","lastmodifieddate","lastactivitydate"])),t.Opportunity||(t.Opportunity=i("Opportunity",["createddate","lastmodifieddate","lastactivitydate"])));var n={};_.each(o,function(e,i){var a=[];_.each(e["order by fields"],function(e){var n=function(e,i){return _.find(t[e],{name:i})}(i,e.name);n.direction=e.direction,a.push(n)}),n[i]={"order by fields":a,limit:e.limit}}),n.__lastModified__=Date.now(),this.set("matchLimitSettings",n)}.bind(this)),r},resync:function(e){var t;switch(e){case"domainMatching":t=n();break;case"preserveManualUpdates":t=a();break;case"matchLimitSettings":break;default:return void _.each(this.attributes,function(e,t){this.resync(t)},this)}_.assign(this.get(e),t)},saveDomainMatching:function(){var e=this.get("domainMatching"),t={"always domain only matching":e.alwaysON?"1":"0","domain only matching as fallback":e.fallbackON?"1":"0"},i=Magellan.Services.FlowBuilder.setCustomSettings(JSON.stringify(t));return i.then(function(){dashboardController.viewObject.statuses.alwaysON=e.alwaysON,dashboardController.viewObject.statuses.fallbackON=e.fallbackON}),i},savePMU:function(){var e=this.get("preserveManualUpdates"),t={"preserve manual tagging in cc":e.preserveManualTaggingInCc?"1":"0","preserve manual tagging in 1x":e.preserveManualTaggingIn1x?"1":"0"},i=Magellan.Services.FlowBuilder.setCustomSettings(JSON.stringify(t));return i.then(function(){dashboardController.viewObject.statuses.preserveManualTaggingInCc=e.preserveManualTaggingInCc,dashboardController.viewObject.statuses.preserveManualTaggingIn1x=e.preserveManualTaggingIn1x}),i},saveMatchLimitSettings:function(){var e=this.get("matchLimitSettings"),t=[];return _.each(e,function(e,i){if(0!==i.indexOf("__")){var n=JSON.stringify(e),a=Magellan.Services.FlowBuilder.setMatchedObjectsLimitSettings(i,n);t.push(a)}}),$.when.apply(null,t)}})}},function(e,t,i){e.exports=function(){var e=i(329).replace(/#RESOURCEURL#/g,resourceURL);return Magellan.Views.SegmentsEdgeMenu=Magellan.Views.EdgeSelectionMenu.extend({initialize:function(e){this.tiebreakerSets=e.tiebreakerSets,this.leadSegments=e.leadSegments,Magellan.Views.EdgeSelectionMenu.prototype.initialize.apply(this,arguments)},template:_.template(e),addRule:function(e){var t=$(e.currentTarget).data("rule-type"),i=Magellan.Migration.emptyEdge(this.model,t);this.model.splice(this.model.length-1,0,i),this.$el.trigger("LD_TaggingSettings_LeadSegment:added",i),this.render(),this.$(".criteria-list-item:not(.criteria-type-default) .edit-icon-div").last().trigger("click")},deleteRule:function(e){var t=$(e.currentTarget).data("criteria-number"),i=this.model[t];Magellan.Views.EdgeSelectionMenu.prototype.deleteRule.apply(this,arguments),this.$el.trigger("LD_TaggingSettings_LeadSegment:deleted",i)},initTiebreakerEdit:function(){var e='<img src="'+resourceURL+'/images/Edit_Icon_Unselected_50x50.png" class="edit-tiebreaker-icon" />';this.$(".criteria-list-item").each(function(){$(this).find(".edit-tiebreaker-set").prepend(e)})},initTiebreakerMatchingTaggingDisable:function(){_.each(this.leadSegments,function(e,t){e.disabled||this.$('.criteria-list-item[data-criteria-number="'+t+'"] .matching-tagging-disabled').toggleClass("hidden")},this)},render:function(){return Magellan.Views.EdgeSelectionMenu.prototype.render.apply(this,arguments),this.initTiebreakerEdit(),this.initTiebreakerMatchingTaggingDisable(),this}})}},function(e,t,i){e.exports=function(){var e=i(330),t=function(e,t){var i=t||{};return e?(_.each(e,function(t,n){if(!i.hasOwnProperty(n)){var a=new Magellan.Views.TiebreakerSetEditor({model:e[n]});a.validateName=function(t){var i=Magellan.Views.TiebreakerSetEditor.prototype.validateName.apply(a,arguments),n=t.toLowerCase().trim(),o=this.original.name.toLowerCase().trim();return _.find(Object.keys(e),function(e){return e.toLowerCase().trim()!==o&&e.toLowerCase().trim()===n},this)&&i.push("Tiebreaker Set's name already exists."),i},i[n]=a}}),i):i},n=function(e,t){for(var i=1,n=(t=t||"")+i,a=e.hasOwnProperty(n);a;)n=t+ ++i,a=e.hasOwnProperty(n);return n};return Magellan.Views.TaggingSettings=Magellan.Views.ButtonHandler.extend({className:"tagging-settings-container",tiebreakerSetEditors:null,secondaryObjectType:"Account",primaryObjectType:"Lead",initialize:function(){this.childViews=[],this.originalSettings=JSON.stringify(this.model),this.modelForFilter=JSON.parse(this.originalSettings),this.upsellClickHandler=function(e){$(e.target).hasClass("upsell-button")||$(".upsell-container").remove()}},discardChanges:function(){this.model=JSON.parse(this.originalSettings),this.render()},cancel:function(e){this.modelDirty()&&($("#dirty-button-2").off("click"),$("#dirty-button-2").on("click",this.discardChanges.bind(this)),$("#dirty-modal").modal("show"))},ok:function(e){this.model.filter=this.modelForFilter.filter,this.model["filter type"]=this.modelForFilter["filter type"],this.model.hasOwnProperty("enabled continuous tagging")&&delete this.model["enabled continuous tagging"];var t=JSON.stringify(this.model);(function(e){Magellan.Services.FlowBuilder.saveTaggingSettings(e).then(function(){this.originalSettings=e,this.renderSingleTiebreakerSetMode(),$("#save-tagging-settings-modal").modal("show")}.bind(this)).fail(function(e,t){alert("Failed to save. An error has occurred.\n\n"+t.message)}.bind(this))}).call(this,t)},restoreDefaults:function(e){e.preventDefault(),this.model.enableMultiTiebreakerSets?this.restoreDefaultLeadSegments():this.restoreDefaultTiebreakers()},restoreDefaultTiebreakers:function(){this.model.tiebreakers=Magellan.Migration.createDefaultTiebreakers(),this.renderSingleTiebreakerSetMode()},restoreDefaultLeadSegments:function(){this.model.leadSegments=_.cloneDeep(Magellan.Migration.defaultTaggingSettings.leadSegments),this.model.tiebreakerSets=_.cloneDeep(Magellan.Migration.defaultTaggingSettings.tiebreakerSets),_.each(this.model.leadSegments,function(e){if(!e.tiebreakerSetKey&&"default"!==e.type){var t=e.name.replace("Lead Segment","Tiebreaker Set"),i=Magellan.Migration.createDefaultTiebreakerSet();i.name=t,this.model.tiebreakerSets[t]=i,e.tiebreakerSetKey=t}},this),this.tiebreakerSetEditors=t(this.model.tiebreakerSets),this.renderMultiTiebreakerLeadSegments()},toggleTaggingSettings:function(e){var t=this.model["enabled continuous tagging"],i=$(e.target).is(".tagging-switch-button-on");if(t!==i){var n="Turn Tagging "+(t?"OFF":"ON")+"?",a="Confirm that you would like to "+(t?"DISABLE":"ENABLE")+" continuous LeanData lead-to-account tagging.";new Magellan.Views.ConfirmationModal({header:n,message:a,footer:"",onConfirmed:this.saveContinuousTaggingSetting.bind(this,i)}).open()}},refreshTaggingSwitchToggle:function(e){null!=window.taggingResources&&(this.model["enabled continuous tagging"]=window.taggingResources["enabled continuous tagging"]=e),this.$(".tagging-switch .toggle-group-button.active").removeClass("active"),e?this.$(".tagging-switch-button-on").toggleClass("active",!0):this.$(".tagging-switch-button-off").toggleClass("active",!0)},toggleMultiTiebreakerSetsMode:function(e){var t=this.model.enableMultiTiebreakerSets,i=$(e.target).is(".toggle-multiple");if(t!==i){var n="Turn "+(t?"OFF":"ON")+" Multiple Tiebreaker Sets Mode?",a="Confirm that you would like to "+(t?"DISABLE":"ENABLE")+" Multiple Tiebreaker Sets Mode.";new Magellan.Views.ConfirmationModal({header:n,message:a,footer:"",onConfirmed:this.setMultiTiebreakerMode.bind(this,i)}).open()}},setMultiTiebreakerMode:function(e){this.model.enableMultiTiebreakerSets=window.taggingResources.enableMultiTiebreakerSets=e,this.model.enableMultiTiebreakerSets&&(!1===_.isArray(this.model.leadSegments)&&this.restoreDefaultLeadSegments(),this.tiebreakerSetEditors=t(this.model.tiebreakerSets)),this.$(".tagging-multi-tiebreaker-toggle .toggle-group-button.active").removeClass("active"),e?this.$(".tagging-multi-tiebreaker-toggle .toggle-multiple").toggleClass("active",!0):this.$(".tagging-multi-tiebreaker-toggle .toggle-single").toggleClass("active",!0),this.$(".tagging-settings-content-wrapper.fadeIn").removeClass("fadeIn"),this.$el.toggleClass("in-multi-tiebreakers-mode",e),this.$(".tagging-settings-content-wrapper:visible").toggleClass("fadeIn",!0)},saveContinuousTaggingSetting:function(e){var t=e?1:0;Magellan.Services.FlowBuilder.saveTaggingSettingsSwitch(t).then(this.refreshTaggingSwitchToggle.bind(this,e)).fail(function(e,t){alert("Failed to save setting. Error: "+t.message)})},deleteLeadSegment:function(e,t){if(t.tiebreakerSetKey&&this.model.tiebreakerSets.hasOwnProperty(t.tiebreakerSetKey)){var i=t.tiebreakerSetKey;delete this.model.tiebreakerSets[i],this.tiebreakerSetEditors[i].remove(),delete this.tiebreakerSetEditors[i]}},addLeadSegment:function(e,i){var a=Magellan.Migration.createDefaultTiebreakerSet(),o=_.indexBy(this.model.leadSegments,"name"),l=n(o,"Lead Segment ");i.name=l;var s=i.name.replace("Lead Segment ","Tiebreaker Set ");this.model.tiebreakerSets.hasOwnProperty(s)&&(s=n(this.model.tiebreakerSets,"Tiebreaker Set ")),a.name=s,i.tiebreakerSetKey=s,this.model.tiebreakerSets[s]=a,t(this.model.tiebreakerSets,this.tiebreakerSetEditors)},editTiebreakerSet:function(e){var t=this.$(e.currentTarget).closest(".criteria-list-item").toggleClass("active",!0),i=t.data("criteria-number"),n=this.model.leadSegments[i],a=n.tiebreakerSetKey,o=this.tiebreakerSetEditors[a];o.leadSegment=n,this.renderTiebreakerSetEditorPanel(o),this.showTiebreakerSetEditor(),t.find(".conditions-edit-partial-wrapper").is(":empty")||t.find(".edit-icon-div").trigger("click")},showTiebreakerSetEditor:function(){this.$("#multi-tiebreaker-lead-segments .criteria-list-item:not(.active)").toggleClass("disabled",!0),this.$("#tagging-tiebreaker-set-editor-panel").show("slide",{direction:"left"},400),this.$(".tagging-multi-tiebreakers-wrapper").toggleClass("editing-tiebreakers",!0)},hideTiebreakerSetEditor:function(){this.$("#multi-tiebreaker-lead-segments .criteria-list-item").removeClass("active disabled"),this.$("#tagging-tiebreaker-set-editor-panel").hide("slide",{direction:"left"},400),this.$(".tagging-multi-tiebreakers-wrapper").toggleClass("editing-tiebreakers",!1)},renameTiebreakerSet:function(e,t){this.model.tiebreakerSets.hasOwnProperty(e)&&(this.model.tiebreakerSets[e].name=t),this.model.tiebreakerSets[t]=this.model.tiebreakerSets[e],this.tiebreakerSetEditors[t]=this.tiebreakerSetEditors[e],_.each(this.model.leadSegments,function(i,n){if(i.tiebreakerSetKey===e)return i.tiebreakerSetKey=t,this.$('.criteria-list-item[data-criteria-number="'+n+'"] .tiebreaker-set-name').text(t),!1},this),delete this.model.tiebreakerSets[e],delete this.tiebreakerSetEditors[e]},validateTiebreakerSet:function(e){var t=[];["inclusion","exclusion"].includes(e["filter type"])&&(e.filter["filter type"]=e["filter type"],0==Magellan.Validation.validateFilterRules(e.filter,this.secondaryObjectType,this.primaryObjectType)&&t.push("Invalid Filter Rules"));return Magellan.Validation.validateTiebreakers(e.tiebreakers,this.secondaryObjectType,this.primaryObjectType)||t.push("Invalid tiebreakers configuration."),t},updateTiebreakerSet:function(e,t,i){i.name!==t.name&&this.renameTiebreakerSet(t.name,i.name),_.assign(t,i),this.toggleTiebreakerSetMatchingTaggingDisabledSign(i);var n=_.isEmpty(this.validateTiebreakerSet(t));this.toggleTiebreakerSetValidationWarningSign(n),this.hideTiebreakerSetEditor()},toggleTiebreakerSetMatchingTaggingDisabledSign:function(e){_.each(this.model.leadSegments,function(t,i){if(t.tiebreakerSetKey===e.name)return t.disabled?this.$('.criteria-list-item[data-criteria-number="'+i+'"] .matching-tagging-disabled').removeClass("hidden"):this.$('.criteria-list-item[data-criteria-number="'+i+'"] .matching-tagging-disabled').addClass("hidden"),!1},this)},toggleTiebreakerSetValidationWarningSign:function(e){this.$("#multi-tiebreaker-lead-segments .criteria-list-item.active .edit-tiebreaker-set-column .warning-sign").toggleClass("hidden",e)},additionalEvents:{"click .ld-tertiary-large-button.main-btn.cancel":"cancel","click .ld-primary-large-button.main-btn.ok":"ok","click .ld-tertiary-large-button.single-tiebreaker-set.restore-defaults":"restoreDefaults","click .tagging-switch-button-on, .tagging-switch-button-off":"toggleTaggingSettings","click .toggle-multiple, .toggle-single":"toggleMultiTiebreakerSetsMode","LD_TaggingSettings_LeadSegment:added":"addLeadSegment","LD_TaggingSettings_LeadSegment:deleted":"deleteLeadSegment","click .edit-tiebreaker-set":"editTiebreakerSet","click .tiebreaker-set-editor-btn.cancel":"hideTiebreakerSetEditor","LD_TaggingSettings_TiebreakerSet:change":"updateTiebreakerSet"},modelDirty:function(){return this.originalSettings!==JSON.stringify(this.model)},template:_.template(e),render:function(){this.removeAllChildViews();var e=this.template({enableMultiTiebreakers:this.model.enableMultiTiebreakerSets||dashboardController.viewObject.featureProvisioning[dashboardController.MULTI_TIEBREAKERS_ON]});return this.$el.html(e),this.refreshTaggingSwitchToggle(this.model["enabled continuous tagging"]),this.setMultiTiebreakerMode(this.model.enableMultiTiebreakerSets||!1),this.renderMultiTiebreakerLeadSegments(),this.renderSingleTiebreakerSetMode(),this.$(".tagging-multi-tiebreakers-wrapper, .tagging-default-tiebreakers-wrapper").toggleClass("animation",!0),$(".tagging-settings-container").click(function(e){$(".upsell-container").remove()}),this},renderSingleTiebreakerSetMode:function(){var e=new Magellan.Views.EdgeSelectionMenu({model:this.model.tiebreakers,objectType:"L2A"});this.childViews.push(e),this.$el.find("#single-set-tiebreakers").html(e.render().$el);var t=new Magellan.Views.FilterRules({model:this.modelForFilter,objectType:"L2A",hideNumber:!0});return this.childViews.push(t),this.$el.find("#account-filter-wrapper").html(t.render().$el),this},renderMultiTiebreakerLeadSegments:function(){var e=new Magellan.Views.SegmentsEdgeMenu({model:this.model.leadSegments,objectType:"Primary",tiebreakerSets:this.model.tiebreakerSets,leadSegments:this.model.leadSegments});return this.childViews.push(e),this.$("#multi-tiebreaker-lead-segments").html(e.render().$el),_.each(this.model.leadSegments,function(e,t){this.$("#multi-tiebreaker-lead-segments .criteria-list-item").eq(t).find(".edit-tiebreaker-set-column .warning-sign").toggleClass("hidden",function(e){var t=this.model.tiebreakerSets[e.tiebreakerSetKey];if(_.isEmpty(t))return!1;var i=this.validateTiebreakerSet(t);return _.isEmpty(i)}.call(this,e))},this),this},renderTiebreakerSetEditorPanel:function(e){this.$("#tagging-tiebreaker-set-editor-panel").empty().html(e.delegateEvents().render().$el)}})}},function(e,t,i){e.exports=function(){var e=i(331);return Magellan.Views.TiebreakerSetEditor=Magellan.Views.ButtonHandler.extend({tagName:"div",template:_.template(e),_vwFilterRules:null,_vwTiebreakersMenu:null,initialize:function(){this.childViews=[],this.original=this.model,this.model=_.cloneDeep(this.model),this.previousUserChoice="",this.model["filter type"]=this.model["filter type"]||"none",this._vwFilterRules=new Magellan.Views.FilterRules({model:this.model,objectType:"L2A",hideNumber:!0}),this._vwTiebreakersMenu=new Magellan.Views.EdgeSelectionMenu({model:this.model.tiebreakers,objectType:"L2A"})},remove:function(){this._vwFilterRules.remove(),this._vwTiebreakersMenu.remove(),this.removeAllChildViews(),Backbone.View.prototype.remove.apply(this,arguments)},cancel:function(e){this.model=_.cloneDeep(this.original)},ok:function(e){this.$el.trigger("LD_TaggingSettings_TiebreakerSet:change",[this.original,this.model])},restoreDefaults:function(e){this.model.tiebreakers=Magellan.Migration.createDefaultTiebreakers(),this._renderTiebreakersMenu()},validateName:function(e){var t=[];return e||t.push("Tiebreaker Set's name cannot be empty."),t},_renderTiebreakersMenu:function(){this._vwTiebreakersMenu.model=this.model.tiebreakers,this._vwTiebreakersMenu.delegateEvents(),this.$(".ld-panel-body .criteria-list-partial").html(this._vwTiebreakersMenu.render().$el)},changeName:function(e){var t;e instanceof $.Event?t=$(e.target).val():"string"==typeof e&&(t=e),t=(t||"").trim();var i=this.validateName(t),n=_.isEmpty(i);this.$('[name="tiebreaker-set-name"]').toggleClass("input-invalid",!n),n?this.$(".tiebreaker-set-name-error").text(""):this.$(".tiebreaker-set-name-error").text(i.join("; ")),n&&(this.model.name=t)},toggleMatchingTagging:function(e){var t=!this.leadSegment.disabled,i=$(e.target).is(".matching-tagging-switch-button-on");if(t!==i){var n="Turn Matching/Tagging "+(t?"OFF":"ON")+"?",a="Confirm that you would like to "+(t?"DISABLE":"ENABLE")+" matching/tagging for this lead segment.";new Magellan.Views.ConfirmationModal({header:n,message:a,footer:"",onConfirmed:this.setMatchingTaggingSetting.bind(this,i)}).open()}},setMatchingTaggingSetting:function(e){this.leadSegment.disabled=!e,this.refreshMatchingTaggingSetting(e),this.$(".criteria-list-partial").toggleClass("disableContainer"),this.$("#enable-account-filtering-container").toggleClass("disableContainer"),this.$(".account-filtering-wrapper").toggleClass("disableContainer")},refreshMatchingTaggingSetting:function(e){this.$(".disable-matching-tagging-toggle .toggle-group-button.active").removeClass("active"),e?(this.$(".disable-matching-tagging-toggle .matching-tagging-switch-button-on").toggleClass("active",!0),"include"===this.previousUserChoice?this.$("#filter-radio-include").click():"exclude"===this.previousUserChoice?this.$("#filter-radio-exclude").click():"none"===this.previousUserChoice&&this.$("#filter-radio-none").click()):(this.$("#filter-radio-include").attr("checked")?this.previousUserChoice="include":this.$("#filter-radio-exclude").attr("checked")?this.previousUserChoice="exclude":this.$("#filter-radio-none").attr("checked")&&(this.previousUserChoice="none"),this.$("#filter-radio-none").click(),this.$(".disable-matching-tagging-toggle .matching-tagging-switch-button-off").toggleClass("active",!0))},events:{"click .tiebreaker-set-editor-btn.cancel":"cancel","click .tiebreaker-set-editor-btn.ok":"ok","click .tiebreaker-set-editor-btn.restore-defaults":"restoreDefaults",'change [name="tiebreaker-set-name"]':"changeName","click .matching-tagging-switch-button-off, .matching-tagging-switch-button-on":"toggleMatchingTagging"},render:function(){this.removeAllChildViews(),this.$el.html("");var e=this.template({model:this.model,leadSegment:this.leadSegment});return this.$el.html(e),this._renderTiebreakersMenu(),this.leadSegment.disabled&&(this._vwFilterRules.model=this.model,this.$(".advanced-settings-view").toggleClass("open",!0)),this.refreshMatchingTaggingSetting(!this.leadSegment.disabled),this.renderFiltering(),this},renderFiltering:function(){this._vwFilterRules.delegateEvents(),this._vwFilterRules.model=this.model,this.$(".filter-div").html(this._vwFilterRules.render().$el),this.$("#customized-header").text("Filter Matched Accounts (requires Matching/Tagging)")}})}},function(e,t){e.exports="<div class=breadCrumbContainer> <span class=\"ld-breadcrumb static\" id=runSummaryLink>Attribution Runs</span> <div class=crumbArrow> &gt; </div> <span class=\"ld-breadcrumb disabled\">Batch Errors</span> </div> <div class=ld-header> Batch Errors </div> <div> <div class=ld-dropdown-large id=batchErrorDropdown></div> </div> <div class=ld-section-container id=runInfoSectionDiv> <table> <tbody> <tr> <td class=ld-field-label-large>Run Type</td> <td class=ld-body-large><%=log.Run_Type__c || ''%></td> </tr> <tr> <td class=ld-field-label-large>Started</td> <td class=ld-body-large><%=log.Run_Start__c %></td> </tr> <tr> <td class=ld-field-label-large>Ended</td> <td class=ld-body-large><%=log.Run_End__c || 'IN PROGRESS' %></td> </tr> <tr> <td class=ld-field-label-large>Run By</td> <td class=ld-body-large><%=log.User__r.Name %></td> </tr> </tbody> </table> </div> <div class=ld-section-header id=errorViewTableHeader> <%= numErrors %> Errors </div> <div class=ld-table> <table id=errorViewTable style=border-bottom:unset!important> </table> </div> "},function(e,t){e.exports="<tr class=summarySubrow data-index=\"<%=summaryIndex%>\"> <td></td> <td><%=batch['batchName']%></td> <td><%=batch['start time string']%></td> <td><%=batch['end time string']%></td> <td><%= (batch['runtime'] ? Magellan.Util.convertSecondsToHoursMinutes(batch['runtime']) : '-') %></td> <td class=\"<%=(hasFailures ? 'hasFailures' : '')%>\"><%=(batch['num failures'] || 0)%> / <%=(batch['num records'] || 0)%></td> <td></td> <td></td> </tr> "},function(e,t){e.exports='<div id=runSummaryView> <div class=ld-header> Attribution Runs </div> <div id=oneTimeRunDiv class=ld-section-container> <div class=ld-section-header> One-time Run </div> <div class=ld-body-large> Kick off a one-time Attribution run. This will delete current Marketing Touch object contents and recalculate Attribution values based on current settings. </div> <div class=ld-primary-large-button id=oneTimeAttributionButton>Start One Time Run</div> <div class=cbDiv> <label class=cb-container-large> <span class="toggleText ld-field-label-large">Notify me when One-time Run is complete</span> <input type=checkbox id=emailNotificationCheckbox /> <span class=checkmark></span> </label> </div> <input type=text class=ld-input-large id=emailInput placeholder="Enter Email Addresses (mary@company.com,jim@co.org)" style=display:none> </div> <% if(model.oneBatchOn === 1) { %> <div id=batchTableHeader class=flexHeader> <span class=ld-section-header>Batch Runs</span> <div class="ld-dropdown-small flexDropdownRight" id=runTypeDropdown> </div> </div> <div class=ld-table> <table id=attributionRunSummaryTable></table> </div> <% } %> </div> <div id=runErrorView></div> '},function(e,t){e.exports='<% if(!model.viewSpecificSettingCategory) { %> <div class=breadCrumbContainer> <span class="ld-breadcrumb static" id=summaryViewLink>Attribution Change Logs</span> <div class=crumbArrow>&gt;</div> <span class="ld-breadcrumb disabled"><%= model.selectedLog.Settings_Page__c %></span> </div> <% } else { %> <div class=breadCrumbContainer> <span class="ld-breadcrumb static" id=summaryViewLink>Attribution Change Logs</span> <div class=crumbArrow>&gt;</div> <span class="ld-breadcrumb static" id=detailViewLink><%= model.selectedLog.Settings_Page__c %></span> <div class=crumbArrow>&gt;</div> <span class="ld-breadcrumb disabled"><%= _.escape(model.selectedComparisonObj.name) %></span> </div> <% } %> <div class=ld-header> <% if (!model.viewSpecificSettingCategory) { %> <%= model.selectedLog.Settings_Page__c %> <% } else { %> <%= _.escape(model.selectedComparisonObj.name) %> <% } %> </div> <div class=ld-subheader> <%= model.selectedLog.User__r.Name %> - <%= formatMomentDate((model.selectedLog.CreatedDate), dateFormat, true) %> </div> <% if (!model.viewSpecificSettingCategory) { %> <table id=comparisonTable> <tbody> <% _.each(model.settingsComparisonObjs, function(settingsComparisonObj, index) { %>  <% if (settingsComparisonObj.addedSettings.length === 0 && settingsComparisonObj.removedSettings.length === 0 && settingsComparisonObj.overlapSettings.length === 0) return; %> <tr class=settingsCategory> <td class=categoryLabelDiv> <div class=ld-body-large><%= _.escape(settingsComparisonObj.name) %></div> <div class="categoryLink ld-body-medium ld-link" index="<%=index%>"><%= _.escape(settingsComparisonObj.name) %> Settings</div> </td> <td class=comparedSetting> <div class=addedSettingHeader>Added</div> <% _.each(settingsComparisonObj.addedSettings, function(addedSetting, index) { %> <div class="addedSetting ld-table-data-large"><%= _.escape(addedSetting) %></div> <% }) %> </td> <td class=comparedSetting> <div class=removedSettingHeader>Removed</div> <% _.each(settingsComparisonObj.removedSettings, function(removedSetting, index) { %> <div class="removedSetting ld-table-data-large"><%= _.escape(removedSetting) %></div> <% }) %> </td> </tr> <% }) %> </tbody> </table> <% } else { %> <div> <div class=settingsListDiv> <div class=ld-th>Current Settings</div> <% _.each(model.selectedComparisonObj.addedSettings, function(addedSetting, index) { %> <div class="addedSetting ld-table-data-large"><%= _.escape(addedSetting) %></div> <% }) %> <% _.each(model.selectedComparisonObj.overlapSettings, function(setting, index) { %> <div class="overlapSetting ld-table-data-large"><%= _.escape(setting) %></div> <% }) %> </div> <div class=settingsListDiv> <div class=ld-th>Previous Settings</div> <% _.each(model.selectedComparisonObj.removedSettings, function(removedSetting, index) { %> <div class="removedSetting ld-table-data-large"><%= _.escape(removedSetting) %></div> <% }) %> <% _.each(model.selectedComparisonObj.overlapSettings, function(setting, index) { %> <div class="overlapSetting ld-table-data-large"><%= _.escape(setting) %></div> <% }) %> </div> </div> <% } %> '},function(e,t){e.exports="<div id=logSummaryView> <div class=ld-header>Settings Change Logs</div> <div class=ld-body-large> View Attribution settings and wizard preference changes over time. </div> <div id=settingsSummaryDropdownContainer> <div id=settingsPageDropdown class=ld-dropdown-small></div> </div> <div class=ld-table> <table id=settingsSummaryTable> </table> </div> </div> <div id=logDetailView> </div> "},function(e,t){e.exports='<div class="modal fade confirmation-modal"> <div class=modal-dialog style=width:fit-content> <div class=modal-content style=height:initial> <div class=dg_inner-wrapper-header style=display:flex;justify-content:center;align-items:center;margin-top:10px> <%=header%> </div> <div class=modal-content-section style="height:initial;padding:30px 20px"> <div class=modal-content-text style=height:initial><%=message%></div> <div class=modal-content-extra style=height:initial;padding-top:20px><%=footer%></div> </div> <div class=modal-button-section style=height:initial;padding-bottom:20px> <% if(!hideSecondaryButton) { %> <span class="ld-tertiary-large-button cancel-button" data-dismiss=modal><%=secondaryButtonText%></span> <% } %> <span class="ld-primary-large-button confirm-button" data-dismiss=modal><%=primaryButtonText%></span> </div> </div> </div> </div> '},function(e,t){e.exports='<div class="ld-data-card-wrapper ld-line-graph-legend"> <% _.each(model.cardInfo, function(card, index) { %> <div class="ld-data-card grey<%= index+1 %> data-card-<%= index+1 %>"> <span class=data-title><%= card.title %></span> <span class=data-value><%= card.value %></span> </div> <% }) %> <div class=line-graph-legend> <svg width=150 height=42> <% model.legendInfo.forEach(function(value, index) { %> <g class="<%=model.lineClasses[index]%>"> <text x=118 y="<%= 5 + 16 * index %>"><%= value %></text> <line class=line x1=130 y1="<%= 5 + 16 * index %>" x2=150 y2="<%= 5 + 16 * index %>"/> </g> <% }) %> </svg> </div> </div> '},function(e,t){e.exports='<div class=add-additional-recipient-row> <div class="additional-recipient-typeahead additional-recip-col1"></div> <div class="add-additional-recipient-button ld-secondary-small-button additional-recip-col2">Add Recipient</div> </div> <% _.each(additionalObjectsLabels, function(label, idx) { %> <div class=additional-recipient-row> <div class=additional-recip-col1><%= label %></div> <div class=additional-recip-col2 style=justify-content:flex-end> <div class="remove-additional-recipient-row ld-cross-icon-grey-large" data-index="<%= idx %>"></div> </div> </div> <% }) %> '},function(e,t){e.exports="<div class=ld-body-medium> <div class=email-recipients-header-row> <div class=ld-field-label-small>Email Recipients</div> <div class=\"ld-secondary-small-button <%= classes['edit-recipients-button'] %>\"><%= recipientCards.length > 0 ? 'Edit' : 'Add' %> Recipients</div> </div> <div class=\"<%= classes['email-recipients-wrapper'] %>\"> <% _.each(recipientCards, function(recipient) { %> <div class=recipient-card><%= recipient %></div> <% }) %> <div class=\"<%= classes['empty-recipients-message'] %>\">There are no email recipients.</div> </div> <div class=\"<%= classes['email-recipients-editor'] %>\"> <div class=\"recipient-editor-row <%= classes['next-owner-row'] %>\"> <label class=cb-container-small> <div>New Owner</div> <input type=checkbox name=next-owner-checkbox class=notif-owner-checkbox data-owner-type=notifyPostOwner <%= recipientData.notifyPostOwner ? 'checked' : '' %> /> <span class=checkmark></span> </label> </div> <div class=\"recipient-editor-row <%= classes['previous-owner-row'] %>\"> <label class=cb-container-small> <div>Previous Owner</div> <input type=checkbox name=previous-owner-checkbox class=notif-owner-checkbox data-owner-type=notifyPreOwner <%= recipientData.notifyPreOwner ? 'checked' : '' %> /> <span class=checkmark></span> </label> </div> <div class=\"recipient-editor-row new-object-owner-row <%= classes['new-object-owner-row'] %>\"> <label class=cb-container-small> <div>Created Object Owner</div> <input type=checkbox name=new-object-owner-checkbox class=notif-owner-checkbox data-owner-type=notifyNewObjectOwner <%= recipientData.notifyNewObjectOwner ? 'checked' : '' %> /> <span class=checkmark></span> </label> </div> <div class=recipient-editor-row> <label class=cb-container-small> <div>Email Addresses</div> <input type=checkbox name=emails-toggle class=\"subcontent-toggle emails-toggle\" <%= !_.isEmpty(recipientData.emails) ? 'checked' : '' %> /> <span class=checkmark></span> </label> <div class=\"recipient-editor-subcontent <%= !_.isEmpty(recipientData.emails) ? '' : 'hidden' %> \"> <textarea rows=2 class=\"ld-textarea-large emails-text-area\"><%= !_.isEmpty(recipientData.emails) ? recipientData.emails.join(', ') : '' %></textarea> </div> </div> <div class=\"recipient-editor-row <%= classes['matched-object-row'] %>\"> <label class=cb-container-small style=height:fit-content> <div style=display:flex;align-items:center> Matched Object <% if (matchedObjectTypes.length === 0) { %> <div class=\"ld-tooltip-hint matched-object-recipient-tooltip\"></div> <% } %> </div> <input type=checkbox name=matched-object-toggle class=\"subcontent-toggle matched-object-toggle\" <%= matchedObjectData.size > 0 ? 'checked' : '' %> <%= matchedObjectTypes.length > 0 ? '' : 'disabled' %> /> <span class=checkmark></span> </label> <div class=\"recipient-editor-subcontent <%= matchedObjectData.size > 0 ? '' : 'hidden' %>\"> <% _.each(matchedObjectTypes, function(sobjectType) { %> <div class=matched-object-row> <label class=cb-container-small> <div><%= sobjectType %></div> <input type=checkbox name=\"matched-<%=sobjectType%>-checkbox\" class=matched-object-checkbox <%= matchedObjectData.has(sobjectType) ? 'checked' : '' %> data-object-type=\"<%=sobjectType%>\"/> <span class=checkmark></span> </label> <div class=\"matched-object-dropdown matched-<%= sobjectType %>-dropdown\"></div> </div> <% }) %> </div> </div> <div class=\"recipient-editor-row <%= classes['additional-recipients-row'] %>\"> <label class=cb-container-small style=height:fit-content> <div style=display:flex;align-items:center> Additional Recipients </div> <input type=checkbox name=additional-recipients-toggle class=\"subcontent-toggle additional-recipients-toggle\" <%= hasAdditionalObjectData ? 'checked' : '' %> /> <span class=checkmark></span> </label> <div class=\"recipient-editor-subcontent additional-recipients-content <%= hasAdditionalObjectData ? '' : 'hidden' %>\"></div> </div> <div class=\"ld-secondary-small-button save-receipients-button\">Done</div> </div> <div class=\"error-message email-recipients-error-messages\"></div> </div>"},function(e,t){e.exports='<div class=ld-body-medium> <div class="ld-field-label-small email-template-header">Email Template</div> <div class=email-template-row> <div class=email-template-selector></div> <div class="ld-link view-email-template-link">View Template</div> </div> <div class="error-message hidden email-template-error-message"></div> </div>'},function(e,t){e.exports="<div class=error-banner-text> <span class=error-banner-primary-text><%= primaryText %></span> <span class=error-banner-secondary-text><%= secondaryText %></span> </div> <% if (!hideCloseButton) { %><div class=error-banner-close-btn></div><% } %>"},function(e,t){e.exports='<div class="dropdown graph-settings-menu"> <style>.graph-settings-menu:not(.open) .toggleButtonIcon.selected{display:none}.graph-settings-menu.open .toggleButtonIcon.selected,.graph-settings-menu:hover .toggleButtonIcon.selected{display:inherit}.graph-settings-menu.open .toggleButtonIcon.unselected,.graph-settings-menu:hover .toggleButtonIcon.unselected{display:none}.graph-settings-menu .dropdown-toggle{text-align:center}.graph-settings-menu .dropdown-menu{margin-left:5px;padding-left:10px;width:270px;border-radius:0}</style> <a class="graph-settings-menu-button dropdown-toggle" href="javascript: void(0);"> <img class="toggleButtonIcon unselected" src="<%=resourceURL%>/images/Header_Bar_Settings_Icon_unselected.png" title="Graph Settings" height=25px /> <img class="toggleButtonIcon selected" src="<%=resourceURL%>/images/Header_Bar_Settings_Icon_selected.png" title="Graph Settings" height=25px /> </a> <ul class="dropdown-menu graph-settings-menu-list" aria-labelledby=graph-settings-menu-button style=float:right;position:relative> <div id=export-png-button class=ld-secondary-small-button>Export Graph as Image (.png)</div> <hr class=horizontal-line-separator-small> <%_.each(checkboxItems, function(item) {%> <li class=dropdown-menu-item> <label class=cb-container-large> <span class=ld-field-label-large><%=item.label%></span> <input type=checkbox id="<%=item.name%>" name="<%=item.name%>" <%=item.value ? \'checked\' : \'\'%> class=checkboxSetting value="<%=item.value%>"/> <span class=checkmark></span> </label> </li> <%});%> </ul> </div> '},function(e,t){e.exports='<div class=ld-dropdown-toggle> <span class=ld-dropdown-value>Select One</span> </div> <ul class="dropdown-menu <%=menuAlignClass%>"> <li class=ld-dropdown-search-filter-container> <input type=text class=ld-dropdown-search-filter-input value="" placeholder=Search /> </li> </ul> '},function(e,t){e.exports='<input class=ld-input /> <span class=ld-input-label> <label class=label-text></label> <img class=edit-icon src="<%=editIconURL%>"/></span> <br/> <span class=ld-input-error></span>'},function(e,t){e.exports="<div class=multiselect-dropdown-toggle><span class=placeholder-text><%= selectAll ? allSelectedPlaceholder : placeholder %></span></div> <ul class=multiselect-dropdown-menu> <li class=multiselect-toggle-all-list-item> <div class=multiselect-dropdown-option> <label class=\"<%= checkboxClass %>\"> <span class=toggleText><%= selectAll ? 'Deselect All' : 'Select All' %></span> <input type=checkbox disabled=disabled /> <span class=checkmark></span> </label> </div> </li> </ul> "},function(e,t){e.exports='<li class=multiselect-dropdown-option-list-item> <div class=multiselect-dropdown-option> <label class="<%= checkboxClass %>"><%= label %> <input type=checkbox data-value="<%= value %>" data-label="<%= label %>" disabled=disabled /> <span class=checkmark></span> </label> </div> </li>'},function(e,t){e.exports='<div class=control-group> <label class="control control--radio"> <span><%= label %></span> <input type=radio class=default-radio-option name="<%= name %>" value="<%= value %>" <%= checked ? \'checked\' : \'\'%> /> <div class=control__indicator></div> </label> </div> '},function(e,t){e.exports="<div class=\"ld-selectable-list header <% _.isEmpty(header) ? 'hidden' : ''%>\"> <%=header%> </div> <ul class=ld-selectable-list style=height:250px;overflow:auto> <%_.each(model.get('data'), function(item, idx) {%> <li class=ld-selectable-list-item> <%=itemContentTemplate(item)%> </li> <%});%> </ul> <div class=\"ld-selectable-list footer\"> <span class=label-selected>Selected:&nbsp;&nbsp;</span> <span class=selected></span> <div class=\"error-message ld-text-danger\"></div> </div> "},function(e,t){e.exports="<table class=ld-table> <thead> <tr class=header-row> </tr> </thead> <tbody> </tbody> </table>"},function(e,t){e.exports="<div id=ld-tabs-container class=ld-tabs-div> <% _.each(model.tabNames, function(tabName) { %> <span class=\"ld-tab <%= model.selectedTab === tabName ? 'selected ' : '' %>\" data-tab-name=\"<%=tabName%>\"><%= tabName %></span> <% }) %> </div> "},function(e,t){e.exports="<div class=line-graph-info-container></div> "},function(e,t){e.exports='<span class=typeahead-input-container> <input class="typeahead typeahead-input" data-main-input=true type=text placeholder="<%=placeholder%>"> <span class=ld-caret></span> </span> '},function(e,t){e.exports='<div class=nts-selected-field> <span class="root nts-selected-node nts-parent-node"><%=root%></span> <span class=separator>&raquo;</span> <% _.each(selection, function(field) { %> <% if (hasChildren(field)) { %> <span <%="title=\'"+field.name+"\'"%> class="nts-selected-node nts-parent-node"><%=field.label.replace(\' ID\', \'\')%></span> <span class=separator>&raquo;</span> <% } else { %> <span <%="title=\'"+field.name+"\'"%> class="nts-selected-node nts-leaf-node"><%=field.label%></span> <% } %> <% }); %> </div>'},function(e,t){e.exports='<div class=multiselect-dropdown-option style=padding-bottom:5px;padding-top:5px> <label class=cb-container-small> <div style=font-size:10px><%= suggestion.label %></div> <% var check = false;\n    for (var i = 0; i < this.selection.length; i++){\n      if (suggestion.label === this.selection[i].label){\n        check = true; break;\n      }\n    }\n    if (check){ %> <input type=checkbox checked=checked name=multi-nestedtypeahead-checkbox class=multi-nestedtypeahead-checkbox label="<%= suggestion.label %>"/> <% } else {%> <input type=checkbox name=multi-nestedtypeahead-checkbox class=multi-nestedtypeahead-checkbox label="<%= suggestion.label %>"/> <% } %> <span class=checkmark></span> </label> </div> '},function(e,t){e.exports="<div class=mnts-selected-list> <% _.each(selection, function(field) { %> <%\n        var lastIndex = selection.length - 1;\n        var punct = type === 'PICKLIST' ? ', ' : '; ';\n        var label = (type === 'PICKLIST' && field.label.includes(',')) ? JSON.stringify(field.label) : field.label;\n        if (selection[0].label == field.label){ %> <span class=mnts-node><%=label%></span> <% } else { %> <span class=mnts-node><%=punct + label%></span> <% } %> <% }); %> </div> "},function(e,t){e.exports='<div class=header-font>Update <%=model.get(\'object\')%> Fields</div> <div style=font-size:11px>Specify <%=model.get(\'object\').toLowerCase()%> fields and values to update.</div> <div class="update-header row" style=margin-top:5px> <div class="update-field-column header-font col-xs-4">Field</div> <div class="update-value-column header-font col-xs-4">New Value</div> <div class="update-delete-column col-xs-2"></div> </div> <div class=sofu-field-updates-list> </div> <div class="add-rule-container row" style=margin-top:10px;clear:both> <div class="add-rule-row-item col-xs-12"> <div class=add-rule-div></div> <div class=header-font>Add field</div> <div class=empty-row-space></div> </div> </div>'},function(e,t){e.exports='<div class="update-row row"> <div class="update-field-column sofu-field-selector col-xs-4"> </div> <div class="update-value-column col-xs-4"> <input class="sofu-update-value width-fill ld-default-input" value="<%= update.get(\'value\') %>"/> <div class="sofu-ld-dropdown hidden"></div> <div class="sofu-ld-typeahead hidden"></div> </div> <div class="sofu-delete-column col-xs-2"></div> </div>'},function(e,t){e.exports=' <div class=tuple-condition data-rule-index="<%= idx %>"> <div class=tuple-condition-num><%= idx + 1 %></div> <div class=tuple-condition-field></div> <div class=tuple-condition-operator></div> <div class=tuple-condition-operand> <input class="tuple-condition-operand-input ld-input-small <%= _.isEmpty(this.condition.operand) ? \'input-invalid\' : \'\' %>"/> <div class=tuple-condition-operand-dropdown></div> </div> <% if (!hideToggleColumn) { %> <div class=tuple-condition-radio> <% var groupId = \'tuple-condition-radio-group-\' + idx %> <% var fieldOptionId = groupId + \'-field\' %> <% var valueOptionId = groupId + \'-value\' %> <fieldset id="<%= groupId %>" class=tuple-fieldset-radiogroup> <input type=radio value=field id="<%= fieldOptionId %>" name="<%= groupId %>"> <label for="<%= fieldOptionId %>">Field</label> <input type=radio value=value id="<%= valueOptionId %>" name="<%= groupId %>"> <label for="<%= valueOptionId %>">Value</label> </fieldset> </div> <% } %> <div class="<%= idx > 0 ? \'tuple-condition-delete\' : \'\' %>" style=width:12px></div> </div>'},function(e,t){e.exports='<div class=tuple-conditions-header-row> <div class=condition-num-column></div> <div class=condition-field-column><%= fieldObjectType %> Field</div> <div class=condition-operator-column>Operator</div> <div class=condition-operand-column></div> <div class=condition-radio-column></div> <div class=condition-delete-column></div> </div> <div class=tuple-conditions-body> <div class=tuple-conditions-row></div> <hr class=tuple-rule-separator> <div class="add-tuple-condition-btn ld-secondary-small-button">Add Condition</div> <div class=rule-logic-row> <div class=ld-field-label-small>Rule Logic</div> <input class="tuple-rule-logic-input ld-input-small <%= rpnLogicIsValid ? \'\' : \'input-invalid\' %>" value="<%= logic %>"/> <div class=reset-tuple-rule-logic>Reset</div> </div> <div class=rule-logic-error-row></div> </div>'},function(e,t){e.exports='<div class="waiting-message-wrapper text-center"></div> <div class=waiting-animation> <div class=sk-circle> <div class="sk-circle1 sk-child"></div> <div class="sk-circle2 sk-child"></div> <div class="sk-circle3 sk-child"></div> <div class="sk-circle4 sk-child"></div> <div class="sk-circle5 sk-child"></div> <div class="sk-circle6 sk-child"></div> <div class="sk-circle7 sk-child"></div> <div class="sk-circle8 sk-child"></div> <div class="sk-circle9 sk-child"></div> <div class="sk-circle10 sk-child"></div> <div class="sk-circle11 sk-child"></div> <div class="sk-circle12 sk-child"></div> </div> </div>'},function(e,t){e.exports='<div class=filter-div style=padding-bottom:15px></div> <div class=circle>2</div><div class="header-font has-object-label" style=display:inline-block>Prioritize Matched <%= pluralObjects %></div> <div style=margin-left:30px;margin-bottom:8px class=has-object-label> Identify the ultimate matched <span class=text-lowercase><%= singleObject %></span> to be selected in cases where LeanData finds multiple matched <span class=text-lowercase><%= pluralObjects %></span>. </div> <div id=criteria-list-partial class=criteria-list-partial></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div>'},function(e,t){e.exports='<div class=row> <div class="col col-xs-9 col-xs-offset-1"> <div class=account-owner-mapping-list-wrapper></div> </div> </div> <div class="alternate-field-assignment-container offset-inline"></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> '},function(e,t){e.exports='<div class=row> <div class="col col-xs-9 col-xs-offset-1"> <div class=account-team-rules-list-wrapper></div> </div> </div> <div class="alternate-field-assignment-container offset-inline"></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> '},function(e,t){e.exports='<div id=action-node-update-partial class=node-partial data-node-type=action-update data-form-title="Action – Update Account"> <div class="main-div so-field-updater-container"> </div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div>'},function(e,t){e.exports="<div id=account-custom-field> Select account's custom user field: </div> <div id=account-custom-field-dropdown> <div class=user-field-selector></div> </div> <hr class=horizontal-line-separator> <div class=alternate-field-assignment-container></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div>"},function(e,t){e.exports="<tr class=custom-field-row> <td class=lead-field-label>Lead Field</td> <td class=account-field-label>Account Field</td> <td class=delete-custom-row></td> </tr>"},function(e,t){e.exports="<% _.each(defaultFields, function(field) { %> <tr> <td class=default-row-col><%= field.leadField.label %></td> <td class=default-row-col><%= field.accountField.label %></td> <td></td> </tr> <% }); %>"},function(e,t){e.exports='<div class="ld-header-wrapper ld-header-wrapper-margins"> <div class="ld-header ld-header-bottom-margin">Advanced Settings</div> <div class="ld-subheader ld-header-bottom-margin">Account Creation</div> </div> <div class=dg_inner-wrapper-secondaryheader> Set preferences for New Account Creation router action. Change lead-to-account field mappings, add new fields, and remove existing fields. </div> <div class=dg_inner-wrapper-content> <div class=dg_details-table-div> <table> <thead> <tr> <th style=width:45%>Lead Field</th> <th style=width:45%>Account Field</th> <th style=width:10%>Delete</th> </tr> </thead> <tbody id=account-creation-fields> </tbody> </table> <div class=add-container> <span class=add-new-row>Create New</span> </div> </div> </div> <div class=dg_inner-wrapper-footer> <div class=buttons-container> <div id=save-mapping-button class="ld-primary-large-button ok requiresReadWrite">Save</div> </div> </div>'},function(e,t){e.exports='<div class="ld-header-wrapper ld-header-wrapper-margins"> <div class="ld-header ld-header-bottom-margin">Advanced Settings</div> <div class="ld-subheader ld-header-bottom-margin">Merge Duplicates</div> </div> <div class=dg_inner-wrapper-content style=border-top:none> <div class=dg_content-col-3> <div class=title-div>Settings</div> <div class=text-div>Overwrite values on merge</div> <div id=overwriteCondition class=dg_picklists-div style=width:80%></div> <div class=text-div>Always consider same email address as a duplicate?</div> <div id=isEmailMatchDupes class=dg_picklists-div style=width:35%></div> <div class=title-div>Merge Preferences</div> <div class=text-div>Email merge preference</div> <div id=emailMergePreference class=dg_picklists-div style=width:100%></div> </div> <div class=dg_content-col-3> <div class=header-div>Lead merged into existing Contact</div> <div class=text-div>Preference pick selection (rule to select which record to copy values from)</div> <div id=dedupePreferenceOperatorLC class=dg_picklists-div style=width:35%;margin-right:5px></div> <div id=dedupePreferenceFieldLC class=dg_picklists-div style=width:60%></div> </div> <div class=dg_content-col-3> <div class=header-div>Lead merged into existing Lead </div> <div class=text-div>Preference pick selection (rule to select which record to copy values from)</div> <div id=dedupePreferenceOperatorLL class=dg_picklists-div style=width:35%;margin-right:5px></div> <div id=dedupePreferenceFieldLL class=dg_picklists-div style=width:60%></div> </div> </div> <div class=dg_inner-wrapper-footer style=text-align:center> <div class="ld-primary-large-button sync-settings-button">Update Settings</div> </div>'},function(e,t){e.exports='<div class=filter-div style=padding-bottom:15px></div> <div class=circle>2</div><div class="header-font has-object-label" style=display:inline-block>Prioritize Matched <%= pluralObjects %></div> <div style=margin-left:30px;margin-bottom:8px class=has-object-label> Identify the ultimate matched <span class=text-lowercase><%= singleObject %></span> to be selected in cases where LeanData finds multiple matched <span class=text-lowercase><%= pluralObjects %></span>. </div> <div id=criteria-list-partial class=criteria-list-partial></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div>'},function(e,t){e.exports="<div id=action-node-opportunity-owner-partial class=node-partial data-node-type=action-opportunity-owner data-form-title=\"Action – Assign to Matched Opportunity Owner\"> <div id=main-div> <span class=header-font>Contact Ownership</span> <div class=control-group class=routing-type-radio-control> <label class=\"control control--radio <%= model.nodeInfo['routing type'] === 'contact owner' ? 'checked' : ''%>\">Matched Contact Owner <input type=radio class=\"default-radio-option routing-type-radio\" name=radio data-routing-type=\"contact owner\" <%= model.nodeInfo['routing type'] === 'contact owner' ? 'checked' : ''%> /> <div class=control__indicator></div> </label> <label class=\"control control--radio <%= model.nodeInfo['routing type'] === 'custom field' ? 'checked' : ''%> \">Matched Contact Custom User Field <input type=radio name=radio class=routing-type-radio data-routing-type=\"custom field\" <%= model.nodeInfo['routing type'] === 'custom field' ? 'checked' : ''%> /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div class=label-dropdown-container> <div class=\"dropdown-label horizontal-tabbing-radio-option-sub-div\">Select the user field to assign the contact to:</div> <div class=col style=width:50%;margin-left:10px><div class=custom-user-field-selector></div></div> </div> </div> </div> </div> <div id=update-account-owner></div> <hr class=horizontal-line-separator> <div class=alternate-field-assignment-container></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div> "},function(e,t){e.exports='<div style=text-align:center> <div class=ld-subheader><%= orgId %></div> <div class=ld-section-header style=margin-bottom:10px><%= versionNumber %></div> </div> <div class=dg_inner-wrapper-content> <div class=dg_status-column-title>Use Passphrase to Access Help Docs: Frictionless Funnel</div> <div class="dg_section help-section"> <div class=dg_section-nav> <div class="help-page-icons matching-icon"></div> <div class=dg_section-nav-title>MATCHING</div> </div> <div class=dg_section-subbox> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904564-matching-datasheet target=_blank>Matching Datasheet</a> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904570-account-scoring-datasheet target=_blank>Account Scoring Datasheet</a> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904573-leandata-tagging-faq target=_blank>Tagging FAQ</a> </div> </div> <div class="dg_section help-section"> <div class=dg_section-nav> <div class="help-page-icons router-icon"></div> <div class=dg_section-nav-title>ROUTER</div> </div> <div class=dg_section-subbox> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904579-routing-datasheet target=_blank>Lead Router Datasheet</a> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904582-contact-routing-datasheet target=_blank>Contact Router Datasheet</a> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/919796-account-routing-datasheet target=_blank>Account Router Datasheet</a> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/949908-opp-routing-datasheet target=_blank>Opportunity Router Datasheet</a> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904585-routing-action-guide target=_blank>Routing Action Guide</a> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/879773-leandata-round-robin target=_blank>Round Robin Datasheet</a> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904588-leandata-router-round-robin-overview target=_blank>Round Robin FAQ</a> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904591-leandata-router-faq target=_blank>Router FAQ</a> </div> </div> <div class="dg_section help-section"> <div class=dg_section-nav> <div class="help-page-icons attribution-icon"></div> <div class=dg_section-nav-title>Attribution</div> </div> <div class=dg_section-subbox> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904603-multi-touch-attribution-datasheet target=_blank>Multi-Touch Attribution Datasheet</a> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904594-leandata-attribution-overview target=_blank>Attribution Overview</a> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904600-leandata-attribution-wizard target=_blank>Attribution Wizard</a> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904597-leandata-attribution-views-setup target=_blank>Attribution Views Setup</a> </div> </div> <div class="dg_section help-section"> <div class=dg_section-nav> <div class="help-page-icons view-icon"></div> <div class=dg_section-nav-title>VIEW</div> </div> <div class=dg_section-subbox> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904606-view-datasheet target=_blank>View Datasheet</a> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904609-view-product-overview target=_blank>Product Overview</a> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904612-view-setup target=_blank>Setup</a> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904615-view-best-practices target=_blank>Best Practices</a> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904618-view-faq target=_blank>FAQ</a> </div> </div> <div class="dg_section help-section"> <div class=dg_section-nav> <div class="help-page-icons admin-icon"></div> <div class=dg_section-nav-title>Admin</div> </div> <div class=dg_section-subbox> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904624-leandata-managed-app-install target=_blank>Managed App Installation</a> <a class="dg_section-subbox-item help-link" data-href=https://leandata.uberflip.com/i/904621-leandata-dashboard-overview target=_blank>Dashboard Overview</a> </div> </div> <div class="dg_section help-section"> <div class=dg_section-nav> <div class="help-page-icons contactus-icon"></div> <div class=dg_section-nav-title>CONTACT US</div> </div> <div class=dg_section-subbox> <a class=dg_section-subbox-item href=mailto:support@leandatainc.com target=_blank>support@leandatainc.com</a> <a class=dg_section-subbox-item href=tel:1-669-721-9386 target=_blank>1-669-721-9386</a> </div> </div> </div> '},function(e,t){e.exports='<div class=filter-div style=padding-bottom:15px></div> <div class=circle>2</div><div class="header-font has-object-label" style=display:inline-block>Prioritize Matched <%= pluralObjects %></div> <div style=margin-left:30px;margin-bottom:8px class=has-object-label> Identify the ultimate matched <span class=text-lowercase><%= singleObject %></span> to be selected in cases where LeanData finds multiple matched <span class=text-lowercase><%= pluralObjects %></span>. </div> <div id=criteria-list-partial class=criteria-list-partial></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div>'},function(e,t){e.exports="<div id=action-node-opportunity-owner-partial class=node-partial data-node-type=action-opportunity-owner data-form-title=\"Action – Assign to Matched Opportunity Owner\"> <div id=main-div> <span class=header-font>Contact Ownership</span> <div class=control-group class=routing-type-radio-control> <label class=\"control control--radio <%= model.nodeInfo['routing type'] === 'contact owner' ? 'checked' : ''%>\">Matched Contact Owner <input type=radio class=\"default-radio-option routing-type-radio\" name=radio data-routing-type=\"contact owner\" <%= model.nodeInfo['routing type'] === 'contact owner' ? 'checked' : ''%> /> <div class=control__indicator></div> </label> <label class=\"control control--radio <%= model.nodeInfo['routing type'] === 'custom field' ? 'checked' : ''%> \">Matched Contact Custom User Field <input type=radio name=radio class=routing-type-radio data-routing-type=\"custom field\" <%= model.nodeInfo['routing type'] === 'custom field' ? 'checked' : ''%> /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div class=label-dropdown-container> <div class=\"dropdown-label horizontal-tabbing-radio-option-sub-div\"> Select the user field to assign the contact to: </div> <div class=\"custom-user-field-selector horizontal-tabbing-dropdown-input\"></div> </div> </div> </div> </div> <hr class=horizontal-line-separator> <div class=alternate-field-assignment-container></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div> "},function(e,t){e.exports='<div id=action-node-update-partial class=node-partial data-node-type=action-update data-form-title="Action – Update Opportunity"> <div class="main-div so-field-updater-container"></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div>'},function(e,t){e.exports='<div class=rule-container style="padding:0 20px 20px 20px;margin-top:5px;background-color:var(--lt-grey-1)"> <div class=rule-header-row style=line-height:45px;display:flex;align-items:center> <div class=ld-section-header style="flex:1 50%"><%= ruleName || \'Add Rule\' %></div> <div style="flex:1 50%;display:flex;justify-content:flex-end"> <div class="cancel-live-routing-rule ld-secondary-small-button">Cancel</div> <div class="save-live-routing-rule ld-primary-small-button">Done</div> </div> </div> <hr style="margin:0 -20px 10px -20px;border-top:1px solid var(--lt-grey-1_5)"> <div class=rule-name style=display:flex;align-items:center> <div style=justify-content:flex-start;flex:40%> <div class=ld-field-label-large style=display:inline-flex;margin-right:10px>Rule Name</div> <input class="live-routing-rule-name-input ld-input-small <%= ruleName.length === 0 ? \'input-invalid\' : \'\' %>" value="<%= ruleName %>" style=width:300px /> </div> <div style=justify-content:flex-end;flex:60%;display:flex;align-items:center;flex-wrap:wrap> <label class=cb-container-large style=display:inline-flex;font-size:14px;margin-right:20px> <span>Assign Alternate Field Instead of Owner</span> <input class=live-routing-alt-field-checkbox type=checkbox /> <span class=checkmark></span> </label> <div class=live-routing-alt-field-dropdown style=width:250px;display:inline-flex;visibility:hidden;margin-left:10px></div> <div class=alt-field-error-row style="flex:1 100%;text-align:right;margin-top:5px;font-size:12px;color:var(--ld-red);display:none"></div> </div> </div> <div class=rule-conditions style=display:flex;align-items:center;margin-top:20px></div> <div class=route-to-container style=display:flex;align-items:center;margin-top:10px> <div class=ld-field-label-large style=display:inline-flex;margin-right:10px>Route to</div> <div class=route-to-dropdown></div> </div> </div>'},function(e,t){e.exports=' <div style=display:flex;align-items:flex-end> <div style="flex:1 50%"> <div style="flex:1 100%;display:flex;align-items:center"> <div class=ld-section-header>Routing Rules</div> <div class=routing-type-filter></div> </div> <div class=invalid-rule-message-bar></div> <div style="flex:1 100%;margin-top:20px"> <div class="add-live-routing-rule ld-primary-small-button">Add Rule</div> </div> </div> <div class=records-routed-section> <div class=records-routed-header> <div class=total-deployment-records><%= totalRecords %> Records Routed</div> </div> <div class=records-routed-body> <div class=deployment-deployer>Deployed by <%= creator %></div> <div class=deployment-date><%= createdDate %></div> <div class=deployment-duration><%= duration %></div> </div> </div> </div> <div style="flex:1 100%;margin-top:10px"> <div class=rules-table-header-row> <div class=drag-column></div> <div class=name-column>Rule Name</div> <div class=details-column>Details</div> <div class=pool-column>RR Pool</div> <div class=records-column>Records Routed</div> <div class=duplicate-column></div> <div class=delete-column></div> </div> <div class=new-rule-table-row></div> <% if (rules.length > 0) { %> <ul class="rules-sortable rules-list list-unstyled"> <% _.each(rules, function(rule, idx) { %> <li class="rules-list-item %>" data-rule-number="<%= idx %>"> <div class="rules-table-row hover-row"> <div class=drag-column><div class="<%= invalidRuleIndexes.has(idx) ? \'vertical-drag-error-img\' : \'vertical-drag-handle-img\' %> grab" style="margin:4px 0"></div></div> <div class=name-column><%= rule.name %></div> <div class=details-column><%= Magellan.Util.formatTupleCriterionHtml(rule) %></div> <div class=pool-column><%= rule[\'round robin group name\'] == "" ? rule[\'target\'] : rule[\'round robin group name\'] %></div> <div class=records-column> <div class=live-routing-rule-metrics><%= (records[rule.name]) ? records[rule.name] : 0 %></div></div> <div class=duplicate-column><div class="duplicate-live-routing-rule ld-action-button">Copy</div></div> <div class=delete-column><div class="delete-live-routing-rule ld-cross-icon-large" style="margin:5px 0"></div></div> </div> <div class=rules-edit-partial-wrapper style=display:flex></div> </li> <% }); %> </ul> <% } else { %> <div class=rules-table-row style=text-align:center;display:block> <div>No Rules Found</div> </div> <% } %> </div> '},function(e,t){e.exports='<div class="live-routing-save-bar static dirty-bar save-bar" style=display:none> <div class="live-routing-cancel-rules-btn cancel ld-tertiary-small-button white">Cancel</div> <div class="live-routing-save-rules-btn save ld-primary-small-button light-button">Save Changes</div> </div> <div class=error-banner-wrapper></div> <div style="flex:1 100%;margin-top:20px"> <div class=ld-header>Live Routing</div> </div> <div class=ld-tabs-div style="flex:1 100%;margin-top:20px"> <% if (viewStatus.hasLiveLeadRouting) { %> <span class="live-routing-tab ld-tab lr-lead-tab" data-view=Lead>Leads</span> <% } if (viewStatus.hasLiveContactRouting) { %> <span class="live-routing-tab ld-tab lr-contact-tab" data-view=Contact>Contacts</span> <% } if (viewStatus.hasLiveAccountRouting) {%> <span class="live-routing-tab ld-tab lr-account-tab" data-view=Account>Accounts</span> <% } if (viewStatus.hasLiveOpportunityRouting) { %> <span class="live-routing-tab ld-tab lr-opportunity-tab" data-view=Opportunity>Opportunities</span> <% } %> </div> <div style="flex:1 100%"> <div class=rules-table-container></div> </div>'},function(e,t){e.exports='<div style="flex:1 100%;text-align:right"> <% if(dashboardController.viewObject.statuses.hasReadWriteAccess) { %> <div class="remove-from-all-pools-button ld-secondary-small-button <%= isEmpty ? \'disabled\' : \'\' %>" style=margin-right:0>Remove from All Pools</div> <% } %> </div> <div class="ld-table round-robin-table" style="flex:1 100%;margin-top:5px"> <table id=member-pools-table></table> </div>'},function(e,t){e.exports='<div class="add-vacation-button ld-primary-small-button disable-while-row-edit" style=margin-top:15px>Add Vacation</div> <div class="ld-table round-robin-table" style="flex:1 100%;margin-top:5px"> <table id=member-vacations-table></table> </div>'},function(e,t){e.exports='<div class="dirty-bar static save-bar" style=display:none> <div class="member-details-vacation-btn cancel ld-tertiary-small-button white">Close</div> <div class="member-details-vacation-btn save ld-primary-small-button light-button">Save Vacation</div> </div> <% if (!hideBreadcrumb) { %> <div style=margin-top:10px;margin-bottom:20px> <span id=member-details-breadcrumb class="ld-breadcrumb static">Members</span> <span>&gt;</span> <span class="ld-breadcrumb current"><%= invalidMember ? memberId : name %></span> </div> <% } %> <% if (invalidMember) { %> <div style="flex:1 100%">Invalid Member ID: <%= memberId %></div> <% } else { %> <div style="flex:1 100%"> <div class=ld-header><%= name %></div> <div style="margin:10px 0"><a href="/<%= memberId %>" target=_blank><%= isQueue ? \'View Queue\' : \'View User\' %></a></div> </div> <% if (!isQueue) { %> <div class=ld-tabs-div style="flex:1 100%;margin-bottom:0"> <span class="member-detail-pools-tab ld-tab poolsView active" data-view=poolsView>Pools</span> <span class="member-detail-pools-tab ld-tab vacationsView" data-view=vacationsView>Vacations</span> </div> <% } %> <div class=tab-content style="flex:1 100%"></div> <% } %> '},function(e,t){e.exports='<div id=round-robin-members-list-wrapper> <div style=display:flex> <div style="flex:1 25%"> <div class=ld-header>Round Robin</div> <div class=ld-subheader style=margin-top:10px>Members</div> </div> <div style="flex:1 75%;text-align:right"> <div class=search-filter style=margin-bottom:15px> <input required id=rr-members-search-filter-input placeholder="Search Members or Pools"/> <button class=clear-search-filter-btn></button> </div> <div style=padding-bottom:10px> <div class=object-type-filter></div> <div class="pool-type-filter <%= !dashboardController.viewObject.statuses.hasLiveRouting ? \'hidden\' : \'\' %>"></div> </div> </div> </div> <div class="ld-table round-robin-table" style="flex:1 100%;margin-top:10px"> <table id=members-list-table></table> </div> </div> '},function(e,t){e.exports="<div class=advanced-tab> <div class=ld-tabs-div> <span class=\"ld-tab schedules active\">Schedules</span> <span class=\"ld-tab capping\">Capping</span> </div> <div class=\"schedules sub-tab-content\"> <div class=setting-header> <div class=flexbox-container> <span class=ld-section-header>Working Hours </span> <div class=\"ld-tooltip-hint working-hours-field\"></div> </div> <div class=ld-hint-medium style=clear:both>optional</div> </div> <div id=working-hours-dropdown style=width:300px;margin-bottom:10px></div> <div class=inline-working-hours></div> <div class=setting-header> <div class=flexbox-container> <span class=ld-section-header>Holidays</span> <div class=\"ld-tooltip-hint holidays-field\"></div> </div> <div class=ld-hint-medium style=clear:both>optional</div> </div> <div id=holidays-dropdown style=width:300px></div> </div> <div class=\"capping sub-tab-content\" style=display:none> <div class=setting-header> <div class=flexbox-container> <span class=ld-section-header>Capping Models</span> <div class=\"ld-tooltip-hint capping\"></div> </div> <div class=ld-field-label-small style=clear:both;margin-top:10px>Select a capping model</div> </div> <div class=capping-menu> <div class=capping-section> <div> <input type=radio name=capping id=capping-none value=none <%= Capping_Type__c === null? 'checked' : '' %>> <label for=capping-none>Off</label> <div class=check></div> </div> </div> <div class=\"capping-section <%= Capping_Type__c === 'hourly' ? 'selected' : '' %>\"> <div> <input type=radio name=capping id=capping-hourly value=hourly <%= Capping_Type__c === 'hourly' ? 'checked' : '' %>> <label for=capping-hourly>Hourly Cap</label> <div class=check></div> </div> <div class=capping-section-detail> <div class=cap-limit> Hourly Cap (per member) <input class=\"ld-input-large cap-limit-input <%= !!parseInt(Capping_Limit__c) ? '' : 'input-invalid' %>\" value=\"<%= Capping_Limit__c %>\" placeholder=\"Enter #\"><br> </div> <div class=timezone> <div class=inline-block style=margin-right:10px>Timezone:</div> <div class=\"inline-block capping-timezone-dropdown hourly-timezone-dropdown\"></div> </div> </div> </div> <div class=\"capping-section <%= Capping_Type__c === 'daily' ? 'selected' : '' %>\"> <div> <input type=radio name=capping id=capping-daily value=daily <%= Capping_Type__c === 'daily' ? 'checked' : '' %>> <label for=capping-daily>Daily Cap</label> <div class=check></div> </div> <div class=capping-section-detail> <div class=cap-limit> Daily Cap (per member) <input class=\"ld-input-large cap-limit-input <%= !!parseInt(Capping_Limit__c) ? '' : 'input-invalid' %>\" value=\"<%= Capping_Limit__c %>\" placeholder=\"Enter #\"><br> </div> <div class=timezone> <div class=inline-block style=margin-right:10px>Timezone:</div> <div class=\"inline-block capping-timezone-dropdown daily-timezone-dropdown\"></div> </div> </div> </div> <div class=\"capping-section <%= Capping_Type__c === 'weekly' ? 'selected' : '' %>\"> <div> <input type=radio name=capping id=capping-weekly value=weekly <%= Capping_Type__c === 'weekly' ? 'checked' : '' %>> <label for=capping-weekly>Weekly Cap</label> <div class=check></div> </div> <div class=capping-section-detail> <div class=cap-limit> Weekly Cap (per member) <input class=\"ld-input-large cap-limit-input <%= !!parseInt(Capping_Limit__c) ? '' : 'input-invalid' %>\" value=\"<%= Capping_Limit__c %>\" placeholder=\"Enter #\"><br> </div> <div class=timezone> <div class=inline-block style=margin-right:10px>Timezone:</div> <div class=\"inline-block capping-timezone-dropdown weekly-timezone-dropdown\"></div> </div> </div> </div> </div> </div> </div> "},function(e,t){e.exports='<div class=metadata-editors id=pools-info-tab> <table class="metadata-editor left-pane float-left"> <tr> <td><span class=ld-field-label-large>Pool Name</span></td> <td> <input id=name-field data-field-name=Grouping_Name__c class="write-to-model ld-input-large ld-body-large" style=width:300px value="" placeholder="Enter Name for Pool"> </td> </tr> <tr class=" <%= !dashboardController.viewObject.statuses.hasLiveRouting ? \'hidden\' : \'\' %>"> <td><span class=ld-field-label-large>Pool Type</span></td> <td style=display:flex;align-items:center> <div id=pool-type-dropdown></div> <div class="ld-tooltip-hint pool-field"></div> </td> </tr> <tr> <td><span class=ld-field-label-large>Object Type</span></td> <td style=display:flex;align-items:center> <div id=object-type-dropdown></div> <div class="ld-tooltip-hint object-field"></div> </td> </tr> <tr> <td style=vertical-align:top;padding-top:15px> <span class=ld-field-label-large>Description</span><br> <span class=ld-hint-medium style=margin-right:10px>optional</span> </td> <td style=padding-top:13px> <textarea id=description-field data-field-name=Description__c class="write-to-model ld-input-large ld-body-large" style=resize:none;height:80px;width:325px placeholder="Enter Description"></textarea> </td> </tr> </table> <div class="metadata-editor right-pane float-right" style=width:40%> <div class=pool-manager-header> <span class=ld-field-label-large style=float:left>Pool Manager(s) </span> <div class="ld-tooltip-hint tooltip-on-left managers-field" style=float:left;width:30px;height:20px;position:relative;top:-2px></div> <div class=ld-hint-medium style=clear:both>optional</div> </div> <div style=vertical-align:top;padding-top:10px> <div id=manager-dropdown></div> <div id=manager-list></div> </div> </div> </div> '},function(e,t){e.exports="<ul class=member-list> <% if(members.length === 0) { %> <li class=empty-placeholder>Drag a user here to begin.</li> <% } %> <% members.forEach(function(member, idx) { %> <% var isActive = (member.User_Owner__r && member.User_Owner__r.IsActive) || groupsMap.hasOwnProperty(member.OwnerId__c) %> <li class=member data-owner-id=\"<%= member.OwnerId__c %>\"> <div class=\"card ld-body-medium flexbox-container\"> <div class=drag-handle> <% if(nextOwnerId === member.OwnerId__c) { %><div class=next-pointer-image></div><% } %> <div class=vertical-drag-handle-img></div> <% if(member.Is_Available_For_Routing__c === false && member.Inactive_Reason__c === 'user is on vacation') { %> <div class=on-vacation-indicator></div><% } %> </div> <div class=\"<%= isActive ? '' : 'ld-red' %>\"> <%= member.Name || (member.User_Owner__r && member.User_Owner__r.Name) || (groupsMap[member.OwnerId__c] && groupsMap[member.OwnerId__c].Name) || member.OwnerId__c %> <%= isActive ? '' : '(INACTIVE)' %> </div> <% \n        var cappingDenom = (Capping_Limit__c && Capping_Type__c) ? ' / ' + Capping_Limit__c : ''; \n        var isAvailable = member.Is_Available_For_Routing__c;\n        isAvailable &= (Capping_Type__c === 'none' || !Capping_Type__c || member.Current_Cap_Value__c < Capping_Limit__c);\n        %> <div><%= (member.Current_Cap_Value__c || '0') + cappingDenom + ' - ' + _.startCase(Capping_Type__c || 'None') %></div> <div class=\"weighting flexbox-container\"> <div class=slider></div> <div class=parts><input value=1.0 /></div> <div class=percentage>20%</div> </div> <div class=row-action-container> <div class=\"row-action <%= (isAvailable ? '' : 'invisible') %>\">Next Up</div> </div> <div class=\"delete-member-card-button ld-cross-icon-large\"></div> </div> </li> <% }) %> </ul>"},function(e,t){e.exports="<div class=members-tab> <div class=flexbox-container> <div class=users-col> <div class=users-pane> <div class=ld-subheader>Users (<span id=pool-user-count><%= users.length %></span>)</div> <div class=flexbox-container style=margin-bottom:5px> <div style=margin-right:10px class=user-filter-key-dropdown></div> <div style=flex-grow:1;max-width:180px class=\"<%= userFilterKey && userFilterKey !== 'Queue' ? '' : 'hidden' %> user-filter-value-dropdown\"></div> </div> <div class=search-filter style=display:flex;align-items:center> <div><input id=search-filter-input placeholder=\"Search Members\" value=\"<%= queryString %>\"/></div> <div style=margin-left:10px> <label class=cb-container-small> Include<br>Inactive <input type=checkbox class=include-inactive-users <%= userFilterOption === 'showInactive' ? 'checked' : '' %> /> <span class=checkmark style=margin-top:5px></span> </label> </div> </div> <hr style=margin-top:10px;margin-bottom:10px> <div class=users-container> </div> </div> </div> <div class=members-col> <div class=members-pane> <div class=members-pane-table-header-row> <div class=ld-subheader style=\"flex:1 50%\">Members (<span id=pool-member-count><%= members.length %></span>) </div> <div class=distribution-checkbox-container> <label class=\"cb-container-small ld-field-label-small\"> <span>Weighted Distribution</span> <input class=weighted-distribution-checkbox type=checkbox <%= Weighting_Enabled__c ? 'checked' : '' %> /> <span class=checkmark></span> </label> <div style=margin-left:20px class=\"reset-weights-button ld-text-navigation\">Reset</div> </div> </div> <div class=members-faux-table> <div class=members-faux-table-headers> <div></div> <div>Member</div> <div>Cap</div> <div>Weighting</div> </div> <div class=members-container></div> </div> </div> </div> </div> </div> "},function(e,t){e.exports='<div id=roundrobin-pools> <div class="dirty-bar static"> <div class="cancel ld-tertiary-small-button white close-pool-editor">Close</div> <div class="save ld-primary-small-button light-button disabled save-pool">Save Pool</div> </div> <div> <div class=ld-header style=margin-top:15px><%= Grouping_Name__c ? Grouping_Name__c : \'Create Round Robin Pool\' %></div> <div class=ld-tabs-div> <span class="ld-tab info active">Info</span> <span class="ld-tab members">Members</span> <span class="ld-tab advanced-settings">Advanced Settings</span> </div> <div id=tab-content></div> </div> </div> '},function(e,t){e.exports="<% if(users.length > 0) { %> <ul class=user-list style=padding-left:0> <% users.forEach(function(user, idx) { %> <% var isActive = user.IsActive || user.Type === 'Queue' || user.type === 'Queue'; %> <li data-id=\"<%= user.Id %>\" class=user> <div class=card> <div class=flexbox-container> <div class=details> <div class=\"name ld-body-medium <%= isActive ? '' : 'ld-red' %>\"><%= user.Name %> <%= isActive ? '' : '(INACTIVE)' %></div> <div class=ld-hint-small><%= user.Id %></div> </div> <div class=drag-handle-container> <div class=drag-handle-img></div> </div> </div> </div> </li> <% }) %> <% } else { %> <div class=no-users-message>No users found.</div> <% } %> </ul>"},function(e,t){e.exports='<div id=roundrobin-pools class="<%= dashboardController.viewObject.statuses.hasReadWriteAccess ? \'\' : \'not-ld-admin\' %>"> <div class=ld-header style=margin-top:18px> Round Robin </div> <div class="flexbox-container space-between" style=padding-top:5px> <div class=left-col> <div class=ld-subheader> Pools </div> </div> <div class=right-col> <div class=search-filter> <input required id=rr-members-search-filter-input placeholder="Search Pools"/> <button class=clear-search-filter-btn></button> </div> </div> </div> <div id=add-pool-button class="ld-primary-small-button rrp-button">Create Round Robin Pool</div> <br> <div style="display:flex;margin:10px 0"> <div class=left-col style="flex:1 100%"> <div id=set-schedule-button class=ld-secondary-small-button>Set Schedule</div> </div> <div class=right-col style="width:max-content;flex:1 100%;text-align:right"> <div class="pool-table-filter inline-block object-type-multiselect"></div> <div class="pool-table-filter inline-block pool-type-multiselect <%= !dashboardController.viewObject.statuses.hasLiveRouting ? \'hidden\' : \'\' %>"></div> </div> </div> <div class=bulk-actions> <div class="flexbox-container upper"> <div class=ld-section-header>Set Schedule</div> <div class=controls> <div class="close-btn ld-secondary-small-button">Close</div> <div class="apply-btn ld-primary-small-button">Apply Changes</div> </div> </div> <hr/> <div class="flexbox-container lower"> <div class=working-hours-bulk-action> <div class=label-enable-working-hours> <span>Working Hours</span> </div> <div class=working-hours-dropdown></div> <div class="ld-tooltip-hint working-hours-tooltip"></div> </div> <div class=holiday-set-bulk-action> <div class=label-enable-holidays> <span>Holiday Set</span> </div> <div class=holiday-set-dropdown></div> <div class="ld-tooltip-hint tooltip-on-left holidays-tooltip"></div> </div> </div> </div> <div class="pools-table-container ld-table-standard-styling"></div> </div> '},function(e,t){e.exports='<div id=round-robin-holiday-creator> <div class="dirty-bar static"> <div class="holiday-creator-button cancel ld-tertiary-small-button white">Close</div> <div class="holiday-creator-button revert ld-primary-small-button light-button disabled">Revert</div> <div class="holiday-creator-button save ld-primary-small-button light-button disabled disable-while-row-edit">Save Holiday Set</div> </div> <div class=creator-body> <div class=ld-header><%= Name || \'Create Holiday Set\' %></div> <div class=metadata-editors> <table class="metadata-editor float-left"> <tr> <td><span class=ld-field-label-large>Name</span></td> <td> <input class="ld-input-large ld-body-large <%= _.isEmpty(Name) ? \'input-invalid\' : \'\' %>" id=name-field style=width:350px value="<%= Name %>" placeholder="Enter Holiday Set Name"> <div class="ld-tooltip-hint holiday-name"></div> </td> </tr> </table> <table class="metadata-editor float-right"> <tr> <td class=description-cell> <span class=ld-field-label-large>Description</span><br> <span class=ld-hint-medium style=margin-right:10px>optional</span> </td> <td> <textarea id=description-field class="ld-body-large ld-input-large" placeholder="Enter Description"><%= Description__c %></textarea> </td> </tr> </table> </div> <div class="ld-primary-small-button disable-while-row-edit" id=create-holiday-set>Add Holiday</div> <div id=table-container class="ld-table ld-table-standard-styling round-robin-table holiday-creator-table"></div> </div> </div> '},function(e,t){e.exports='<div id=add-holiday-button class=ld-primary-small-button>Create Holiday Set</div> <div class="ld-table holidays round-robin-table" style=margin-top:10px> <table class=hoverable> <thead> <tr> <th>Holiday Set</th> <th>Pools</th> <th>Date created</th> <th>Date modified</th> <th>Modified by</th> <th></th> </tr> </thead> </table> <div class=inner-scroll> <table> <tbody> <% _.each(collectionToJson, function(model) { %> <tr class="holidays-row hover-row" data-id="<%= model.Id %>"> <td><%= model.Name %></td> <td><%= scheduleToPoolMap[model.Id] ? scheduleToPoolMap[model.Id].length : 0 %></td> <td><%= formatMomentDate(model.CreatedDate, \'MM/DD/YYYY\') %></td> <td><%= formatMomentDate(model.LastModifiedDate, \'MM/DD/YYYY\') %></td> <td><%= model.LastModifiedBy.Name %></td> <td><div class="delete-holiday-set ld-cross-icon-large"></div></td> </tr> <% }) %> </tbody> </table> <% if(collectionToJson.length === 0) { %> <div class=empty-placeholder> No holidays to display. </div> <% } %> </div> </div> '},function(e,t){e.exports="<div class=\"working-hours-creator-container <%= inlineMode ? 'inline-mode' : '' %> <%= readOnly ? 'read-only' : '' %>\"> <div class=working-hours-creator> <div class=\"dirty-bar static working-hours-dirty-bar\"> <div class=\"hour-creator-button ld-tertiary-small-button white cancel\">Close</div> <div class=\"hour-creator-button ld-primary-small-button light-button revert <%= hasChanged ? '' : 'disabled' %>\">Revert</div> <div class=\"hour-creator-button ld-primary-small-button light-button save <%= hasChanged ? '' : 'disabled' %>\">Save Working Hours</div> </div> <div> <div class=\"ld-header working-hours-page-header-1\"><%= Name ? Name : 'Create Working Hours' %></div> <div class=working-hours-page-header-2> <div class=ld-subheader style=flex:1;margin-bottom:0>Create Working Hours</div> <div style=flex:1;text-align:right> <div class=\"revert-button ld-tertiary-large-button\">Revert Changes</div> </div> </div> <div class=\"ld-tabs-div working-hours-tabs-div\" style=margin-top:20px;line-height:15px> <span class=\"ld-tab editor active\">Working Hours</span> <span class=\"ld-tab pools <%= !isNewCreation ? '' : 'hidden'%>\">Pools</span> </div> <div class=\"tab-content editor\"> <% if(!showHoursOnly) { %> <div class=\"working-hour-template-editor metadata-editors flexbox-container\" style=\"width:100%;justify-content:space-between;padding:10px 0\"> <table class=metadata-editor> <tr> <td><span class=ld-field-label-large>Name</span></td> <td> <input id=name-field class=\"ld-input-large ld-body-large <%= _.isEmpty(Name) && Is_Template__c ? 'input-invalid' : '' %>\" style=width:300px value=\"<%= Name %>\" placeholder=\"Enter Working Hours Name\" <%= !Is_Template__c ? 'disabled' : '' %> > <div class=\"ld-tooltip-hint working-hour-name-tooltip\"></div> <div class=working-hours-save-as-template> <label class=cb-container-small> <span class=ld-field-label-large>Save as Template</span> <input type=checkbox class=save-as-template-checkbox <%= Is_Template__c ? 'checked' : '' %> /> <span class=checkmark></span> </label> <div class=\"ld-tooltip-hint tooltip-on-left save-as-template-checkbox\"></div> </div> </td> </tr> <tr> <td><span class=ld-field-label-large>Timezone</span></td> <td> <div id=timezone-dropdown></div> </td> </tr> </table> <table class=\"metadata-editor working-hour-description-box\"> <tr> <td style=vertical-align:top;padding-top:15px> <span class=ld-field-label-large>Description</span><br> <span class=ld-hint-medium style=margin-right:10px>optional</span> </td> <td> <textarea id=description-field class=\"ld-input-large ld-body-large\" style=resize:none;height:80px;width:325px placeholder=\"Enter Description\"><%= Description__c %></textarea> </td> </tr> </table> </div> <% } %> <div style=clear:both;width:100%> <table class=working-hours-editor style=width:100%> <% _.each(moment.weekdays(), function(titlecaseDayName,idx) { %> <% var dayName = titlecaseDayName.toLowerCase(); %> <tr data-row=\"<%= dayName %>\"> <td class=\"day-name ld-field-label-small\"><%= _.startCase(dayName) %></td> <td class=hours> <% if(Schedule_Data__c[dayName].length !== 0 && !(Schedule_Data__c[dayName][0][0] === '00:00' && Schedule_Data__c[dayName][0][1] === '23:59')) { %> <% Schedule_Data__c[dayName].forEach(function(hourPair, position, arr) { %> <% var pairIsInvalid = (hourPair[0] === null || hourPair[1] === null); %> <div data-col=\"<%= position %>\" class=\"hour-range-container <%= pairIsInvalid ? 'invalid' : '' %>\"> <div class=hour-range style=display:inline-block> <div data-side=start class=\"selected-time ld-dropdown-xtra-small hourInput <%= hourPair[0] === null ? 'empty-input' : '' %>\"> <%= hourPair[0] === null ? 'start time' : convertTo12Hr(hourPair[0])  %> <div class=time-dropdown-container> <%= generateHourOptions(hourPair[0], model.getDropdownBounds(dayName, position, 'start')) %> </div> </div> <span class=\"hour-range-separator ld-hint-medium\">to</span> <div data-side=end class=\"selected-time ld-dropdown-xtra-small hourInput <%= hourPair[1] === null ? 'empty-input' : '' %>\"> <%= hourPair[1] === null ? 'end time' : convertTo12Hr(hourPair[1])  %> <div class=time-dropdown-container> <%= generateHourOptions(hourPair[1], model.getDropdownBounds(dayName, position, 'end')) %> </div> </div> </div> <span class=hour-range-delete> <span class=ld-cross-icon-large></span> </span> </div> <div class=\"ld-body-medium inline-hours-div\"><%= hourPair[0] %> to <%= hourPair[1] %></div> <% }) %> <div class=\"ld-add-button-large add-hours-btn <%= model.allDaysAreValid() ? '' : 'disabled' %>\"></div> <% if(!model.dayIsValid(dayName)) { %><img class=error-icon src=\"<%= iconToURLMap['Node Validation Error Icon'] %>\"/><% } %> <% } else { %> <% var allDay = Schedule_Data__c[dayName].length !== 0 && Schedule_Data__c[dayName][0][0] === '00:00' && Schedule_Data__c[dayName][0][1] === '23:59'; %> <div class=\"no-hours-default-text <%= allDay ? 'ld-body-medium' : 'ld-hint-medium' %>\"><%= allDay ? 'All Day (24 Hours)' : 'No Routing Scheduled' %></div> <select class=day-dropdown> <% if (allDay) { %> <option value=no-routing>No Routing</option> <option value=all-day selected=selected>All Day (24 Hours)</option> <% } else { %> <option value=no-routing selected=selected>No Routing</option> <option value=all-day>All Day (24 Hours)</option> <% } %> <option value=custom>Custom Hours</option> </select> <% } %> </td> </tr> <% }) %> </table> </div> </div> <div class=\"tab-content pools working-hours-pools-tab\"> <div class=pool-table-container></div> </div> </div> </div> <div class=working-hours-description-box> <div class=\"ld-body-large working-hour-description-header\">Timezone</div> <div class=\"ld-body-medium working-hour-description-body\"><%= Timezone__c || 'N/A' %></div> <div class=\"ld-body-large working-hour-description-header\" style=margin-top:20px>Description</div> <div class=\"ld-body-medium working-hour-description-body\"><%= Description__c || '' %></div> </div> </div>"},function(e,t){e.exports='<div id=add-hours-button class=ld-primary-small-button>Create Working Hours</div> <div class="ld-table round-robin-table working-hours" style=margin-top:10px> <table class=hoverable> <thead> <tr> <th>Working Hours</th> <th>Pools</th> <th>Date created</th> <th>Date modified</th> <th>Modified by</th> <th></th> </tr> </thead> </table> <div class=inner-scroll> <table> <tbody> <% _.each(collectionToJson, function(model) { %> <tr class="working-hour-row hover-row" data-id="<%= model.Id %>"> <td><%= model.Name %></td> <td><%= scheduleToPoolMap[model.Id] ? scheduleToPoolMap[model.Id].length : 0 %></td> <td><%= formatMomentDate(model.CreatedDate, \'MM/DD/YYYY\') %></td> <td><%= formatMomentDate(model.LastModifiedDate, \'MM/DD/YYYY\') %></td> <td><%= model.LastModifiedBy.Name %></td> <td><div class="delete-working-hour ld-cross-icon-large"></div></td> </tr> <% }) %> </tbody> </table> <% if(collectionToJson.length === 0) { %> <div class=empty-placeholder> No working hours to display. </div> <% } %> </div> </div> '},function(e,t){e.exports='<div> <div class="dirty-bar static"> <div class="vacation-creator-button cancel ld-tertiary-small-button white">Close</div> <div class="vacation-creator-button revert ld-primary-small-button light-button disabled">Revert</div> <div class="vacation-creator-button save ld-primary-small-button light-button disable-while-row-edit disabled">Save Vacations</div> </div> <div> <div class=ld-header style="margin:20px 0">Schedule Vacations</div> <div class="ld-primary-small-button disable-while-row-edit" id=add-vacation-btn>Add Vacation</div> <div> <div class="table-container round-robin-table ld-table-standard-styling vacation-creator-table" style=width:1045px;margin-top:20px></div> </div> </div> </div> '},function(e,t){e.exports="<div id=add-vacations-button class=ld-primary-small-button>Schedule Vacations</div> <div class=\"ld-table vacations round-robin-table\" style=margin-top:10px> <table class=hoverable> <thead> <tr> <th>User Name</th> <th>Vacations Scheduled</th> <th></th> <th>Created by</th> <th>Date created</th> <th></th> </tr> </thead> </table> <div class=inner-scroll> <table> <tbody> <% _.each(userToVacationsMap, function(vacations, ownerId) { %> <% var user = vacations[0].get('Vacation_User__r'); %> <tr class=\"parent-row collapsed\" data-id=\"<%= ownerId %>\"> <td><div class=pivot-table-arrow></div><%= user.Name %></td> <td><%= vacations.length %></td> <td></td> <td></td> <td></td> <td></td> </tr> <% _.each(vacations, function(vacation) { %> <% var dateRange = vacation.get('Schedule_Data__c') %> <tr class=child-row data-vacationid=\"<%= vacation.get('Id') %>\" data-id=\"<%= ownerId %>\"> <td></td> <td><%= _.unescape(vacation.get('Name')) %></td> <td> <%= formatGMTDateTimeToTimezone(dateRange[\"startDate\"], user.TimeZoneSidKey) %> - <br/> <%= formatGMTDateTimeToTimezone(dateRange[\"endDate\"], user.TimeZoneSidKey) %><br/> <%=user.TimeZoneSidKey%> </td> <td><%= vacation.get('CreatedBy') ? vacation.get('CreatedBy').Name : 'Not Available' %></td> <td><%= formatMomentDate(vacation.get('CreatedDate'), 'MM/DD/YYYY') %></td> <td><div class=\"deleteIcon ld-cross-icon-grey-large\"></div></td> </tr> <% }) %> <% }) %> </tbody> </table> <% if(_.isEmpty(userToVacationsMap)) { %> <div class=empty-placeholder> No vacations to display. </div> <% } %> </div> </div> "},function(e,t){e.exports='<div class=mainDiv id=roundrobin-schedules> <div class=ld-header>Round Robin</div> <div class=ld-subheader>Schedules</div> <div class=ld-tabs-div style=margin-top:20px;line-height:15px> <span class="ld-tab working-hours active">Working Hours</span> <span class="ld-tab holidays">Holiday Sets</span> <span class="ld-tab vacations">Vacations</span> </div> <div style=margin-bottom:100px id=tab-content></div> </div> <div id=fullscreenDiv></div> '},function(e,t){e.exports='<span class="section separator">CSV Requirements<a class=link href="<%= resourceURL %>/images/Territory_Sample.csv" download=LeanData-Territory-Example.csv>Download sample CSV</a></span> <div style=width:100%> <div class=body-copy-lrg style=margin-bottom:10px>When creating your CSV, remember that the following columns must be present and spelled correctly in your CSV:</div> <ul> <li>Territory</li> <li>Owner Id, OR Round Robin Name</li> <li>PostalCode</li> <li>City</li> <li>State</li> <li>Country</li> </ul> <img class=samplecsv src="<%= resourceURL %>/images/sample_csv_screenshot.png"/> <div class=body-copy-lrg style=margin-bottom:20px;clear:both>Each row in your CSV should represent a complete Territory or a portion of a Territory. That is, a Territory may require multiple rows to define.</div> <div class=gray-container> <p class="section gray-container-title"> Learn more about creating a Segment</p> <div class="section collapsed separator" style=display:flex;align-items:center><div class=pivot-table-arrow style=margin-right:5px></div>Territory Ownership</div> <div class=section-body> <p class=body-copy-lrg> Owner Id is required to assign ownership of a Territory to a user in your Salesforce instance. You can find this Id on the owner\\\'s user object in Salesforce.</p> <p class=body-copy-lrg>When creating the Territories in your Segment, keep in mind that each of the rows in your CSV should contain complete data, with the exception of the Owner Id and Round Robin Name columns; only one of these is required per row. That is, a given Territory cannot be owned by a specific user and a Round Robin pool, so only fill out one of these two when creating that Territory.</p> </div> <div class="section collapsed separator" style=display:flex;align-items:center><div class=pivot-table-arrow style=margin-right:5px></div>Auto-Naming</div> <div class=section-body> <p class=body-copy-lrg>If you upload a CSV that contains a Territory with multiple owners, you will notice that the Territory has been split into multiple rows and renamed based on ownership. Example: "Southern CA" was owned by Bob and Jim in your CSV. After upload, you will notice that we have renamed the Territory to "Southern CA - Bob" and "Southern CA - Jim". We do this in order to maintain the best practice of having one owner per Territory.</p> </div> </div> <div class=button-container> <div class="ld-secondary-large-button close-btn" data-dismiss=modal>Close</div> <label for=upload> <span class="ld-primary-large-button selectFile" style="" id=selectFile>Select a File To Upload</span> </label> <span> <input type=file id=upload style=display:none accept=.csv class=required /> </span> </div> </div> '},function(e,t){e.exports='<style>.ui-autocomplete{max-height:250px;overflow-y:auto;overflow-x:hidden;border:1px solid var(--ld-lt-green-1);border-bottom-left-radius:5px;border-bottom-right-radius:5px;padding:5px 0;width:143px!important}.ui-menu .ui-state-focus{margin:0}.ui-autocomplete .ui-menu-item{background:0 0;border:none;font-weight:200;padding:4px 10px}.ui-autocomplete .ui-menu-item:hover{background-color:var(--ld-lt-green-1);color:#fff;border:none}.button-div{width:600px;float:left;clear:left;display:flex;justify-content:center}.ul{margin-bottom:0}.ui-icon{background:url("{!URLFOR($Resource.Reporting_Images, \'Down_Arrow_Icon.png\')}") no-repeat right!important;transform:rotate(-90deg);background-size:9px 6px!important;background-position-x:3.5px!important}select:hover{cursor:pointer}.ui-front{width:150px;word-wrap:break-word}.ui-state-focus{background:#45b7e6;font-weight:600;border:0}.ui-menu-icon{display:flex!important}</style> <div class=mainDiv id=territory-assignments> <div class="dirty-bar static" style=display:none> <div class="segment-assignment-btn cancel ld-tertiary-small-button white">Cancel</div> <div class="segment-assignment-btn save ld-primary-small-button light-button">Save Changes</div> </div> <div class=secondDiv style=width:auto> <div id=territory-routing-assignments style=display:block> <div style=margin-top:20px> <span class="ld-breadcrumb static" id=segments-breadcrumb style=margin-top:20px;width:40px>Segments</span> <span class="" style=margin-top:20px>&gt;</span> <span class="ld-breadcrumb current" style=margin-top:20px>Ownership</span> </div> <div class=ld-header style=margin-top:18px>Territory Management</div> <div style=margin-top:10px> <span id=assignmentSubHeader2 class=ld-subheader style=margin-top:0;display:inline-block><%= collection.segmentName %></span> <span class="ld-secondary-small-button dk-grey-1 bg-white" id=edit-segment-button style=position:relative;top:-4px;margin-left:10px>Edit Segment</span> </div> <div class=ld-tabs-div style=line-height:15px> <span class="ld-tab owners active">Owner Assignments</span> <span class="ld-tab territories">Territory Assignments</span> <div id=pivotByOwner style=display:block;margin-top:20px> <table class="ld-table territory-table territory-owner-table" style=margin-top:20px> <tbody> <tr> <th class=ownerHeader>Owner Name</th> <th class=subTable>Territories</th> </tr> </tbody> </table> <div class=inner-scroll> <table class="ld-table territory-table territory-owner-table" style=margin-top:0> <tbody> <% _.each(ownerIds, function(ownerId) { %> <% var searchMap = {}; searchMap[ns+\'Owner__c\'] = ownerId; %> <% var ownedTerritories = collection.where(searchMap); %> <tr class="owner-row collapsed" data-ownerid="<%= ownerId %>"> <td><div class=pivot-table-arrow></div><%=this.getOwnerName(ownerId)%></td> <td><%= ownedTerritories.length %></td> <td class=pivot-table-dropdown-container><span class="assign-owner-dropdown ld-secondary-small-button dk-grey-1 bg-white">Select a new owner</span></td> </tr> <% _.each(ownedTerritories, function(territory) { %> <tr class="owner-pivot-row no-hover" data-territoryid="<%= territory.get(\'Id\') %>" data-ownerid="<%= ownerId %>"> <td class=subRow><%= territory.get(ns+\'Name__c\') %></td> <td></td> <td class=pivot-table-dropdown-container><span class="assign-owner-dropdown ld-secondary-small-button dk-grey-1 bg-white">Select a new owner</span></td> </tr> <% }) %> <% }) %> </tbody> </table> </div> </div> <div id=pivotByTerritory style=display:block> <table class="ld-table territory-table" style=margin-top:20px> <tbody> <tr class=dataHeaders style=height:30px> <th>Territory Name</th> <th>Owner</th> <th></th> </tr> </tbody> </table> <div class=inner-scroll> <table class="ld-table territory-table territory-owner-table" style=margin-top:0> <tbody> <% _.each(collection.models, function(territory) { %> <tr data-territoryid="<%= territory.get(\'Id\') %>" class="dataRowHover territory-row"> <td><%= territory.get(ns+\'Name__c\') %></td> <td><%=this.getOwnerName(territory.get(ns+\'Owner__c\'))%></td> <td></td> <td class=pivot-table-dropdown-container><span class="assign-owner-dropdown ld-secondary-small-button dk-grey-1 bg-white">Select a new owner</span></td> </tr> <% }) %> </tbody> </table> </div> </div> </div> </div> </div> </div> '},function(e,t){e.exports='<style>.ui-autocomplete{border:1px solid #b2e8de;border-bottom-left-radius:5px;border-bottom-right-radius:5px;padding:5px 0}.ui-menu .ui-state-focus{margin:0}.ui-autocomplete .ui-menu-item{background:0 0;border:none;font-weight:200;padding:4px 10px}.ui-autocomplete .ui-menu-item:hover{background:#65d2bd;color:#fff;border:none}.autoCompReassign.ui-autocomplete-input{padding-left:4px}.autoCompReassign.ui-autocomplete-input:focus{outline:0;border:1px solid #b2e8de;border-bottom:none;border-bottom-left-radius:0;border-bottom-right-radius:0}</style> <div class=mainDiv id=territory-editor> <div class="dirty-bar static" style=display:none> <div class="segment-edit-btn cancel ld-tertiary-small-button white">Cancel</div> <div class="segment-edit-btn save ld-primary-small-button light-button">Save Changes</div> </div> <div class=secondDiv style=width:auto> <div id=territory-routing-editor style=display:block> <div style=margin-top:20px> <span class="ld-breadcrumb static" style=width:40px id=segments-breadcrumb>Segments</span> <span>&gt;</span> <span class="ld-breadcrumb static" style=width:40px id=assignments-breadcrumb>Ownership</span> <span>&gt;</span> <span class="ld-breadcrumb current">Edit Segment</span> </div> <div class=ld-header style=margin-top:18px>Edit Segment</div> <div style=margin-top:10px> <div> <span id=editorSubHeader2 class=ld-subheader style=margin-top:0><%= collection.segmentName %></span> <span class="imgHover edit-icon" style=margin-top:-8px id=rename-button></span> </div> <div id=add-territory-buttton class="ld-secondary-small-button dk-grey-1 bg-white" style=position:relative;top:-4px;margin-top:15px>Add Territory</div> </div> <div class="territorySegmentsDiv tableWrapper outer-panel" style=line-height:15px> <div class=inner-panel> <table class="list ld-table territory-table" cellspacing=0 cellpadding=0 style=table-layout:fixed id=territoryGeosTable> <thead class=territorySegmentsTableHead> <tr class=headerRow role=row> <th></th> <th>Territory Name</th> <th>Owner Name</th> <th>PostalCode</th> <th>City</th> <th>State</th> <th>Country</th> <th>Custom Field</th> <th></th> </tr> </thead> <tbody class=territorySegmentsTableBody> </tbody> </table> </div> </div> </div> </div> </div> '},function(e,t){e.exports="<div class=mainDiv id=territory-main> <div class=secondDiv style=width:auto> <div class=\"ld-breadcrumb current\" style=margin-top:20px>&zwnj;</div> <div class=\"ld-header ld-green\" style=margin-top:18px> Territory Management </div> <div> <span id=segmentSubheader class=ld-subheader style=display:inline-block>Segments (<%= segments.length %>)</span> <span class=ld-text-navigation style=margin-left:10px id=csv-upload-instructions>CSV Upload Instructions</span> </div> <div class=\"ld-primary-small-button territory-button\" id=create-segment style=margin-top:10px> Create Segment </div> <div class=\"ld-table territory-table\" id=territorySegmentTable style=margin-top:20px> <table class=hoverable> <tbody> <tr style=height:30px> <th></th> <th>Segment Name</th> <th>CSV File</th> <th>Territories</th> <th>Created by</th> <th>Date created</th> <th>Date modified</th> <th></th> <th></th> </tr> </tbody> </table> <div class=inner-scroll> <table> <tbody> <% _.each(segments, function(segment){ %> <tr class=dataRowHover style=height:20px data-id=\"<%= segment.Id %>\" data-cid=\"<%= segment._cid %>\" data-segmenttype=\"<%= segment.segmentType %>\" data-namestring=\"<%= segment[ns+'Name__c'] %>\"> <td style=overflow:visible!important> <% if( (segment['inactiveOwner']) || (segment[ns+'Upload_Status__c'] != null && ((segment[ns+'Upload_Status__c'].startsWith('Upload Failed') && segment.segmentType !== 'draft') || (segment[ns+'Upload_Status__c'].startsWith('Upload Draft Failed') && segment.segmentType === 'draft')))) { %> <img class=errorIcon src=\"<%= resourceURL + '/images/Triangle_Error_Icon_node.png' %>\" height=20px width=20px> <div class=error-messages style=display:none><%= (segment['inactiveOwner']) ? (\"This segment contains invalid users or deleted round robin pools\") : (segment.uploadStatus) %></div> <% } %> </td> <td> <%= segment[ns+'Name__c'] + (segment.segmentType === 'draft' ? ' - Draft' : '') + ((segment[ns+'Upload_Status__c'] != null && segment[ns+'Upload_Status__c'.startsWith('Upload')]) ? ((segment[ns+'Upload_Status__c'] != null && segment[ns+'Upload_Status__c'].startsWith('Upload Failed')) ? '<span style=\"color:red;display:block;\">Upload Failed</span>' : '<span style=\"display:block\">Upload In Progress</span>') : '') %> </td> <td> <%= ( (segment.segmentType !== 'draft') ? (segment[ns+'FileName__c']) : (segment[ns+'Draft_FileName__c']) ) %> </td> <td> <%= ( (segment.segmentType !== 'draft') ? (segment.segmentCount) : (segment.segmentCountDraft) )%> </td> <td><%= segment.CreatedBy.Name %></td> <td><%= formatMomentDate(segment.CreatedDate, 'MM/DD/YYYY') %></td> <td> <%= formatMomentDate(segment.LastModifiedDate, 'MM/DD/YYYY') %> <% if(segment.isDeployed && !(segment.segmentType === 'draft')) { %> <div class=live-icon style=margin-left:5px></div> <% } %> </td> <td class=segment-action-cell> <% if((segment[ns+'Version__c'] >= 0) && (segment.segmentType !== 'draft' || (segment[ns+'Upload_Status__c'] == null || !segment[ns+'Upload_Status__c'].startsWith('Upload Draft')))) { %> <div class=segment-action> Actions <div class=ld-select-dropdown> <% if(['draft'].includes(segment.segmentType)) { %> <div class=deploy-action>Deploy</div> <% } %> <% if(['default'].includes(segment.segmentType)) { %> <div class=copy-action>Copy</div> <% } %> <% if(['default', 'draft'].includes(segment.segmentType)) { %> <div class=export-action>Export</div> <% } %> <% if(['empty'].includes(segment.segmentType)) { %> <div class=upload-action>Upload</div> <% } %> <% if(['default'].includes(segment.segmentType)) { %> <div class=replace-action>Replace</div> <% } %> <% if(['empty','draft','default'].includes(segment.segmentType)) { %> <div class=rename-action>Rename</div> <% } %> </div> </div> <% } %> </td> <td><div class=\"deleteIcon ld-cross-icon-large\"></div></td> </tr> <% }); %> </tbody> </table> </div> </div> </div> </div> <script src=\"<%= uploadCsvJsURL %>\"><\/script>"},function(e,t){e.exports='<div class=auth_panel> <div style=display:flex;justify-content:flex-end> <div class=show_authorization> <span>Show Authorization</span> </div> </div> <div class=authorization-div style=display:none> <div style=padding:20px> <span class=auth_text>Authorization Link | </span> <span class=dg_inner-wrapper-subheader>Enable LeanData product monitoring and access performance reports</span> <div class=hide_authorization> <span>Hide This</span> </div> </div> <div class=authorization-content> <img class=installation-complete src="<%= iconToURLMap[\'Complete Button\'] %>"> <a class=authorization-link href="<%= _.escape(globalAuthorizationLink) %>" target=_blank style=display:none> <div class="authorize-button-token ld-primary-small-button"> Authorize Salesforce Token </div> </a> </div> </div> </div> <div class=home-component> <div class="ld-subheader graph-name">Routing Usage</div> <span class=graph-date-range> <%=model.startDate + \' - \' + model.endDate%></span> <div class="ld-primary-small-button detailed-report-button">Detailed Report</div> <div class=line-graph-wrapper></div> <div class=icon-container> <div class=row id=first-row> <% _.map(model.firstRowIconNameToPageName, function(pageName, iconName) { %> <div class="icon <%=iconName.toLowerCase() + \'-product\'%> col col-xs-3" data-page-name="<%=pageName%>" data-icon-name="<%=iconName%>"> <div class="thumbnail product-icon-button"> <div class="dg_section-nav-image <%=iconName.toLowerCase() + \'-image\'%>"></div> <div class=dg_section-nav-title> <%=iconName%> </div> <img class=promo-upgrade-ribbon src="<%= iconToURLMap[\'Upgrade Sash\'] %>"/> </div> </div> <% }) %> </div> <div class=row> <% _.map(model.secondRowIconNameToPageName, function(pageName, iconName) { %> <div class="icon col <%=iconName.toLowerCase()%> <%= iconName === \'Admin\' ? \'col-xs-offset-3\' : \'\'%> col-xs-3" data-page-name="<%=pageName%>" data-icon-name="<%=iconName%>"> <div class="thumbnail product-icon-button"> <div class="dg_section-nav-image <%=iconName.toLowerCase() + \'-image\'%>"></div> <div class=dg_section-nav-title><%=iconName%></div> </div> </div> <% }) %> </div> </div> <div class=home-component-popover-container></div> </div> '},function(e,t){e.exports="<tr class=custom-field-row> <td class=left-dropdown-container>Account Field</td> <td class=right-dropdown-container>Lead Field</td> <td><span class=delete-custom-row style=cursor:pointer><img style=width:20px;height:20px;cursor:pointer src=#RESOURCEURL#/images/Delete_Icon.png /></span></td> </tr>"},function(e,t){e.exports=' <% _.each(standard_fields, function(field, idx) { %> <tr style=color:#1abc9c> <td style=color:#1abc9c><%= field.accountField["label"] %></td> <td style=color:#1abc9c><%= field.leadField["label"] %></td> <td></td> </tr> <% }); %> <% _.each(custom_fields, function(field, idx) { %> <tr class=custom-field-row> <td class=account-field-label data-value="<%= field.accountField[\'value\'] %>"><%= field.accountField["label"] %></td> <td class=lead-field-label data-value="<%= field.leadField[\'value\'] %>"><%= field.leadField["label"] %></td> <td><span class=delete-row style=cursor:pointer><img style=width:20px;height:20px src=#RESOURCEURL#/images/Delete_Icon.png /></span> </td> </tr> <% }); %> '},function(e,t){e.exports='<div class="ld-header-wrapper ld-header-wrapper-margins" style=margin-bottom:0> <div class=ld-header>Advanced Settings</div> <div class=ld-subheader>Mapped Account Fields</div> </div> <div class=dg-inner-wrapper-content style=margin:25px> <div class=dg_error-message-div /> <div class=dg_details-table-div> <table> <thead> <tr> <th style=width:45%>Account Field</th> <th style=width:45%>Lead Field</th> <th style=width:10%>Delete</th> </tr> </thead> <tbody id=mapped_account_fields> </tbody> </table> </div> <div style=margin-left:55px;margin-top:50px;margin-bottom:20px> <div><span style=cursor:pointer class=add-new-row><img style=width:20px;height:20px src=#RESOURCEURL#/images/Add_Icon_Unselected.png />&nbsp;&nbsp;Create New</span></div> </div> <div class=dg_centeredfooter style=margin-bottom:100px> <span class="ld-primary-large-button ok requiresReadWrite disabled" style=margin-right:10px id=save_button> Save </span> <span class="ld-primary-large-button ok requiresReadWrite" style=margin-left:10px;display:none id=sync_button> Sync </span> </div> </div>'},function(e,t){e.exports='<div class="ld-header-wrapper ld-header-wrapper-margins" style=margin-bottom:0> <div class=ld-header>Match Settings </div> <div id=match-settings-header-info> These settings determine how matched objects are selected, prioritized, or updated. </div> </div> <div id=domain-matching-section class="dm-section match-settings-section"> <div class=ld-section>Domain Matching</div> <div class=match-settings-info>Include all records where domains match (warning, this may pull in low quality match results)</div> <div class=match-settings-content> <div class=setting-switch> <span class=switch-label>Include Domain Matches</span> <div class=ld-toggle-group-large> <div class="toggle-group-button domain-matching-switch button-off">OFF</div> <div class="toggle-group-button domain-matching-switch button-on">ON</div> </div> </div> <div class=setting-options> <div class=options> <input id=alwaysON class="styledInput domain-matching-option" type=radio name=matchingOptions value=alwaysON /> <label for=alwaysON class=requiresReadWrite>Always Include</label><br> </div> <div class=options> <input id=fallbackON class="styledInput domain-matching-option" type=radio name=matchingOptions value=fallbackON /> <label for=fallbackON class=requiresReadWrite>Fallback Only (Include ONLY IF no other matches are found)</label> </div> </div> </div> </div> <div id=preserve-manual-updates-section class="pmu-section match-settings-section"> <div class=ld-section>Preserve Manual Updates</div> <div class=match-settings-info>Preserve manual updates of the LeanData Reporting Matched Account lead field (Reporting_Matched_Account__c).</div> <div class=match-settings-content> <div class=setting-switch> <span class=switch-label>Continuous Matching</span> <div class=ld-toggle-group-large> <div class="toggle-group-button pmu-continuous-switch button-off">OFF</div> <div class="toggle-group-button pmu-continuous-switch button-on">ON</div> </div> <div class=match-settings-info> Preserve manually entered values in the Reporting Matched Account lead lookup field (LeanData matching will not overwrite manually entered values) </div> </div> <div class=setting-switch> <span class=switch-label>One-Time Matching</span> <div class=ld-toggle-group-large> <div class="toggle-group-button pmu-1x-switch button-off">OFF</div> <div class="toggle-group-button pmu-1x-switch button-on">ON</div> </div> <div class=match-settings-info> Preserve manually entered values in the Reporting Matched Account lead lookup field (LeanData matching will not overwrite manually entered values for one-time match jobs) </div> </div> </div> </div> <div id=matched-objects-limit-section class="mol-section match-settings-section"> <div class=ld-section>Routing Match Limits</div> <div class=match-settings-info>Specify the number of matched records to return in LeanData Routing. 1,000 or fewer matched records are recommended to improve overall system performance</div> <div class=match-settings-content></div> </div> <div class=toast style=display:none></div> '},function(e,t){e.exports='<div class="row match-limit-settings-row"> <div class="col col-xs-2 text-right object-name object-name-label">Matched <%=pluralize(objectType)%></div> <div class="col col-xs-3 limit-column"><span class=limit-label>Return the first</span> <input type=number max=10000 class="limit-number-input ld-default-input" name=limit-number-input data-object-type="<%=objectType%>" value="<%=settings[\'limit\']%>"/> </div> <div class="col col-xs-3 sort-label">matched <span class="object-name-label text-lowercase"> <%=pluralize(objectType)%></span> sorted by </div> <div class="col col-xs-4 sort-fields"></div> </div>'},function(e,t){e.exports='<div class="criteria-table-header header-font"> <div class=drag-column></div> <div class=edge-label-column> Lead Segment Name</div> <div class=decision-criteria-column> Segment\'s Condition</div> <div class=next-node-column> Tiebreakers Set</div> <div class=delete-column></div> </div> <ul class="criteria-sortable criteria-list list-unstyled" style=list-style-type:none;margin:0> <% _.each(edges, function(edge, idx) { %> <li class="criteria-list-item <%= edge[\'type\'] === \'default\' ? \'criteria-list-default\' : \'\' %> <%= \'criteria-type-\'+ edge[\'type\'] %>" data-criteria-number="<%= idx %>"> <div style=background-color:#ccc;width:100%;height:1px;margin-top:-1px;background-clip:content-box> </div> <div class="criteria-table-row <%= (!trueFalseNode && Magellan.Models.criterionEmpty(edge)) ? \'empty\' : (Magellan.Models.criterionInvalid(edge) ? \'invalid\' : \'\') %>"> <div class=drag-column> <% if (edge["type"] !== "default") { %> <img class=grab src=#RESOURCEURL#/images/Directional_Arrow.png> <% } %> </div> <div class=edge-label-column> <div style=padding-right:23px> <input class="ld-input-component edge-name-input" value="<%=edge[\'name\']%>" data-criteria-number="<%= idx %>"/> </div> </div> <div class="decision-criteria-column edit-icon-div" style=cursor:pointer data-criteria-number="<%= idx %>"> <div> <div class=decision-criteria-text> <%= formattedConditionTextTemplate({\n                        criterion: edge,\n                        trueFalseNode: trueFalseNode,\n                        getFieldLabel: getFieldLabel,\n                        getOperandFieldLabel: getOperandFieldLabel,\n                        getOperandValueLabel: getOperandValueLabel\n                        }) %> <img class="warning-sign <%=validateEdge(edge) || edge.isNew ? \'hidden\' : \'\'%>" src=#RESOURCEURL#/images/Triangle_Error_Icon_form.png width=15px /> </div> <a class=empty-criteria-label>Edit condition</a> <% if(edge["description"] && edge["description"].length > 0) { %> <div class=criteria-description-text style=margin-left:20px;margin-right:4px><%=\n                        edge["description"] %> </div> <% } %> </div> </div> <% var chosenNode, dropdownClass, chooserId = "node-chooser-" + idx; %> <% if(edge["target"] == null) { %> <% chosenNode = "None"; %> <% dropdownClass = "node-chosen-none"; %> <% } else if(edge["target"] == -1) { %> <% chosenNode = "END OF FLOW"; %> <% dropdownClass = "node-chosen-end"; %> <% } else { %> <% chosenNode = edge["target"]; %> <% dropdownClass = ""; %> <% } %> <div class=edit-tiebreaker-set-column> <a class=edit-tiebreaker-set href=javascript:void(0);> <span class="tiebreaker-set-name <%= edge[\'tiebreakerSetKey\'] ? \'\' : \'empty-tiebreaker-set\'%>"> <%= (edge[\'tiebreakerSetKey\'] || \'NOT SET\') %> </span> </a> <div class=matching-tagging-disabled>Matching/Tagging Disabled</div> <img class="warning-sign hidden" src=#RESOURCEURL#/images/Triangle_Error_Icon_form.png width=15px style=margin-left:5px /> </div> <div class="delete-column <%= edge[\'type\'] !== \'default\' && edges.length !== 1 ? \'minus-icon-div\' : \'\' %>" data-criteria-number="<%= idx %>"></div> </div> <div style=background-color:#ccc;width:100%;height:1px;background-clip:content-box></div> <div class=conditions-edit-partial-wrapper data-criteria-number="<%= idx %>"></div> </li> <% }); %> </ul> <div class="add-rule-container new-rule-container" style=margin-top:10px> <div class=add-rule-row-item> <div class="add-rule-div rule-type" data-rule-type=conditions></div> <div class=header-font>New Lead Segment</div> <div class=empty-row-space></div> </div> </div> '},function(e,t){e.exports='<div class=ld-header-bottom-margin> <div class="ld-header ld-header-bottom-margin">Tagging Tie Breakers</div> </div> <div class=ld-section style=margin-top:20px>Lead-to-Account Tagging Settings</div> <div class="tagging-header-setting-row tagging-setting-main-description row"> <div class=tagging-setting-description> <span>These settings control your continuous, on-going lead-account matches within your Salesforce system. Once enabled, LeanData Matching automatically finds and updates the best lead-account matches. Matching also copies matched account fields to leads as specified in Mapped Account Fields.</span> </div> </div> <div class="tagging-switch switch-container tagging-header-setting-row row"> <div class=tagging-switch-image-wrapper> <span class=switch-label>Lead-to-Account Matching</span> <div class=ld-toggle-group-large> <div class="toggle-group-button tagging-switch-button-off">OFF</div> <div class="toggle-group-button tagging-switch-button-on">ON</div> </div> </div> <div class="tagging-switch-description-wrapper tagging-setting-description"> <span>Enable / disable lead-to-account matching within your Salesforce system. Matching occurs when match relevant changes occur. If Matching is turned off, no match updates will be detected or made within your system. Existing records will need to be matched via a one time run (Settings --\x3e Matching --\x3e One-Time Lead2Account Matching).</span> </div> </div> <div class="tagging-multi-tiebreaker-toggle switch-container last-switch-container tagging-header-setting-row row <%= enableMultiTiebreakers ? \'enable-multiple-tiebreakers\' : \'disable-multiple-tiebreakers\' %>"> <div> <span class=switch-label>Multiple Tie-Breakers</span> <div class="ld-toggle-group-large multi-tiebreaker-toggle"> <div class="toggle-group-button toggle-single">OFF</div> <div class="toggle-group-button toggle-multiple">ON</div> </div> <div class="upsell-wide-badge upsell-button" data-feature="matching multi-tiebreakers on" onclick=\'dashboardController.showPackagingPopup(this,"upsell")\'>UPGRADE</div> </div> <div class="tagging-multi-tiebreaker-sets-toggle tagging-setting-description"> <span class=description-text>Toggle this setting to use single (default) or multiple tiebreaker sets for match prioritization.</span> </div> </div> <div id=tagging-settings-main> <div class="tagging-settings-content-wrapper tagging-default-tiebreakers-wrapper"> <div class="ld-section ld-header-wrapper">Matched Account Tie-Break Prioritization Rules</div> <div class="dg-inner-wrapper-content tagging-settings"> <div class=header-font style=display:inline-block>Prioritize Matched Accounts</div> <div style=margin-bottom:8px>Specify the best matched account in cases where LeanData finds multiple matched accounts for a lead. Matched accounts will go through the tie-breaking rules until a single account is selected. </div> <div id=single-set-tiebreakers class=criteria-list-partial> </div> <hr style=border-color:#ccc /> <div class="advanced-settings-view collapsible-outer-container"> <div class="collapsible-section-header header-font">Advanced Settings</div> <div class=collapsible-section> <label class=cb-container-small></label> <div id=account-filter-wrapper></div> </div> </div> <div class=button-div style="margin:20px 0;text-align:center"> <div class="ld-tertiary-large-button main-btn cancel" style=margin-right:4px>Cancel</div> <div class="ld-tertiary-large-button single-tiebreaker-set restore-defaults" style=margin-left:4px>Defaults</div> <div class="ld-primary-large-button main-btn ok" style=margin-left:4px>Save Settings</div> </div> </div> </div> <div class="tagging-settings-content-wrapper tagging-multi-tiebreakers-wrapper"> <div class="ld-section ld-header-wrapper">Multiple Tie-Breaker Rule Sets by Leads Segmentation</div> <div class="dg-inner-wrapper-content tagging-settings"> <div class=header-font style=display:inline-block>Prioritize Matched Accounts</div> <div class=tagging-setting-description style=margin-bottom:8px>Specify the best matched account in cases where LeanData finds multiple matched accounts for a lead. Matched accounts will go through the tie-breaking rules until a single account is selected. </div> <div id=multi-tiebreaker-lead-segments class=criteria-list-partial> </div> <div class=button-div style="margin:20px 0;text-align:center"> <div class="ld-tertiary-large-button main-btn cancel" style=margin-right:4px>Cancel</div> <div class="ld-primary-large-button main-btn ok" style=margin-left:4px>Save Settings</div> </div> </div> <div id=tagging-tiebreaker-set-editor-panel class="ld-panel ld-panel-left"></div> </div> </div> '},function(e,t){e.exports='<div class=ld-panel-heading> <br/> <div class=tiebreaker-set-name-wrapper> <div class=form-group> <label class=ld-field-label-large style=margin-right:10px>Name:</label> <input class=ld-input-small style=width:600px type=text value="<%=model.name%>" name=tiebreaker-set-name maxlength=100 /> <span class="tiebreaker-set-name-error ld-text-danger help-block"></span> </div> </div> <hr/> <div class=header-font style=display:inline-block>Prioritize Matched Accounts</div> <div style=margin-bottom:8px>Specify the best matched account in cases where LeanData finds multiple matched accounts for a lead. Matched accounts will go through the tie-breaking rules until a single account is selected. </div> </div> <div class=ld-panel-body> <div class="tiebreaker-editor-el filter-wrapper"></div> <div class="tiebreaker-editor-el criteria-list-partial <%= leadSegment.disabled ? \'disableContainer\' : \'\' %>"></div> <div class="tiebreaker-editor-el advanced-settings-view collapsible-outer-container"> <div class="collapsible-section-header header-font">Advanced Settings</div> <div class=collapsible-section style=padding-left:25px> <div class=disable-matching-tagging-container style=height:50px;margin-top:-10px> <span class="header-font has-object-label"> Matching/Tagging </span> <div class="ld-toggle-group-large disable-matching-tagging-toggle" style=margin-left:30px> <div class="toggle-group-button matching-tagging-switch-button-off">OFF</div> <div class="toggle-group-button matching-tagging-switch-button-on">ON</div> </div>  <div class=has-object-label style=margin-top:15px> Turns off matching and tagging for a particular lead segment. This functionality is primarily utilized when a database has a large set of leads and an organization would only like to match / tag a subset. Consult your LeanData team with any questions</div> </div> <label id=enable-account-filtering-container style=font-size:11px;margin-top:35px class="filter-div <%= leadSegment.disabled ? \'disableContainer\' : \'\' %>"> </label> </div> </div> </div> <ul class=ld-panel-footer> <div class=button-div style="margin:20px 0;text-align:center"> <div class="ld-button tiebreaker-set-editor-btn cancel" style=margin-right:4px>Cancel</div> <div class="ld-button tiebreaker-set-editor-btn restore-defaults" style=margin-left:4px>Defaults</div> <div class="ld-button tiebreaker-set-editor-btn ok" style=margin-left:4px>OK</div> </div>  </ul>'},function(e,t){e.exports='<div class=partner-apps-wrapper> <div class=breadCrumbContainer> <span class="ld-breadcrumb static" id=return-to-partner-apps>Partner Apps</span> <div class=crumbArrow> &gt; </div> <span class="ld-breadcrumb disabled"><%= model.selectedPartnerName %></span> </div> <div class=ld-header-wrapper-margins> <div class="ld-header ld-header-bottom-margin">Partner Apps</div> </div> <% if (!dashboardController.viewObject.featureProvisioning[\'integrations enabled\'] || dashboardController.viewObject.featureProvisioning[\'integrations enabled\'] === \'0\') { %> <div class="messaging-section ld-body-large" style="padding:10px 20px;margin-bottom:20px"> <span>Contact us today to take advantage of Partner Apps!</span> <a href=mailto:support@leandatainc.com target=_blank style=margin-left:10px> <div class=ld-primary-small-button>Contact Us</div> </a> </div> <% } else { %> <div class="messaging-section ld-body-large" style="padding:10px 20px;margin-bottom:20px"> <span> Welcome to LeanData Partner Apps! Access to Partner Integrations is free until the end of contract. Contact your CSM for details. </span> </div> <% } %> <div class="ld-body-large partner-apps-summary"> LeanData makes it easier than ever to automate actions throughout your Technology Stack. The available integrations will empower you with a new set of functionality that streamlines common workflows. With FlowBuilder Integrations, you can now initiate actions in Partner tools backed by the power of LeanData and simplified with the ease of FlowBuilder. Please reach out to <a href=mailto:integrations@leandatainc.com> integrations@leandatainc.com </a> with any questions. </div> <div class=partner-apps-content></div> </div> '},function(e,t){e.exports='<div class=partner-app-header-config-wrapper> <div class="<%= model.partnerName.toLowerCase() %>-icon"></div> <div class="partner-app-header-config ld-body-large"> <div class="partner-name ld-subheader"><%= model.partnerName %></div> <%= model.summary %> </div> </div> <div class="config-instructions-wrapper partner-instructions-panel"> </div> <div class="config-settings-wrapper partner-config-panel"> <div class=ld-section-header><%= model.partnerName %> Settings</div> <div class=authorization-section> <div class=ld-body-large-bold><%= model.partnerName %> Authorization</div> <div> <div class="auth-input-label ld-body-large-bold">Application ID</div> <input class=ld-input-large id=app-id-input placeholder="e.g. 1abc2d34efg56h7i89j101112kl3mn145..."/> </div> <div> <div class="auth-input-label ld-body-large-bold">Client Secret</div> <input type=password class=ld-input-large id=client-secret-input placeholder="e.g. 23a3b4567c8de9f1ghi11jklmn121314o..."/> </div> </div> <% if (model.mappingFields.length > 0) { %> <div class=field-mapping-section> <div class=ld-body-large-bold><%= model.partnerName %> Field Mapping</div> <div style="margin:10px 0;display:flex"> <div class=auth-column-label style=width:300px>Salesforce Field</div> <div class=auth-column-label style=flex:1><%= model.partnerName %> Field</div> </div> <div class=partner-apps-field-mapping-row> <div class=partner-apps-salesforce-field-column> <div class=field-mapping-label>Lead Field</div> <div id=leadProspectIdField-field-dropdown class=field-mapping-dropdown> <div class=ld-dropdown-large></div> </div> </div> <div class=mapping-arrow>→</div> <div class=partner-apps-partner-field-column>Id (Outreach Internal)</div> </div> <div class=partner-apps-field-mapping-row> <div class=partner-apps-salesforce-field-column> <div class=field-mapping-label>Contact Field</div> <div id=contactProspectIdField-field-dropdown class=field-mapping-dropdown> <div class=ld-dropdown-large></div> </div> </div> <div class=mapping-arrow>→</div> <div class=partner-apps-partner-field-column>Id (Outreach Internal)</div> </div> <div class=partner-apps-field-mapping-row> <div class=partner-apps-salesforce-field-column> <div class=field-mapping-label>User Field</div> <div id=userIdField-field-dropdown class=field-mapping-dropdown> <div class=ld-dropdown-large></div> </div> </div> <div class=mapping-arrow>→</div> <div class=partner-apps-partner-field-column>Id (Outreach Internal)</div> </div> <div class=confirmation-section> <label class=cb-container-large> <span class="toggleText ld-body-large"> Confirm Pushing and Outbound Update are enabled on the Lead, Contact and User settings of your Outreach Salesforce Plugin. </span> <input type=checkbox id=confirm-config-checkbox /> <span class=checkmark></span> </label> </div> </div> <% } %> <div class=retry-section style=align-items:center;display:flex;margin-bottom:30px> <div class=ld-body-large-bold>Retry Action in</div> <div style=margin-left:10px> <input class=ld-input-large id=retry-time-input type=number min=0> <div id=retry-time-unit-dropdown> <div class=ld-dropdown-large></div> </div> </div> </div> <div class=center-button-wrapper> <div class="ld-primary-large-button disabled" id=authorize-update-button> <%= !model.isAuthorized ? \'Authorize \' + model.partnerName : \'Update Settings\'  %> </div> </div> </div> '},function(e,t){e.exports="<div class=ld-section-header>Get Started!</div> <div class=ld-body-large> Please have the Outreach and Salesforce Administrator complete the instructions outlined below. </div> <div class=ld-section-header>Instructions</div> <div class=ld-body-large-bold>Authorization</div> <div class=ld-body-large> <ol> <li> Provide the Callback URL (<%= params.partnerData.callbackUrl %>) to platform@outreach.io and request the Application ID and Client Secret. </li> <li> Once you've received the Application ID and Secret, enter them in the form to the right. </li> </ol> </div> <div class=ld-body-large-bold>Implementation Steps</div> <div class=ld-body-large> This <a href=https://leandatahelp.zendesk.com/hc/en-us/articles/360019138933-Routing-LeanData-Outreach-Flowbuilder-Integration>Self-Serve Guide</a> walks through each step in detail. </div> <div class=ld-body-large> <ol> <li> <div> Authorize Outreach with LeanData </div> </li> <li> <div> Enable Outreach-Salesforce Sync <em>(can be completed in parallel with step 1)</em> </div> <ul> <li> Field Creation and Updates Out </li> </ul> </li> <li> Select a Retry Action Time Interval </li> <li> Set Node Conditions </li> <li> Add Node(s) to the Graph </li> <li> Review Edge options </li> </ol> <div> Please review and complete the instructions in the <a href=https://leandatahelp.zendesk.com/hc/en-us/articles/360019138933-Routing-LeanData-Outreach-Flowbuilder-Integration>Self-Serve Guide</a> to set up the integration. Reach out to <a href=mailto:support@leandatainc.com>support@leandatainc.com</a> with any questions. </div> </div> "},function(e,t){e.exports="<div class=ld-section-header>Get Started!</div> <div class=ld-body-large> Please have the SalesLoft Administrator complete the instructions outlined below. </div> <div class=ld-section-header>Instructions</div> <div class=ld-body-large-bold>Authorization</div> <div class=ld-body-large> <ol> <li> To authorize, please create an app here (<a href=https://accounts.salesloft.com/oauth/applications/new> https://accounts.salesloft.com/oauth/applications/new </a>) with this Redirect URI (<%= params.partnerData.callbackUrl %>). For the name, please enter “LeanData” along with the name of your company. This naming convention assists SalesLoft with troubleshooting any issues. </li> <li> SalesLoft will then provide a Client ID and Client Secret. </li> <li> Return to this page, populate the Application ID (Client ID) and Client Secret, and submit the form to authorize LeanData access to SalesLoft. </li> </ol> </div> <div class=ld-body-large-bold>Implementation Steps</div> <div class=ld-body-large> <div>This <a href=https://leandatahelp.zendesk.com/hc/en-us/articles/360018979474-Routing-LeanData-SalesLoft-Flowbuilder-Integration>Self-Serve Guide</a> walks through each step in detail.</div> <ol> <li> Enter the Retry Action time interval. This time interval determines when we will retry initiating an action in SalesLoft after a failure. </li> <ul> <li> An example of failure is when LeanData cannot find the CRM ID on the SalesLoft record; hence, we recommend aligning this interval to your Salesforce-SalesLoft Sync settings. </li> <li> You can change this value to as small as 1 minute. </li> <li> Note that there is a limit to the amount of retries we will initiate. Once that limit is reached, the action will fail indefinitely. </li> </ul> <li>Add Node(s) to the Graph</li> <li>Review Edge options</li> </ol> <div> Please review the <a href=https://leandatahelp.zendesk.com/hc/en-us/articles/360018979474-Routing-LeanData-SalesLoft-Flowbuilder-Integration>Self-Serve Guide</a> to understand how this integration impacts FlowBuilder, Audit Logs, and Routing Insights. Reach out to <a href=mailto:support@leandatainc.com>support@leandatainc.com</a> with any questions. </div> </div> "},function(e,t){e.exports='<div class=partner-card-wrapper> <div class="<%= model.partnerName.toLowerCase() %>-icon"></div> <% if (!model.isAuthorized) { %> <div class="partner-content ld-body-large"> <div class="partner-name ld-section-header"><%= model.partnerName %></div> <div style=margin-bottom:10px> <%= model.summary %> </div> <div> <div id=learn-more class=ld-link style=color:#000> Learn More </div> </div> </div> <% } else { %> <div class=partner-content> <div class="partner-name ld-section-header"><%= model.partnerName %></div> <div class=ld-body-large> <div>Authorized</div> <div><%= model.authorizedDate %></div> <div><%= model.authorizedBy %></div> <div class="ld-body-large ld-link" id=disable-authorization style=margin-top:10px> Disable Authorization </div> </div> <% } %> <div class=center-button-wrapper> <% if (!Magellan.Models.Provisioning.isPartnerEnabled(model.partnerName.toLowerCase())) { %> <div class="ld-secondary-small-button action-button disabled" style=color:#b3b3b3;background-color:#e6e6e6> <%= \'Authorize \' + model.partnerName %> </div> <% } else { %> <div class="ld-secondary-small-button action-button <%= model.partnerName%>" data-partnername="<%= model.partnerName %>"> <%= model.isAuthorized ? \'Update Settings\' : \'Authorize \' + model.partnerName %> </div> <% } %> </div> </div> </div>'},function(e,t){e.exports='<div class=routing-metrics-wrapper> <div class=ld-header-wrapper-margins> <div class="ld-header ld-header-bottom-margin">Routing Usage Dashboard</div> </div> <div class=line-graph-tab-wrapper></div> <div class=line-graph-control-wrapper></div> <div class=line-graph-wrapper></div> <div class=routing-metrics-table-wrapper></div> </div> '},function(e,t){e.exports="<div id=control-container style=display:block> <span id=export-routing-usage-btn class=ld-secondary-small-button style=line-height:2>Export Routing Usage</span> <div class=query-options-container> <div class=hide-inactive-users-container> <label class=\"cb-container-small ld-field-label-small\"> <span>Hide Inactive Users</span> <input id=hide-inactive-users class=hide-inactive-users-checkbox type=checkbox data-id=all <%= model.hideInactiveUsers ? 'checked' : '' %> /> <span class=checkmark></span> </label> </div> <div class=start-date-container> <input id=start-datepicker class=dg_date-input value=\"<%= queryStartDate || '' %>\" data-field-name=queryStartDate /> <label class=ld-date-label for=start-datepicker></label> </div> <label class=date-text>to</label> <div class=end-date-container> <input id=end-datepicker class=dg_date-input value=\"<%= queryEndDate || '' %>\" data-field-name=queryEndDate /> <label class=ld-date-label for=end-datepicker></label> </div> </div> </div> "},function(e,t){e.exports="<div class=table-div> <table class=ld-table id=graph-table> <thead> <% if (model.routingList.length == 0 && model.selectedPoint) { %> <div class=ld-table-filter-info style=position:static> </div> <% } %> <tr> <th class=ld-th>User Name</th> <th class=ld-th>SFDC ID</th> <th class=ld-th>Status</th> <th class=ld-th>Role</th> <th class=ld-th>Profile</th> <th class=ld-th>Records Routed</th> </tr> </thead> <tbody> <% if (model.routingList.length > 0) { %> <% model.routingList.filter(routingInfo => routingInfo.Count[model.selectedTab] > 0).forEach(function(routingInfo) { %> <tr> <td><%= routingInfo.Name %></td> <td><%= routingInfo.Id %></td> <td><%= routingInfo.Status %></td> <td><%= routingInfo.Role %></td> <td><%= routingInfo.Profile %></td> <td><%= routingInfo.Count[model.selectedTab] %></td> </tr> <% }); %> <% } else { %> <tr class=no-data-row> <td colspan=6>No Routing Usage</td> </tr> <% } %> </tbody> </table> </div> "},function(e,t){e.exports='<div> <ul id=dangling-edge-list> <% _.each(edges, function(edge, idx) { %> <% if (!edge.target && edge.target !== 0 && edge.type !== \'system\') { %> <li data-edge-name="<%= edge.formattedName || edge.name %>" data-edge-idx="<%= idx %>"> <img src="<%= iconToURLMap[\'Unlinked Edge Icon\'] %>"/> <span> <%= edge.formattedName || edge.name %> </span> </li> <% } %> <% }); %> </ul> </div>'},function(e,t){e.exports='<div class=deployment-history-panel> <div class="ld-header-wrapper ld-header-wrapper-margins"> <div class="ld-header ld-header-bottom-margin">Deployment History</div> </div> <div class=deployment-history-filters> <div class=deployment-history-filters-left> <div class=checkbox-container style=margin-right:17.5px> <label class=cb-container-small> <span class=toggleText>Continuous</span> <input type=checkbox id=continuous-checkbox <%= (showContinuous ? "checked" : "")%>/> <span class=checkmark></span> </label> </div> <div class=checkbox-container style=margin-right:17.5px> <label class=cb-container-small> <span class=toggleText>One-Time</span> <input type=checkbox id=one-time-checkbox <%= (showOneTime ? "checked" : "")%>/> <span class=checkmark></span> </label> </div> </div> <% if(showContinuous) {  %> <div class=deployment-history-filters-right> <div class="checkbox-container hide-empty-checkbox-container" style=margin-left:17.5px> <label class=cb-container-small> <span class=toggleText>Hide Graphs with No <%= Magellan.Util.getPluralObjectName(LeanData__PrimarySObjectType) %> </span> <input type=checkbox id=hide-no-lead-graphs-checkbox <%= (hideEmpty ? "checked" : "")%>/> <span class=checkmark></span> </label> </div> </div> <% } %> </div> <table class=deployment-history-table> <thead> <tr> <th style=width:30px> </th> <th style=width:402px> Router Workflow <div class="sort_icon sort_asc_icon"/> <div class="sort_icon sort_desc_icon"/> <div class="sort_icon sort_both_icon"/> </th> <th style=width:200px> Date <div class="sort_icon sort_asc_icon"/> <div class="sort_icon sort_desc_icon"/> <div class="sort_icon sort_both_icon"/> </th> <th style=width:200px> Pending <%= Magellan.Util.getPluralObjectName(LeanData__PrimarySObjectType) %> <div class="sort_icon sort_asc_icon"/> <div class="sort_icon sort_desc_icon"/> <div class="sort_icon sort_both_icon"/> </th> <th style=width:50px> <% if (showContinuous) { %> <%= "New " + Magellan.Util.getPluralObjectName(LeanData__PrimarySObjectType) %> <div class="sort_icon sort_asc_icon"/> <div class="sort_icon sort_desc_icon"/> <div class="sort_icon sort_both_icon"/> <% } %> </th> <th style=width:50px> <% if (showContinuous) { %> <%= "Updated " + Magellan.Util.getPluralObjectName(LeanData__PrimarySObjectType) %> <div class="sort_icon sort_asc_icon"/> <div class="sort_icon sort_desc_icon"/> <div class="sort_icon sort_both_icon"/> <% } %> </th> <th style=width:50px> <%= "Total " + Magellan.Util.getPluralObjectName(LeanData__PrimarySObjectType) %> <div class="sort_icon sort_asc_icon"/> <div class="sort_icon sort_desc_icon"/> <div class="sort_icon sort_both_icon"/> </th> </tr> </thead> <tbody class=deployment-history-tbody> <% _.each(deployedGraphs, function(graph, i) { %> <tr class=deployment-row data-graph-id="<%= graph.id %>"> <td class=text-center></td> <td> <div class=deployment-name><%= graph.name %></div> <div class=deployment-deployer><%= graph.deploymentType === \'1x Routing\' ? \'Run\' : \'Deployed\' %> by&nbsp;<%= graph.createdBy %> </div> </td> <td> <div class=deployment-date><%= moment(graph.date).format("MM/DD/YYYY h:mm a") %></div> <% if (graph.deploymentType === \'1x Routing\') {%> <div class=deployment-duration>One-Time</div> <%} else {%> <div class=deployment-duration><%= getDeploymentDuration(graph) %></div> <%}%> </td> <td class=total-pending-ccios><%= graph.pendingCCIOs || 0 %></td> <td class=total-roi><%= graph.deploymentType === \'1x Routing\' ? \'\' : graph.totalROI %></td> <td class=total-rou><%= graph.deploymentType === \'1x Routing\' ? \'\' : graph.totalROU %></td> <td class=total-routed><%= (graph.totalROI || 0) + (graph.totalROU || 0) %></td> </tr> <% }); %> </tbody> </table> </div> '},function(e,t){e.exports='<div data-graph-id="<%= graph.id %>" id="<%= graph.id%>" class="sortable-panel chart-panel"> <ul class=icon-bar> <li id=deploy-icon class=icon-bar-item></li> <li id=edit-icon class=icon-bar-item></li> <li id=copy-icon class=icon-bar-item></li> <li id=delete-icon class=icon-bar-item></li> <li id=export-icon class=icon-bar-item></li> </ul> <div style=font-weight:500;line-height:15px><%= truncateExcess(graph.name) %></div> <div class=chart-thumbnail-container> <img class=chart-thumbnail src="<%= graph.image %>"/> </div> <div class=lower-text> <div style=font-weight:500>Last Modified</div> <br> <%= moment(graph.lastModifiedDate).format("MM/DD/YYYY") %> – <%= graph.lastModifiedBy %> </div> </div>'},function(e,t){e.exports='<div> <div class="ld-header-wrapper ld-header-wrapper-top-margin"> <div class=ld-header><%= capitalizedObjectType %></div> <div class=ld-subheader> FlowBuilder <div id=importGraphDiv style=float:right;font-size:12px;cursor:pointer> <input type=file id=importSelectGraph style=display:none> <span onclick=\'document.getElementById("importSelectGraph").click()\'>Import Flow</span> </div> </div> </div> </div> <div class=dg-inner-wrapper-content> <div style=overflow:hidden;padding-bottom:30px;padding-left:3px> <div class=routing-graphs></div> </div> </div> '},function(e,t){e.exports='<div data-graph-id="<%= graph.id %>" id="<%= graph.id%>" class="chart-panel live-graph"> <img class=chart-panel-live src="<%= resourceURL + \'/images/Deploy_Live_Icon.png\' %>"/> <ul class=icon-bar style=margin-top:25px> <li id=edit-icon class=icon-bar-item></li> <li id=copy-icon class=icon-bar-item></li> <li id=export-icon class=icon-bar-item></li> </ul> <div style="font-weight:500;line-height:15px;width:300px;margin:0 auto"><%= truncateExcess(graph.name) %></div> <div class=chart-thumbnail-container> <img class=chart-thumbnail src="<%= graph.image %>"/> </div> <div class=validation-errors-modal-icon style="left:7px;bottom:7px;position:absolute;display:<%= graph.isValid ? \'none\' : \'block\' %>"></div> <div class=lower-text-live-container> <div class=lower-text-live-left> <div style=font-weight:500>Last Modified</div> <br> <%= moment(graph.lastModifiedDate).format("MM/DD/YYYY") %> – <%= graph.lastModifiedBy %> </div> <div class=lower-text-live-right> <div style=font-weight:500>Last Deployed</div> <br> <%= moment(graph.lastDeployedDate).format("MM/DD/YYYY") %> </div> </div> </div> '},function(e,t){e.exports='<table id=logs-table class="table table-striped sticky"> <thead class=table-header> <tr class=log-table-header> <th> <span><%= objectType.toUpperCase() %></span> </th> <th> <span>ACTION</span> </th> <th> <span>PATH</span> </th> </tr> </thead> <tbody class=table-body> <% _.each(logs, function(log, logIndex) { %> <% try { %> <tr> <td data-name=Lead class=flowbuilder-logs-table-data> <% _.each(objectParameters, function(objectParameter) { %> <div> <span class=blue-parameter-font> <%= _.capitalize(objectParameter) %>: </span> <% var objectParameterValue = log.attributes[objectParameter]; %> <% if (objectParameter === \'name\') { %> <a target=_blank href="<%= sobjLinkPrefix + log.attributes.id %>"> <span class=black-parameter-font style=text-decoration:underline> <%= objectParameterValue %> </span> </a> <% } else { %> <span class=black-parameter-font> <%= objectParameterValue %> </span> <% } %> </div> <% }); %> <% if (railsPage) { %> <div> <span class=blue-parameter-font> CCIO Created At: </span> <span class=black-parameter-font> <%= logsFormatDate(log["ccio created at"]) %> </span> </div> <div> <span class=blue-parameter-font> CCIO Processed At: </span> <span class=black-parameter-font> <%= logsFormatDate(log["completed at"]) %> </span> </div> <% }  else { %> <div> <span class=blue-parameter-font> Processed At: </span> <span class=black-parameter-font> <%= logsFormatDate(log["processed at"]) %> </span> </div> <% } %> <% if(log[\'graph id\'] !== \'tagging deployment\'){ %> <div> <% if(log[\'ccio type\'] === \'LiveRoutingInsert\' || log[\'ccio type\'] === \'LiveRoutingUpdate\') { %> <span class=blue-parameter-font> Live Routing Rules: </span> <a target=_blank href="/<%= \'apex/\' + ns + \'Dashboard#routing/round_robin_live_routing\' %>"> <span class=black-parameter-font style=text-decoration:underline>View Conditions</span> </a> <% } else { %> <span class=blue-parameter-font> Routing Deployment: </span> <a target=_blank href="/<%= \'apex/\' + ns + \'Dashboard#routing/\' + log[\'sobject type\'].toLowerCase() + \'/insights/\' + log[\'graph id\'] %>"> <span class=black-parameter-font style=text-decoration:underline><%= log["graph id"] %></span> </a> <% if(log[\'ccio type\'] === \'RoutingOnly\'){ %> <span class=black-parameter-font> (One-Time)</span> <% } %> <% } %> </div> <% } %> <div class=collapse-group> <div class=collapse-clickable style=cursor:pointer;font-weight:bolder> <br/> <span class=black-parameter-font>More Info </span> <span class=expand-glyph></span> </div> <div class=collapse-toggleable> <ul class=optional-keys-ul style=list-style:none> <% _.each(hiddenKeys, function(hiddenKey) { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> <%= hiddenKey %>: </span> <span class=black-parameter-font> <% var hiddenValue = log.attributes[hiddenKey]; %> <% var isDateValue = isValidDate(hiddenValue); %> <% if (isDateValue) { %> <%= hiddenValue ? logsFormatDate(hiddenValue) : "" %> <% } else { %> <%= hiddenValue || "" %> <% } %> </span> </li> <% }); %> <% var eHiddenKeys = extraHiddenKeys(log); %> <% _.each(eHiddenKeys, function(extraHiddenKey) { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> <%= extraHiddenKey %>: </span> <span class=black-parameter-font> <% var extraHiddenValue = log.attributes[extraHiddenKey]; %> <% var isDateValue = isValidDate(extraHiddenValue); %> <% if (isDateValue) { %> <%= extraHiddenValue ? logsFormatDate(extraHiddenValue) : "" %> <% } else { %> <%= extraHiddenValue || "" %> <% } %> </span> </li> <% }); %> </ul> </div> </div> </td> <td data-name=Action class=flowbuilder-logs-table-data> <div> <% var errorKeys = ["convert error", "merge error", "update error", "fallback error", "email notification error"]; %> <% var oldErrorKeys = ["error", "convert_error"]; %> <% var error = _.reduce(_.union(errorKeys, oldErrorKeys), function(error, errorKey) { return !_.isEmpty(error) ? error : (!_.isEmpty(log[errorKey]) ? log[errorKey] : null); }, null); %> <% var routingMessageAndFontClass = formatRoutingAction(log); %> <% var routingAction = routingMessageAndFontClass.message; %> <% var fontClass = routingMessageAndFontClass.fontClass; %> <span class="<%= fontClass %>"> <%= routingAction %> </span> </div> <% if (error) { %> <div style=line-height:12px> <span class=red-parameter-font> <%= error %> </span> </div> <% } %>  <% if (!taggingPreviewPage) { %> <% var triggeringAction = log["ccio type"]; %> <% if (triggeringAction.toLowerCase().includes("insert")) { %> <% triggeringAction = "Insert"; %> <% } else if (triggeringAction.toLowerCase().includes("update")) { %> <% triggeringAction = "Update"; %> <% } else if (triggeringAction.toLowerCase().includes("routingonly")) { %> <% triggeringAction = "One-Time Routing"; %> <% } else if (triggeringAction.toLowerCase().includes("routingscheduled")) {%> <% triggeringAction = "Time-based"; %> <% } %> <div> <span class=blue-parameter-font> Triggering Action: <%= triggeringAction %> </span> </div> <% } %>  <% if (!taggingPreviewPage && log["primary routing action"].toUpperCase() !== "MERGED" && (!(log["primary routing action"].toUpperCase().includes("ASSIGNED") && !log["primary routing action"].toUpperCase().includes("ROUTED")))) { %> <% var postOwnerString = \'Post-Owner:\'; %> <% if(log["conversion"]) postOwnerString = postOwnerString + \' (Contact)\'; %> <div> <span class=blue-parameter-font> <%= postOwnerString %> </span> <a target=_blank href="/<%= log[\'post-owner id\'] %>"> <span class=black-parameter-font style=text-decoration:underline> <%= log["post-owner name"] %> </span> </a> </div> <div> <span class=blue-parameter-font> Pre-Owner: </span> <a target=_blank href="/<%= log[\'pre-owner id\'] %>"> <span class=black-parameter-font style=text-decoration:underline> <%= log["pre-owner name"] %> </span> </a> </div> <% } %>  <% if (log[\'update account owner\'] != undefined) { %> <div> <span class=blue-parameter-font> New Account Owner: </span> <a target=_blank href="/<%= log[\'update account owner\'] %>"> <span class=black-parameter-font style=text-decoration:underline> <%= log["update account name"] || log[\'update account owner\'] %> </span> </a> </div> <div> <span class=blue-parameter-font> Previous Account Owner: </span> <a target=_blank href="/<%= log[\'pre-account owner id\'] %>"> <span class=black-parameter-font style=text-decoration:underline> <%= log["pre-account owner name"] %> </span> </a> </div> <% } %>  <% if (!taggingPreviewPage && log["primary routing action"].toUpperCase() !== "MERGED" && log["primary routing action"].toUpperCase().includes("ASSIGNED")) { %> <div> <span class=blue-parameter-font> New <%= log["assignment field label"] %>: </span> <a target=_blank href="/<%= log[\'assignment field new\'] %>"> <span class=black-parameter-font style=text-decoration:underline> <%= log["assignment field username"] %> </span> </a> </div> <div> <span class=blue-parameter-font> Previous <%= log["assignment field label"] %>: </span> <a target=_blank href="/<%= log[\'assignment field previous\'] %>"> <span class=black-parameter-font style=text-decoration:underline> <%= log["assignment field username previous"] %> </span> </a> </div> <% } %>  <% var matchedRecord = getMatchedRecordForLog(log, graphIdToNodeNameToNode); %> <% if (matchedRecord && matchedRecord["matched record id"]) { %> <hr class=dashed-border> <div> <span class=green-parameter-font> <%= matchedRecord["match type"].toUpperCase() %> - </span> <a target=_blank href="<%= sobjLinkPrefix + matchedRecord[\'matched record id\'] %>"> <span class=blue-parameter-font> <%= matchedRecord["name"] || matchedRecord["matched record id"] %> </span> </a> </div> <% } %>  <% if (matchedRecord && matchedRecord["matched record id"]) { %> <div class=collapse-group> <div class=collapse-clickable style=cursor:pointer;font-weight:bolder> <span class=black-parameter-font>More Info </span> <span class=expand-glyph></span> </div> <div class=collapse-toggleable> <ul class=optional-keys-ul style=list-style:none> <% _.each(getAttributesForMatchedRecord(matchedRecord["matched record"]), function(listItem) { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font><%= listItem[0] %>: </span> <span class=black-parameter-font><%= listItem[1] %></span> </li> <% }); %> </ul> </div> </div> <% } %> </td> <td data-name=Path class=flowbuilder-logs-table-data> <% var matchedObject; %> <% var matchedObjectType; %> <% if (!graphIdToNodeNameToNode[log["graph id"]]) return; %>  <% _.each(log.route, function(node, idx) { %> <% var fullNode = graphIdToNodeNameToNode[log["graph id"]][node.name]; %> <% var matchList, totalMatchedObjects; %> <% var matchTypeLabel; %> <% var nodeTypeLabel = fullNode.type %> <% if (fullNode.type === "MATCH") { %> <% if (fullNode.objectType === "Dupe") { %> <% matchList = log["dupe leads"]; totalMatchedObjects = log["total dupe leads"];%> <% matchTypeLabel = "Matched Duplicate Leads";%> <% nodeTypeLabel = "MATCH NODE - Dupe Leads"; %> <% } else if (fullNode.objectType === "DupeC") { %> <% matchList = log["dupe contacts"]; totalMatchedObjects = log["total dupe contacts"];%> <% matchTypeLabel = "Matched Duplicate Contacts";%> <% nodeTypeLabel = "MATCH NODE - Dupe Contacts"; %> <% } else if (fullNode.objectType === "L2A") { %> <% matchList = log["matched accounts"]; totalMatchedObjects = log["total matched accounts"]; %> <% matchTypeLabel = "Matched Accounts";%> <% nodeTypeLabel = "MATCH NODE - L2A"; %> <% } else if (fullNode.objectType === "L2L") { %> <% matchList = log["matched leads"]; totalMatchedObjects = log["total related leads"]; %> <% matchTypeLabel = "Matched Leads";%> <% nodeTypeLabel = "MATCH NODE - L2L"; %> <% } else if (fullNode.objectType === "L2O") { %> <% matchList = log["matched opportunities"]; %> <% matchTypeLabel = "Matched Opportunities";%> <% nodeTypeLabel = "MATCH NODE - L2O"; %> <% } else if (fullNode.objectType === "C2O") { %> <% matchList = log["matched opportunities"]; %> <% matchTypeLabel = "Account\'s Opportunities";%> <% nodeTypeLabel = "MATCH NODE - C2O"; %> <% } else if (fullNode.objectType === "C2C") { %> <% matchList = log["matched contacts"]; %> <% matchTypeLabel = "Account\'s Contacts";%> <% nodeTypeLabel = "MATCH NODE - C2C"; %> <% } else if(fullNode.objectType === \'A2O\') { %> <% matchList = log["matched opportunities"]; %> <% matchTypeLabel = "Account\'s Opportunities";%> <% nodeTypeLabel = "MATCH NODE - A2O"; %> <% } else if(fullNode.objectType === \'O2O\') {%> <% matchList = log["matched opportunities"];%> <% matchTypeLabel = "Matched Opportunities"; %> <% nodeTypeLabel = "MATCH NODE - O2O"; %> <% } else if(fullNode.objectType === \'O2C\') {%> <% matchList = log[\'matched contacts\']; %> <% matchTypeLabel = "Opportunity\'s Contacts"; %> <% nodeTypeLabel = "MATCH NODE - O2C"; %> <% } %> <% } else if (fullNode.type === \'REROUTING\') {\n          nodeTypeLabel = node["next routing time"] ? \'PENDING ROUTE\' : \'TIME-BASED ROUTE\';\n        } %> <div class=route-node> <span class=left-column-text> <% if (fullNode.type === "TRIGGER" || fullNode.type === "UPDATE TRIGGER") { %> <img class=log-node src="<%= imageURLs[\'trigger node\'] %>" style=height:22px;width:22px;margin-top:3px> <% } else if (fullNode.type === "ACTION") { %> <img class=log-node src="<%= imageURLs[\'action node\'] %>" style=height:14px;width:30px;margin-top:4px> <% } else if (fullNode.type === "PARTNER NODE") { %> <img class=log-node src="<%= imageURLs[\'partner node\'] %>" style=height:14px;width:30px;margin-top:4px> <% } else if (fullNode.type === "DECISION") { %> <img class=log-node src="<%= imageURLs[\'decision node\'] %>" style=height:17px;width:24px;margin-top:3px> <% } else if (fullNode.type === "REROUTING") { %> <img class=log-node src="<%= imageURLs[\'reroute node\'] %>" style=height:20px;width:21px;margin-top:2px> <% } else if (fullNode.type === "MATCH") { %> <img class=log-node src="<%= imageURLs[\'match node\'] %>" style=height:20px;width:21px;margin-top:2px> <% } %> </span> <span class=right-column-text> <div class=blue-parameter-font> <%= (fullNode.name === \'Reroute\') ? \'Time-based\' : _.escape(fullNode.name) %> </div> <div class=green-parameter-font> <%= nodeTypeLabel %> </div> <% var isActionNode = (fullNode.type === "ACTION"); %> <% var isPartnerNode = (fullNode.type === "PARTNER NODE"); %> <% var isCustomInterface = (isActionNode && fullNode.actionType === "Custom Interface"); %> <% var isUpdateAction = (isActionNode && (fullNode.actionType === "Update Lead" || fullNode.actionType === "Update Contact" || fullNode.actionType === "Update Account" || fullNode.actionType === "Update Opportunity")); %>  <% if (isCustomInterface || fullNode.actionType === "Route To Territory" || ((isActionNode || isPartnerNode) && !isUpdateAction) || node["edge"] == "Not Available For Routing") { %> <div class=collapse-group> <div class=collapse-clickable style=cursor:pointer;font-weight:bolder> <span class=black-parameter-font>More Info </span> <span class=expand-glyph></span> </div> <div class=collapse-toggleable style=width:225px> <ul class=optional-keys-ul> <% if (fullNode.actionType === "Round Robin" || fullNode.actionType === "Route To Territory") { %> <% var poolId = node["Territory"] != null ? node["round robin id"] : fullNode["round robin id"] %> <% var poolName = node["Territory"] != null ? node["round robin group"] : fullNode["round robin group"] %> <% if (fullNode.actionType === "Route To Territory") { %> <li> <span class=blue-parameter-font> Territory Segment: </span> <span> <%= node["Segment"] %> </span> </li> <% if(node["Territory"] != null) { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Territory: </span> <span> <%= node["Territory"] %> </span> </li> <li> <span class=blue-parameter-font> Fields Used For Assignment: </span> <span> <%= node["Fields Used For Assignment"] %> </span> </li> <% } %> <% } %> <% if (poolId != null) { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Round Robin Pool Id: </span> <span> <%= poolId %> </span> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Round Robin Pool Name: </span> <span> <%= poolName %> </span> </li> <% } %> <% if((node["assignment field name"] != null || fullNode.actionType != \'Route To Territory\') && node["edge"] != "Not Available For Routing") { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> New <%= node["assignment field name"] %>: </span> <span> <a target=_blank href="/<%= node[\'assignment field new\'] %>"> <%= node["assignment field new"] %> </a> </span> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Previous <%= node["assignment field name"] %>: </span> <span> <a target=_blank href="/<%= node[\'assignment field previous\'] %>"> <%= node["assignment field previous"] %> </a> </span> </li> <% } %> <% if(node["edge"] === "Not Available For Routing") { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Not Available Reason </span> <span> <%= node["not available reason"] %> </span> </li> <% } %>  <% } else if (fullNode.actionType === "Merge Dupe Lead" || fullNode.actionType === "Merge Dupe Contact") { %> <% if (fullNode.actionType === "Merge Dupe Contact") { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Merge Status: </span> <span> <%= fullNode["merge status"] %> </span> </li> <% } %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Dupe Id: </span> <span> <a target=_blank href="<%= sobjLinkPrefix + node[\'dupe id\'] %>"> <%= node["dupe id"] %> </a> </span> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Dupe Preference: </span> <span> <a target=_blank href="<%= sobjLinkPrefix + node[\'dupe preference\'] %>"> <%= node["dupe preference"] %> </a> </span> </li> <% } else if (fullNode.actionType === "Convert Lead") { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Convert Status: </span> <span> <%= fullNode["convert status"] %> </span> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Create Opportunity: </span> <span> <%= !fullNode.doNotCreateOpportunity %> </span> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Account Id: </span> <span> <a target=_blank href="<%= sobjLinkPrefix + node[\'account id\'] %>"> <%= node["account id"] %> </a> </span> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Contact Owner Id: </span> <span> <a target=_blank href="/<%= node[\'contact owner id\'] %>"> <%= node["contact owner id"] %> </a> </span> </li> <% } else if (["Route to Contact"].includes(fullNode.actionType)) { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> CBR Type: </span> <span> <%= fullNode["routing type"] %> </span> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Contact Id: </span> <span> <a target=_blank href="<%= sobjLinkPrefix + node[\'contact id\'] %>"> <%= node["contact id"] %> </a> </span> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Owner Id: </span> <span> <a target=_blank href="<%= sobjLinkPrefix + node[\'owner id\'] %>"> <%= node["owner id"] %> </a> </span> </li> <% } else if (["Opportunity Based Routing", "Assign Owner Opportunity", "Route to Opportunity", "Route to Matched Opportunity"].includes(fullNode.actionType)) { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> OBR Type: </span> <span> <%= fullNode["obr type"] %> </span> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Opportunity Id: </span> <span> <a target=_blank href="<%= sobjLinkPrefix + node[\'opportunity id\'] %>"> <%= node["opportunity id"] %> </a> </span> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Owner Id: </span> <span> <a target=_blank href="/<%= node[\'owner id\'] %>"> <%= node["owner id"] %> </a> </span> </li> <% } else if (["Route to Matched Account", "Account Based Routing", "Route to Account", "Route to Account Team", "Route to User Field", "Route to Owner Mapping"].includes(fullNode["actionType"])) { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> ABR Type: </span> <span> <%= fullNode["abr type"] %> </span> </li> <% if (!_.isNull(node["implicit fallback"]) && !_.isUndefined(node["implicit fallback"])) { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Implicit Fallback: </span> <span> <%= node["implicit fallback"] %> </span> </li> <% } %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Account Id: </span> <span> <a target=_blank href="<%= sobjLinkPrefix + node[\'account id\'] %>"> <%= node["account id"] %> </a> </span> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> New <%= node["assignment field name"] %>: </span> <span> <a target=_blank href="/<%= node[\'assignment field new\'] %>"> <%= node["assignment field new"] %> </a> </span> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Previous <%= node["assignment field name"] %>: </span> <span> <a target=_blank href="/<%= node[\'assignment field previous\'] %>"> <%= node["assignment field previous"] %> </a> </span> </li> <% } else if (["Lead Based Routing", "Assign Owner Lead", "Route to Matched Lead"].includes(fullNode.actionType)) { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> A2BBR Type: </span> <span> <%= fullNode["a2bbr type"] %> </span> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Lead Id: </span> <span> <a target=_blank href="<%= sobjLinkPrefix + node[\'lead id\'] %>"> <%= node["lead id"] %> </a> </span> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Owner Id: </span> <span> <a target=_blank href="/<%= node[\'owner id\'] %>"> <%= node["owner id"] %> </a> </span> </li> <% } else if (["Route to Contact"].includes(fullNode.actionType)) { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> A2BBR Type: </span> <span> <%= fullNode["routing type"] %> </span> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Contact Id: </span> <span> <a target=_blank href="<%= sobjLinkPrefix + node[\'contact id\'] %>"> <%= node["contact id"] %> </a> </span> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Owner Id: </span> <span> <a target=_blank href="/<%= node[\'owner id\'] %>"> <%= node["owner id"] %> </a> </span> </li> <% } else if (["Account Creation", "Create New Account", "Create Account"].includes(fullNode.actionType)) { %> <% if (node["account attribs"]) { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font>New Account: </span> <span><a target=_blank href="/<%= node["account attribs"].Id %>"><%= node["account attribs"].Id %></a></span> </li> <% } else { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font>Converted <%= log["sobject type"] %>: </span> <span><a target=_blank href="/<%= log.attributes.id %>"><%= log.attributes.id %></a></span> </li> <% } %> <% _.each(node["node attribs"], function(att, key) { %> <% if (key.toLowerCase() === "id") return; %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> <%= key %>: </span> <span> <%= att %> </span> </li> <% }); %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Convert Lead to Contact: </span> <span> <%= fullNode["convertLeadToContact"] %> </span> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Create Opportunity: </span> <span> <%= !fullNode["doNotCreateOpportunity"] %> </span> </li> <% } else if (fullNode.actionType === "Create Task") { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font>New Task: </span> <span><a target=_blank href="/<%= node["task attribs"].Id %>"><%= node["task attribs"].Id %></a></span> </li> <% _.each(node["task attribs"], function(att, key) { %> <% if (key.toLowerCase() === "id") return; %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> <%= key %>: </span> <span> <%= att %> </span> </li> <% }); %> <% } else if (fullNode.actionType === "Create Opportunity") { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> New Opportunity: </span> <span> <a target=_blank href="/<%=node[\'opportunity attribs\'].Id%>"> <%= node[\'opportunity attribs\'].Id %> </a> </span> </li> <li class=optional-key-li-no-margin> <% if (node[\'default owner assignment\'] != undefined) { %> <span class=blue-parameter-font> DEFAULT ACTION: Owner assigned to Opportunity Account Owner. </span> <% } %> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Opportunity Owner: </span> <span> <a target=_blank href="/<%=node[\'opportunity attribs\'].OwnerId%>"> <%= node[\'opportunity attribs\'].OwnerId %> </a> </span> </li> <%_.each(node["opportunity attribs"], function(value, key){ %> <% if (key.toLowerCase() == "id" || key.toLowerCase() == \'ownerid\') return; %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> <%= key %>: </span> <span> <%= value %> </span> </li> <% }); %>  <% } else if (fullNode.actionType === "Custom Interface") { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Parameter: </span> <span> <%= fullNode["parameter"] %> </span> </li> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Owner Id: </span> <span> <a target=_blank href="/<%= node[\'owner id\'] %>"> <%= node["owner id"] %> </a> </span> </li> <% } else if (["Explicit Owner Assignment", "Assign Owner"].includes(fullNode.actionType)) { %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Owner: </span> <span> <a target=_blank href="/<%=fullNode[\'explicit owner assignment id\']%>"> <%= node["owner name"] %> </a> </span> </li> <% if (fullNode.assignmentType == \'user field\') { %> <li> <span class=blue-parameter-font> Source: </span> <span> <%= fullNode[\'user field\'] %> </span> </li> <% } %>  <% } else if (fullNode.actionType === "Send Notification") { %> <% var emailStatus = node[\'email status\'] %> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Email Template: </span> <span> <a target=_blank href="/<%= fullNode.notificationSettings[emailStatus].template %>"> <%= fullNode.notificationSettings[emailStatus].template %> </a> </span> </li> <% } %> </ul> </div> </div> <% } else if (fullNode.type === "MATCH") { %> <span class=black-parameter-font-bold> <% if (fullNode.objectType === "Dupe") { %> Chosen Duplicate Lead: <% } else if (fullNode.objectType === "DupeC") { %> Chosen Duplicate Contact: <% } else if (fullNode.objectType === "L2A") { %> Chosen Matched Account: <% } else if (fullNode.objectType === "L2L") { %> Chosen Matched Lead: <% } else if (fullNode.objectType === "L2O") { %> Chosen Matched Opportunity: <% } else if (fullNode.objectType === "C2O") { %> Chosen Opportunity: <% } else if (fullNode.objectType === "C2C") { %> Chosen Contact: <% } else if(fullNode.objectType === "A2O") { %> Chosen Opportunity: <% } else if(fullNode.objectType == "O2O") {%> Chosen Opportunity: <% } else if(fullNode.objectType == "O2C") {%> Chosen Contact: <% } %> </span> <ul class=optional-keys-ul style=list-style:none> <% if (node["chosen"] !== null) { %> <a target=_blank href="<%= sobjLinkPrefix + node["chosen"]["id"] %>"> <li> <%= node["chosen"]["id"] %> </li> </a> <% } else { %> <li> None </li> <% } %> </ul> <%if (fullNode.objectType === "L2O") { %> <span class=black-parameter-font-bold> Matched Opportunity Account: </span> <ul class=optional-keys-ul style=list-style:none> <% if (node["chosen"] !== null && node["chosen"]["account.id"] !== null) { %> <a target=_blank href="<%= sobjLinkPrefix + node["chosen"]["account.id"] %>"> <li> <%= node["chosen"]["account.id"] %> </li> </a> <% } else { %> <li> None </li> <% } %> </ul> <% } %> <div class=collapse-group> <div class=collapse-clickable style=cursor:pointer> <span class=black-parameter-font-bold> <%= matchTypeLabel %> - </span> <span class=black-parameter-font> <%= matchList.length %> </span> <% if (matchList.length > 0) { %> <span class=expand-glyph></span> <% } %> <%if (totalMatchedObjects && totalMatchedObjects > matchList.length) {%> <br/> <%=\'(Out of \' + totalMatchedObjects + \' possible matches.)\'%> <%}%> </div> <div class=collapse-toggleable> <ul class=optional-keys-ul style=list-style:none> <% _.each( matchList, function(id) { %> <a target=_blank href="<%= sobjLinkPrefix + id %>"> <li> <%= id %> </li> </a> <% }); %> </ul> </div> </div> <% var matchSet = {}; %> <% _.each(matchList, function(id){matchSet[id] = true;}); %> <% var currentSize = matchList.length; %> <% var oldSize = currentSize; %>  <% if (oldSize > 0) { %> <div class=collapse-group> <div class=collapse-clickable style=cursor:pointer;font-weight:bolder> <span class=black-parameter-font>More Info </span> <span class=expand-glyph></span> </div> <div class=collapse-toggleable> <ul class=optional-keys-ul style=list-style:none;width:250px> <%if (node["enableMultiTiebreakerSets"]) {%> <div class=text-primary style=margin-bottom:10px> <i>"Multiple Tiebreaker Rule Sets" is Enabled</i><br/> <span class=blue-parameter-font>Chosen Tiebreaker Set: </span> <span class=black-parameter-font><%=node["chosenTiebreakerSetName"]%></span> </div> <%}%>  <% if (fullNode["filter type"] !== "none") { %> <% _.each(node["filtered out"], function(id){delete matchSet[id];}); %> <li class=optional-key-li> <div class=collapse-group> <div class=collapse-clickable style=cursor:pointer;font-weight:bolder> <div class=blue-parameter-font style=font-weight:400> <%= fullNode.filter && fullNode.filter.type === "custom" ? "Custom Filter - " + fullNode.filter.parameter : fullNode.filter && fullNode.filter.type === "conditions" ? constructParsedCondition(fullNode.filter) : fullNode.filter.soqlCondition  %>: </div> <div class=black-parameter-font> <span> filtered <%= node["filtered out"].length %> of <%= currentSize %> </span> <span class=expand-glyph></span> </div> <% currentSize -= node["filtered out"].length; %> </div> <div class=collapse-toggleable> <ul class=optional-keys-ul style=list-style:none> <% _.each(node["filtered out"], function(id) { %> <li> <a target=_blank href="<%= sobjLinkPrefix + id %>"> <%= id %> </a> </li> <% }); %> </ul> </div> </div> </li> <% } %>  <% if ( "filtered out inactive" in node) { %> <% if ( node["filtered out inactive"].length > 0) { %> <% _.each(node["filtered out inactive"], function(id){delete matchSet[id];}); %> <li class=optional-key-li> <div class=collapse-group> <div class=collapse-clickable style=cursor:pointer;font-weight:bolder> <div class=blue-parameter-font style=font-weight:400> Inactive Owners </div> <div class=black-parameter-font> <span> filtered <%= node["filtered out inactive"].length %> of <%= currentSize %> </span> <span class=expand-glyph></span> </div> <% currentSize -= node["filtered out inactive"].length; %> </div> <div class=collapse-toggleable> <ul class=optional-keys-ul style=list-style:none> <% _.each(node["filtered out inactive"], function(id) { %> <li> <a target=_blank href="<%= sobjLinkPrefix + id %>"> <%= id %> </a> </li> <% }); %> </ul> </div> </div> </li> <% } %> <% } %>  <% _.each(node.tiebreakers, function(tiebreakArray, idx) { %> <% if ((currentSize === 0 || currentSize === 1) && !railsPage) return; %> <% var addAsterisk = tiebreakArray === "fallthrough" %> <% tiebreakArray = tiebreakArray instanceof Array ? tiebreakArray : []; %> <li class=optional-key-li> <div class=blue-parameter-font style=font-weight:400> <%= fullNode.tiebreakers[idx] && fullNode.tiebreakers[idx].type === "conditions" ? constructParsedCondition(fullNode.tiebreakers[idx]) : (fullNode.tiebreakers[idx] && fullNode.tiebreakers[idx].type === "optima" ? capitalize(fullNode.tiebreakers[idx].direction) + " " + fullNode.tiebreakers[idx].field : (fullNode.tiebreakers[idx] && fullNode.tiebreakers[idx].type === "custom") ? "Custom Tiebreaker: " + fullNode.tiebreakers[idx].parameter : fullNode.tiebreakers[idx].soqlCondition) %>: </div> <div class=collapse-group style=line-height:initial> <div class=collapse-clickable style=cursor:pointer> <%= tiebreakArray.length > 0 ? ("excluded " + tiebreakArray.length + " of " + currentSize) : "no exclusions" + (addAsterisk ? "*" : "") %> <% if (tiebreakArray.length > 0) { %> <span class=expand-glyph></span> <% } %> </div> <div class=collapse-toggleable> <ul class=optional-keys-ul style=list-style:none> <% _.each( tiebreakArray, function(id) { %> <li> <a target=_blank href="<%= sobjLinkPrefix + id %>"> <%= id %> </a> </li> <% }); %> </ul> </div> </div> <% oldSize = currentSize; %> <% _.each(tiebreakArray, function(id){delete matchSet[id];}); %> <% currentSize -= tiebreakArray.length; %>  <% if (_.size(matchSet) > 0) { %> <div class=collapse-group style=line-height:initial> <div class=collapse-clickable style=cursor:pointer> <span> <%= "included " + _.size(matchSet) + " of " + oldSize %> </span> <span class=expand-glyph></span> </div> <div class=collapse-toggleable> <ul class=optional-keys-ul style=list-style:none> <% _.each(matchSet, function(value, id) { %> <li> <a target=_blank href="<%= sobjLinkPrefix + id %>"> <%= id %> </a> </li> <% }); %> </ul> </div> </div> <% } %> </li> <% }); %> </ul> </div> </div> <% } %> <% } else if (fullNode.type === \'REROUTING\') { %>  <% if (node["next routing time"]) {%> <span class=black-parameter-font-bold> Scheduled to route at: </span> <ul class=optional-keys-ul style=list-style:none> <li><%=logsFormatDate(node["next routing time"])%></li> </ul> <% } %> <% if (log["parent log"]) {%> <div class=collapse-group> <div class=collapse-clickable style=cursor:pointer;font-weight:bolder> <span class=black-parameter-font>More Info </span> <span class=expand-glyph></span> </div> <div class=collapse-toggleable> <ul class=optional-keys-ul style=list-style:none;width:250px> <li class=optional-key-li-no-margin> <span class=blue-parameter-font> Parent log: </span> <span class=black-parameter-font> <a target=_blank href="/apex/<%=ns%>dashboard#routing/<%=log[\'sobject type\'].toLowerCase()%>/audit_logs/<%=log[\'parent log\']%>"><%=log["parent log"]%></a> </span> </li> </ul> </div> </div> <% } %>  <% } %> </span> </div> <% var nextNodeName = (idx + 1 < log.route.length) ? log.route[idx + 1].name : \'End of Flow\'; %> <% if (_.isEmpty(node[\'next routing time\'])) {%> <div class=next-node-arrow> <img style=height:25px;vertical-align:middle src="<%= imageURLs[\'edge arrow\'] %>"/> <% node.edge = node.edge === "Not Available For Routing" ? node.edge = "Not Available" : node.edge = node.edge; %> <span style=margin-top:-20px;margin-left:5px><%= node.edge %> - <%= _.escape(nextNodeName) %></span> </div> <%}%>  <% }); %>  <% if (_.isEmpty(log.route[log.route.length - 1][\'next routing time\'])) {%> <div class=route-node> <div class=right-column-text> <span class=blue-parameter-font>End of Flow</span> <br/> </div> </div> <%}%> <br/> <br/> </td> </tr> <% } catch(e){console.log(e);} %> <% }); %> </tbody> </table> '},function(e,t){e.exports='<div id="tagging-preview-wrapper ld-header-wrapper"> <div class=ld-header-wrapper-margins> <div class="ld-header ld-header-bottom-margin">Tagging Finder</div> </div> <div class=search-div> <span class=search-sfdc-lead-label>Search SFDC Lead ID: </span> <input name=lead-id id=lead-id class="search-sfdcid ld-input-large"> <div type=button class="ld-primary-large-button search-lead-button search-lead" id=tagging-preview-button>Check Matches</div> <div id=feedback-message-wrapper style=display:none><pre id=feedback-message></pre></div> </div> <div id=routing_table_target class=bs></div> </div>'},function(e,t){e.exports="<td class=error_log_col_icon></td> <td class=error_log_col_text colspan=7> <%= errorText %> </td> <td class=error_log_col_text style=display:none></td> <td class=error_log_col_text style=display:none></td> <td class=error_log_col_text style=display:none></td> <td class=error_log_col_text style=display:none></td> <td class=error_log_col_text style=display:none></td> <td class=error_log_col_text style=display:none></td> "},function(e,t){e.exports=' <div id="<%= uniqueId %>-modal" class="modal fade"> <div class=modal-dialog> <div class=modal-content style=height:initial> <div class=dg_inner-wrapper-header id="<%= uniqueId %>-text" style=display:flex;justify-content:center;align-items:center;margin-top:10px> <%= headerText %> </div> <div class=modal-content-section style="height:initial;padding:30px 0 30px 0"> <div class=modal-content-text id="<%= uniqueId %>-modal-text" style=height:initial><%= mainText %></div> <div class=modal-content-extra id="<%= uniqueId %>-extra" style=height:initial;padding-top:20px></div> </div> <div id="<%= uniqueId %>-button-div" class=modal-button-section style=height:initial;padding-bottom:20px> <% if (!_.isNull(button1Name) && !_.isUndefined(button1Name)) { %> <% if (!_.isNull(button1Action) && !_.isUndefined(button1Action)) { %> <span class=ld-tertiary-large-button data-dismiss=modal onclick="<%= button1Action() %>" id="<%= uniqueId %>-button-1"> <% } else { %> <span class=ld-tertiary-large-button data-dismiss=modal id="<%= uniqueId %>-button-1"> <% } %> <%= button1Name %> </span> <% } %> <% if (!_.isNull(button2Name) && !_.isUndefined(button2Name)) { %> <% if (!_.isNull(button2Action) && !_.isUndefined(button2Action)) { %> <span class=ld-primary-large-button data-dismiss=modal role=button onclick="<%= button2Action() %>" id="<%= uniqueId %>-button-2"> <% } else { %> <span class=ld-primary-large-button data-dismiss=modal role=button id="<%= uniqueId %>-button-2"> <% } %> <%= button2Name %> </span> <% } %> </span></span></div> </div> </div> </div>'},function(e,t){e.exports='<div id=createModalText style=height:60px>Enter a name for your new Territory Segment. <div class=modal-content-extra id=createExtra style=height:70px> <span>Name</span> <input style=margin-left:10px;width:125px;height:22px type=text id=nameInput> <div class="alert alert-danger" style=display:none id=sameNameDiv>Territory Segment cannot have the same name as another Segment</div> </div> </div> '},function(e,t){e.exports="<div id=createModalText style=height:60px> Edit existing Segment name<br><br> <input style=margin-left:10px;width:125px;height:22px type=text id=renameTerritoryInput> </div> <div class=modal-content-extra id=renameSegmentContent> </div> "},function(e,t){e.exports='<div> <ul id=overlapping-link-list> <% _.each(edges, function (edge, idx) { %> <li data-edge-idx="<%= idx %>"> <img data-edge-name="<%= edge.name %>" class="left edge-selector" src="<%= selectedEdgeIdx == idx ? iconToURLMap["Unselected Anchor"] : iconToURLMap[\'Empty Anchor\'] %>"/> <span style=margin-left:9px;margin-top:4px;position:absolute><%= edge.name %></span> <img class=right src="<%= iconToURLMap[\'Double Arrows\'] %>"/> </li> <% }); %> </ul> </div>'},function(e,t){e.exports="<div id=additional-task-fields> <span class=header-font>Additional Task Fields</span><br/> <div class=single-mapping-row>Optional: Select additional fields on the new task to update.</div> <div id=edit-task-fields-wrapper class=single-mapping-row></div> <div class=single-mapping-row> <div class=add-rule-row-item> <div class=add-rule-div></div> <div class=header-font>Add Field</div> </div> </div> </div>"},function(e,t){e.exports='<div id=additional-opp-fields> <span class=header-font>Additional Opportunity Fields</span><br/> <div class=single-mapping-row>Optional: Select additional fields on the new opportunity to update.</div> <div id=edit-opp-fields-wrapper class=single-mapping-row></div> <div class="add-opp-field-wrapper single-mapping-row"> <div class=add-rule-row-item> <div class=add-rule-div></div> <div class=header-font>Add Field</div> </div> </div> </div>'},function(e,t){e.exports="<div class=\"advanced-settings-view collapsible-outer-container <%= openPanel ? 'open' : '' %>\"> <div class=\"collapsible-section-header header-font\">Advanced Settings</div> <div class=collapsible-section> <div class=l2a-match-parent-settings-container></div> <span id=advanced-settings-text> Specify next node, if any, when a condition below is met. </span> <div class=criteria-list-partial> </div> </div> </div>"},function(e,t){e.exports='<div> <div id=conditions-edit-partial> <div id=edit-rules-div style=margin-bottom:0> </div> <div class=add-rule-container style=margin-top:10px> <div class=add-rule-row-item> <div class=add-rule-div></div> <div class=header-font>New condition</div> <div class=empty-row-space></div> </div> </div> <div class="rule-logic-div <%=showLogic ? \'\' : \'hidden\'%>" style=margin-top:10px> <span class="rule-logic-label header-font">Rule Logic (<a href=javascript:void(0); class=reset-default-logic>Default</a>)</span> <img class=warning-sign src=#RESOURCEURL#/images/Triangle_Error_Icon_form.png width=15px style=margin-left:5px;margin-top:-1px><br/> <input value="<%= logic %>" type=text data-name=rule-logic class=rule-logic-input style=margin-top:5px;width:90% /> <span class=rule-logic-feedback style=font-size:8px;color:#d91e18></span> </div> <% if (showDescription) { %> <div class="description-div collapsible-outer-container" style=margin-top:10px;display:block> <div class="description-label collapsible-section-header" style=margin-bottom:2px;display:inline-block>Description</div><br/> <textarea class="description-input collapsible-section change-parameter-input" data-parameter=description id=conditions-description-input><%= description %></textarea> </div> <% } %> </div></div>'},function(e,t){e.exports=' <div class="task-related-to section-wrapper-spacing"> <div class="header-font header-spacing">Related To</div> <div class=control-group id=related-to-radio-control> <label class="control control--radio"> <%= primarySObjectType %> <input type=radio name=related-to-radio-control-option data-category=relatedTo data-type=relatedToPrimary /> <div class=control__indicator></div> </label> <label class="control control--radio" style=display:flex;align-items:center> <span class=matched-object-label>Matched Object</span> <input type=radio name=related-to-radio-control-option data-category=relatedTo data-type=relatedToMatched <%= matchedObjectTypes.length === 0 ? \'disabled\' : \'\' %> /> <div class=control__indicator></div> <% if (matchedObjectTypes.length === 0) { %> <div class="ld-tooltip-hint related-matched-obj-tooltip"></div> <% } %> </label> <div class=radio-sub-div style=margin-left:30px> <% _.each(matchedObjectTypes, function(objectType) { %> <label class="control control--radio"> <%= objectType %> <input type=radio name=related-to-radio-control-option-2 data-category=relatedTo data-type=relatedToMatchedObject data-value="<%= objectType %>"/> <div class=control__indicator></div> </label> <% }) %> </div> <div id=invalidRelatedToMatchedObject class=node-form-error-text></div> <label class="control control--radio" style=display:flex;align-items:center> <span class=created-object-label>Created Object</span> <input type=radio name=related-to-radio-control-option data-category=relatedTo data-type=relatedToCreated <%= createdObjectTypes.length === 0 ? \'disabled\' : \'\' %> /> <div class=control__indicator></div> <% if (createdObjectTypes.length === 0) { %> <div class="ld-tooltip-hint related-created-obj-tooltip"></div> <% } %> </label> <div class=radio-sub-div style=margin-left:30px> <% _.each(createdObjectTypes, function(object) { %> <label class="control control--radio"> <%= object %> <input type=radio name=related-to-radio-control-option-3 data-category=relatedTo data-type=relatedToCreatedObject data-value="<%= object %>"/> <div class=control__indicator></div> </label> <% }) %> </div> <div id=invalidRelatedToCreatedObject class=node-form-error-text></div> </div> </div> <div class=task-assigned-to class=section-wrapper-spacing> <div class="header-font header-spacing">Assigned To</div> <div class=control-group id=assigned-to-radio-control> <label class="control control--radio"> <%= primarySObjectType %> User Field <input type=radio name=assigned-to-radio-control data-category=assignedTo data-type=assignedToPrimary data-value="<%= primarySObjectType %>"/> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div id=primaryUserFieldDropdown class=node-detail-input></div> <div id=invalidAssignedToPrimaryUser class=node-form-error-text></div> </div> <label class="control control--radio" style=display:flex;align-items:center> <span class=matched-object-label>Matched Object</span> <input type=radio name=assigned-to-radio-control data-category=assignedTo data-type=assignedToMatched <%= matchedObjectTypes.length === 0 ? \'disabled\' : \'\' %> /> <div class=control__indicator></div> <% if (matchedObjectTypes.length === 0) { %> <div class="ld-tooltip-hint assigned-matched-obj-tooltip"></div> <% } %> </label> <div class=radio-sub-div style=margin-left:30px> <% _.each(matchedObjectTypes, function(objectType) { %> <label class="control control--radio"> <%= objectType %> User Field <input type=radio name=assigned-to-radio-control-3 data-category=assignedTo data-type=assignedToMatchedObject data-value="<%= objectType %>"/> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div class="matchedUserFieldDropdown node-detail-input" data-value="<%= objectType %>"></div> </div> <div class="invalidAssignedToMatchedUser-<%= objectType %> node-form-error-text"></div> <% }) %> </div> <div id=invalidAssignedToMatchedUser class=node-form-error-text></div> <label class="control control--radio"> Explicit Owner <input type=radio name=assigned-to-radio-control data-category=assignedTo data-type=assignedToExplicitOwner /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div id=explicitOwnerListDropdown class=node-detail-input></div> </div> <div id=invalidExplicitOwner class=node-form-error-text></div> </div> </div>'},function(e,t){e.exports='<div class=rule-div> <div class=matched-field-column> <div style=margin-right:10px> <span style=font-weight:600>Custom Parameter</span> <input class="width-fill change-parameter-input" style="outline:1px solid #9eb7cb;margin-top:1px;min-height:20px;color:#000;text-shadow:none" data-parameter=parameter value="<%= customParameter %>"/> </div> </div> </div>'},function(e,t){e.exports='<% if (!isAccountSettingsPage) { %> <div class="criteria-table-header header-font"> <% if (!hideDragColumn) { %> <div class=drag-column></div> <% } %> <div class=decision-criteria-column> Condition </div> <% if (!hideLabel) { %> <div class=edge-label-column> Label </div> <% } %> <div class=next-node-column> Target </div> <% if (!hideDragColumn) { %> <div class=delete-column></div> <% } %> </div> <% } %> <ul id=criteria-sortable class="criteria-list list-unstyled" style=list-style-type:none;margin:0> <% _.each(edges, function(edge, idx) { %> <li class="criteria-list-item <%= edge[\'type\'] === \'default\' ? \'criteria-list-default\' : \'\' %> <%= \'criteria-type-\'+ edge[\'type\'] %> <%= edge[\'type\']===\'system\' ? \'hidden\' : \'\'%>" data-criteria-number="<%= idx %>"> <div style=background-color:#ccc;width:100%;height:1px;margin-top:-1px;background-clip:content-box> </div> <div class="criteria-table-row <%= (!trueFalseNode && Magellan.Models.criterionEmpty(edge)) ? \'empty\' : (Magellan.Models.criterionInvalid(edge) ? \'invalid\' : \'\') %>"> <% if (!hideDragColumn) { %> <div class=drag-column style=""> <% if (edge["type"] !== "default") { %> <img class=grab src=#RESOURCEURL#/images/Directional_Arrow.png> <% } %> </div> <% } %> <div class="decision-criteria-column edit-icon-div" style=cursor:pointer data-criteria-number="<%= idx %>"> <div> <div class=decision-criteria-text> <%= formattedConditionTextTemplate({\n\t\t\t\t\t\t\t\tcriterion: edge, \n\t\t\t\t\t\t\t\ttrueFalseNode: trueFalseNode, \n\t\t\t\t\t\t\t\tgetFieldLabel: getFieldLabel, \n\t\t\t\t\t\t\t\tgetOperandFieldLabel: getOperandFieldLabel,\n\t\t\t\t\t\t\t\tgetOperandValueLabel: getOperandValueLabel\n\t\t\t\t\t\t\t}) %> <img class="warning-sign <%=validateEdge(edge) || trueFalseNode ? \'hidden\' : \'\'%>" src=#RESOURCEURL#/images/Triangle_Error_Icon_form.png width=15px /> </div> <a class=empty-criteria-label>Edit condition</a> <% if(edge["description"] && edge["description"].length > 0) { %> <div class=criteria-description-text style=margin-left:20px;margin-right:4px><%= edge["description"]  %></div> <% } %> </div> </div> <% if (!hideLabel) { %> <div class=edge-label-column> <div style=padding-right:23px> <input class="ld-input-component edge-name-input" value="<%=edge[\'name\']%>" data-criteria-number="<%= idx %>"/> </div> </div> <% } %>  <% \n\t\t\t\tvar chosenNode, dropdownClass, chooserId = "node-chooser-" + idx; \n\t\t\t    if (edge["target"] == null) {\n\t\t\t    \tchosenNode = "None"; \n\t\t\t    \tdropdownClass = "node-chosen-none";\n\t\t\t    } else if (edge["target"] == -1) {\n\t\t\t       \tchosenNode = "END OF FLOW";\n\t\t\t\t\tdropdownClass = "node-chosen-end";\n\t\t\t    } else if (edge["target"] == 0) {\n\t\t\t\t\tchosenNode = "ROUTE TO SELF";\n\t\t\t\t\tdropdownClass = "node-chosen-reschedule";\n\t\t\t\t} else {\n\t\t\t       \tchosenNode = edge["target"];\n\t\t\t\t\tdropdownClass = "";\n\t\t\t    }\n\t\t\t\t%> <% if (!isAccountSettingsPage) { %> <div class=next-node-column></div> <% } %> <% if (!hideDragColumn) { %> <div class="delete-column <%= edge[\'type\'] !== \'default\' && edges.length !== 1 ? \'minus-icon-div\' : \'\' %>" data-criteria-number="<%= idx %>"></div> <% } %> </div> <div style=background-color:#ccc;width:100%;height:1px;background-clip:content-box></div> <div class=conditions-edit-partial-wrapper data-criteria-number="<%= idx %>"></div> </li> <% }); %> </ul> <% if (!hideDragColumn) { %> <div class="add-rule-container new-rule-container" style=margin-top:10px> <% if (isTrigger) { %> <div class=add-rule-row-item> <div class="add-rule-div rule-type" data-rule-type=logic></div> <div class=header-font>New Rule</div> <div class=empty-row-space></div> </div> <% } else { %> <div class=add-rule-row-item> <div class=add-rule-div></div> <div class=header-font>New Rule</div> <div class=empty-row-space></div> </div> <div class=add-rule-row-item> <div class=rule-type-selection> <div class="rule-type-circle rule-type" data-rule-type=logic> <div class="single-line header-font" style=line-height:1;font-size:10px>LOGIC</div> </div> <div class="rule-type-circle rule-type" data-rule-type=soql> <div class="single-line header-font" style=line-height:1;font-size:10px>SOQL</div> </div> <% if (allowOptimaNode) { %> <div class="rule-type-circle rule-type" data-rule-type=optima> <div class="single-line header-font" style=line-height:1;font-size:10px;margin-left:1px>MIN</div> <div class="single-line header-font" style=line-height:1;font-size:10px;margin-left:1px>MAX</div> </div> <% } %> </div> <div class=empty-row-space></div> </div> <% } %> </div> <% } %>'},function(e,t){e.exports='<% if (!triggerNode) { %> <div class=filter-div style=margin-bottom:15px> <% if (!hideNumber){ %><div class=circle>1</div><%}%> <div id=customized-header class="header-font has-object-label" style=display:inline-block>Filter <%= isDupeNode ? "Duplicate" : "Matched" %> <%= pluralObjects %></div> <div style=margin-left:30px> <div id=customized-header-subtext class=has-object-label> Identify <%= isDupeNode ? "duplicate" : "matched" %> <%= pluralObjects %> to be considered/excluded:</div> </div> <div class=control-group id=filter-type-radio-control> <label class="control control--radio"><span class=has-object-label>Include <%= isDupeNode ? "duplicate" : "matched" %> <%= pluralObjects %> based on conditions:</span> <input class=filter-type-radio type=radio id=filter-radio-include name=radio data-filter-type=inclusion <%= filterType === "inclusion" ? "checked" : ""%>> <div class=control__indicator></div> </label> <div id=inclusion-filter-rules style="margin-left:30px;border-left:1px solid #ccc"></div> <label class="control control--radio checked"><span class=has-object-label>Exclude <%= isDupeNode ? "duplicate" : "matched" %> <%= pluralObjects %> based on conditions:</span> <input class=filter-type-radio type=radio id=filter-radio-exclude name=radio data-filter-type=exclusion <%= filterType === "exclusion" ? "checked" : ""%>> <div class=control__indicator></div> </label> <div id=exclusion-filter-rules style="margin-left:30px;border-left:1px solid #ccc"></div> <% if (actionNodeMetaData.hasCustomFilter) { %> <label class="control control--radio">Custom Interface Filter <input class=filter-type-radio type=radio id=filter-radio-custom name=radio data-filter-type=custom <%= (filterType === "custom") ? "checked" : ""%>> <div class=control__indicator></div> </label> <div id=custom-filter-rules style="margin-left:30px;border-left:1px solid #ccc"></div> <% } %> <label class="control control--radio">Do not filter <input class=filter-type-radio type=radio id=filter-radio-none name=radio data-filter-type=none <%= (filterType !== "inclusion" && filterType !== "exclusion" && filterType !== "custom") ? "checked" : ""%>> <div class=control__indicator></div> </label> <div style=margin-top:10px></div> </div> </div> <% } else { %> <div class=control-group id=filter-type-radio-control> <% if (!isUpdateTrigger) { %> <label class="control control--radio"><span class=has-object-label>All <%= pluralObjects %></span> <input class=filter-type-radio type=radio id=filter-radio-none name=radio data-filter-type=none <%= (filterType === "none" || (filterType !== "all" && filterType !== "inclusion")) ? "checked" : ""%>> <div class=control__indicator></div> </label> <% } %> <label class="control control--radio checked"><span class=has-object-label>None</span> <input class=filter-type-radio type=radio id=filter-radio-exclude name=radio data-filter-type=all <%= filterType === "all" ? "checked" : ""%>> <div class=control__indicator></div> </label> <label class="control control--radio">Include the <%= pluralObjects %> below: <input class=filter-type-radio type=radio id=filter-radio-include name=radio data-filter-type=inclusion <%= filterType === "inclusion" ? "checked" : ""%>> <div class=control__indicator></div> </label> <div id=criteria-list-partial></div> </div> <% } %> <% if(node && node.nodeInfo.objectType === \'L2O\') { // not a great way to check for L2O, but we currently don\'t pass full node info%> <label class=cb-container-small style="margin:10px 0!important"> <span class=toggleText>Restrict opportunities to matched Account (L2A match node required)</span> <input type=checkbox id=restrict-l2o-to-chosen-account name=restrict-l2o-to-chosen-account <%= restrictL2OToChosenAccount ? \'checked="checked"\' : \'\' %>/> <span class=checkmark></span> </label> <% } %> <% if(magellanClass == \'Magellan.Models.MatchNode\'){  // checking for L2L %> <label class=cb-container-small style="margin:10px 0!important"> <span class=toggleText>Exclude matched <%= pluralObjects.toLowerCase() %> with inactive owners</span> <input type=checkbox id=exclude-inactive-owned name=exclude-inactive-owned <%= excludeInactiveOwned ? \'checked="checked"\' : \'\' %> /> <span class=checkmark></span> </label> <% } %> '},function(e,t){e.exports=' <% if (trueFalseNode) { %> <%= criterion.condition %> <% } else if (criterion.type === "default") { %> Default <% } else if (Magellan.Models.criterionEmpty(criterion)){ %> <a class=empty-criteria-label>Edit condition</a> <% } else if (criterion.type === "conditions") { %> <% if (trueFalseNode) { %> <%= criterion.condition %> <% } else if (criterion.conditions.length !== 0) { %>  <% var feedbackMessages = Magellan.Util.parseLogic(criterion.conditions.length ,(criterion.logic ? criterion.logic : criterion.conditions.logic) ).feedbackMessage %> <% if (feedbackMessages.length < 1) { %> <% var tokenizedLogic = Magellan.Util.tokenize(criterion.conditions.length, (criterion.logic ? criterion.logic : criterion.conditions.logic) ).tokens; %> <% _.each(tokenizedLogic, function(token, idx) { %> <% var tokenType = Magellan.Util.identifyToken(token); %> <% if (tokenType === "Integer") { %> <% \n\t\t\t\t\t\tvar cond = criterion.conditions[token - 1]; \n\t\t\t\t\t\tvar condOperand = cond[\'value/field\'] === \'field\' ? getOperandFieldLabel(cond.operand) : getOperandValueLabel(cond);\n%> (<%= getFieldLabel(cond["field"]) %> <span style=color:#1abc9c> <%= cond.operator %> </span> <span title="<%=_.escape(cond.operand)%>" style=display:inline-block><%=condOperand%>)</span> <% } else if (tokenType === "Logical Operator") { %> <span style=color:#1abc9c> <%= token + " " %> </span> <% } else { %> <%= token + " " %> <% } %> <% }.bind(tokenizedLogic)); %> <% } else { %> <%= feedbackMessages.join("\\n") %> <% } %> <% } %>  <% } else if (criterion.type === "optima") { %> <%= getFieldLabel(criterion.field) %> <span style=color:#1abc9c> <%= criterion.direction.toUpperCase() %> </span> <% } else if (criterion.type === "fixed") { %> <%= Magellan.Migration.getFormattedEdgeName(criterion.condition) %> <% } else if (criterion.type === "soql") { %> <span style=font-style:italic><%= criterion.soqlCondition %></span> <% } else if (criterion.type === "custom") { %> Custom Tiebreaker: <%= criterion.parameter %> <% } %> '},function(e,t){e.exports="<div class=L2A-match-parent-settings style=margin-bottom:20px> <label class=cb-container-small> <div>Match to Parent Account</div> <input type=checkbox name=l2a-match-parent-toggle class=\"subcontent-toggle l2a-match-parent-toggle\" <%= model.nodeInfo.hasOwnProperty('matchToParent') ? 'checked' : '' %> /> <span class=checkmark></span> </label> <div class=\"control-group l2a-match-parent-choices <%= !model.nodeInfo.hasOwnProperty('matchToParent') ? 'hidden' : ''%>\" style=margin-left:30px> <label class=\"control control--radio\"> <input type=radio class=l2a-match-parent-choice name=l2a-match-parent-choice value=\"<%= 'parent' %>\" <%= model.nodeInfo['matchToParent'] === 'parent' ? 'checked' : '' %> /> <div class=control__indicator></div> Parent </label> <label class=\"control control--radio\"> <input type=radio class=l2a-match-parent-choice name=l2a-match-parent-choice value=\"<%= 'ultimate parent' %>\" <%= model.nodeInfo['matchToParent'] === 'ultimate parent' ? 'checked' : '' %> /> <div class=control__indicator></div> Ultimate Parent </label> </div> </div> "},function(e,t){e.exports='<div class=rule-div> <div class=matched-field-column> <div style=margin-right:10px> <span style=font-weight:600><%= condition.comparand ? condition.comparand : "" %> Field</span> <div class=nested-dropdown-container></div> </div> </div> <div class=operator-column> <div style=margin-right:10px> <span style=font-weight:600>Operator</span> <div class="dropdown width-fill"> <div class=dropdown-toggle id=operator-dropdown- data-toggle=dropdown aria-haspopup=true aria-expanded=true> <span class="dropdown-selection operator-value"><%= condition["direction"] %></span> <span class=ld-caret></span> </div> <ul class="dropdown-menu list-unstyled" aria-labelledby=operator-dropdown-> <li class="dropdown-choice change-parameter-dropdown" data-parameter=direction data-value=max>max</li> <li class="dropdown-choice change-parameter-dropdown" data-parameter=direction data-value=min>min</li> </ul> </div> </div> </div> <br/> </div> <div class=rule-div> <div class="description-div collapsible-outer-container" style=display:block> <div class="description-label collapsible-section-header" style=margin-bottom:2px;display:inline-block>Description</div><br/> <textarea class="description-input collapsible-section change-parameter-input" id=conditions-description-input data-parameter=description><%= condition.description %></textarea> </div> </div>'},function(e,t){e.exports='<div id=node-properties-wrapper> <div id=node-properties-panel style=font-size:10px> <% if (optionRequired) { %> <div id=option-wrapper> </div> <% } else { %> <div id=node-type><%= currentNode.getFormTitle() %></div> <div id=node-name-and-description-div> <% if (!(currentNode instanceof Magellan.Models.TriggerNode)) { %> <div class=node-name-div> <div class=header-font style=margin-bottom:4px>Node Name</div> <input type=text value="<%= _.escape(currentNode.nodeInfo.name) %>" data-name=name id=node-name-input class=ld-input-large style="border:1px solid var(--lt-grey-2)"/> </div> <hr class=horizontal-line-separator> <% } %> <div class="description-div collapsible-outer-container"> <div class="description-label collapsible-section-header">Description</div> <br/> <textarea class="description-input collapsible-section" id=node-description-input><%= currentNode.nodeInfo.description %></textarea> </div> </div> <hr class=horizontal-line-separator> <div id=node-partial-wrapper> </div> <div class=button-div style="margin:20px 0;text-align:center"> <% if (Magellan.Controllers.GUI.isInteractive) { %> <div class="ld-tertiary-large-button node-panel-button cancel" style=margin-right:4px>Cancel</div> <div class="ld-primary-large-button node-panel-button ok" style=margin-left:4px>OK</div> <% } else { %> <div class="ld-primary-large-button node-panel-button ok" style=margin-left:4px>Close</div> <% } %> </div> <% } %> </div> </div> '},function(e,t){e.exports='<div class=dropdown style="outline:1px solid #9eb7cb;margin-right:8px;width:100%"> <div class="dropdown-toggle <%= dropdownClass %>" id="<%= chooserId %>" data-toggle=dropdown aria-haspopup=true aria-expanded=true> <span class=dropdown-selection><%= chosenNode %></span> <span class=ld-caret></span> </div> <ul class="dropdown-menu dropdown-menu-right node-choice-list" aria-labelledby="<%= chooserId %>"> <li class="dropdown-choice node-choice-none" style=color:#aaa>None</li> <% $(legalNodes).each(function(i, item){ %> <li class=dropdown-choice data-value="<%= item.nodeInfo["name"]%>" data-choice="<%= item.nodeInfo["name"]%>"><%= item.nodeInfo["name"] %></li> <% }) %> <li class="dropdown-choice node-choice-end" data-value="END OF FLOW">END OF FLOW</li> </ul> </div>'},function(e,t){e.exports='<div id=node-properties-wrapper> <div id=node-type style=font-size:11px><%= nodeType %></div> <div id=hat-choosing-div> <span class=header-font>Please select one of the following:</span> <div class=control-group> <% _.each(hatOptions, function(option) { %> <label class="control control--radio" data-value="<%= option.value %>"><span class=header-font><%= option.name %></span><%= option.description ? " - " + option.description : "" %> <input type=radio id=hat-radio-l2a name=radio data-hat="<%= option.value %>" <%= selectedOption === option.value ? "checked" : "" %>/> <div class=control__indicator data-value="<%= option.value %>"></div> </label> <% }); %> </div> <div class=button-div style="margin:20px 0;text-align:center"> <% if (Magellan.Controllers.GUI.isInteractive) { %> <div class="ld-button cancel" style=margin-right:4px>Cancel</div> <div class="ld-button ok" style=margin-left:4px>OK</div> <% } else { %> <div class="ld-button ok" style=margin-left:4px>Close</div> <% } %> </div> </div> </div> '},function(e,t){e.exports='<div class=section-wrapper-spacing> <div class="header-font header-spacing">Task Status</div> <div id=taskStatusDropdown class=createTaskTypeahead style="margin:0 300px 0 0"></div> </div> <div id=invalidTaskStatus class=node-form-error-text></div> <div class=section-wrapper-spacing> <div class="header-font header-spacing">Task Subject</div> <div id=taskSubjectDropdown class=createTaskTypeahead style="margin:0 300px 0 0"></div> </div> <div class=section-wrapper-spacing> <div class="header-font header-spacing">Task Priority</div> <div id=taskPriorityDropdown class=createTaskTypeahead style="margin:0 300px 0 0"></div> </div> <div id=invalidTaskPriority class=node-form-error-text></div> <div class=section-wrapper-spacing> <div class=control-group id=oc-date-radio-control> <div class="header-font header-spacing">Due Date</div> <label class="control control--radio"> <div>None</div> <input type=radio name=oc-date-radio-control data-date-type=noDueDate /> <div class=control__indicator></div> </label> <label class="control control--radio"> <div>Relative Date</div> <input type=radio name=oc-date-radio-control data-date-type=taskDays /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div style=margin-left:30px> (Task Creation Date) + <input type=text id=dueDateDays class="<%= taskDays > 0 ? \'\' : \'input-invalid\' %>" value="<%= taskDays > 0 ? taskDays : \'\' %>" style=width:30px /> days </div> </div> <label class="control control--radio"> Specific Date <input type=radio name=oc-date-radio-control data-date-type=specificDate /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div style=display:inline-flex;margin-left:30px> <input type=text class="dg_date-input <%= dueDateInvalid ? \'input-invalid\' : \'\' %>" id=dueDatePicker /> <label class=dg_date-label for=dueDatePicker style=top:0></label> </div> </div> </div> </div> '},function(e,t){e.exports='<div class="node-opp-stage-div section-wrapper-spacing"> <div class="header-font header-spacing">Stage</div> <div id=opportunityStageDropdown style="margin:0 300px 0 0"></div> </div> <hr class=horizontal-line-separator> <div class="node-opp-date-div section-wrapper-spacing"> <div class=control-group id=oc-date-radio-control> <div class="header-font header-spacing">Close Date</div> <label class="control control--radio"> <div>Relative Date</div> <input type=radio name=oc-date-radio-control data-date-type=closeDays /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div style=margin-left:30px> (Opportunity Creation Date) + <input type=text id=oppDateDays class="<%= closeDays > 0 ? \'\' : \'input-invalid\' %>" value="<%= closeDays > 0 ? closeDays : \'\' %>" style=width:30px /> days </div> </div> <label class="control control--radio"> Specific Date <input type=radio name=oc-date-radio-control data-date-type=specificDate /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div style=display:inline-flex;margin-left:30px> <input type=text class="dg_date-input <%= closeDateInvalid ? \'input-invalid\' : \'\' %>" id=oppDatePicker /> <label class=dg_date-label for=oppDatePicker style=margin-top:0;top:5px></label> </div> </div> </div> </div>'},function(e,t){e.exports='<% if (showFailureNotificationForm) { %> <span class="ld-field-label-small send-notification-header">Email Notifications</span> <% } %> <span class="upsell-wide-badge upsell-button" data-feature="routing notifications on" onclick=\'dashboardController.showPackagingPopup(this,"upsell")\'>UPGRADE</span> <div class=collapsible-section style=margin-right:20px> <div class=success-notification-wrapper> <% if (showFailureNotificationForm) { %> <label class="cb-container-small success-notification-toggle"> <div>Success Notifications</div> <input type=checkbox name=send-notif-form-cb class=send-notif-form-cb data-type=success <%= showSuccessContent ? \'checked\' : \'\' %> /> <span class=checkmark></span> </label> <% } %> <div class="success-notification-content <%= showSuccessContent ? \'\' : \'hidden\' %> "> <div class="send-notification-subcontent success-notification-template-selector"></div> <div class="send-notification-subcontent success-notification-recipient-selector"></div> </div> </div> <% if (showFailureNotificationForm) { %> <div class=failure-notification-wrapper> <label class="cb-container-small failure-notification-toggle"> <div>Failure Notifications</div> <input type=checkbox name=send-notif-form-cb class=send-notif-form-cb data-type=failure <%= showFailureContent ? \'checked\' : \'\' %> /> <span class=checkmark></span> </label> <div class="failure-notification-content <%= showFailureContent ? \'\' : \'hidden\' %> "> <div class="send-notification-subcontent failure-notification-template-selector"></div> <div class="send-notification-subcontent failure-notification-recipient-selector"></div> </div> </div> <% } %> </div> <% if (!showFailureNotificationForm) { %> <div id=advanced-settings-wrapper></div> <% } %> '},function(e,t){e.exports='<div class=rule-div> <% if (!hideFieldValueColumn) { %> <div class=value-field-selection-column> <div class=vertically-centered-container> <div class=vertically-centered-element style=font-weight:600;position:relative;left:5px>Value / Field</div> <div style=text-align:center;margin-top:2px;margin-left:-4px class="side-by-side-control-group vertically-centered-element"> <label class="side-by-side-control control--radio"> <input class=match-type type=radio name="vf_radio_<%= ruleNum %>" value=value data-rule-number="<%= ruleNum %>" <%= condition["value/field"] == "value" ? "checked" : "" %>> <div class=control__indicator></div> </label> <label class="side-by-side-control control--radio"> <input class=match-type type=radio name="vf_radio_<%= ruleNum %>" value=field data-rule-number="<%= ruleNum %>" <%= condition["value/field"] == "field" ? "checked" : "" %>> <div class=control__indicator></div> </label> </div> </div> </div> <% } %> <div class="rule-number-column header-font <%= (isUpdateTrigger && !isFirstCondition) ? \'no-header\' : \'\'%>"> <div style=margin-left:5px;margin-right:5px><%= ruleNum + 1 %>.</div> </div> <div class=matched-field-column> <div> <% if (!isUpdateTrigger || isFirstCondition) { %> <span style=font-weight:600><%= (conditionObjects["leftOperand"].label + \' Field\').trim() %></span> <% } %> <div class=nested-dropdown-container></div> </div> </div> <div class="operator-column <%= isUpdateTrigger ? \'wider-column\' : \'\'%>"> <div style=margin-right:10px> <% if (!isUpdateTrigger || isFirstCondition) { %> <span style=font-weight:600><%= conditionObjects["operator"].label || "Operator" %></span> <% } %> <div class=operator-dropdown></div> </div> </div> <div class=value-field-column> <div class=value-field-container style=margin-right:8px> <% if (condition.operator !== "has changed" && condition.operator !== "is null" && condition.operator !== "not null") { %> <% if (!isUpdateTrigger || isFirstCondition) { %> <span class="value-field-label text-capitalize" style=font-weight:600> <%= condition["value/field"] === "field" ? conditionObjects["rightOperand"].label + " " : "" %> <%=condition["value/field"]%> </span> <% } %> <% if (condition["value/field"] === "field" || useBooleanDropdown) { %> <div class=right-operand-dropdown id=right-operand-dropdown></div> <% } else { %> <input style=padding-left:3px;height:32px;border-radius:3px class="<%= dropdownValid ? \'\' : \'input-invalid\' %> change-condition-value width-fill dropdown-nested" type=text value="<%= _.escape(condition.operand) || \'\' %>"> <% } %> <div class=temp-operand-dropdown id=temp-operand-dropdown></div> <% } %> </div> </div> <% if (!isOnlyCondition) { %> <div class="delete-column <%= (isUpdateTrigger && !isFirstCondition) ? \'no-header\' : \'\'%>" data-rule-number="<%= ruleNum %>"></div> <% }%> <% if (isUpdateTrigger) { %> <div class="and-column <%= (isUpdateTrigger && !isFirstCondition) ? \'no-header\' : \'\'%>"><%= !isLastCondition ? \'AND\' : \'\' %></div> <% } %> </div> <div class="input-message ld-text-danger" style=font-size:1em;margin-top:10px></div> <div class="error-message ld-text-danger" style=font-size:.9em;margin-top:10px></div> '},function(e,t){e.exports='<div class=rule-div> <div class=value-field-selection-column> <div class=vertically-centered-container> <div class=val-field-header style=margin-bottom:5px>Value / Field</div> <div class="side-by-side-control-group val-field-content"> <label class="side-by-side-control control--radio"> <input class=match-type type=radio name="vf_radio_<%= ruleNum %>" value=value data-rule-number="<%= ruleNum %>" <%= fieldType == "value" ? "checked" : "" %>> <div class=control__indicator></div> </label> <label class="side-by-side-control control--radio"> <input class=match-type type=radio name="vf_radio_<%= ruleNum %>" value=field data-rule-number="<%= ruleNum %>" <%= fieldType == "field" ? "checked" : "" %>> <div class=control__indicator></div> </label> </div> </div> </div> <div class=value-field-column> <div style=margin-right:8px> <div class="value-field-label text-capitalize" style=font-weight:600;margin-bottom:5px><%= writeType %> Field</div> <div class=write-field-dropdown></div> </div> </div> <div class=matched-field-column> <div> <div style=font-weight:600;margin-bottom:5px><%= fieldType == "field" ? readFieldHeader : "New Value" %></div> <% if (fieldType == "value") { %> <% if (dataType == "BOOLEAN") { %> <div class=boolean-dropdown></div> <% } else { %> <input type=text class="change-condition-value width-fill" style=height:32px value="<%= _.escape(fieldValue) || \'\' %>"/> <% } %> <% } else { %> <div class=read-field-dropdown></div> <% } %> </div> </div> <div class=delete-column data-rule-number="<%= ruleNum %>"></div> </div> <div class="input-message ld-text-danger" style=font-size:1em;margin-top:10px></div> <div class="error-message ld-text-danger" style=font-size:.9em;margin-top:10px></div> '},function(e,t){e.exports='<div class=rule-div> <div class=matched-field-column> <div> <span style=font-weight:600>SOQL Condition</span> <input class="width-fill change-parameter-input <%= isValid ? \'\' : \'input-invalid\' %>" style=min-height:32px;color:#000;text-shadow:none;margin-top:5px;border-radius:3px data-parameter=soqlCondition value="<%= soqlCondition %>"/> <span class=soqlFeedback style=font-size:9px;color:#d91e18></span> </div> </div> </div> <div class=rule-div> <div class="description-div collapsible-outer-container" style=display:block> <div class="description-label collapsible-section-header" style=margin-bottom:2px;display:inline-block>Description</div><br/> <textarea class="description-input collapsible-section change-parameter-input" id=conditions-description-input data-parameter=description><%= description %></textarea> </div> </div>'},function(e,t){e.exports="<hr class=horizontal-line-separator style=\"display:<%= disableUpdateAccountCheckbox ? 'none;' : 'block;' %>\"> <div class=\"update-account-owner-view collapsible-outer-container\" style=\"display:<%= disableUpdateAccountCheckbox ? 'none;' : 'block;' %>\"> <span class=header-font>Update Contact Account Owner</span> <label class=cb-container-small style=\"margin:10px 0!important\"> <span class=toggleText>Update Contact's Account Owner</span> <input type=checkbox id=updatePrimaryAccountOwner <%= checked ? 'checked' : '' %>> <span class=checkmark></span> </label> </div>"},function(e,t){e.exports='<div class="chart-panel new-graph-tile"> <div class=chart-thumbnail-container> <div class=new-graph-thumbnail></div> </div> </div>'},function(e,t){e.exports='<div id=action-node-account-owner-partial data-node-type=action-account-owner data-form-title="Action – Assign to Matched Account Owner"> <div id=main-div> <span class=header-font><%= primaryObject %> Ownership</span> <div class=control-group id=abr-radio-control> <label class="control control--radio"><%= primaryObject === "Lead" ? "Matched " : ""%>Account Owner <input type=radio class=default-radio-option name=radio data-abr-type="account owner"/> <div class=control__indicator></div> </label> <label class="control control--radio"><%= primaryObject === "Lead" ? "Matched " : ""%>Account Custom User Field <input type=radio name=radio data-abr-type="custom field"/> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div class=label-dropdown-container id=matched-account-custom-user-field-div> <div class=horizontal-tabbing-radio-option-sub-div><div class=dropdown-label>Select the user field to assign the <%= primaryObject.toLowerCase() %> to:</div></div> <div class=horizontal-tabbing-dropdown-input style=width:50%><div class=custom-user-field-selector></div></div> </div> </div> <label class="control control--radio">Account Team <input type=radio name=radio data-abr-type="account team"/> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div class=label-dropdown-container> <div class=dropdown-label id=account-teams>Account teams:</div> <div id=account-team-div></div> <div class=account-team-view-team-link style=margin-left:20px><div id=view-team-link class=ld-link>View Team</div></div> </div> </div> <label class="control control--radio">Owner Mapping <input type=radio name=radio data-abr-type="owner mapping"/> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div class=label-dropdown-container> <div class=dropdown-label id=available-mappings>Available mappings:</div> <div id=owner-mapping-div></div> </div> </div> <% if (actionNodeMetaData.hasCustomAccountBasedRouting && primaryObject === "Lead") { %> <label class="control control--radio">Custom Interface <input type=radio name=radio data-abr-type="custom interface"/> <div class=control__indicator></div> </label> <% } %> </div> </div> <hr class=horizontal-line-separator> <div style=display:inline-block class=alternate-field-assignment-container></div> <div id=update-account-owner></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div> '},function(e,t){e.exports='<div class=action-node-alternate-field-assignment-partial> <span class=header-font>Alternate Field Assignment</span> <label class=cb-container-small style="margin:10px 0!important"> <span class=toggleText>Assign Alternate Field Instead of Owner</span> <input type=checkbox id=alternateFieldAssignment /> <span class=checkmark></span> </label> <div class=label-dropdown-container style=display:flex id=alternate-field-assignment-div> <div class=dropdown-label style=margin-left:45px;margin-right:20px;max-width:180px;display:inline-table;vertical-align:bottom>Select the <%= primaryObject %> user field to assign: </div> <div id=alternate-field-assignment-typeahead style=display:inline-block;min-width:150px></div> </div> </div> '},function(e,t){e.exports='<div id=action-node-convert-partial class=node-partial data-node-type=action-convert data-form-title="Action – Convert"> <div id=main-div> <div> <span class=header-font>Options</span> <label class=cb-container-small style="margin:10px 0!important"> <span class=toggleText>Create an opportunity upon lead conversion</span> <input type=checkbox id=do-not-create-opportunity <%= doNotCreateOpportunity ? \'\' : \'checked="checked"\' %>/> <span class=checkmark></span> </label> <label class=cb-container-small style="display:inline-block;margin-bottom:15px;margin:10px 0!important"> <span class=toggleText>Convert under specified Account:</span> <input type=checkbox id=explicit-account-conversion <%= explicitAccountConversion ? \'checked="checked"\' : \'\' %>/> <span class=checkmark></span> </label> <input id=explicit-account-id class=ld-default-input value="<%= explicitAccountId %>" style=display:inline-block> </div> <div class=label-dropdown-container style=margin-top:10px> <div class=dropdown-label style=margin-right:5px;max-width:105px>Convert Lead Status:</div> <div class=convert-status-dropdown-div id=convert-status-dropdown-div></div> </div> </div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper> </div> </div>'},function(e,t){e.exports='<div id=create-new-account-partial> <div class=header-font id=radio-label>Choose an action:</div> <div class=control-group> <label class="control control--radio">Create Account <input type=radio name=account-creation-choice value="create account only" <%= convertLeadToContact ? \'\' : \'checked="checked"\' %>/> <div class=control__indicator></div> </label> <div style=margin-top:-5px;padding-left:40px class="<%=convertLeadToContact ? \'hidden\' : \'\'%>"> <a href="<%= fieldMappingLink %>" target=_blank> View lead-to-account field mapping. </a> </div> <label class="control control--radio"> Create Account and Convert Lead to Contact Under New Account <% if (convertLeadToContact) { %> <div class=warning-text>Important: This option uses the default Salesforce new account field mapping, not the user-defined LeanData ones.</div> <% } %> <input type=radio name=account-creation-choice value="convert lead to contact" <%= convertLeadToContact ? \'checked="checked"\' : \'\' %>/> <div class=control__indicator></div> </label> <div class="<%=convertLeadToContact ? \'\' : \'hidden\'%> horizontal-tabbing-radio-option-sub-div"> <div class=label-dropdown-container id=convert-status-dropdown-div> <div class=dropdown-label style=margin-right:5px;max-width:120px>Converted Lead Status:</div> <div id=convert-status-typeahead-dropdown></div> </div> </div> </div> <hr class=horizontal-line-separator> <div> <span class=header-font>Options</span> <label class=cb-container-small style="margin:10px 0!important"> <span class=toggleText>Create Opportunity</span> <input type=checkbox id=do-not-create-opportunity <%= doNotCreateOpportunity ? \'\' : \'checked="checked"\' %>> <span class=checkmark></span> </label> </div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper> </div> </div>'},function(e,t){e.exports='<div id=create-new-opportunity-partial class=node-partial data-node-type=action-create-opportunity data-form-title="Action - Create Opportunity"> <div id=account-create-opp-div> <div class="node-opp-name-div section-wrapper-spacing"> <div class="header-font header-spacing">Opportunity Name</div> <input type=text class="<%= oppName.length === 0 ? \'input-invalid\' : \'\' %>" value="<%= oppName %>" data-name=name id=node-opp-name-input /> <div class=warning-text style=padding-bottom:0>New Opportunities will be created under the matched Account.</div> </div> <hr class=horizontal-line-separator> <div class=node-opp-owner-div class=section-wrapper-spacing> <div class="header-font header-spacing">Owner</div> <div class=control-group id=oc-owner-radio-control> <% if (objectType != \'Account\') { %> <label class="control control--radio"> <%= objectType + \' Owner\' %> <input type=radio name=oc-owner-radio-control data-owner-type=ownerAssignment /> <div class=control__indicator></div> </label> <% } %> <label class="control control--radio"> <%= \'Account Owner\' %> <input type=radio name=oc-owner-radio-control data-owner-type=accountOwnerAssignment /> <div class=control__indicator></div> </label> <label class="control control--radio"> Account Team <input type=radio name=oc-owner-radio-control data-owner-type=accountTeamAssignment /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div id=account-team-typeahead class=node-detail-input></div> <div id=invalidAccountTeamText style=margin-left:30px;color:red></div> </div> <label class="control control--radio"> Explicit Owner <input type=radio name=oc-owner-radio-control data-owner-type=explicitOwnerAssignment /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div id=ownerListDropdown class=node-detail-input>Loading...</div> <div id=invalidExplicitOwnerText style=margin-left:30px;color:red></div> </div> <label class="control control--radio"> Custom User Field <input type=radio name=oc-owner-radio-control data-owner-type=customUserField /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div id=custom-user-field-typeahead class=node-detail-input></div> </div> </div> </div> <hr class=horizontal-line-separator> <div id=required-opp-fields-wrapper class=section-wrapper-spacing></div> <hr class=horizontal-line-separator> <div id=additional-opp-fields-wrapper class=section-wrapper-spacing></div> </div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div>'},function(e,t){e.exports='<div id=create-new-opportunity-partial class=node-partial data-node-type=action-create-task data-form-title="Action - Create Task"> <div id=create-task-form-container> <div id=create-task-radio-options-wrapper class=section-wrapper-spacing></div> <div id=other-task-fields-wrapper class=section-wrapper-spacing></div> <div id=additional-task-fields-wrapper class=section-wrapper-spacing></div> </div> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div> '},function(e,t){e.exports="<div id=criteria-list-partial class=criteria-list-partial></div>"},function(e,t){e.exports='<section> <div class=owner-assignment-container> <div class=section-wrapper-spacing> <div class="header-font header-spacing">Route To</div> <div class=control-group> <label class="control control--radio"> Specific Users <input type=radio name=route-to-speicific-user data-category=routedTo data-type="by user id"/> <div class=control__indicator></div> </label> <div class=radio-sub-div style=padding-left:40px> <div class=user-finder-component></div> <div class=selected-owner-label-container> <div class=preset-user-text style=display:inline-block>Selected User:</div> <a href=/ class=selected-user-information-href style=display:inline-block;margin-left:5px target=_blank></a> <div class="selected-user-information-text invalid-user" style=display:inline-block;margin-left:5px>No owner selected</div> </div> </div> <label class="control control--radio"> User Field on Routed <%= LeanData__PrimarySObjectType %> <input type=radio name=route-to-speicific-user data-category=routedTo data-type="user field"/> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div class=label-dropdown-container id=self-referential-field-selection> <div class=horizontal-tabbing-radio-option-sub-div><div class=dropdown-label>Select the user field to assign the <%= LeanData__PrimarySObjectType.toLowerCase() %> to:</div></div> <div class="col horizontal-tabbing-dropdown-input" style=width:50%><div class=custom-user-field-selector></div></div> </div> </div> </div> </div> </div> <hr class=horizontal-line-separator> <div style=display:inline-block class=alternate-field-assignment-container></div> <div id=update-account-owner class=update-account-owner></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper class=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </section>'},function(e,t){e.exports='<div id=action-node-lead-owner-partial class=node-partial data-node-type=action-lead-owner data-form-title="Action – Assign to Matched Lead Owner"> <div id=main-div> <span class=header-font>Lead Ownership</span> <div class=control-group id=a2bbr-radio-control> <label class="control control--radio"><%= primaryObject === "Lead" ? "Matched " : ""%>Lead Owner <input type=radio class=default-radio-option name=radio data-a2bbr-type="lead owner"/> <div class=control__indicator></div> </label> <label class="control control--radio"><%= primaryObject === "Lead" ? "Matched " : ""%>Lead Custom User Field <input type=radio name=radio data-a2bbr-type="custom field"/> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div class=label-dropdown-container id=matched-lead-custom-user-field-div> <div class=horizontal-tabbing-radio-option-sub-div><div class=dropdown-label>Select the user field to assign the <%= primaryObject.toLowerCase() %> to:</div></div> <div class="col horizontal-tabbing-dropdown-input" style=width:50%><div class=custom-user-field-selector></div></div> </div> </div> <% if (actionNodeMetaData.hasCustomLeadBasedRouting && primaryObject === "Lead") { %> <label class="control control--radio">Custom Interface <input type=radio name=radio data-a2bbr-type="custom interface"/> <div class=control__indicator></div> </label> <% } %> </div> <hr class=horizontal-line-separator> <div id=excludeQueueOwnedDiv> <span class=header-font>Queue Owned Leads</span> <label class=cb-container-small style="margin:10px 0!important"> <span class=toggleText id=excludeQueueOwnedLabel>Prevent Routing to Queues</span> <input type=checkbox id=excludeQueueOwned /> <span class=checkmark></span> </label> </div> </div> <hr class=horizontal-line-separator> <div style=display:inline-block class=alternate-field-assignment-container></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div> '},function(e,t){e.exports='<div class=filter-div style=padding-bottom:15px></div> <div class=circle>2</div><div class="header-font has-object-label" style=display:inline-block>Prioritize <%= isDupeNode ? "Duplicate" : "Matched" %> <%= pluralObjects %></div> <div style=margin-left:30px;margin-bottom:8px class=has-object-label> Identify the ultimate <%= isDupeNode ? "duplicate" : "matched" %> <%= singleObject.toLowerCase() %> to be selected in cases where LeanData finds multiple <%= isDupeNode ? "duplicate" : "matched" %> <%= pluralObjects.toLowerCase() %>. </div> <div id=criteria-list-partial class=criteria-list-partial></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div>'},function(e,t){e.exports='<div id=action-node-merge-partial class=node-partial data-node-type=action-merge data-form-title="Action – Merge Dupe Contact"> <div class=label-dropdown-container id=merge-status-dropdown-div> <div class=dropdown-label style=margin-right:5px;max-width:105px>Merge Lead Status:</div> <div id=merge-status-typeahead-dropdown></div> </div> <div class="merge-contact-error-message error-message"></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper /> </div>'},function(e,t){e.exports='<div id=action-node-merge-partial class=node-partial data-node-type=action-merge data-form-title="Action – Merge Dupe Lead"> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper> </div> </div>'},function(e,t){e.exports='<div id=action-node-opportunity-owner-partial class=node-partial data-node-type=action-opportunity-owner data-form-title="Action – Assign to Matched Opportunity Owner"> <div id=main-div> <span class=header-font><%=primaryObject%> Ownership</span> <div class=control-group id=obr-radio-control> <label class="control control--radio">Matched Opportunity Owner <input type=radio class=default-radio-option name=radio data-obr-type="opportunity owner"/> <div class=control__indicator></div> </label> <label class="control control--radio">Matched Opportunity Custom User Field <input type=radio name=radio data-obr-type="custom field"/> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div class=label-dropdown-container> <div class=dropdown-label id=select-user>Select the user field to assign the <span class=text-lowercase><%=primaryObject%></span> to:</div> <div id=matched-opportunity-custom-user-field-div></div> </div> </div> </div> </div> <hr class=horizontal-line-separator> <div style=display:inline-block class=alternate-field-assignment-container></div> <div id=update-account-owner></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div>'},function(e,t){e.exports='<div id=outreach-add-to-sequence-partial class=node-partial data-node-type=action-outreach-add-to-sequence data-form-title="Action - Add to Sequence"> <% if (!partnerAuthorizations[\'outreach\']) { %> <div class=ld-body-medium><span class=error-message> Outreach is not authorized; please authorize under Admin > Partner Apps </span></div> <% } %> <div class=section-wrapper-spacing> <div class="header-font header-spacing">Sequence Assignment</div> <div style=display:flex;align-items:center> <div class=control-group style=margin-left:7px> Add Prospect to Sequence </div> <div class=outreach-sequences-typeahead style=margin-left:17px;width:300px> </div> <img id=refresh-sequences-typeahead src="<%= iconToURLMap[\'Refresh Icon\'] %>" style=cursor:pointer;height:20px;margin-left:10px /> </div> <div class="sequences-error-text error-message" style=margin-left:150px;display:none> Not a Valid Sequence </div> </div> <div class=section-wrapper-spacing> <div class="header-font header-spacing" style=display:flex> <span>Mailbox for Email Delivery</span> <div class="ld-tooltip-hint mailbox-user-tooltip" style=margin-left:5px></div> </div> </div> <div id=radio-record-owner></div> <div style=display:flex> <div id=radio-custom-user-field></div> <div id=outreach-user-field-typeahead-container style=display:flex;align-items:center> <span class=custom-user-field-typeahead style=margin-left:17px;width:300px> </span> </div> </div> <div> <div style=display:flex> <div id=radio-specific-user></div> <div id=outreach-users-typeahead-container> <div style=display:flex;align-items:center> <span class=outreach-users-typeahead style=margin-left:17px;width:300px> </span> <img id=refresh-users-typeahead src="<%= iconToURLMap[\'Refresh Icon\'] %>" style=cursor:pointer;height:20px;margin-left:10px /> </div> <div class="users-error-text error-message" style=margin-left:22px;display:none> Not a Valid User </div> </div> </div> </div> <hr class=horizontal-line-separator /> <div id=advanced-settings-wrapper></div> </div> '},function(e,t){e.exports='<div class=reroute-node-form> <div class=reroute-time-config-container> <div> <span class=ld-field-label-small>Time Frame</span> <div class=ld-body-small> Set the time frame after which the following rules will be evaluated. <span style=font-style:italic>(Note: There may be up to a 2 minute delay)</span> </div> </div> <div style=padding-left:20px> <div style=display:flex;width:250px> <div style=flex:3> <div class=ld-body-small style="margin:5px 0">Days</div> <div class=time-days-container style=display:inline-flex;margin-left:0;width:75px;vertical-align:middle></div> </div> <div style=flex:3> <div class=ld-body-small style="margin:5px 15px">Hours</div> <div class=time-hours-container style=display:inline-flex;margin-left:10px;width:75px;vertical-align:middle></div> </div> <div style=flex:3> <div class=ld-body-small style="margin:5px 15px">Minutes</div> <div class=time-minutes-container style=display:inline-flex;margin-left:10px;width:75px;vertical-align:middle></div> </div> </div> <div class="error-message time-frame-error" style=margin-top:5px> </div> </div> </div> <br/> <hr class=horizontal-line-separator> <div> <span class=ld-field-label-small>Rules</span> </div> <div id=criteria-list-partial class=reroute-edges-config-container></div> </div>'},function(e,t){e.exports='<div id=action-node-round-robin-partial class=node-partial data-node-type=action-round-robin data-form-title="Action – Round Robin"> <div id=main-div> <div class=header-font><%= capitalizedObjectType %> Ownership</div> <div>Specify the Round Robin group used to assign <%= graphType %> ownership.</div> <div class=label-dropdown-container id=round-robin-group-dropdown-div style=margin-top:8px> <div class=dropdown-label style=margin-right:5px;max-width:105px>Round Robin Group:</div> <div id=round-robin-typeahead></div> <div class=round-robin-view-group-link style=margin-left:8px><div id=view-group-link class=ld-link>view group</div></div> </div> <div class="rr-error-message-div error-message"></div> <hr class=horizontal-line-separator> <div style=display:inline-block class=alternate-field-assignment-container></div> <div id=update-account-owner></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div> </div>'},function(e,t){e.exports='<div id=salesloft-add-to-cadence-partial class=node-partial data-node-type=action-salesloft-add-to-cadence data-form-title="Action - Add to Cadence"> <% if (!partnerAuthorizations[\'salesloft\']) { %> <div class=ld-body-medium><span class=error-message> Salesloft is not authorized; please authorize under Admin > Partner Apps </span></div> <% } %> <div class=section-wrapper-spacing> <div class="header-font header-spacing">Cadence Assignment</div> <div style=display:flex;align-items:center> <div class=control-group style=margin-left:7px> Add Person to Cadence </div> <div class=salesloft-cadences-typeahead style=margin-left:17px;width:300px> </div> <img id=refresh-cadences-typeahead src="<%= iconToURLMap[\'Refresh Icon\'] %>" style=cursor:pointer;height:20px;margin-left:10px /> </div> <div class="cadences-error-text error-message" style=margin-left:150px;display:none> Not a Valid Cadence </div> </div> <div class=section-wrapper-spacing> <div class="header-font header-spacing" style=display:flex> <span>Assignee for Cadence</span> <div class="ld-tooltip-hint assignee-user-tooltip" style=margin-left:5px></div> </div> </div> <div id=radio-record-owner></div> <div style=display:flex> <div id=radio-custom-user-field></div> <div id=salesloft-user-field-typeahead-container style=display:flex;align-items:center> <span class=custom-user-field-typeahead style=margin-left:17px;width:300px> </span> </div> </div> <div> <div style=display:flex> <div id=radio-specific-user></div> <div id=salesloft-users-typeahead-container> <div style=display:flex;align-items:center> <span class=salesloft-users-typeahead style=margin-left:17px;width:300px> </span> <img id=refresh-users-typeahead src="<%= iconToURLMap[\'Refresh Icon\'] %>" style=cursor:pointer;height:20px;margin-left:10px /> </div> <div class="users-error-text error-message" style=margin-left:22px;display:none> Not a Valid User </div> </div> </div> </div> <hr class=horizontal-line-separator /> <div id=advanced-settings-wrapper></div> </div> '},function(e,t){e.exports='<div id=action-node-territory-routing-partial class=node-partial data-node-type=action-territory-routing data-form-title="Action – Route To Territory"> <div id=main-div> <div class=label-dropdown-container id=segment-dropdown-div> <div class=dropdown-label style=margin-right:5px>Choose a Territory Segment:</div> <div id=territory-segment-typeahead-dropdown></div> </div> <div id=territory-routing-field-mapping-title style=display:none;margin-bottom:10px;margin-top:20px> <div class=header-font>Fields Used for Assignment</div> <div style=margin-bottom:10px>Select the fields to be checked for a Territory assignment.</div> <div style=margin-bottom:30px class=territory-routing-field-mapping id=territory-routing-field-mapping></div> </div> </div> <hr class=horizontal-line-separator> <div class=alternate-field-assignment-container></div> <div id=update-account-owner></div> <div id=populateTerritoryFieldDiv class=action-node-alternate-field-assignment-partial style=margin-top:10px> <span class=header-font>Territory Field Tagging</span> <label class=cb-container-small style="margin:10px 0!important"> <span class=toggleText>Tag LD Territory Field on <%= LeanData__PrimarySObjectType %> Record When Routed</span> <input type=checkbox id=populateTerritoryField> <span class=checkmark></span> </label> <div class=label-dropdown-container id=populateTerritoryDropdown style=display:none> <div class=dropdown-label style=margin-left:45px;margin-right:20px;max-width:180px;display:inline-table>Select the field on the <%= LeanData__PrimarySObjectType %> to tag:</div> <span id=populateTerritoryFieldDropdown></span></div> <div id=onlyTagTerritoryDropdown style=display:none> <label class=cb-container-small> <span class=toggleText>Only tag the <%= LeanData__PrimarySObjectType %> with the Territory Field. The <%= LeanData__PrimarySObjectType %> will not be routed/assigned.</span> <input type=checkbox id=onlyTagTerritory> <span class=checkmark></span> </label> </div> </div> </div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> '},function(e,t){e.exports='<div id=trigger-node-partial class=node-partial data-node-type=trigger data-form-title=Trigger> <div class=header-font id=radio-label><%= isUpdateTrigger ? "Updated" : "New" %> <span class=text-capitalize><%=pluralObjectType%></span> to be sent through the <span class=text-lowercase><%=objectType%></span> workflow </div> <div class=filter-div></div> <div id=conditions-edit-div></div> <% if (!isUpdateTrigger) { %> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper> </div> <% } %> </div>'},function(e,t){e.exports='<div class=control-group id=filter-type-radio-control> <label class="control control--radio"><span class=has-object-label>SOQL Rule</span> <input class=rule-type-radio type=radio name=radio data-rule-type=soql <%= ruleType === "soql" ? "checked" : ""%>> <div class=control__indicator></div> </label> <div id=soql-rule-wrapper></div> <label class="control control--radio"><span class=has-object-label>Logic Rule</span> <input class=rule-type-radio type=radio name=radio data-rule-type=conditions <%= ruleType === "conditions" ? "checked" : ""%>> <div class=control__indicator></div> </label> <div id=condition-set-wrapper></div> <hr class=horizontal-line-separator> <div class=criteria-list-partial></div> <div id=advanced-settings-wrapper></div> </div>'},function(e,t){e.exports='<div id=action-node-update-partial class=node-partial data-node-type=action-update data-form-title="Action – Update Lead"> <div class=main-div> <div id=update-lead-rows-div class=so-field-updater-container> </div> </div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div>'},function(e,t){e.exports='<div id=action-node-update-partial class=node-partial data-node-type=action-update data-form-title="Action – Update Lead"> <div class=main-div> <% if (allowAssignmentRule) { %> <div class=header-font>Lead Assignment Rule</div> <div style=margin-right:10px;width:40%> <div class="dropdown width-fill dropdown-border <%= isSelectionValid ? \'\' : \'input-invalid\' %>"> <div class=dropdown-toggle data-toggle=dropdown aria-haspopup=true aria-expanded=true> <span class="dropdown-selection lead-field-value"><%= assignmentRuleSelectionObject ? assignmentRuleSelectionObject.Name : assignmentRuleSelection ? assignmentRuleSelection : "" %></span> <span class=ld-caret></span> </div> <ul class="dropdown-menu dropdown-scroll"> <% _.each(assignmentRules, function(item){ %> <li class="assignment-rule-selection dropdown-choice" data-choice="<%= item.Id %>"><%= item.Name %></li> <% }); %> </ul> </div> </div> <div class="error-message <%= isSelectionValid ? \'hidden\' : \'\' %>">Previously selected lead assignment rule <%= assignmentRuleSelection %> is no longer valid</div> <% } %> <div id=update-lead-rows-div class=so-field-updater-container> </div> </div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div>'},function(e,t){e.exports='<ul class=stencil-dropdown-list> <% _.each(stencilTypes, function(stencil) { %> <li class=stencil-dropdown-list-item> <img class=stencil-dropdown-image data-stencil="<%= stencilName %>" data-stencilmodel="<%= stencil.get("stencilModel") %>" src="<%= iconToURLMap[stencil.get("dropdownImage")] %>"/> <span class=stencil-dropdown-label> <%= stencil.get("dropdownLabel") %> </span> </li> <% }); %> </ul>'},function(e,t){e.exports='<defs> <pattern id=img1 x=0 y=0 width=20 height=20 patternunits=userSpaceOnUse> <image xlink:href="<%= iconToURLMap["Arrow Anchor"] %>" x=10 y=5 width=11 height=11></image> </pattern> <pattern id=edge-arrow-selected x=0 y=0 width=20 height=20 patternunits=userSpaceOnUse> <image xlink:href="<%= iconToURLMap["Edge Arrow Selected"] %>" x=10 y=5 width=11 height=11></image> </pattern> <pattern id=edge-arrow x=0 y=0 width=20 height=20 patternunits=userSpaceOnUse> <image xlink:href="<%= iconToURLMap["Edge Arrow"] %>" x=10 y=5 width=11 height=11></image> </pattern> <pattern id=imgAnchor x=0 y=0 width=20 height=20 patternunits=userSpaceOnUse> <image xlink:href="<%= iconToURLMap["Unselected Anchor"] %>" x=10 y=5 width=11 height=11></image> </pattern> <pattern id=graph-paper-background x=0 y=0 width=106 height=106 patternunits=userSpaceOnUse> <rect fill="rgba(0,0,0, 0.07)" x=95 y=0 width=1 height=106 /> <rect fill="rgba(0,0,0, 0.07)" x=0 y=44 width=106 height=1 /> </pattern> <filter id=dark-grey-shadow> <fegaussianblur stddeviation=3 result=offsetBlur /> <feflood flood-color=#808080 flood-opacity=0.9 result=offsetColor /> <fecomposite in=offsetColor in2=offsetBlur operator=in result=compBlur /> <femerge> <femergenode in=compBlur /> <femergenode in=SourceGraphic /> </femerge> </filter> <filter id=light-orange-glow> <fegaussianblur stddeviation=3 result=offsetBlur /> <feflood flood-color=#FF6600 flood-opacity=0.65 result=offsetColor /> <fecomposite in=offsetColor in2=offsetBlur operator=in result=compBlur /> <femerge> <femergenode in=compBlur /> <femergenode in=SourceGraphic /> </femerge> </filter> <filter id=dark-orange-glow> <fegaussianblur stddeviation=3 result=offsetBlur /> <feflood flood-color=#FF6600 flood-opacity=0.95 result=offsetColor /> <fecomposite in=offsetColor in2=offsetBlur operator=in result=compBlur /> <femerge> <femergenode in=compBlur /> <femergenode in=SourceGraphic /> </femerge> </filter> </defs> '},function(e,t){e.exports='<div class=ld-tooltip> <div class="ld-tooltip-close-icon ld-cross-icon-grey-small"></div> <div class=ld-tooltip-title><%= title %></div> <div class=ld-tooltip-body><%= body %></div> </div> '},function(e,t){e.exports='<div id=board-container> <div id=graph-status-indicator class=dg_inner-wrapper-header> <div class=toolbar-button-wrapper> <div id=graph-settings-menu class=top-button style=border-bottom:none;border-right:none;width:52px> </div> <% if (chosenGraphIdMap[objectType] === liveGraphIdMap[objectType]) { %> <div id=save-deploy-button class=ld-primary-large-button style=width:145px> Save & Deploy </div> <% } %> <div id=save-button class="ld-primary-large-button <% if (magellanPage === \'main\' || magellanPage === \'main-contact\' || magellanPage === \'main-account\' || magellanPage === \'main-opportunity\') { %> <% if (chosenGraphIdMap[objectType] === liveGraphIdMap[objectType]) { %> save-as <% } else { %> save <% } %> <% } else { %> history-save-as <% } %> "> <% if (magellanPage === \'main\' || magellanPage === \'main-contact\' || magellanPage === \'main-account\' || magellanPage === \'main-opportunity\') { %> <%= chosenGraphIdMap[objectType] !== liveGraphIdMap[objectType] ? "Save" : "Save As" %> <% } else { %> Save a Copy <% } %> </div> <div id=close-button class="ld-tertiary-large-button <%= magellanPage === \'deploymentMetrics-lead\' || magellanPage === \'deploymentHistory\' || magellanPage === \'deploymentMetrics-contact\' || magellanPage === \'deploymentHistory-contact\' || magellanPage === \'deploymentHistory-account\' || magellanPage === \'deploymentMetrics-account\' || magellanPage === \'deploymentHistory-opportunity\' || magellanPage === \'deploymentMetrics-opportunity\' ? \'close-history\' : \'close-builder\'%>"> Close </div> <% if (graphType !== \'deployed\') { %> <div id=validate-button class=ld-tertiary-large-button <%= (magellanPage === \'main\' || magellanPage ===\'main-contact\' || magellanPage === \'main-account\' || magellanPage === \'main-opportunity\') ? \'\' : \'style="display:none;"\' %> > Validate </div> <% } %> <div class=zoom-wrapper> <div class="zoom-button zoom-out"> <image class=zoom-out-icon src=#RESOURCEURL#/images/Minus_icon.png /> </div> <div class=zoom-slider> <input type=range min=0 max=500 value=250 steps=1 list=snapMiddle id=zoom-slider-input> <datalist id=snapMiddle> <option>250</option> </datalist> </div> <div class="zoom-button zoom-in"> <image class=zoom-in-icon src=#RESOURCEURL#/images/Plus_icon.png /> </div> <div class=zoom-status> <span class=zoom-status-text> 100 </span> <input type=text style=display:none class=zoom-status-input> <span class=zoom-status-unit> % </span> </div> </div> </div> <% if (graphType === \'deployed\') { %> <div id=metrics-display class=top-button> <div class=enabled-div style=display:none;margin-left:17.5px> <input class="styledInput view-metrics" id=view-metrics name=view-metrics type=checkbox> <label for=view-metrics>Metrics</label> </div> <div class=routing-type-container style=display:flex> <span class="top-button-label routing-type-label top-button-label-line-break">Routing <br> Type</span> <select class=routing-type-dropdown> <option class=routing-type-select-option disabled=disabled data-type=continuous>Continuous</option> <option id=one-time-routing class=routing-type-select-option disabled=disabled data-type=one-time>One-Time</option> </select> </div> <div class="select-wrapper for-one-time-routing-only"> <span class=top-button-label>One-Time Run</span> <select id=one-time-run-list></select> </div> <div class="select-wrapper for-continuous-routing-only"> <span class="top-button-label top-button-label-line-break"><%= window.LeanData__PrimarySObjectType %> <br> Type</span> <select id=stat-type-select> <option value=all>All</option> <option value=new>New</option> <option value=updated>Updated</option> </select> </div> <div class="dg_date-text for-continuous-routing-only" style=display:inline-flex;align-items:center;margin-left:12.5px> <span class=top-button-label>Dates</span> <input type=text class=dg_date-input id=metricswrapper-initial-date style="margin:0 0 0 2.5px"> <span style=margin-left:7.5px>to</span> <input type=text class=dg_date-input id=metricswrapper-end-date style="margin:0 0 0 2.5px"> </div> </div> <% } %> <% if (graphType === \'draft\') { %> <div class=hide-on-inspect> </div> <% } %> <div class=graph-title-container></div> <% if (graphType !== \'deployed\') { %> <div id=graph-status-container> <div id=graph-status-message></div> <div id=graph-status-message-icon></div> <div id=graph-status-message-description></div> </div> <% } %> </div> <div class=dg-inner-wrapper-content style="clear:both;border:solid thin;border-color:transparent"> <div id=board class="<%= (Magellan.Util.checkIfReadOnlyGraph() ? "read-only-graph" : "") %> <%= boardClasses %>"> <div id=paper-wrapper> <div id=paper-overlay> </div> <div id=paper class=show-labels> <div id=html-edge-menu></div> <div id=html-multiple-links-menu></div> </div> </div> <% if (Magellan.Util.checkIfReadOnlyGraph()) { %> <ul class="noty_inline_layout_container i-am-new" style=width:100%;height:auto;margin:0;padding:0;list-style-type:none;position:absolute;top:0> <li style="overflow:hidden;border:none!important;border-radius:5px;box-shadow:rgba(0,0,0,.1) 0 2px 4px;color:#fff;cursor:default"> <div class="noty_bar noty_type_information" id=noty_1415168867638666200> <div class=noty_message><span class=noty_text>This graph cannot be edited.</span></div> </div> </li> </ul> <% } %> <% if (graphType === \'draft\') { %> <ul id=node-group-container class=hide-on-inspect> <li class="node-group-item toggle-match-nodes"> <image class=node-group-item-image style=width:21px;height:20px src="<%= resourceURL + \'/images/Match_Node_Small.png\' %>" data-stencilmodel=Magellan.Models.MatchNodeStencil data-image-width=86 data-image-height=86></image> <image class=node-group-item-label-arrow src="<%= resourceURL + \'/images/Palette_Icon_Arrow.png\' %>"></image> <div class=node-group-item-label>Match</div> <div class="stencil-overlay match-node-stencil"></div> <div class="stencil-overlay match-node-stencils-dropdown"></div> </li> <li class="node-group-item toggle-decision-nodes"> <image class=node-group-item-image src="<%= resourceURL + \'/images/Decision_Node_Small.png\' %>" style=width:24px;height:16px data-image-width=113 data-image-height=113></image> <image class=node-group-item-label-arrow src="<%= resourceURL + \'/images/Palette_Icon_Arrow.png\' %>"></image> <div class=node-group-item-label>Decision</div> <div class="stencil-overlay decision-node-stencils-dropdown"> <div class="joint-theme-default joint-stencil" style=display:none> <div class="stencil-paper-drag joint-theme-default joint-paper" style=width:1px;height:1px> <div class=joint-paper-background></div> <div class=joint-paper-grid></div> <svg xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink version=1.1 id=v-283 width=100% height=100%> <g id=v-284 class=joint-viewport></g> <defs id=v-285></defs> </svg> </div> <div class=content> <div class="elements joint-theme-default joint-paper" style=width:199px;height:121px> <div class=joint-paper-background></div> <div class=joint-paper-grid></div> <svg xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink version=1.1 id=v-280 width=100% height=100%> <g id=v-281 class="joint-viewport decision-g-container"> <g id=j_25 class="cell type-magellan type-magellan-models type-magellan-models-stencilelement element toggle-true-false-nodes decision-submenu" data-type=Magellan.Models.StencilElement fill=#ffffff stroke=none transform=translate(0,0)> <g class=stencil-dropdown-item id=v-332> <rect class="stencil-dropdown-item-rect true-false-rect" width=198 height=40 stroke-width=1 id=v-333 fill="rgba(255, 255, 255, 1)" stroke="rgba(230, 230, 230, 1)"> </rect> <image class=stencil-dropdown-item-image height=35 width=35 xlink:href="<%= resourceURL + \'/images/True_False_Icon.png\' %>" transform="translate(5, 3)"></image> <text class=stencil-dropdown-item-label fill=#555555 transform="translate(45, 24)"> True/False </text> <image class=stencil-dropdown-label-arrow height=4 width=4.5 transform="translate(3.5, 31.5)" xlink:href="<%= resourceURL + \'/images/Palette_Icon_Arrow.png\' %>"></image> </g> </g> <g id=j_26 class="cell type-magellan type-magellan-models type-magellan-models-stencilelement element toggle-branch-nodes decision-submenu" data-type=Magellan.Models.StencilElement fill=#ffffff stroke=none transform=translate(0,40)> <g class=stencil-dropdown-item id=v-335> <rect class="stencil-dropdown-item-rect branch-rect" width=198 height=40 stroke-width=1 id=v-336 fill="rgba(255, 255, 255, 1)" stroke="rgba(230, 230, 230, 1)"> </rect> <image class=stencil-dropdown-item-image height=35 width=35 xlink:href="<%= resourceURL + \'/images/Branch_Icon.png\' %>" transform="translate(5, 3)"></image> <text class=stencil-dropdown-item-label fill=#555555 transform="translate(45, 24)"> Branch </text> <image class=stencil-dropdown-label-arrow height=4 width=4.5 transform="translate(3.5, 31.5)" xlink:href="<%= resourceURL + \'/images/Palette_Icon_Arrow.png\' %>"></image> </g> </g> </g> <defs id=v-282></defs> </svg> <div class="stencil-overlay true-false-node-stencils-dropdown toggle-true-false-nodes"></div> <div class="stencil-overlay branch-node-stencils-dropdown toggle-branch-nodes"></div> </div> </div> </div> </div> </li> <li class="node-group-item toggle-action-nodes"> <image class=node-group-item-image src="<%= resourceURL + \'/images/Action_Node_Small.png\' %>" style=width:30px;height:14px></image> <image class=node-group-item-label-arrow src="<%= resourceURL + \'/images/Palette_Icon_Arrow.png\' %>"></image> <div class=node-group-item-label>Action</div> <div class="stencil-overlay action-node-stencils-dropdown"></div> </li> <li class="node-group-item toggle-reroute-nodes"> <image class=node-group-item-image src="<%= resourceURL + \'/images/TIME-NODE_TOOL-BAR@2x.png\' %>" style=width:30px;height:14px></image> <image class=node-group-item-label-arrow src="<%= resourceURL + \'/images/Palette_Icon_Arrow.png\' %>"></image> <div class=node-group-item-label>Time-Based</div> <div class="stencil-overlay reroute-node-stencils-dropdown"></div> </li> <% /* If no partners have valid nodes, don\'t show outreach node. */ %> <% if (partners.menuValidity[objectType].length !== 0) { %> <li class="node-group-item toggle-partner-nodes"> <image class=node-group-item-image src="<%= resourceURL + \'/images/partner-node_icon_2x.png\' %>" style=width:31px;height:17px></image> <image class=node-group-item-label-arrow src="<%= resourceURL + \'/images/Palette_Icon_Arrow.png\' %>"></image> <div class=node-group-item-label>Partner</div> <div class="stencil-overlay partner-node-stencils-dropdown"> <div class="joint-theme-default joint-stencil" style=display:none> <div class="stencil-paper-drag joint-theme-default joint-paper" style=width:1px;height:1px> <div class=joint-paper-background></div> <div class=joint-paper-grid></div> <svg xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink version=1.1 id=v-283 width=100% height=100%> <g id=v-284 class=joint-viewport></g> <defs id=v-285></defs> </svg> </div> <div class=content> <div class="elements joint-theme-default joint-paper" style=width:199px;height:81px> <div class=joint-paper-background></div> <div class=joint-paper-grid></div> <svg xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink version=1.1 id=v-280 width=100% height=100%> <g id=v-281 class="joint-viewport partner-g-container"> <% /* We loop through every integration. */ %> <% for (let [index, partner] of partners.partnerList.entries()) { %> <% if (partners.menuValidity[objectType].includes(partner.name)) { %> <% if (!partner.enabled) { %> <g class="cell type-magellan type-magellan-models type-magellan-models-stencilelement element partner-submenu disabled-node-submenu" data-type=Magellan.Models.StencilElement data-offset="<%= index * 40 %>" fill=#ffffff stroke=none transform="translate(0,<%= index * 40 %>)" data-submenu-key="<%= partner.name.toLowerCase() %>"> <g class="stencil-dropdown-item unauthorized-stencil" id=v-332> <rect class="stencil-dropdown-item-rect <%= partner.name.toLowerCase() %>-rect" width=198 height=40 stroke-width=1 id=v-333 fill=var(--lt-grey-1_5) stroke=var(--lt-grey-2)></rect> <image class=stencil-dropdown-item-image height=35 width=35 xlink:href="<%= resourceURL + partner.disabledIconURL %>" transform="translate(5, 3)"></image> <text class=stencil-dropdown-item-label fill=#b3b3b3 transform="translate(45, 24)"> <%= partner.name %> </text> <image xlink:href="<%= iconToURLMap["Upgrade Sash"] %>" x=137.5 y=0.5 width=60px /> </g> </g> <% } else if (partner.authorized) { %> <g class="cell type-magellan type-magellan-models type-magellan-models-stencilelement element toggle-<%= partner.name.toLowerCase() %>-nodes partner-submenu" data-type=Magellan.Models.StencilElement fill=#ffffff stroke=none transform="translate(0,<%= index * 40 %>)"> <g class=stencil-dropdown-item id=v-332> <rect class="stencil-dropdown-item-rect <%= partner.name.toLowerCase() %>-rect" width=198 height=40 stroke-width=1 id=v-333 fill=var(--white) stroke=var(--lt-grey-2)></rect> <image class=stencil-dropdown-item-image height=35 width=35 xlink:href="<%= resourceURL + partner.iconURL %>" transform="translate(5, 3)"></image> <text class=stencil-dropdown-item-label fill=#555555 transform="translate(45, 24)"> <%= partner.name %> </text> <image class=stencil-dropdown-label-arrow height=4 width=4.5 transform="translate(3.5, 31.5)" xlink:href="<%= resourceURL + \'/images/Palette_Icon_Arrow.png\' %>"></image> </g> </g> <% } else { %> <g class="cell type-magellan type-magellan-models type-magellan-models-stencilelement element unauthorized-<%= partner.name.toLowerCase() %>-nodes partner-submenu unauthorized-stencil" data-type=Magellan.Models.StencilElement data-offset="<%= index * 40 %>" fill=#ffffff stroke=none transform="translate(0,<%= index * 40 %>)"> <g class="stencil-dropdown-item unauthorized-stencil" id=v-332> <rect class="stencil-dropdown-item-rect <%= partner.name.toLowerCase() %>-rect" width=198 height=40 stroke-width=1 id=v-333 fill=var(--white) stroke=var(--lt-grey-2)></rect> <image class=stencil-dropdown-item-image height=35 width=35 xlink:href="<%= resourceURL + partner.disabledIconURL %>" transform="translate(5, 3)"></image> <text class=stencil-dropdown-item-label fill=#b3b3b3 transform="translate(45, 19)"> <%= partner.name %> </text> <text class=stencil-dropdown-item-label fill=#b3b3b3 transform="translate(45, 29)" style=font-size:10px>Not Authorized</text> <image class=stencil-dropdown-label-arrow height=4 width=4.5 transform="translate(3.5, 31.5)" xlink:href="<%= resourceURL + \'/images/Palette_Icon_Arrow.png\' %>"></image> </g> </g> <% } %> <% } %> <% } %> </g> <defs id=v-282></defs> </svg> <% for (let partner of partners.partnerList) { %> <div class="stencil-overlay <%= partner.name.toLowerCase() %>-node-stencils-dropdown toggle-<%= partner.name.toLowerCase() %>-nodes" data-partner-enabled="<%= partner.enabled %>"></div> <% } %> <div class=authorize-popup-container style=display:none> <div class=ld-body-large></div> </div> </div> </div> </div> </div> </li> <% } %> </ul> <% } %> <div class="metrics-legend-wrapper hidden"> <ul> <li class=metrics-legend-item data-content="Number of <%=objectType%>s successfully processed within the action node <%if (objectType === \'lead\') {%>(e.g. lead owner routed and assigned to matched account owner)<%}%>"> <div class=legend-icon-col><img src="<%=resourceURL%>/images/Success_Icon.png"/></div> <div class=legend-label-col>Action Success</div> </li> <li class=metrics-legend-item data-content="Number of <%=objectType%>s unsuccessfully processed within the action node <%if (objectType === \'lead\') {%>(e.g. attempt to convert a queue owned lead)<%}%>"> <div class=legend-icon-col><img src="<%=resourceURL%>/images/Failure_Icon.png"/></div> <div class=legend-label-col>Action Failure</div> </li> <li class=metrics-legend-item data-content="Indicates that a particular action node has both <%=objectType%>s successfully processed as well as <%=objectType%>s that were unsuccessfully processed"> <div class=legend-icon-col><img src="<%=resourceURL%>/images/Success_Failure_Icon.png"/></div> <div class=legend-label-col>Action Success / Failure</div> </li> <li class=metrics-legend-item data-content="Number of <%=objectType%>s that are pending to continue processing through Router at this point"> <div class=legend-icon-col><img src="<%=resourceURL%>/images/TIME-NODE_INSIGHTS_LEGEND.png"/></div> <div class=legend-label-col>Pending</div> </li> <li class=metrics-legend-item data-content="Number of <%=objectType%>s that ended their processing through Router at this point"> <div class=legend-icon-col><img src="<%=resourceURL%>/images/EOF_Icon.png"/></div> <div class=legend-label-col>End of Flow</div> </li> </ul> </div> <div id=selectionInfo><span id=selectionInfo-count></span> selected</div> <div id=inspector> <div class="node-inspector joint-theme-default"> <div id=properties-wrapper class=group data-name=text> </div> </div> </div> </div> </div> </div> '},function(e,t){e.exports='<g class="label">\n\t<rect class="edge-name-box"/>\n\t<text class="for-jointjs edge-name" text-anchor="middle" />\n</g>'},function(e,t){e.exports='<g>\n  \n  <% if (Magellan.Controllers.GUI.isInteractive) { %>\n  <image action="paste" class="paste-icon function-menu clickAction" data-action-type="pasteNode"/>\n  <image action="copy" class="copy-icon function-menu clickAction" data-action-type="copyNode"/>\n  <image action="edit" class="edit-icon function-menu clickAction" data-action-type="editNode"/>\n  <image action="delete" class="delete-icon function-menu clickAction" data-action-type="deleteNode"/>\n  <% } %>\n  <image class="main-icon clickAction" data-action-type="selectNode"/>\n  <image class="edge-notification edge-notification-icon clickAction <%=(nodeStats[\'danglingEdges\'] > 0 ? \'\' : \'hidden\')%>" data-action-type="openEdgeMenu"/>\n  <text class="edge-notification edge-notification-number clickAction <%=(nodeStats[\'danglingEdges\'] > 0 ? \'\' : \'hidden\')%>" data-action-type="openEdgeMenu" text-anchor="middle">\n    <tspan><%= nodeStats["danglingEdges"] %></tspan>\n  </text>\n\n  <image class="validation-error-icon <%=(isValid ? \'hidden\' : \'\')%>"/>\n  \n  <% \n  if (node instanceof Magellan.Models.RerouteNode) {\n    var rerouteTimeframe = \'\';\n    _.forEach({\'days\': \'d\', \'hours\': \'h\', \'minutes\': \'m\' }, function(alias, k) {\n      if (node.nodeInfo[k]) rerouteTimeframe += node.nodeInfo[k] + alias + \' \';\n    });\n    rerouteTimeframe = rerouteTimeframe.trim();\n    \n    var centerX = 65 - ((rerouteTimeframe.length * 5) / 2);\n  %>\n  <g height="40" width="40" class="reroute-time-frame-label">\n    <text x="<%=centerX%>" y="55" class="reroute-time-frame-insights" font-size="10px" font-weight="400" fill="#4D4D4D">\n      <%=rerouteTimeframe%>\n    </text>\n  </g>\n    <% \n    if (showMetrics) { \n      var pendingCCIOs = (nodeStats["pendingCCIOs"] || 0) + "";\n      var centerXPending = 92 + (17 - ((pendingCCIOs.length * 5) / 2));\n    %>\n  <g height="40" width="40" class="total-pending-label">\n    <text x="<%=centerXPending%>" y="33" class="reroute-time-frame-insights" font-size="10px" font-weight="400" fill="#FFFFFF">\n      <%=pendingCCIOs%>\n    </text>\n  </g>\n    <% } // end of showMetrics in rerouteNode%>\n  <% } // end of Magellan.Models.RerouteNode %>\n\n  <% if (showMetrics === true && $("#view-metrics").prop("checked")) { %>\n  <% if (node instanceof Magellan.Models.ActionNode || node instanceof Magellan.Models.OutreachNode) { %>\n  <g height="40" width="40" class="metrics-wrapping-g" transform="translate(<%= nodeStats.metricBubbleTranslate %>)">\n    <% if (nodeStats["successStats"] > 0 && nodeStats["failureAndErrorStats"] > 0) { %>\n    <image class="success-failure-icon"/>\n    \x3c!-- put text after image so it draws later --\x3e\n    <text x="10" y="-2" text-anchor="middle" font-size="9px" font-weight="400" fill="#FFFFFF" class="metric-number" transform="translate(10,17)"><%= nodeStats["successStats"] %></text>\n    <text x="10" y="15" text-anchor="middle" font-size="9px" font-weight="400" fill="#FFFFFF" class="metric-number" transform="translate(10,17)"><%= nodeStats["failureAndErrorStats"] %></text>\n    <% } else if (nodeStats["failureAndErrorStats"] > 0) { %>\n    <image class="failure-icon"/>\n    \x3c!-- put text after image so it draws later --\x3e\n    <text x="10" y="6.5" text-anchor="middle" font-size="9px" font-weight="400" fill="#FFFFFF" class="metric-number" transform="translate(10,17)"><%= nodeStats["failureAndErrorStats"] %></text>\n    <% } else { %>\n    <image class="success-icon"/>\n    \x3c!-- put text after image so it draws later --\x3e\n    <text x="10" y="6.5" text-anchor="middle" font-size="9px" font-weight="400" fill="#FFFFFF" class="metric-number" transform="translate(10,17)"><%= nodeStats["successStats"] %></text>\n    <% } %>\n\n  </g>\n  <g class="stat-box node-stats" transform="translate(<%= nodeStats.statBoxTranslate %>)" style="display: none;">\n    <rect class="node-stats-rect" width="<%= ((nodeStats[\'longestEdgeMetricLength\'] + nodeStats[\'longestEdgeNameLength\']) * 4.5) + 40 %>" height="<%= nodeStats[\'infoBoxHeight\'] %>" rx="5" ry="5" style="stroke-width:1px;stroke:var(--med-grey-1);fill:var(--white);"></rect>\n    <text class="stats-number node-stats-metrics" x="10" y="20" font-size="10px">\n      <% var userStartDate = $("#metricswrapper-initial-date").datepicker("getDate") ? $("#metricswrapper-initial-date").datepicker("getDate").getTime() : \'null\'; %>\n      <% var userEndDate = $("#metricswrapper-end-date").datepicker("getDate") ? $("#metricswrapper-end-date").datepicker("getDate").getTime() : \'null\'; %>\n      <% var statType = $("#stat-type-select").val() || \'new\' %>\n      <% var link = \'/apex/Dashboard?deploymentId=\' + currentGraphId + \'&nodeName=\' + encodeURIComponent(node.nodeInfo.name) + \'&userStartDate=\' + userStartDate + \'&userEndDate=\' + userEndDate + \'&objectType=\' + window.LeanData__PrimarySObjectType + \'&statType=\' + statType; %>\n      <% var successEdgeNames = node.getSuccessEdgeNames(); %>\n      <% for (var i = 0; i < successEdgeNames.length; i++) { %>\n\n      <% if (showDetailsLink) { %><a xlink:href="<%= _.escape(link + \'&statusKey=success\' + \'#routing/\'+objectType+\'/metrics\') %>" target="_blank"><% } %><tspan x="10" y="<%= (i + 1) * 25 %>" fill="var(--ld-green)" font-weight="600" class="node-stats-metric-number"><%= node.getEdgeStats(successEdgeNames[i]) %></tspan><% if (showDetailsLink) { %></a><% } %>\n      <% if (node.nodeInfo.actionType === "Custom Interface") { %>\n      <tspan x="<%= nodeStats[\'metricToNameOffset\'] %>" y="<%= (i + 1) * 25 %>" fill="#000" font-weight="300" class="node-stats-metric-name"><%= _.escape(successEdgeNames[i]) %></tspan>\n      <% } else { %>\n      <tspan x="<%= nodeStats[\'metricToNameOffset\'] %>" y="<%= (i + 1) * 25 %>" fill="#000" font-weight="300" class="node-stats-metric-name"><%= _.escape(Magellan.Util.getEdgeName(node, successEdgeNames[i])) %></tspan>\n      <% } %>\n      <% } %>\n      <% if (nodeStats["failureAndErrorStats"] > 0) { %>\n      <tspan x="10" y="<%= ((i + 1) * 25) + 10 %>" fill="#d91e18" font-weight="600" class="node-stats-metric-name">Failures</tspan>\n\n      <% i = i + 1 %>\n      <% var failureEdgeNames = node.getFailureEdgeNames() %>\n      <% for (var j = i; j < failureEdgeNames.length + i; j++) { %>\n      <% if (showDetailsLink) { %><a xlink:href="<%= _.escape(link + \'&statusKey=error\' + \'#routing/\'+objectType+\'/metrics\') %>" target="_blank"><% } %><tspan x="10" y="<%= ((j + 1) * 25) + 10 %>" fill="#d91e18" font-weight="600" class="node-stats-metric-number"><%= node.getEdgeStats(failureEdgeNames[j - i]) %></tspan><% if (showDetailsLink) { %></a><% } %>\n      <tspan x="<%= nodeStats[\'metricToNameOffset\'] %>" y="<%= ((j + 1) * 25) + 10 %>" fill="#000" font-weight="300" class="node-stats-metric-name"><%= Magellan.Migration.getFormattedEdgeName(failureEdgeNames[j - i]) %></tspan>\n      <% } %>\n      <% var errorEdgeNames = node.getErrorEdgeNames() %>\n      <% for (var k = j; k < errorEdgeNames.length + j; k++) { %>\n      <% if (showDetailsLink) { %><a xlink:href="<%= _.escape(link + \'&statusKey=error\' + \'#routing/\'+objectType+\'/metrics\') %>" target="_blank"><% } %><tspan x="10" y="<%= ((k + 1) * 25) + 10 %>" fill="#d91e18" font-weight="600" class="node-stats-metric-number"><%= node.getEdgeStats(errorEdgeNames[k - j]) %></tspan><% if (showDetailsLink) { %></a><% } %>\n      <tspan x="<%= nodeStats[\'metricToNameOffset\'] %>" y="<%= ((k + 1) * 25) + 10 %>" fill="#000" font-weight="300" class="node-stats-metric-name"><%= Magellan.Migration.getFormattedEdgeName(errorEdgeNames[k - j]) %></tspan>\n      <% } %>\n      <% } %>\n    </text>\n  </g>\n  <% } else if (node instanceof Magellan.Models.DecisionNode || node instanceof Magellan.Models.MatchNode || node instanceof Magellan.Models.RerouteNode) { %>\n  <g height="40" width="40" class="metrics-wrapping-g" transform="translate(<%= nodeStats.EOFBubbletranslate %>)">\n    <% var nodeEOFStats = node.getEndOfFlowStats(); %>\n    <% if (nodeEOFStats > 0) { %>\n    <image class="end-of-flow-icon"/>\n    \x3c!-- put text after image so it draws later --\x3e\n    <text x="10" y="5" text-anchor="middle" font-size="9px" font-weight="400" fill="#FFFFFF" class="metric-number" transform="translate(10,17)"><%= nodeEOFStats %></text>\n    <% } %>\n  </g>\n  <g class="stat-box node-stats" transform="translate(<%= nodeStats.statBoxTranslate %>)" style="display: none;">\n    <rect class="node-stats-rect" width="<%= ((nodeStats[\'longestEdgeMetricLength\'] + nodeStats[\'longestEdgeNameLength\']) * 4.5) + 40 %>" height="<%= nodeStats[\'infoBoxHeight\'] %>" rx="5" ry="5" style="stroke-width:1px;stroke:var(--med-grey-1);fill:var(--white);"></rect>\n    <text class="stats-number node-stats-metrics" x="10" y="20" font-size="10px">\n      <% var userStartDate = $("#metricswrapper-initial-date").datepicker("getDate") ? $("#metricswrapper-initial-date").datepicker("getDate").getTime() : \'null\'; %>\n      <% var userEndDate = $("#metricswrapper-end-date").datepicker("getDate") ? $("#metricswrapper-end-date").datepicker("getDate").getTime() : \'null\'; %>\n      <% var statType = $("#stat-type-select").val() || \'new\' %>\n      <% var link = \'/apex/Dashboard?deploymentId=\' + currentGraphId + \'&nodeName=\' + encodeURIComponent(node.nodeInfo.name) + \'&userStartDate=\' + userStartDate + \'&userEndDate=\' + userEndDate + \'&objectType=\' + window.LeanData__PrimarySObjectType + \'&statType=\' + statType; %>\n      <% var successEdgeNames = node.getSuccessEdgeNames(); %>\n      <% for (var i = 0; i < successEdgeNames.length; i++) { %>\n      <% if (showDetailsLink) { %><a xlink:href="<%= _.escape(link + \'&statusKey=endOfFlow\' + \'#routing/\'+objectType+\'/metrics\') %>" target="_blank"><% } %><tspan x="10" y="<%= (i + 1) * 25 %>" fill="var(--ld-green)" font-weight="600" class="node-stats-metric-number"><%= node.getEndOfFlowStats() %></tspan><% if (showDetailsLink) { %></a><% } %>\n      <% if (node.nodeInfo.actionType === "Custom Interface") { %>\n      <tspan x="<%= nodeStats[\'metricToNameOffset\'] %>" y="<%= (i + 1) * 25 %>" fill="#000" font-weight="300" class="node-stats-metric-name"><%= _.escape(successEdgeNames[i]) %></tspan>\n      <% } else { %>\n      <tspan x="<%= nodeStats[\'metricToNameOffset\'] %>" y="<%= (i + 1) * 25 %>" fill="#000" font-weight="300" class="node-stats-metric-name"><%= _.escape(Magellan.Util.getEdgeName(node, successEdgeNames[i])) %></tspan>\n      <% } %>\n      <% } %>\n    </text>\n  </g>\n  <% } %>\n  <% } else {%>\n    <image class="auxiliary-icon clickAction" data-action-type="selectNode"/>\n    <% } %>\n  \n  <text class="node-name-text-box node-text clickAction" data-action-type="selectNode">\n    <% if (node.nodeInfo.objectType) { %>\n    <tspan class="object-hat"><%= node.nodeInfo.objectType == \'Opportunity\' ? \'Opp\' : node.nodeInfo.objectType %></tspan>\n    <% } %>\n    <tspan class="line-1"><%= node.nameLines[0] || "" %></tspan>\n    <tspan class="line-2"><%= node.nameLines[1] || "" %></tspan>\n    <tspan class="line-3"><%= node.nameLines[2] || "" %></tspan>\n  </text>\n</g>\n'},function(e,t){e.exports='<g class="label">\n    <rect class="wrapper-box opacity-50pct" />\n    \n    <g class="image-wrapper edge-metric-number-group">\n        <rect class="metric-number-box"></rect>\n        <text class="stats-number metric-number"></text>\n    </g>\n    \n    <rect class="edge-name-box"/>\n    <text class="for-jointjs edge-name" text-anchor="middle"/>\n\n    <g class="stat-box edge-stats" style="display: none;">\n        \x3c!-- Populate by createMetricInfoBoxContent() --\x3e\n    </g>\n</g>'},function(e,t){e.exports='<g class="stencil-dropdown-item <%= stencil.attributes.isDisabled ? \'disabled-stencil\' : \'\' %>" data-node-model="<%= stencil.attributes.nodeModel %>">\n  <rect class="stencil-dropdown-item-rect" width="198" height="41.5" stroke-width="1">\n  </rect>\n  <image class="stencil-dropdown-item-image" xlink:href="<%= stencil.attributes.isDisabled && stencil.dropdownImage + \' Disabled\' in iconToURLMap ? iconToURLMap[stencil.dropdownImage + \' Disabled\'] : iconToURLMap[stencil.dropdownImage] %>"\n    <% if (stencil.iconType === "match icon") { %>\n    height="20" width="21" transform="translate(13, 9.5)"\n    <% } else if (stencil.iconType === "decision icon") { %>\n    height="16" width="24" transform="translate(13, 13)"\n    <% } else { %>\n    height="35" width="35" transform="translate(5, 3)"\n    <% } %>\n  ></image>\n  <text class="stencil-dropdown-item-label" fill="<%= stencil.attributes.isDisabled ? \'#b3b3b3\' : \'#555555\'%>" transform="translate(45, 24)">\n    <%= stencil.dropdownLabel %>\n  </text>\n  <% if (stencil.attributes.isDisabled) { %>\n    <image xlink:href="<%= iconToURLMap["Upgrade Sash"] %>" x="137.5" y="0.5" width="60px"/>\n  <% } %>\n</g>\n'},function(e,t){e.exports=function(){return Backbone.Model.extend({defaults:{showPartnerCards:!0,partnersList:[],selectedPartnerModel:{},authMetadata:{}}})}},function(e,t,i){e.exports=function(){const e=i(408)(),t=i(406)();return Backbone.View.extend({template:_.template(i(332)),initialize:function(e){this.parseDataAndUpdateModel(e),this.on("partnerCardClicked",this.partnerCardClickedHandler),this.render()},events:{"click #return-to-partner-apps":"returnToPartnerApps"},parseDataAndUpdateModel:function(e){console.log(e);let t=[],i=Object.keys(e.metadata.authorizedPartnerMetadata);for(let n of Object.keys(e.metadata.configurationInstructions)){let a=JSON.parse(e.metadata.configurationInstructions[n]);i.includes(n)?(a.isAuthorized=!0,a.authorizedDate=moment(e.metadata.partners[n].AuthorizedDate).format("MM/DD/YYYY hh:mm:ss A"),a.authorizedBy=e.metadata.partners[n].LastModifiedByName,e.metadata.integrationConfig[n]?a.integrationConfig=JSON.parse(e.metadata.integrationConfig[n]):"salesloft"===n&&(a.integrationConfig={applicationId:null,clientSecret:null,retryTime:10,retryTimeUnit:"Minutes"})):"outreach"===n?a.integrationConfig={applicationId:null,clientSecret:null,leadProspectIdField:null,contactProspectIdField:null,userIdField:null,retryTime:10,retryTimeUnit:"Minutes"}:"salesloft"===n&&(a.integrationConfig={applicationId:null,clientSecret:null,retryTime:10,retryTimeUnit:"Minutes"}),a.fieldMappingOptions=e.metadata.fieldMappingOptions,a.mappingFields="outreach"===n?[{name:"Lead",sObject:"lead",integrationConfigKey:"leadProspectIdField"},{name:"Contact",sObject:"contact",integrationConfigKey:"contactProspectIdField"},{name:"User",sObject:"user",integrationConfigKey:"userIdField"}]:"salesloft"===n?[]:e.metadata.mappingFields,t.push(a)}this.model.set("partnersList",t)},returnToPartnerApps:function(){this.model.set("selectedPartnerModel",[]),this.model.set("selectedPartnerName",""),this.model.set("showPartnerCards",!0),this.render()},partnerCardClickedHandler:function(e){const t=this.model.get("partnersList").find(t=>t.partnerName===e);void 0!==t&&(this.model.set("selectedPartnerModel",t),this.model.set("selectedPartnerName",t.partnerName),this.model.set("showPartnerCards",!1),this.render())},render:function(){const i=this.template({model:this.model.toJSON()});if(this.$el.html(i),this.model.get("showPartnerCards"))this.model.get("partnersList").forEach(t=>{const i=new e({model:t,parent:this});this.$el.find(".partner-apps-content").append(i.$el)}),this.$el.find(".breadCrumbContainer").hide(),this.$el.find(".partner-apps-summary").show();else{let e=new t({model:this.model.get("selectedPartnerModel"),parent:this});this.$el.find(".partner-apps-content").html(e.$el),this.$el.find(".breadCrumbContainer").show(),this.$el.find(".partner-apps-summary").hide()}return this}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(333)),initialize:function(){const e=i(407)();this.instructionsView=new e(this.model.partnerName.toLowerCase(),{partnerData:this.model}),this.render(),this.hasIntegrationConfigChanged=!1},authorizationURLGenerators:{Outreach:(e,t)=>`https://accounts.outreach.io/oauth/authorize?client_id=${e}&redirect_uri=${t}&response_type=code&scope=accounts.all+callDispositions.all+callPurposes.all+calls.all+events.all+mailings.all+mailboxes.all+personas.all+prospects.all+sequenceStates.all+sequenceSteps.all+sequences.all+stages.all+taskPriorities.all+users.all+tasks.all+snippets.all+templates.all+rulesets.all+opportunities.all+opportunityStages.all+sequenceTemplates.all+customValidations.all+webhooks.all+teams.all+mailboxContacts.all+meetingTypes.all+experiments.all+phoneNumbers.all+meetingFields.all+customDuties.all+duties.all+favorites.all`,Salesloft:(e,t)=>`https://accounts.salesloft.com/oauth/authorize?client_id=${e}&redirect_uri=${t}&response_type=code`},events:{"input .ld-input-large":"handleInputChange","change .cb-container-large":"toggleCheckbox","click #authorize-update-button":"saveConfigurationSettings"},saveConfigurationSettings:function(){console.log("this.model.integrationConfig",this.model.integrationConfig),Magellan.Controllers.FlowBuilder.savePartnerIntegrationConfiguration(this.model.partnerName.toLowerCase(),JSON.stringify(this.model.integrationConfig),JSON.stringify(this.model.mappingFields)).then((e,t)=>{if(200===t.statusCode){const e=this.model.integrationConfig.applicationId,t=this.authorizationURLGenerators[this.model.partnerName](e,this.model.callbackUrl);window.location=t}})},toggleCheckbox:function(e){this.$el.find("#confirm-config-checkbox").is(":checked")?this.enableAuthorizeUpdateButton():this.$el.find("#authorize-update-button").addClass("disabled")},handleInputChange:function(e){const t=e.target.id;let i="";"app-id-input"===t?i="applicationId":"client-secret-input"===t?i="clientSecret":"retry-time-input"===t&&(i="retryTime"),this.updateIntegrationConfigHelper(i,this.$el.find("#"+t).val()),this.enableAuthorizeUpdateButton()},updateIntegrationConfigHelper(e,t){this.model.integrationConfig[e]!==t&&(this.model.integrationConfig[e]=t,this.hasIntegrationConfigChanged=!0)},initializeFieldMappingDropdowns:function(){this.model.mappingFields.forEach(e=>{let t=new Magellan.Views.LDDropdown({required:!1,value:this.model.isAuthorized?this.model.fieldMappingOptions[e.sObject].filter(t=>t.value===this.model.integrationConfig[e.integrationConfigKey])[0]:null,options:Magellan.Util.createBlacklistFilter(e.sObject,"value")(this.model.fieldMappingOptions[e.sObject]),size:"large",optionTemplate:function(e){return`<span>${e.label}</span>`},placeholder:"Select "+_.capitalize(e.name)+" Field",onChange:function(e){return function(t){this.handleFieldMappingDropdownChange(e,t)}.bind(this)}.bind(this)(e),datumTokenizer:e=>[].concat(e.label.split(" ")).concat(e.value.split("_"))});this.$el.find("#"+e.integrationConfigKey+"-field-dropdown").html(t.$el)})},handleFieldMappingDropdownChange:function(e,t){this.updateIntegrationConfigHelper(e.integrationConfigKey,t.value),this.enableAuthorizeUpdateButton()},handleRetryTimeDropdownChange:function(e){this.updateIntegrationConfigHelper("retryTimeUnit",e),this.enableAuthorizeUpdateButton()},enableAuthorizeUpdateButton:function(){Object.values(this.model.integrationConfig).includes(null)||!this.$el.find("#confirm-config-checkbox").is(":checked")&&0!==this.model.mappingFields.length||!0!==this.hasIntegrationConfigChanged||this.$el.find("#authorize-update-button").removeClass("disabled")},initializeTimeUnitDropDown:function(){let e=new Magellan.Views.LDDropdown({required:!1,value:this.model.integrationConfig.retryTimeUnit||null,options:["Minutes","Hours","Days"],size:"large",placeholder:null,onChange:(e=>{this.handleRetryTimeDropdownChange(e)}).bind(this)});this.$el.find("#retry-time-unit-dropdown").html(e.$el)},updateConfigurationInput:function(){if(this.model.isAuthorized){let e=this.model.integrationConfig;this.$el.find("#app-id-input").val(e.applicationId),this.$el.find("#client-secret-input").val(e.clientSecret)}this.$el.find("#retry-time-input").val(this.model.integrationConfig.retryTime)},render:function(){const e=this.template({model:this.model});return this.$el.html(e),this.initializeFieldMappingDropdowns(),this.initializeTimeUnitDropDown(),this.updateConfigurationInput(),this.model.isAuthorized&&this.$el.find("#confirm-config-checkbox").prop("checked",!0),0==this.model.mappingFields.length&&this.enableAuthorizeUpdateButton(),this.$el.find(".config-instructions-wrapper").html(this.instructionsView.$el),this}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({templates:{outreach:i(334),salesloft:i(335)},initialize:function(e,t){this.params=t,this.partner=e,this.template=_.template(this.templates[this.partner]),this.render()},render:function(){const e=this.template({params:this.params});this.$el.html(e)}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({tagName:"div",template:_.template(i(336)),initialize:function(e){this.parent=e.parent,this.render()},events:{"click .action-button":"partnerCardClicked","click #disable-authorization":"disablePartnerAuthorization","click #learn-more":"navigateToHelp"},navigateToHelp:function(e){Magellan.Navigation.navigate("help")},disablePartnerAuthorization:function(){Magellan.Controllers.FlowBuilder.disablePartnerAuthorization(this.model.partnerName.toLowerCase()).then((e,t)=>{200===t.statusCode&&new Magellan.Views.ConfirmationModal({header:"Partner Authorization",message:"You have successfully disabled authorization. Please refresh this page.",primaryButtonText:"OK",hideSecondaryButton:!0}).open()})},partnerCardClicked:function(e){const t=$(e.target).data("partnername");this.parent.trigger("partnerCardClicked",t)},render:function(){const e=this.template({model:this.model});return this.$el.html(e),this}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({defaults:{usageMetrics:[],lineValues:[],idToRecordTypeCount:{},leadLineValues:void 0,contactLineValues:void 0,accountLineValues:void 0,opportunityLineValues:void 0,selectedTab:"total",selectedPoint:void 0,renderTableOnly:!1,routingList:[],allRoutingList:[],tempRoutingList:[],hideInactiveUsers:!1,inactiveUserIds:[]}})}},function(e,t,i){e.exports=function(){const e=i(0)(),t=i(78)(),n=i(412)(),a=i(411)();return Backbone.View.extend({template:_.template(i(337)),initialize:function(e){this.formatUsageMetrics(e.routingMetrics.routingCountMetrics,e.startDate,e.endDate),this.model.set("routingUserLicenseCount",e.routingMetrics.routingUserLicenseCount),this.setRoutedToIds(),this.fetchRoutingList(this.model.get("routedToIds")),this.model.set("queryStartDate",this.model.get("startDate")),this.model.set("queryEndDate",this.model.get("endDate"))},render:function(){const e=this.template({model:this.model.toJSON()});return this.$el.html(e),this.createTab(),this.createRoutingMetricsControl(),this.createGraphData(),this.updateMaxUniqueUsers(),this.parseObjectTypeLineValues(),this.renderLineGraph(),this.createRoutingMetricsTable(),this.setListeners(),this.setActiveUserAndRecordCount(),this},createTab:function(){this.graphTabs=new t(["All Routing","Lead","Contact","Account","Opportunity"]),this.$el.find(".line-graph-tab-wrapper").html(this.graphTabs.$el)},createRoutingMetricsControl:function(){this.routingMetricsControl=new a({model:this.model}).bind(this),this.$el.find(".line-graph-control-wrapper").html(this.routingMetricsControl.$el)},createGraphData:function(){const e=this.model.get("usageMetrics").map(function(e,t){e.All_Routing_Users;return{index:t,date:e.Date,count:e.All_Routing_User_Count,metric:e}});this.model.set("lineValues",e)},renderLineGraph:function(){const t=this.model.get("routingUserLicenseCount"),i=Magellan.Util.shortenNumbers(this.model.get("maxUniqueRoutedToCount")),n=this.model.get("recordsRouted").total;this.lineGraphView=new e({cardInfo:this.getCardInfo(t,i,n),legendInfo:this.getLegendInfo(),graphLines:{},params:{width:1050,height:350,margin_top:10,margin_left:15,margin_bottom:30,margin_right:30,tick_format_x:d3.timeFormat("%m/%d"),tick_format_y:function(e){return Math.floor(e)==e?e:void 0},get_data_x:function(e){return e.date},get_data_y:function(e){return e.count},transition_time:700}}),this.$el.find(".line-graph-wrapper").html(this.lineGraphView.$el);const a=this.model.get("lineValues");this.updateGraphLines(a)},createRoutingMetricsTable:function(){this.routingMetricsTable=new n({model:this.model}).bind(this),this.$el.find(".routing-metrics-table-wrapper").html(this.routingMetricsTable.$el)},setListeners:function(){this.listenTo(this.graphTabs,"selectedTab:changed",this.updateGraphAndTable),this.listenTo(this.routingMetricsControl,"dateRange:changed",this.updateDateRange),this.listenTo(this.routingMetricsControl,"exportRoutingUsageButton:clicked",this.exportRoutingUsage),this.listenTo(this.routingMetricsControl,"hideInactiveUsers:changed",this.handleInactiveUsers),this.listenTo(this.lineGraphView,"dataPoint:selected",this.selectPoint),this.listenTo(this.routingMetricsTable,"dateFilter:changed",this.deselectPoint),this.listenTo(this.model,"change:routingList",this.updateMaxUniqueUsers)},updateMaxUniqueUsers:function(){let e=0,t=0,i=0;const n=this.model.get("routingList").filter(e=>e.Count[this.model.get("selectedTab")]>0);for(let a=0;a<n.length;a++)"User"===n[a].Profile?e++:"Queue"===n[a].Profile?t++:"Deleted"===n[a].Profile&&i++;this.model.set("maxUniqueRoutedToCount",e+t+i),this.model.set("maxUniqueUsers",e),this.model.set("maxUniqueQueues",t),this.model.set("deletedUsersOrQueues",i)},handleInactiveUsers:function(){if(!0===this.model.get("hideInactiveUsers")){const e=this.model.get("routingList").filter(e=>"Active"===e.Status);this.model.set("tempRoutingList",this.model.get("routingList")),this.model.set("routingList",e)}else this.model.set("routingList",this.model.get("tempRoutingList")),this.model.set("tempRoutingList",[]);const e=this.model.get("selectedPoint"),t="total"===this.model.get("selectedTab")?"All Routing":this.model.get("selectedTab");if(e){const i=e.index,n=this.getNewSelectedPoint(i,t);e.count!=n.count&&(this.model.set("selectedPoint",void 0),this.selectPoint(n))}else this.lineGraphView.setTransitionDuration(700),this.filterGraphLinesByObject(t,!0)},selectPoint:function(e){if(this.model.get("selectedPoint"))return;this.$el.find(".line-graph-wrapper").LoadingOverlay("show"),this.$el.find(".primary-line, .secondary-line, .tertiary-line").hide(),this.$el.find(".point-selection").show(),this.model.set("selectedPoint",e),this.updateGraphLines(this.model.get("lineValues")),this.lineGraphView.setTransitionDuration(0),this.lineGraphView.updateGraph();const t=moment(this.model.get("selectedPoint").date).format(Magellan.Validation.DATE_FORMAT),i=Magellan.Controllers.FlowBuilder.getUsageMetricsRoutingListOnDate(t);$.when(i).then(function(e){this.updateRoutingListForDate(e),this.updateInactiveUserIds(e.User),this.routingMetricsTable.render(),this.$el.find(".line-graph-wrapper").LoadingOverlay("hide",!0);const t=this.model.get("routingUserLicenseCount"),i=this.model.get("selectedTab");let n=0;const a=this.model.get("inactiveUserIds");for(let t in e.routingMetrics)if(!this.model.get("hideInactiveUsers")||!a.includes(t)){const a=e.routingMetrics[t][i];_.isUndefined(a)||(n+=a)}const o=this.getCardInfo(t,this.model.get("maxUniqueRoutedToCount"),n);this.lineGraphView.updateCardInfo(o)}.bind(this))},createSelectedPointLine:function(){const e=this.model.get("selectedPoint");let t=[];"total"==this.model.get("selectedTab")||_.capitalize(this.model.get("selectedTab"));const i=this.model.get("hideInactiveUsers");return e&&(t=[Object.assign({},e,{count:"total"!=this.model.get("selectedTab")||i?e.count:e.metric.All_Routing_User_Count})]),t},getNewSelectedPoint:function(e,t){const i=Object.assign({},this.model.get("All Routing"===t?"lineValues":t.toLowerCase()+"LineValues").filter(t=>t.index===e)[0]);if(!0===this.model.get("hideInactiveUsers")){const e=this.model.get("inactiveUserIds"),n="All Routing"===t?i.metric.All_Routing_Users:i.metric;i.count=Object.keys(n).filter(t=>!e.includes(t)).length}return i},updateRoutingListForDate:function(e){const t=[];this.formatRoutingList(e.Queue,e.routingMetrics,"Queue",t),this.formatRoutingList(e.User,e.routingMetrics,"User",t),this.includeDeletedUsersAndQueues(t,e.routingMetrics),this.model.set("routingList",t)},deselectPoint:function(e){if(!this.model.get("selectedPoint"))return;this.$el.find(".primary-line, .secondary-line, .tertiary-line").show(),this.$el.find(".point-selection").hide(),this.model.set("selectedPoint",void 0);const t="total"===this.model.get("selectedTab")?"All Routing":this.model.get("selectedTab");if(this.filterGraphLinesByObject(t,!0),this.model.set("routingList",this.model.get("allRoutingList")),!0===this.model.get("hideInactiveUsers")){const e=this.model.get("routingList").filter(e=>"Active"===e.Status);this.model.set("tempRoutingList",this.model.get("routingList")),this.model.set("routingList",e)}this.updateDataCardValues(this.model.get("selectedTab")),e&&(this.lineGraphView.setTransitionDuration(0),this.lineGraphView.updateGraph(),this.routingMetricsTable.render())},exportRoutingUsage:function(){this.routingMetricsTable.downloadCsv()},updateDateRange:function(e){this.deselectPoint(!1);const t=moment(e.startDate).format(Magellan.Validation.DATE_FORMAT),i=moment(e.endDate).format(Magellan.Validation.DATE_FORMAT);this.model.set("hideInactiveUsers",!1),this.$el.find("#hide-inactive-users").prop("checked",!1);const n=Magellan.Controllers.FlowBuilder.getRoutingUsageMetricsAndLicenseCount(t,i);$.when(n).then(function(e){if(_.isEmpty(e.routingCountMetrics)){this.$el.find(".primary-line, .secondary-line, .tertiary-line").hide(),this.model.set("routingList",[]),this.lineGraphView.render();const e=this.getCardInfo(0,0,0);this.lineGraphView.updateCardInfo(e),this.routingMetricsTable.render()}else{this.model.set("allRoutingList",[]),new Promise(function(n,a){this.formatUsageMetrics(e.routingCountMetrics,t,i)?n():a()}.bind(this)).then(()=>this.setRoutedToIds()).then(()=>this.fetchRoutingList(this.model.get("routedToIds")))}}.bind(this))},updateGraphAndTable:function(e){let t=void 0,i=!0;const n=this.model.get("selectedPoint");if(n&&(t=n.index,this.model.set("selectedPoint",void 0),i=!1),this.lineGraphView.setTransitionDuration(700),this.filterRoutingMetricsTableByObject(e,i),this.filterGraphLinesByObject(e,i),t){const i=this.getNewSelectedPoint(t,e);this.selectPoint(i)}"All Routing"!==e&&(console.log(this.$el.find(".data-card-2")),this.$el.find(".data-card-2").hide())},filterRoutingMetricsTableByObject:function(e,t){"All Routing"===e?this.model.set("selectedTab","total"):this.model.set("selectedTab",e.toLowerCase()),this.updateMaxUniqueUsers(),t&&this.routingMetricsTable.render()},filterGraphLinesByObject:function(e,t){this.model.get("hideInactiveUsers");if("All Routing"===e)return this.updateDataCardValues("total"),void this.updateGraphLines(this.model.get("lineValues"));if(t){const t=e.toLowerCase()+"LineValues";this.updateDataCardValues(e.toLowerCase()),this.updateGraphLines(this.model.get(t))}},updateDataCardValues:function(e){let t,i=this.model.get("maxUniqueRoutedToCount");t=this.model.get("hideInactiveUsers")?this.model.get("activeRecordsRouted"):this.model.get("recordsRouted");const n=this.model.get("routingUserLicenseCount"),a=t[e],o=this.getCardInfo(n,i,a);this.lineGraphView.updateCardInfo(o)},fetchRoutingList:function(e){const t=JSON.stringify(e),i=Magellan.Controllers.FlowBuilder.getUsageMetricsRoutingList(t,"User"),n=Magellan.Controllers.FlowBuilder.getUsageMetricsRoutingList(t,"Queue");$.when(i,n).then(function(e,t){this.updateRoutingList(e[0],"User","allRoutingList"),this.updateInactiveUserIds(e[0]),this.updateRoutingList(t[0],"Queue","allRoutingList"),this.includeDeletedUsersAndQueues(this.model.get("allRoutingList"),this.model.get("idToRecordTypeCount")),this.model.set("routingList",this.model.get("allRoutingList")),this.render()}.bind(this))},formatUsageMetrics:function(e,t,i){const n=Magellan.Util.formatUsageMetrics(e);return this.model.set({usageMetrics:n.usageMetrics,recordsRouted:n.recordsRouted,idToRecordTypeCount:n.idToRecordTypeCount,rawRoutingMetrics:e,startDate:moment(t).format("MMMM D, YYYY"),endDate:moment(i).format("MMMM D, YYYY")}),!0},parseObjectTypeLineValues:function(){for(const e of Magellan.Util.objectTypes){const t=e.toLowerCase()+"LineValues",i=this.model.get("lineValues").map(function(t,i){const n=JSON.parse(t.metric[e+"_Routing_Users"]),a=Object.keys(n).length;return{index:i,date:t.date,count:a,metric:n}});this.model.set(t,i)}},setActiveUserAndRecordCount:function(){const e=this.model.get("inactiveUserIds"),t=this.model.get("rawRoutingMetrics");for(let i in t){const n=t[i];for(let t in n){const i=n[t];for(let t in i)e.includes(t)&&delete i[t]}}const i=Magellan.Util.formatUsageMetrics(t);this.model.set({activeUserCount:i.userCount,activeRecordsRouted:i.recordsRouted})},updateRoutingList:function(e,t,i){const n=this.model.get(i);this.formatRoutingList(e,this.model.get("idToRecordTypeCount"),t,n),this.model.set(i,n)},includeDeletedUsersAndQueues:function(e,t){let i=[],n=e.map(e=>e.Id),a=Object.keys(t);for(let e of a)n.includes(e)||i.push(e);for(let n of i){const i={Name:"Deleted",Id:n,Status:"Deleted",Role:"Deleted",Profile:"Deleted",Count:t[n]};e.push(i)}},formatRoutingList:function(e,t,i,n){const a=this.model.get("inactiveUserIds");let o;for(let l of e){o="User"===i?l.IsActive?"Active":"Inactive":"Active";const e={Name:l.Name,Id:l.Id,Status:o,Role:"User"===i?l.Profile.Name:i,Profile:i,Count:t[l.Id]};this.model.get("hideInactiveUsers")&&a.includes(e.Id)||n.push(e)}},setRoutedToIds:function(){const e=[];this.model.get("usageMetrics").map(function(t,i){const n=Object.keys(t.All_Routing_Users);for(let t of n)_.contains(e,t)||e.push(t)}),this.model.set("routedToIds",e)},updateInactiveUserIds:function(e){const t=this.model.get("inactiveUserIds");for(let i of e)i.IsActive||t.includes(i.Id)||t.push(i.Id)},updateGraphLines:function(e){if(void 0!=e){const t=this.model.get("startDate"),i=this.model.get("endDate"),n=this.model.get("routingUserLicenseCount"),a=this.createSelectedPointLine();let o=e;!0===this.model.get("hideInactiveUsers")&&(o=e.map(function(e,t){const i="total"===this.model.get("selectedTab")?"All":_.capitalize(this.model.get("selectedTab"));let n=[];const a="All"===i?e.metric[i+"_Routing_Users"]:e.metric;_.isUndefined(a)||(n=Object.keys(a));const o=n.filter(e=>!this.model.get("inactiveUserIds").includes(e));return{index:e.index,date:e.date,count:o.length,metric:a}}.bind(this))),this.lineGraphView.createAndSetGraphLine(t,i,n,o,a),this.lineGraphView.updateGraph()}},getCardInfo:function(e,t,i){return[{title:"Licensed Users",value:numberWithCommas(e)},{title:"Unique Users",value:numberWithCommas(t)},{title:"Records Routed",value:numberWithCommas(i)}]},getLegendInfo:function(){return["Active Users/Queues","Licensed Users"]}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(338)),initialize:function(){this.render()},events:{"click #update-btn":"changeDateRange","click #export-routing-usage-btn":"exportRouting","click #hide-inactive-users":"toggleHideInactiveUsers"},changeDateRange:function(){const e=this.$el.find("#start-datepicker").datepicker("getDate"),t=this.$el.find("#end-datepicker").datepicker("getDate");this.trigger("dateRange:changed",{startDate:e,endDate:t})},exportRouting:function(){this.trigger("exportRoutingUsageButton:clicked")},toggleHideInactiveUsers:function(e){setTimeout(function(){this.model.set("hideInactiveUsers",e.currentTarget.checked),this.trigger("hideInactiveUsers:changed")}.bind(this),0)},isEqualsOrAfter(e,t){const i=moment(e).format("YYYY-MM-DD"),n=moment(t).format("YYYY-MM-DD");return moment(i).isSame(n)||moment(n).isAfter(i)},openDateWarning(e){new Magellan.Views.ConfirmationModal({header:"Error",message:e,primaryButtonText:"Ok",hideSecondaryButton:!0}).open()},render:function(){const e=this.template({model:this.model.toJSON(),queryStartDate:moment(this.model.get("queryStartDate")).format("MM/DD/YYYY"),queryEndDate:moment(this.model.get("queryEndDate")).format("MM/DD/YYYY")});this.$el.html(e);var t=this;const i={changeMonth:!0,changeYear:!0,onSelect:function(e){const i=this.getAttribute("data-field-name"),n=(t.model.get(i),moment().format("YYYY-MM-DD")),a=moment(t.$el.find(this).datepicker("getDate")).format("YYYY-MM-DD");let o=!0;if(t.isEqualsOrAfter(n,a))t.render(),t.openDateWarning("Date must be before today's date."),o=!1;else if("queryStartDate"===i){const e=t.model.get("queryEndDate");t.isEqualsOrAfter(e,a)&&(t.render(),t.openDateWarning("Start date cannot be after or equals to end date."),o=!1)}else if("queryEndDate"===i){const e=t.model.get("queryStartDate");t.isEqualsOrAfter(a,e)&&(t.render(),t.openDateWarning("End date cannot be before or equals to start date."),o=!1)}o&&(t.model.set(i,a),t.render(),t.changeDateRange())}};return this.$el.find("#start-datepicker").datepicker(i),this.$el.find("#end-datepicker").datepicker(i),this}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(339)),initialize:function(){this.render()},events:{"click .ld-date-filter":"removeDateFilter"},render:function(){const e=this.template({model:this.model.toJSON()});this.$el.html(e),this.graphTable=this.$el.find("#graph-table"),0==this.$el.find(".no-data-row").length&&this.graphTable.DataTable({pageLength:10,dom:'<"ld-table-filter-info"><"ld-table-length"l>t<"ld-table-pagination"<p>>'});let t=this.$el.find(".ld-table-filter-info"),i={Users:this.model.get("maxUniqueUsers"),Queue:this.model.get("maxUniqueQueues"),Deleted:this.model.get("deletedUsersOrQueues")};for(let e of Object.keys(i))i[e]>0&&t.append(`<span class="ld-table-info">${e} <span class="bold">(${i[e]})</bold></span>`);if(this.model.get("selectedPoint")){const e=moment(this.model.get("selectedPoint").date),i=e.format("MMMM"),n=""+e.format("DD");t.append('<span class="ld-date-filter">'+i+" "+n+'<svg width="10" height="10" style="vertical-align: middle; margin-left:10px; position: relative; top: -1px; right: -3px;"><line x1="0" y1="0" x2="10" y2="10" stroke="white" stroke-width="2"/><line x1="0" y1="10" x2="10" y2="0" stroke="white" stroke-width="2"/></svg></span>')}return this},removeDateFilter:function(){this.trigger("dateFilter:changed",!0)},downloadCsv:function(){let e=this.graphTable.DataTable().rows({order:"applied"}).data();const t=(e=e.map(function(e){return e.map(function(e){return(e=(e=e?e.toString():"").replace(/"/g,'""')).search(/("|,|\n)/g)>=0&&(e='"'+e+'"'),e})})).map(function(e){return e.join(",")}).join("\n"),i=new Blob([t],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(i,"export.csv");else{const e=document.createElement("a");if(void 0!==e.download){const t=URL.createObjectURL(i);e.setAttribute("href",t),e.setAttribute("download","export.csv"),"undefined"!=typeof sforce&&e.setAttribute("target","_blank"),e.style.visibility="hidden",document.body.appendChild(e),e.click(),document.body.removeChild(e)}}}})}}]);