<apex:page showHeader="false" controller="liveagent_chatterclass"  pageStyle="overflow-y:auto;">

<apex:pageMessages id="msgs"/>
<apex:includeScript value="{!$Resource.Cookies}"/>
<style type="text/css">
#liveAgentChatLog { 
 border: 1px solid #000;
width: 400px;
height: 300px;}
#j_id0:j_id33:j_id37:j_id38:j_id51:j_id52
{
float:right;clear:both;
}
</style>
<apex:includeScript value="{!$Resource.jquery}"/>
<script src="/soap/ajax/15.0/connection.js" type="text/javascript"></script>
<script src="/soap/ajax/15.0/apex.js" type="text/javascript"></script>
<!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>-->
<!--<apex:stylesheet value="{!URLFOR($Resource.GDCLogo, 'gdc.css')}"/>-->
<apex:stylesheet value="{!URLFOR($Resource.Services_Connectivity, 'gdc.css')}"/>
<script>
var varVal;
var appname=navigator.appName;
var clearvalue=null;
var queuevalue=null;
 $(document).ready(function() {
  setInterval(checkFetchHWProdIndxSearchResultProcess, (0.1 * 1000))
  clearvalue=setInterval(accept, (0.1 * 1000))
  
         if($('button.liveAgentSendButton').length>0)
         {
           $("#liveAgentChatInput").css('display','none');
           $(".liveAgentSendButton").click(function(){
              document.getElementById("j_id0:j_id32:j_id36:j_id37:j_id57:txt1").value='';
              });
         }
         varVal = Get_Cookie('Reason'); 
        
 });
 function checkFetchHWProdIndxSearchResultProcess()
   {
     $(".operator").find('Strong').html('GDC Flight Specialist:');
   }
        
       function accept()
        {
        
        
       if($(".operator").find('Strong').length>0)
        {
                
            $("#waitingMessage").css('display','none');
           
            
        }
        
            
         if($(".operator").find('Strong').length>0)
         
         {
              document.getElementById("liveAgentChatInput").value='Need help on "'+varVal+'"';
              SfdcApp.LiveAgent.Chasitor.sendMessage();
              document.getElementById("j_id0:j_id32:j_id36:j_id37:j_id57:txt1").style.display="inline";
              document.getElementById("j_id0:j_id32:j_id36:j_id37:j_id50:j_id51").style.display="inline";
              document.getElementById("j_id0:j_id32:j_id36:j_id37:j_id50:end").style.display="inline";
             
              clearInterval(clearvalue);
         }
        
        }
        


 function savetext()
 {
  var url = 'https://c.la2c1cs.salesforceliveagent.com/content'+"/s/transcriptDownload";
      var textLog = "";
    /*for (var i=0; i<chatMessages.length; i++) {
        var msg = chatMessages[i].getPublicInterface();
        if (msg.getContent()) {
            textLog += msg.getName()+": "+msg.getContent()+"\n";
        }
    }*/
    var tex=document.getElementById("liveAgentChatLog");
     var textval;
   if (tex)
  {
      if ( tex.textContent )
      { // FF
      
       textval=tex.textContent ;
       textval=textval.replace(/GDC Flight Specialist:/g,"\n GDC Flight Specialist:");
       textLog=textval.replace(/You:/g,"\n You:");
      }
      else
      {
           textval=tex.innerText;  //alert ( divObj.innerHTML );
           textval=textval.replace(/GDC Flight Specialist:/g,"\n GDC Flight Specialist:");
           textval =textval.replace(/You:/g,"\n You:");
           textLog=textval.replace("You've ended the chat.","");
           
      } 
  }  

    var curDate = new Date();
    var month;
    if ( ( curDate.getMonth() + 1 ) < 10 ) {
        month = '0'+String(curDate.getMonth() + 1);
    } else {
        month = String(curDate.getMonth() + 1);
    }

    var date;
    if ( curDate.getDate() < 10 ) {
        date = '0'+String(curDate.getDate());
    } else {
        date = String(curDate.getDate());
    }

    var year = String(curDate.getFullYear());

    var iframe = document.createElement("iframe");
    iframe.style.display = "none";
    iframe.name = (new Date().getTime())+'_'+Math.random();
    document.body.appendChild(iframe);
    Sfdc.Event.add(iframe, "load", function() {
        iframe.parentNode.removeChild(iframe);
        form.parentNode.removeChild(form);
    });

    var form = document.createElement('form');
    form.style.display = 'none';
    form.method = "POST";
    form.action = url;
    form.target = iframe.name;
    document.body.appendChild(form);
    var fields = {
        type: 'clientjs',
        text: textLog,
        name: month+date+year+'_transcript.txt'
    };
    for (var name in fields) {
        var input = document.createElement('input');
        input.type = 'hidden';
        input.name = name;
        input.value = fields[name];
        form.appendChild(input);
    }
    form.submit();
 }
 function test()
 {

  var txtVal1 = document.getElementById("j_id0:j_id32:j_id36:j_id37:j_id57:txt1").value;
  document.getElementById("liveAgentChatInput").value=txtVal1 ;
 
  
 }
 
/**function save()
 {
    set fso = CreateObject("Scripting.FileSystemObject");  
    set s = fso.CreateTextFile("C:\test.txt", True);
    s.writeline( document.getElementById("liveAgentChatLog").value);
    s.Close();
 
 }**/
 function end()
 {
 SfdcApp.LiveAgent.Chasitor.endChat();
  document.getElementById("j_id0:j_id32:j_id36:j_id37:j_id57:txt1").style.display="none";
  document.getElementById("j_id0:j_id32:j_id36:j_id37:j_id50:end").style.display="none";
 }
 function checkenter(e) {
    if (e.keyCode == 13) {
        var txtVal1 = document.getElementById("j_id0:j_id32:j_id36:j_id37:j_id57:txt1").value;
        document.getElementById("liveAgentChatInput").value=txtVal1 ;
        document.getElementById("j_id0:j_id32:j_id36:j_id37:j_id57:txt1").value='';
        SfdcApp.LiveAgent.Chasitor.sendMessage();
        return false;
    }
}
       </script>


<apex:pageBlock >
<center>
<!--<apex:image value="{!$Resource.GDCImage}" width="240" height="75" />--><apex:image value="{!$Resource.ServicesImage}"/></center><br/>
<div id="waitingMessage" class="modal">
<center>
<br/><br/>
<h3>You are now being connected to an agent.</h3>


<img alt="Progress Bar"
 src="https://1.la2c1cs.salesforceliveagent.com/content/images/html_progress_bar.gif"/>
</center>
</div>

<liveAgent:clientchat >
<!--<div id="Queuemesage">
<center>
<br/><br/><br/><br/><br/><br/>
<strong>
You are currently number<liveAgent:clientChatQueuePosition id="Queueposition"/>in queue.
</strong></center>
</div>-->

<div>
<liveAgent:clientChatMessages />
</div>

<div id="chatControls" class="pod" style="width: 400px;">

<apex:form >
<apex:commandButton value="Save Chat" onclick="savetext();" style="display:none;float:right;"  reRender="msgs"/>
<apex:commandButton Id="end" value="End Chat" onclick="end();" style="display:none;" reRender="msgs"/>
</apex:form>
<!--     <input type="button" value="Save" onclick="Save()"/>     -->

</div>
<br/>
<liveAgent:clientChatLog /><br/>

<div id="chatInput" class="pod">
<apex:form >
<apex:inputTextarea value="{!inputtextvalue}" id="txt1"  onkeypress="return checkenter(event)" onblur="test();" 
style="wrap: normal;width: 350px;height: 40px;border: double 3px #000000;word-wrap: break-word; display:none;" />
</apex:form>
<liveAgent:clientChatSendButton id="testbutton" label="Send"/>
<liveagent:clientChatInput />

</div>
</liveAgent:clientchat>
</apex:pageBlock>
<!--<apex:form >
apex:form>-->
<!-- You can customize the window title with the js below -->
<script type="text/javascript">
document.title = "My Custom Live Chat Window";
</script>
<apex:insert name="footer">
        <c:honeywellFooter />
</apex:insert>

</apex:page>