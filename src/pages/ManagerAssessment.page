<apex:page standardController="Sales_Competency__c" extensions="SalesCompetencyRatingController" showHeader="false" sidebar="false" showChat="false" id="page">
    
     <html>
    <head>
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <meta charset="utf-8"/>
    <meta name="description" content=""/>
    <meta http-equiv="X-UA-Compatible" content="IE=8" />
    <script type='text/javascript' src='/soap/ajax/29.0/connection.js'></script>
    <script type='text/javascript' src='/soap/ajax/29.0/apex.js'></script>
 
    <script type="text/javascript"> 
                  
           function cancelfun(){
           var sf1='{!isSF1}';
           if(sf1=='true' && sforce.one){ 
                        
           }
          }
          
          function myClose(){
           // window.opener.location.href='/{!$CurrentPage.parameters.id}';
           window.top.close(); 
          }
    </script>
    <script type="text/javascript">
 
        /*
        *    function to handle checkbox selection
        */
        function doCheckboxChange(cb,itemId)
        {
 
            if(cb.checked==true)
            {
                aSelectItem(itemId);
            }
            else{
                aDeselectItem(itemId);
            }
 
        }
        function checkAll(cb)
        {
            
            var inputElem = document.getElementsByTagName("input");
            for(var i=0; i<inputElem.length; i++)
            {
                if(inputElem[i].id.indexOf("checkedone")!=0)
                inputElem[i].checked = cb.checked;
              
            }
             
        }

</script>
 <script type="text/javascript">
    function SetName() {
        if (window.opener != null && !window.opener.closed) {
            var txtName = window.opener.document.getElementById("su");
            txtName.value = document.getElementById("ddlNames").value;
        }
        window.close();
    }
</script>
    </head>
    
    <table  Class="tablehead" style=" solid #236FBD;text-align:center;" ALIGN="CENTER" cellspacing="5">
    <tr>
      <td><font color="white">Manager Assessment</font></td>
    </tr>
    </table>
    
    
    <apex:form id="frm">
    
    <style type="text/css">
.tablehead {
    border: 6px solid;
    background-color: #236FBD;
    font-weight: bold;
    font-size: 150%;
    color:white;
    border-bottom-left-radius: 25px;    
    border-bottom-right-radius: 25px; 
    border-radius: 15px;
    outline: 2px solid #236fbd;
    text-align:center;
    height:40px;
    white-space: pre-wrap;
    white-space: -moz-pre-wrap;
    word-wrap: break-word;
    }
.totals{
    background-color: #236FBD;
    font-weight: bold;}
.infohead {
    font-size: 200%;
    font-weight: bold;
    padding: 100px 100px 100px 100px;
}
.odd {
    border-bottom: 1px solid #000;
    padding: 2px 2px 4px 4px;
    font-size: 200%;}
.even {
    border-bottom: 1px solid #000;
    padding: 2px 2px 4px 4px;
    font-size: 200%;
  }
.highlightcol {
  background-color: #236FBD;     
}

</style>

<style>
p.normal {position: absolute;
    top: 15px;
    right: 10px;
    font-weight: bold;}
p.small {position: absolute;
    top: 0px;
    right: 10px;
    font-weight: bold;}
</style>

<style type="text/css">

        .popup
        {
            background-color: white;
            border-width: 2px;
            border-style: solid;
            z-index: 9999;
            left: 50%;
            padding:10px;
            position: absolute;
            width: 800px;
            margin-left: -250px;
            top:80px;
            margin-top: 225px;
            column-gap: 40px; 
            border: 4px solid #FFFFFF; 
           -moz-border-radius: 10px;
           -webkit-border-radius: 10px;
        
        }

        .popupBg
        {
            background-color:black;
            opacity: 0.60;
            filter: alpha(opacity = 70);
            position: absolute;
            width: 140%;
            height: 110%;
            top: 0;
            left: 0;
            z-index: 9998;
        }

        .PopupHeaderStyle
        {
            background-color:#003399;
            text-align:left;
        }
        .pageblocktable
        {
          border-style:solid;
          border-color:black;
          border-width: 1px;
          padding: 10px;
        }
        
        .panelWrapper .mainTitle {
    background-color: green !important;
    color:white !important;
    padding: 30px 0 20px 40px !important;
    

   .black_overlay{
        display: none;
        position: absolute;
        top: 0%;
        left: 0%;
        width: 100%;
        height: 100%;
        background-color: black;
        z-index:1001;
        -moz-opacity: 0.8;
        opacity:.80;
        filter: alpha(opacity=80);
    }
    .white_content {
        display: none;
        position: absolute;
        top: 25%;
        left: 25%;
        width: 50%;
        height: 50%;
        padding: 16px;
        border: 3px solid Blue;
        background-color: white;
        z-index:1002;
        overflow: auto;
    }

   
    </style>


<div>
<p class="small"><apex:outputField value="{!Sales_Competency__c.Proficiency_Definitions__c}"/></p>
<p class="normal"><apex:outputField value="{!Sales_Competency__c.Development_Resource__c}"/></p>
</div>

    <apex:pageBlock id="scrpb">
    <apex:pagemessages />
    
    <apex:outputPanel id="userExistsErrorPanel" rendered="{!usernameExists}" >
        <br/>
            <apex:pageMessage title="Error" summary="One or more Competencies below are having Employee Proficiency-Rating below Expected Minimum Proficiency. Please select at least one development need. <br/> <B>{!varB}</B>" severity="error" strength="3" escape="false"/>
            
            <apex:pageMessages />  
        </apex:outputPanel>
    
    <apex:repeat value="{!Sales_Competency__c}" var="a" id="repeat">
    <p style="font-weight: bold;font-size: 120%;color:black;text-align:left;"><B>Sales Competency Assessment:</b>&nbsp;&nbsp;&nbsp;<apex:outputtext value="{!a.Name}" style="font-weight: bold;font-size: 150%;color:#236FBD;text-align:Center; "/></p><br/>
     </apex:repeat>    
        
        
        <apex:datatable value="{!salesCompRatings}" var="sc" id="theTbt" headerClass="tablehead" rowClasses="odd,even"  style="font-size: 50%;"  border="1">
        
        <!--<apex:column headerValue="Name">
         <apex:outputText value="{!Opp.Opp.Name}"/>   
                <apex:outputLink value="/{!sc.scr.Id}" target="_parent">{!sc.scr.Name}</apex:outputLink>               
            </apex:column> -->
            
            <apex:column headerValue="Competency" style="text-align:center;outline:2px solid #236FBD; border-top-left-radius:25px;border-top-right-radius: 25px;  border-bottom-left-radius: 25px;border-bottom-right-radius: 25px; border-radius: 15px;  border: 50px solid; background-color: #236FBD; border: 5px solid;font-weight: bold; font-size: 100%;color:white;">
                
                <apex:inputField value="{!sc.scr.Competency__c}" id="comp" Style="color:black;"/>
                <script>document.getElementById('{!$Component.comp}').disabled = true; </script>
            </apex:column>
            
            <apex:column headerValue="Expected Minimum Proficiency" style="width:130px;height:20px;outline:1px solid #236FBD;text-align:center;" >
            <b> <apex:outputField value="{!sc.scr.Proficiency_Expectation_for_Role_Target__c}"/>      </b>
            </apex:column>
                      
            <apex:column headerValue="Employee Proficiency-Rating" style="width:100px;height:20px;outline:1px solid #236FBD; text-align:center; ">
                <apex:inputField value="{!sc.scr.Employee_Proficiency_Rating__c}"  style="width:90px;height:20px;" />                
            </apex:column>
            
            <apex:column headerValue="Sub-Competency - Needs Development" style="outline:1px solid #236FBD;" >
               <apex:inputField value="{!sc.scr.SubCompetency_Needs_Development__c}" />    
            </apex:column>
            
            <apex:column headerValue="Development Resources" style="outline:1px solid #236FBD;">
               &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<apex:commandButton value="Show" action="{!showPopup}" rerender="popup" style="color:black">
               <apex:param value="{!sc.scr.id}" name="jd"/>
                </apex:commandButton>        
            </apex:column>

            <apex:column headerValue="Suggested Development Actions">
                <apex:inputtextarea value="{!sc.scr.Suggested_Development_Action_New__c}" id="theTbt" style="width:500px; height:100px;outline:1px solid #236FBD;"/>                               
            </apex:column>
            
            <apex:column headerValue="Comments" >
                <apex:inputField value="{!sc.scr.Comments_New__c}" style="width:300px; height:100px;outline:1px solid #236FBD;"/>                 
            </apex:column>
        
        </apex:datatable>
     
   
    
                  <apex:pageBlockButtons >
                  <apex:commandButton action="{!saveclosemgr}" value="Save"/>
                  <apex:commandButton action="{!saveclosemgr1}" value="Save & close"/>
                  <apex:commandButton value="Cancel" onclick="window.top.close()" action="{!goback}" />
                  <apex:actionFunction action="{!goback}" name="cancelfun"/>
                  
              </apex:pageBlockButtons>


    
    
<apex:pageblocksection >
   
    <apex:outputPanel id="popup">
        <apex:outputPanel styleClass="popupBg" layout="block" rendered="{!displayPopUp}"/>
            <apex:outputPanel styleClass="popup" layout="block" rendered="{!displayPopUp}">
            <apex:outputPanel styleClass="panelWrapper" layout="block"/>
           <div style="overflow:scroll; height:300px">
              <apex:pageblockTable value="{!contacts}" var="s" >                             
               <apex:column headervalue="Competency" value="{!s.tContact.Competency__c}" style="font-size: 50%;"/>
               <apex:column headervalue="Sub-competency" value="{!s.tContact.Sub_Competency_Needs_Development__c}" style="font-size: 50%;" />
               <apex:column headervalue="Format" value="{!s.tContact.Format__c}" style="font-size: 50%;" />
               <apex:column headervalue="Development Resource Name" value="{!s.tContact.Development_Resource_Name__c}" style="font-size: 50%;"/>
               <apex:column headervalue="Select" > 
                <apex:inputCheckbox value="{!s.IsSelected}" onchange="doCheckboxChange(this,'{!s.tContact.Id}')" id="jj"/>
                </apex:column>
            </apex:pageblockTable>
          </div>
            <br/>
            <apex:outputLabel value="[{!SelectedCount} records selected]" id="sssd"/>
            <br/>
               <p align="Center"><apex:commandButton value="Add" action="{!Add}" reRender="popup,scrpb"/>
                <apex:commandButton value="Close" action="{!closePopup}" rerender="popup"/></p>
            </apex:outputPanel>
        </apex:outputPanel>
         
     <!-- handle selected item -->
                            <apex:actionFunction name="aSelectItem" action="{!doSelectItem}" rerender="sssd">
                                <apex:param name="contextItem" value="" assignTo="{!contextItem}"/>
                            </apex:actionFunction>
                     
                            <!-- handle deselected item -->
                            <apex:actionFunction name="aDeselectItem" action="{!doDeselectItem}" rerender="sssd">
                                <apex:param name="contextItem" value="" assignTo="{!contextItem}"/>
                            </apex:actionFunction>
</apex:pageblocksection>
       </apex:pageBlock>


    </apex:form>
    </html>
</apex:page>