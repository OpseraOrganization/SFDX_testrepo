<apex:page cache="false"  standardController="Case" extensions="BGAMobTOCMail,BGATechserre"  showHeader="false" docType="html-5.0" standardStylesheets="false">

<apex:form >
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="refresh" content="900" />
<title>Direct Access</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0" />
<meta name="apple-mobile-web-app-capable" content="yes"/>

<!-- Le styles -->
<link href="{!URLFOR($Resource.BGAMob_JQueryMobile_zip, 'css/jquery.mobile-1.3.1.min.css')}" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" /> 
<link href="{!URLFOR($Resource.BGAMob_JQueryMobile_zip, 'css/common.css')}" rel="stylesheet" type="text/css" />
<link href="{!URLFOR($Resource.BGAMob_JQueryMobile_zip, 'css/desktop.css')}" rel="stylesheet" type="text/css" />
<link href="{!URLFOR($Resource.BGAMob_JQueryMobile_zip, 'css/tablet.css')}" rel="stylesheet" type="text/css" />
<link href="{!URLFOR($Resource.BGAMob_JQueryMobile_zip, 'css/smartphone.css')}" rel="stylesheet" type="text/css" />

<script type="text/javascript" src="{!URLFOR($Resource.BGAMob_JQueryMobile_zip, 'js/jquery-1.9.1.min.js')}"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>    
<script type="text/javascript" src="{!URLFOR($Resource.BGAMob_JQueryMobile_zip, 'js/jquery.mobile-1.3.1.min.js')}"></script> 
<script type="text/javascript" src="{!URLFOR($Resource.BGAMob_JQueryMobile_zip, 'js/common.js')}"></script>

<script type="text/javascript" src="{!URLFOR($Resource.jqueryCookieJS)}"></script>

<!--  Support for IE8  -->
<apex:includeScript value="{!URLFOR($Resource.BGAMob_IESupport)}"/>

<style>
.ui-btn-inner {
    padding: 5px 20px;
}
.ui-tooltip, .arrow:after {
    background: #EFEEEC;
    border: 2px solid white;
}
.ui-tooltip {
    padding: 10px 20px;
    color: black;
    border-radius: 20px;
    font: bold 14px "Helvetica Neue", Sans-Serif;

    box-shadow: 0 0 7px black;
}
.arrow {
    width: 70px;
    height: 16px;
    overflow: hidden;
    position: absolute;
    left: 50%;
    margin-left: -35px;
    bottom: -16px;
}
.arrow.top {
    top: -16px;
    bottom: auto;
}
.arrow.left {
    left: 20%;
}
.arrow:after {
    content: "";
    position: absolute;
    left: 20px;
    top: -20px;
    width: 25px;
    height: 25px;
    box-shadow: 6px 5px 9px -9px black;
    -webkit-transform: rotate(45deg);
    -moz-transform: rotate(45deg);
    -ms-transform: rotate(45deg);
    -o-transform: rotate(45deg);
    tranform: rotate(45deg);
}
.arrow.top:after {
    bottom: -20px;
    top: auto;
}

</style>



<style>
.ui-body-c, .ui-overlay-c  {
    background-color: #FFFFFF;
}

.Mandatory {
    color:#FF0000;
    font-size:150%;
}

.ui-select .ui-btn {
    border-radius: 9px;
    margin: 0.5em 0px;
}

.ui-icon-loading {
    background-image: url("{!URLFOR($Resource.BGAMob_JQueryMobile_zip, 'css/images/ajax-loader.gif')}") !important;
}
#clearBtn{
    float: right;
    position: relative;
    margin-top: -9%;
    margin-right: 1%;
}  
textarea{
    max-height: 45px;
}
   
li { background: #FFFFFF !important; }
li.clicked { background: #E7E8EC !important; }

</style>

<script type="text/javascript">
$(document).ready(function() {
var $this = $( this ),
        theme = $this.jqmData( "theme" ) || $.mobile.loader.prototype.options.theme,
        msgText = $this.jqmData( "msgtext" ) || $.mobile.loader.prototype.options.text,
        textVisible = $this.jqmData( "textvisible" ) || $.mobile.loader.prototype.options.textVisible,
        textonly = !!$this.jqmData( "textonly" );
        html = $this.jqmData( "html" ) || "";
        
        var userAgent = navigator.userAgent;

        if (userAgent.match(/(iPad|iPhone|iPod|Mobile|Android|BlackBerry)/g)) {    
            $("#toc-case-page .aog-content").height($(document).height() - 10);
        }
        else {   
            $("#toc-case-page .aog-content").height($(document).height() - 100);
        }
        
        $("li").click(function(){
           $(this).toggleClass("clicked");
        });

         $("#IEbtn").click(function(){
            var phone = $("#phone").val();
            var mail = $("#Email").val();
            var descrp = $('#Desc').val();
                
                if(phone == "") {
                     $.mobile.silentScroll(0);
                     $("#Phone-no").text("Please enter the Phone Number.");
                } else {
                    $("#Phone-no").text("");
                    var filter = /^[0-9-+()\sxX]+$/;
                    if (!(filter.test(phone))) 
                    {
                     $.mobile.silentScroll(0);
                     $("#Phone-no").text("Please enter valid Phone Number.");
                      return false;
                    }
                   
               }
                
                if(mail == "") {
                     $("#mail").text("Please enter the Business Email Address.");
                } else {
                    $("#mail").text("");
                    if(!isValidEmailAddress(mail))
                       {
                        $("#mail").text("Please enter valid email address");
                        return false;
                       }
                }
            
                if(descrp == "" ) {
                    $("#descrp").text("Please enter the Problem Description.");
                } else {
                    $("#descrp").text("");     
                } 
                
                if(phone != "" && mail != "" && descrp != ""  ) {
                    $("#Phone-no").text("");
                    $("#mail").text("");
                    $("#descrp").text("");
            
             
                 $("#IEbtn").attr('href',"mailto:{!EmailTOC}?Subject=TOC Request From BGA Mobile App&body=Case Details: "+"%0D%0A %0D%0A"+"Phone: "+phone+"%0D%0A %0D%0A"+"Email Address: "+mail+"%0D%0A %0D%0A"+"Problem Description: "+descrp+"%0D%0A %0D%0A"+"Sent from Honeywell's MySupport App");    
                 }
                 
        });
        
        var ua = navigator.userAgent; 
        var msie = false;
        //Javascript Browser Detection - Internet Explorer
        if (/MSIE (\d+\.\d+);/.test(ua)) //test for MSIE x.x; True or False
        {
            var msie = (/MSIE (\d+\.\d+);/.test(ua)); //True or False
            var ieversion = new Number(RegExp.$1); //gets browser version
           if(ieversion<10){
                $("#commentForm").hide();
                $("#File").css("display","none");
                 $("#IEbtn").show();
                 $('#clearBtn').css("display","none");
            }
            else
              $("#IEbtn").hide();

        }
        else if (ua.indexOf("BlackBerry") >= 0)
        {
           $("#commentForm").hide();
            $("#File").hide();
            $("#IEbtn").show();
         }
        else
         $("#IEbtn").hide();
      
            $("#clearBtn").hide();
        
            $("#clearBtn").click(function(){
                 $("#attachmentFile").val("");
                 $("#clearBtn").hide();
            });
      
           $("input[type='file']").change( function() {
              if( $("#attachmentFile").val()!= ""){
                      // IF THE BROWSER IS INTERNET EXPLORER 10
                    if (navigator.appVersion.indexOf("MSIE 10") != -1)
                    {
                       $('#clearBtn').css("display","none");
                    }else{
                     $("#clearBtn").show();
                    }
              }
        });
});


// Tool Tip Code
$(function() {
    $( document ).tooltip({
        position: {
            my: "center bottom-20",
            at: "center top",
            using: function( position, feedback ) {
                $( this ).css( position );
                $( "<div>" )
                .addClass( "arrow" )
                .addClass( feedback.vertical )
                .addClass( feedback.horizontal )
                .appendTo( this );
            }
        }
    });
});
// On click of submit button - Validation part
function submitform()
 {
 
    var phone = $("#phone").val();
    var mail = $("#Email").val();
    var descrp= $('#Desc').val();
    
    if(phone == "") {
                     $.mobile.silentScroll(0);
                     $("#Phone-no").text("Please enter the Phone Number.");
                } else {
                    $("#Phone-no").text("");
                    var filter = /^[0-9-+()\sxX]+$/;
                    if (!(filter.test(phone))) 
                    {
                     $.mobile.silentScroll(0);
                     $("#Phone-no").text("Please enter valid Phone Number.");
                      return false;
                    }
                   
               }
    
    if(mail == "") {
         $("#mail").text("Please enter the Business Email Address.");
    } else {
        $("#mail").text("");
        if(!isValidEmailAddress(mail))
   {
    $("#mail").text("Please enter valid email address");
    return false;
   }
    }

    if(descrp== "" ) {
        $("#descrp").text("Please enter the Problem Description.");
    } else {
        $("#descrp").text("");     
    } 
    
    if(phone != "" && mail != "" && descrp!= ""  ) {
        $("#Phone-no").text("");
        $("#mail").text("");
        $("#descrp").text("");
        $.mobile.loading( "show" );
    
        
         
         if ( navigator.userAgent.indexOf("MSIE") > 7 ) 
         {
           BGAMobTOCMail.insertCase('toc',phone,mail,descrp, null, null,   function(result, event) {
       
         if(event.status) {
           window.location.assign("http://honeywellaero.force.com/bgadir/BGAMob_Submitpage?casenum="+result.CaseNumber+"&returnpage=TOC")
           return false;
           $.mobile.loading( "hide" );
                   $("#phone").val("");
             $("#Email").val("");
              $('#Desc').val("");
             $("#attachmentFile").val("");
          }
           
        },
        {buffer: true, escape: true, timeout: 120000}
      );
         }
         else
           uploadFile(phone,mail,descrp);
        
    }
 }

//  Upload file functionality
var maxStringSize = 6000000;    //Maximum String size is 6,000,000 characters
    var maxFileSize = 4350000;      //After Base64 Encoding, this is the max file size
    var chunkSize = 950000;         //Maximum Javascript Remoting message size is 1,000,000 characters
    var attachment;
    var attachmentName;
    var fileSize;
    var positionIndex;
    var doneUploading;
   
//Method to prepare a file to be attached to the Account bound to the page by the standardController
    function uploadFile(phone,mail,descrp) {
   
      var file = document.getElementById('attachmentFile').files[0];
    
      if(file != undefined) {
        if(file.size <= maxFileSize) {
          attachmentName = file.name;
          var fileReader = new FileReader();
          fileReader.onloadend = function(e) {
            attachment = window.btoa(this.result);  //Base 64 encode the file before sending it
            positionIndex=0;
            fileSize = attachment.length;
            
            doneUploading = false;
            if(fileSize < maxStringSize) {
              uploadAttachment(null,phone,mail,descrp);
            } else {
              alert("Base 64 Encoded file is too large.  Maximum size is " + maxStringSize + " your file is " + fileSize + ".");
            }
             
          }
          fileReader.onerror = function(e) {
            alert("There was an error reading the file.  Please try again.");
          }
          fileReader.onabort = function(e) {
            alert("There was an error reading the file.  Please try again.");
          }
         
          fileReader.readAsBinaryString(file);  //Read the body of the file
         
        } else {
          alert("File must be under 4.3 MB in size.  Your file is too large.  Please try again.");
        }
      } else {
         BGAMobTOCMail.insertCase('toc',phone,mail,descrp, null, null,   function(result, event) {
       
         if(event.status) {
           window.location.assign("http://honeywellaero.force.com/bgadir/BGAMob_Submitpage?casenum="+result.CaseNumber+"&returnpage=TOC")
          
           $.mobile.loading( "hide" );
                   $("#phone").val("");
         $("#Email").val("");
          $('#Desc').val("");
         $("#attachmentFile").val("");
            }
           
        },
        {buffer: true, escape: true, timeout: 120000}
      );
      }
      $.mobile.silentScroll(0);
    }
     
//Method to send a file to be attached to the Account bound to the page by the standardController
//Sends parameters: Account Id, Attachment (body), Attachment Name, and the Id of the Attachment if it exists to the controller   
    function uploadAttachment(fileId,phone,mail,descrp) {
    
      var attachmentBody = "";
      if(fileSize <= positionIndex + chunkSize) {
        attachmentBody = attachment.substring(positionIndex);
        doneUploading = true;
      } else {
        attachmentBody = attachment.substring(positionIndex, positionIndex + chunkSize);
      }
    
      BGAMobTOCMail.insertCase('toc',phone,mail,descrp, attachmentBody, attachmentName,   function(result, event) {
       
          if(event.status) {
              window.location.assign("http://honeywellaero.force.com/bgadir/BGAMob_Submitpage?casenum="+result.CaseNumber+"&returnpage=TOC")
                $.mobile.loading( "hide" );
                $("#phone").val("");
                 $("#Email").val("");
              $('#Desc').val("");
                $("#attachmentFile").val("");
            }
           
        },
        {buffer: true, escape: true, timeout: 120000}
      );
    }
 
 function isValidEmailAddress(emailAddress) {
    var pattern = new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);
    return pattern.test(emailAddress);
};
 
</script>

</head>

<body>
<form id="form1" enctype="multipart/formdata">
 
<!-- TOC - TOC Case form  -->

<div id="toc-case-page" class="" data-role="page">
    <div data-role="header" style="background: #EE3124;" >        
        <a href="BGAMob_TechnicalSupport" data-rel="back" rel="external" class="back-button show-page-loading-msg" data-role="button" data-theme="d" data-textonly="false" data-textvisible="false" data-msgtext="" data-inline="true">Back</a>
        <p class="bgamob-header">Contact Technical Support</p> 
        <a href="#navPanel" class="menu-btn" data-role="button"></a> 
    </div>
    
    <div data-role="content" class="aog-content">
    <div class="content-cls">
        <apex:pageMessages />
          <h4 align="center" id="caseid-alertTxt" style="color:#5D7BB9"></h4>
         <h3 align="center" style="font-weight: normal;"><font  COLOR="#666666">Please complete the required(*) fields and click the "Submit" button to create a Case with Technical Support.  You will receive an email confirmation shortly.</font></h3>
        
         <h4 align="center" id="caseid-alertTxt" style="color:#666362"></h4>
         
         <div class="ui-grid-a ui-responsive">
            <div class="ui-block-a"><span class="Mandatory"> *</span>Phone</div>
            <div class="ui-block-b"> <input type="text" value="{!Case.SuppliedPhone}" id="phone" placeholder="+Country Code-Area Code-Number" /><span style="color:red" id="Phone-no"></span> </div>
        </div>

        <div class="ui-grid-a ui-responsive">
            <div class="ui-block-a"><span class="Mandatory"> *</span>Email Address</div>
            <div class="ui-block-b"><input type="text" value="{!Case.SuppliedEmail}" id="Email" placeholder="Enter Business Email Address" /><span id="mail" style="color:red"></span> </div>
        </div>
         
         <div class="ui-grid-a ui-responsive">
            <div class="ui-block-a"><span class="Mandatory"> *</span>Problem Description </div>
           <div class="ui-block-b"> <TEXTAREA value="{!case.Description}" id="Desc" onkeyup="textAreaAdjust(this)" style="overflow:hidden"  /> <span id="descrp" style="color:red"></span></div> 
        </div>
    
        <div class="ui-grid-a ui-responsive" id="File">
            <div class="ui-block-a">Attach a File</div> 
            <div class="ui-block-b"> <input type="file" id="attachmentFile"/>
            <img id="clearBtn" src="{!URLFOR($Resource.BGAMob_Map, 'clearBtn.png')}"/> 
            </div>
        </div>

        <br/>
         <div id="commentForm" style="width:100%; background: #EE3124; color: #FFFFFF; text-shadow: none;" data-role="button" data-inline="true" onclick="submitform()" > Submit </div>
         <a id="IEbtn" href="" data-role="button" style="width:100%; background: #EE3124; color: #FFFFFF; text-shadow: none; display:none;"> Submit </a>
     </div>
     
       
       </div>
       
    <div data-role="panel" data-position="right" id="navPanel" class="nav-panel">
        <ul data-role="listview" data-divider-theme="d" class="nav-list">
            <li><a href="/bgadir/BGAMob_HomePage" rel="external" class="show-page-loading-msg" data-theme="d" data-textonly="false" data-textvisible="false" data-msgtext="" data-inline="true">Direct Access Home</a></li>
            <li><a href="/bgadir/BGAMob_AOG" data-prefetch="true" rel="external"  class="show-page-loading-msg" data-theme="d" data-textonly="false" data-textvisible="false" data-msgtext="" data-inline="true"><span class="nav-panel-aog">AOG - Aircraft On Ground</span></a></li>
            <li><a href="/bgadir/BGAMob_TechnicalSupport" rel="external" class="show-page-loading-msg" data-theme="d" data-textonly="false" data-textvisible="false" data-msgtext="" data-inline="true">Technical Support</a></li>
            <li><a href="/bgadir/BGAMob_PilotSupport" rel="external" class="show-page-loading-msg" data-theme="d" data-textonly="false" data-textvisible="false" data-msgtext="" data-inline="true">Pilot Support</a></li>
            <li><a href="/bgadir/BGAMob_BusinessSales" rel="external" class="show-page-loading-msg" data-theme="d" data-textonly="false" data-textvisible="false" data-msgtext="" data-inline="true">Business &amp; Sales Support</a></li>
            <li><a href="/bgadir/BGAMob_Tabpage" rel="external" class="show-page-loading-msg" data-theme="d" data-textonly="false" data-textvisible="false" data-msgtext="" data-inline="true">Dealers &amp; Service Centers</a></li>
            <li><a href="/bgadir/BGAMob_PartsSupport" rel="external" class="show-page-loading-msg" data-theme="d" data-textonly="false" data-textvisible="false" data-msgtext="" data-inline="true">Parts Support</a></li>
            <li><a href="/bgadir/BGAMob_BusinessAviationNews" rel="external" class="show-page-loading-msg" data-theme="d" data-textonly="false" data-textvisible="false" data-msgtext="" data-inline="true">Business Aviation News</a></li>
            <li><a href="/bgadir/BGAMob_TSO" rel="external" class="show-page-loading-msg" data-theme="d" data-textonly="false" data-textvisible="false" data-msgtext="" data-inline="true">Help</a></li>
            <li><a href="/bgadir/BGAMob_Settings" rel="external" class="show-page-loading-msg" data-theme="d" data-textonly="false" data-textvisible="false" data-msgtext="" data-inline="true">Settings</a></li>
        </ul>
    </div><!-- /panel -->
</div>
</form>
</body>
</html>
</apex:form>
<apex:insert name="footer">
        <c:honeywellFooter1 />
</apex:insert>

</apex:page>