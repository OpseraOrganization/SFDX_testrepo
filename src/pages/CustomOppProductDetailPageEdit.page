<apex:page standardController="OpportunityLineItem" extensions="CustomOppProductDetailController" lightningStylesheets="true"
                    showHeader="true" showQuickActionVfHeader="true">
<apex:form rendered="{!$Profile.Name !='D&S_Partner_Portal_User'}">
<apex:sectionHeader title="Opportunity Product" subtitle="{!OpportunityLineItem.Name}" />

<apex:pageBlock mode="edit" tabStyle="OpportunityLineItem" title="Opportunity Product Edit">
    <apex:pageBlockButtons >
        <apex:commandButton value="Save" action="{!save}" reRender="messagePanel" status="saveStatus"/>
        <apex:commandButton value="Cancel" action="{!cancel}" status="cancelStatus" reRender="messagePanel"/>
        <apex:actionStatus startText=" Saving..." id="saveStatus"/>
        <apex:actionStatus startText=" Please wait..." id="cancelStatus"/>
    </apex:pageBlockButtons>
    <apex:outputPanel id="messagePanel">
        <apex:pageMessages />
    </apex:outputPanel>
    <apex:pageBlockSection columns="2" title="Product Information">
        <apex:repeat value="{!fields}" var="f">
            <apex:outputLabel rendered="{!if(AND(fldSetName == 'D_S',OR(f.FieldPath=='M_PM_Product_Leader__c',f.FieldPath=='Status__c')),true,false)}"/>
            
           <apex:inputField required="{!IF(OR(f.FieldPath=='Quantity',f.FieldPath=='ServiceDate',f.FieldPath=='UnitPrice',
            AND(fldSetName == 'D_S',OR(f.FieldPath=='M_PM_Product__c',f.FieldPath=='Revenue_Type__c',f.FieldPath=='Plant__c')))
            ,true,false)}" value="{!opliRec[f]}"
            
            rendered="{!AND(f.FieldPath!='Probability__c',f.FieldPath!='Revenue_Start_Date__c',f.FieldPath!='Revenue_End_Date__c',
            f.FieldPath!='Quantity',f.FieldPath!='UnitPrice')}"/>
            
            <apex:inputField required="true" value="{!opliRec[f]}" rendered="{!AND(OR(f.FieldPath=='Quantity',f.FieldPath=='UnitPrice'),hasSchedule=='No')}"/>
            
            <apex:outputField value="{!opliRec[f]}" rendered="{!OR(f.FieldPath=='Probability__c',f.FieldPath=='Revenue_Start_Date__c',f.FieldPath=='Revenue_End_Date__c')}"/>
            
            <apex:outputField value="{!opliRec[f]}" rendered="{!AND(OR(f.FieldPath=='Quantity',f.FieldPath=='UnitPrice'),hasSchedule=='Yes')}"/>
            
            <apex:outputLabel rendered="{!if(AND(fldSetName == 'D_S',OR(f.FieldPath=='Revenue_Type__c',f.FieldPath=='Child_Opportunity_Stage__c',f.FieldPath=='Closure_Actions__c')),true,false)}"/>
            <apex:outputLabel rendered="{!if(AND(fldSetName == 'BGA',f.FieldPath=='Sales_Month_Year__c'),true,false)}"/> 
        </apex:repeat>
        <apex:repeat value="{!fields_LHS}" var="f"> 
            <apex:inputField required="{!IF(OR(f.FieldPath=='Quantity',f.FieldPath=='ServiceDate',f.FieldPath=='UnitPrice',
            AND(fldSetName == 'D_S',OR(f.FieldPath=='M_PM_Product__c',f.FieldPath=='Revenue_Type__c',f.FieldPath=='Plant__c')))
            ,true,false)}" value="{!opliRec[f]}" />
            <apex:outputLabel />
        </apex:repeat>
        <apex:repeat value="{!fields_RHS}" var="f"> 
            <apex:outputLabel />
            <apex:inputField required="{!IF(OR(f.FieldPath=='Quantity',f.FieldPath=='ServiceDate',f.FieldPath=='UnitPrice',
            AND(fldSetName == 'D_S',OR(f.FieldPath=='M_PM_Product__c',f.FieldPath=='Revenue_Type__c',f.FieldPath=='Plant__c')))
            ,true,false)}" value="{!opliRec[f]}" />           
        </apex:repeat>
    </apex:pageBlockSection>    
    <apex:pageBlockSection columns="2" title="Pricing" rendered="{!if(fldSetName =='BGA',true,false)}">
        <apex:repeat value="{!pricingFields}" var="f"> 
            <apex:inputField rendered="{!AND(f.FieldPath!='Probability__c',f.FieldPath!='Quantity',f.FieldPath!='UnitPrice')}" 
            
            required="{!IF(OR(f.FieldPath=='Quantity',f.FieldPath=='ServiceDate',f.FieldPath=='UnitPrice',
            AND(fldSetName == 'D_S',OR(f.FieldPath=='M_PM_Product__c',f.FieldPath=='Revenue_Type__c',f.FieldPath=='Plant__c')))
            ,true,false)}" value="{!opliRec[f]}" />
            
            <apex:inputField rendered="{!AND(OR(f.FieldPath=='Quantity',f.FieldPath=='UnitPrice'),hasSchedule=='No')}" 
            
            required="{!IF(OR(f.FieldPath=='Quantity',f.FieldPath=='ServiceDate',f.FieldPath=='UnitPrice',
            AND(fldSetName == 'D_S',OR(f.FieldPath=='M_PM_Product__c',f.FieldPath=='Revenue_Type__c',f.FieldPath=='Plant__c')))
            ,true,false)}" value="{!opliRec[f]}" />
            
            <apex:outputField rendered="{!IF(f.FieldPath=='Probability__c',true,false)}" value="{!opliRec[f]}" />
            
            <apex:outputField rendered="{!AND(OR(f.FieldPath=='Quantity',f.FieldPath=='UnitPrice'),hasSchedule=='Yes')}" value="{!opliRec[f]}" />
        </apex:repeat>
    </apex:pageBlockSection>
    <apex:pageBlockSection columns="2" title="Description Information" rendered="{!if(fldSetName =='BGA',true,false)}">
        <apex:repeat value="{!infoFields}" var="f"> 
            <apex:inputField required="{!IF(OR(f.FieldPath=='Quantity',f.FieldPath=='ServiceDate',f.FieldPath=='UnitPrice',
            AND(fldSetName == 'D_S',OR(f.FieldPath=='M_PM_Product__c',f.FieldPath=='Revenue_Type__c',f.FieldPath=='Plant__c')))
            ,true,false)}" value="{!opliRec[f]}" />
        </apex:repeat>
    </apex:pageBlockSection>
    <apex:pageBlockSection columns="2" title="Forecasting" rendered="{!if(fldSetName =='D_S',true,false)}">
        <apex:repeat value="{!DSProductFields}" var="f"> 
            <apex:inputField required="{!IF(OR(f.FieldPath=='Quantity',f.FieldPath=='ServiceDate',f.FieldPath=='UnitPrice',
            AND(fldSetName == 'D_S',OR(f.FieldPath=='M_PM_Product__c',f.FieldPath=='Revenue_Type__c',f.FieldPath=='Plant__c')))
            ,true,false)}" value="{!opliRec[f]}" />
        </apex:repeat>
    </apex:pageBlockSection>
    <apex:pageBlockSection columns="2" title="Tech Sales" rendered="{!if(fldSetName =='D_S',true,false)}">
        <apex:repeat value="{!DSTSFields}" var="f"> 
            <apex:inputField required="{!IF(OR(f.FieldPath=='Quantity',f.FieldPath=='ServiceDate',f.FieldPath=='UnitPrice',
            AND(fldSetName == 'D_S',OR(f.FieldPath=='M_PM_Product__c',f.FieldPath=='Revenue_Type__c',f.FieldPath=='Plant__c')))
            ,true,false)}" value="{!opliRec[f]}" />
        </apex:repeat>
    </apex:pageBlockSection>
    
    <apex:pageBlockSection columns="2">
        <apex:repeat value="{!SystemFields}" var="f"> 
            <apex:inputField value="{!opliRec[f]}" />           
        </apex:repeat>
    </apex:pageBlockSection>
</apex:pageBlock>
</apex:form>
<apex:detail subject="{!OpportunityLineItem.id}" rendered="{!$Profile.Name =='D&S_Partner_Portal_User'}"/>
<script>function setFocusOnLoad() {}</script>
</apex:page>