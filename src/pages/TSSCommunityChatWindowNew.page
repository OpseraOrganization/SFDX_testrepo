<apex:page showHeader="false" standardStylesheets="false">
<title></title>

<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0" />
<meta name="apple-mobile-web-app-title" content="Cases" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="format-detection" content="telephone=no" />

<!--    Bootstrap CSS
<link href="{!URLFOR($Resource.TSSCommunityRes,'css/bootstrap.min.css')}" rel="stylesheet" media="screen"/>
<script src="{!URLFOR($Resource.TSSCommunityRes,'js/jquery-1.11.0.min.js')}"></script>
<script src="{!URLFOR($Resource.TSSCommunityRes,'js/bootstrap.min.js')}"></script>
-->
    <link href="{!URLFOR($Resource.TSSCommunity_New,'css/hon-dls.min.css')}" rel="stylesheet" />
    <link href="{!URLFOR($Resource.TSSCommunity_New,'css/hon-dls_aero.min.css')}" rel="stylesheet" />
    <link href="{!URLFOR($Resource.TSSCommunity_New,'css/hon-dls_aero_tkc.min.css')}" rel="stylesheet" />
    <script type="text/javascript" src="{!URLFOR($Resource.TSSCommunity_New,'js/hon-dls.min.js')}"></script>
    
    <script type="text/javascript" src="{!URLFOR($Resource.TSSCommunityRes,'js/jquery-ui.js')}"></script>

    <!---Google Analytics script starts -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-12579259-5', {'name': 'rollup_myaero'});
      ga('rollup_myaero.require', 'displayfeatures');  
      ga('rollup_myaero.send', 'pageview');
        
      ga('create', 'UA-12579259-13', 'auto');
      ga('require', 'displayfeatures');
      ga('send', 'pageview');

    </script>
    <!---Google Analytics script ends -->

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
<script type='text/javascript'>

liveagent.addEventListener(liveagent.chasitor.Events.CHAT_REQUEST_SUCCESSFUL, myCallBack);
liveagent.addEventListener(liveagent.chasitor.Events.CHAT_ESTABLISHED, newagent);
//liveagent.addEventListener(liveagent.chasitor.Events.AGENT_CHAT_TRANSFERRED, newagent);

function myCallBack() {
    var details = liveagent.chasitor.getDetails();
    document.getElementById("waitingMessage").style.display = 'none';
       
}
function newagent() {
    //console.log('------------> in new Agent');
    var details = liveagent.chasitor.getDetails();
    
    //console.log('---------->2' + details.prechatDetails[2].label);
    //console.log('---------->2' + details.prechatDetails[2].value);
    
    var delay=3000;
    setTimeout(function(){
        document.getElementById("liveAgentChatInput").value = 'Need help on "' + details.prechatDetails[2].value + '"';
        SfdcApp.LiveAgent.Chasitor.sendMessage();
        document.getElementById("liveAgentChatLog").style.display = 'block';
    },delay);
    
    document.getElementById("inputMessage").style.display = 'block';
    document.getElementById("chatSendBtn").style.display = 'block'; 
    document.getElementById("chatEndBtn").style.display = 'block';
    
    //$('#inputMessage').show();
    //$('#chatSendBtn').show();
    //$('#chatEndBtn').show();
}
</script>
<style>

#inputMessage{
    display:none;
}

#liveAgentChatLog {
    height: 200px;
    width: 100%;
    background-color: white;
    border-radius: 0px;
    margin: 0px 0 0 0;
    overflow: auto;
}

#liveAgentChatInput{
    width:70%;
    height: 40px;
    margin-top: 5px;
    display:none;
}

/*
.liveAgentChatElement.liveAgentSendButton{
    width: 75px;
    height: 35px;
    background-color: #ECEBEC;
    text-align: center;
    color: black !important;
    border: 1px solid #CBCCCE;
    border-radius: 5px;
    -moz-border-radius: 5px;
    -webkit-border-radius: 5px;
    padding: 7px 5px;
}

.liveAgentChatElement.liveAgentSaveButton{
    height: 35px;
    background-color: #ECEBEC;
    text-align: center;
    color: black !important;
    border: 1px solid #CBCCCE;
    border-radius: 5px;
    -moz-border-radius: 5px;
    -webkit-border-radius: 5px;
    padding: 7px 5px;
    margin-top: 10px;
    //width: 40%;
}

.liveAgentChatElement.liveAgentEndButton,#chatEndBtn{
    height: 35px;
    background-color: #ECEBEC;
    text-align: center;
    color: black !important;
    border: 1px solid #CBCCCE;
    border-radius: 5px;
    -moz-border-radius: 5px;
    -webkit-border-radius: 5px;
    padding: 7px 5px;
    margin-top: 10px;
    //width: 40%;
    float: right;
    margin-top: 10px;
    display:none;
}

#chatSendBtn{
    height: 35px;
    background-color: #ECEBEC;
    text-align: center;
    color: black !important;
    border: 1px solid #CBCCCE;
    border-radius: 5px;
    -moz-border-radius: 5px;
    -webkit-border-radius: 5px;
    padding: 7px 5px;
    margin-top: 10px;
    width: 100%;
    display: none;
}
*/
.liveagent-header {
    /*background: url({!URLFOR($Resource.TSSCommunityRes,'images/user-white-indicator.png')}) no-repeat;
    color: white;*/
    height: 36px;
    font-size: 16px;
    padding: 5px;
    background-position: 9px 6px;
    cursor: pointer;
}

#liveAgentChatLogText{
    font-size: 18px;
    font-family: Calibri;
}
.loading {
    background-color: transparent;
}
</style>
<body style="height:100%">
<div style="height:400px;width:100%;" class="wrapper">
    <div >
        <div class="liveagent-header">
            <i class="icon icon-circled-user-male"></i> Chat with an Agent
        </div>
        <liveAgent:clientchat >
                       
            <div id="prechatdata">
            </div>
            
            <div style="padding:10px">
                <liveAgent:clientChatAlertMessage />
                <liveAgent:clientChatStatusMessage />
                
                <table id="waitingMessage" cellpadding="0" cellspacing="0" style="text-align: center;width: 100%;" >
                    <tr>
                        <td style="text-align:center;display:inline;width:300px;">You are now being connected to an agent.</td>                        
                    </tr>
                    <tr>
                        <td style="padding: 5px 0 5px;">
                            <!-- <img alt="Progress Bar" src="https://1.la2c1cs.salesforceliveagent.com/content/images/html_progress_bar.gif"/> -->
                            <div class="padded loader"><div class="loading"></div></div>
                        </td>
                    </tr>
                </table>
                
                <div style="word-wrap: break-word; ">
                    <liveAgent:clientChatLog />
                </div>
                
                <div style="width:100%">
                    <liveagent:clientChatInput />
                    <!--<liveAgent:clientChatSendButton label="Send" />-->
                    <div style="display: inline-block;width: 70%;margin-top: 5px;">
                        <textarea id="inputMessage" style="width:100%;height: 60px;"/>
                    </div>
                    
                    <div style="display: inline-block;width: 30%;float: right;">
                        <button id="chatSendBtn" onclick="sendChatMessage();" class="btn btn-primary btn-block">Send</button>
                    </div>
                </div>
            </div>
            
            <div style="padding: 0 10px;margin-top:-10px">
                <div class="col-xs-6 col-xs-6 col-xs-6 col-xs-6" style="padding-left:0px">
                <!--    <liveAgent:clientChatSaveButton label="Save Chat" /> -->
                    <button class="liveAgentChatElement liveAgentSaveButton btn btn-secondary" id="liveAgentSaveButton" onclick="SfdcApp.LiveAgent.Chasitor.saveChat();" title="Save Chat">Save Chat</button>
                </div>
                <div class="col-xs-6 col-xs-6 col-xs-6 col-xs-6" style="padding-right:0px">
                    <button id="chatEndBtn" onclick="confirmEnd();" class="btn btn-primary">End Chat</button>
                </div>
                <!-- <liveAgent:clientChatEndButton label="End Chat"/> -->
            </div>
        </liveAgent:clientchat>
    </div>
    
<script>
    $("#inputMessage").keyup(function(event) {
        if(event.keyCode==13) {
            sendChatMessage();
            document.getElementById("inputMessage").value = '';
        }
            
    });

    function sendChatMessage(){
        document.getElementById("liveAgentChatInput").value = document.getElementById("inputMessage").value;
        SfdcApp.LiveAgent.Chasitor.sendMessage();
        document.getElementById("inputMessage").value = '';
    }
    
    function confirmEnd(){
        $('#endChatModal').modal({
            show:true,
            closeOnEscape: true
        });
    }
    function closeChat(){
        SfdcApp.LiveAgent.Chasitor.endChat();
        
        var delay=3000;
        setTimeout(function(){
            console.log('Ending Chat'); 
            window.parent.close();
        },delay);
    }
</script>

<!-- End Chat popup begins -->
<div id="endChatModal" class="modal fade bs-example-modal-sm in" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header popup-header">
                <b>End Chat</b>
            </div>
            <div class="modal-body popup-header" style="font-weight: normal;">
                You are about to end the chat session. Are you sure?
            </div>                   
            <div class="modal-footer popup-footer">
                <div class="col-xs-12" style="">
                    <div class="col-xs-6 col-xs-6 col-xs-6 col-xs-6">
                        <a class="btn btn-primary white-btn create-next-btn" style="width:100%" id="" type="button" data-dismiss="modal" onclick="closeChat(); " href="#">
                             Yes 
                        </a>
                    </div>
                    <div class="col-xs-6 col-xs-6 col-xs-6 col-xs-6">
                       <a class="btn btn-secondary white-btn create-next-btn" style="width:100%" id="" type="button" data-dismiss="modal">
                            Cancel
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div> 
</div>
<!-- End Chat popup ends -->

</div>
</body>


</apex:page>