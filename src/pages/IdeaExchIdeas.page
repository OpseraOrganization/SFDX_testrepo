<apex:page sidebar="false" controller="IdeaExchIdeas_Cntrl" showHeader="false" standardStylesheets="false" title="GOLD WEEK 2015" cache="false" docType="html-5.0" applyHtmlTag="false">
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>GOLD WEEK 2015 | Ideas</title>    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0" />
    <meta name="apple-mobile-web-app-title" content="GOLD WEEK" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="icon" href="{!URLFOR($Resource.goldweek_resources,'img/favicon.png')}" />
    
    <!--    Bootstrap CSS -->
    <link href="{!URLFOR($Resource.goldweek_resources,'css/bootstrap.min.css')}" rel="stylesheet" media="screen"/>
    <link href="{!URLFOR($Resource.goldweek_resources,'css/goldweek.min.css')}" rel="stylesheet" media="screen"/>
    
    <!--   Images for iOS   -->
    <link href="{!URLFOR($Resource.goldweek_resources,'img/gold_144x144.png')}" rel="apple-touch-icon-precomposed" sizes="144x144" />
    <link href="{!URLFOR($Resource.goldweek_resources,'img/gold_114x114.png')}" rel="apple-touch-icon-precomposed" sizes="114x114" />
    <link href="{!URLFOR($Resource.goldweek_resources,'img/gold_72x72.png')}" rel="apple-touch-icon-precomposed" sizes="72x72" />
    <link href="{!URLFOR($Resource.goldweek_resources,'img/gold_57x57.png')}" rel="apple-touch-icon-precomposed" />
   
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->    

</head>

<body>

<div class="container">

    <c:PAC_IDEAS_header />

    <div class="row" style="margin-bottom:10px">
        <div class="col-md-4 col-md-offset-4 col-xs-12">
          <a class="btn btn-default btn-block btn-lg" href="IdeaExchPost"><i class="icons8-Plus"></i> Add a New Idea</a>
        </div>
    </div>

    <ul class="nav nav-tabs">
        <li role="presentation" class="active"><a href="#latest" aria-controls="latest" role="tab" data-toggle="tab">Latest<span class="hidden-xs"> Ideas</span></a></li>
        <li role="presentation"><a href="#my" aria-controls="my" role="tab" data-toggle="tab">My Ideas</a></li>
        <li role="presentation"><a href="#pop" aria-controls="pop" role="tab" data-toggle="tab">Popular<span class="hidden-xs"> Ideas</span></a></li>
        <li role="presentation" id="idea-Details-Tab" class="hidden hidden-xs"><a href="#idea-Details" aria-controls="det" role="tab" data-toggle="tab"><span class="hidden-xs">Idea </span>Details</a></li>
    </ul>

    <div class="tab-content">

        <div role="tabpanel" class="tab-pane fade in active" id="latest">
            <div class="ideas">
            </div>
            <div class="row row-load_more">
                <div class="col-md-4 col-md-offset-4 col-xs-12">
                  <a class="btn btn-default btn-block btn-lg btn-load" data-loading-text="Loading...">Load More</a>
                </div>
            </div>
        </div>

        <div role="tabpanel" class="tab-pane fade" id="my">
            <div class="ideas">
            </div>        
            <div class="row row-load_more">
                <div class="col-md-4 col-md-offset-4 col-xs-12">
                  <a class="btn btn-default btn-block btn-lg btn-load" data-loading-text="Loading...">Load More</a>
                </div>
            </div>
        </div>

        <div role="tabpanel" class="tab-pane fade" id="pop">
            <div class="ideas">
            </div>
            <div class="row row-load_more">
                <div class="col-md-4 col-md-offset-4 col-xs-12">
                  <a class="btn btn-default btn-block btn-lg btn-load" data-loading-text="Loading...">Load More</a>
                </div>
            </div>
        </div>

        <div role="tabpanel" class="tab-pane fade" id="idea-Details">            
        </div>

    </div>
  
</div> <!-- /container -->

<!--  Loader Icon  -->
<div class="hon-loader">
    <div class="hon-loader-overlay"></div>
    <div class="spinner">
      <div class="double-bounce1"></div>
      <div class="double-bounce2"></div>
    </div>
</div>

<template id="row_idea">
    <div class="row row-idea">
        <div class="col-idea col-lg-10 col-md-9 col-xs-12 pull-right">
          <h3><a href="#"></a></h3>
          <p></p>
          <div class="row">
            <div class="col-md-9 col-xs-12"><i class="icons8-User-Male-Filled"></i> Posted by <strong class="posted_by"></strong> to <span class="posted_to"></span></div>
            <div class="col-md-3 col-xs-12"><i class="icons8-Comments"></i> <a href="#" class="num_comments"> Comments</a></div>
          </div>
        </div>
        <div class="col-idea col-lg-2 col-md-3 col-xs-12">
          <div class="btn btn-default btn-lg btn-block btn-like" idea-id="" data-loading-text="Voting..."><i class="icons8-Like"></i> <span class="num_votes"></span> Votes</div>
          <span class="label label-primary center-block"><span class="status"></span> on <span class="submit_date"></span></span>
        </div>
    </div>
</template>

<template id="post_comment">
    <div class="row row-comment">
      <div class="col-idea col-lg-10 col-md-9 col-xs-12 pull-right">
        <textarea id="idea_desc" placeholder="Comment" rows="4" class="form-control"></textarea>
      </div>
      <div class="col-idea col-lg-2 col-md-3 col-xs-12">
        <a class="btn btn-default btn-block btn-post" data-loading-text="Posting...">Post</a>
      </div>
    </div>
</template>

<template id="all_comments">
    <div class="row row-comment">
      <div class="col-idea col-lg-10 col-xs-9 pull-right">
        <p></p>
      </div>
      <div class="col-idea col-lg-2 col-xs-3">
        <h4></h4>
        <span class="label label-primary center-block"></span>
      </div>
    </div>
</template>

<script src="{!URLFOR($Resource.goldweek_resources,'js/jquery.min.js')}"></script>
<script src="{!URLFOR($Resource.goldweek_resources,'js/bootstrap.min.js')}"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="{!URLFOR($Resource.goldweek_resources,'js/ie10-viewport-bug-workaround.js')}"></script>
<script src="{!URLFOR($Resource.goldweek_resources,'js/goldweek.js')}"></script>
<script type="text/javascript">

/* Populate Idea(s) */
function populateIdeas(array, root_element) {
    var ideas='';
    var abstractLimit = 400;

    $.each(array,function(index){

        var idea_temp;
        console.log($(this)[0].Votes);
        tmp_date = new Date($(this)[0].CreatedDate);
        the_date = (tmp_date.getMonth()+1)+"/"+tmp_date.getDate()+" at "+tmp_date.getHours()+":"+tmp_date.getMinutes();

        if('content' in document.createElement('template') ) {
            idea_temp = document.querySelector('#row_idea');
            ideas = document.importNode(idea_temp.content, true);
        } else {
            idea_temp = document.querySelector('#row_idea>div');
            ideas = $(idea_temp).clone(true);
        }

        $(ideas).find("h3 a").attr("href", "#"+$(this)[0].Id).text( $(this)[0].Title );
        $(ideas).find("p").html( $(this)[0].Body.substr(0,abstractLimit) );
        $(ideas).find(".posted_by").text( $(this)[0].CreatorName );
        $(ideas).find(".posted_to").text( $(this)[0].Categories );
        $(ideas).find(".num_comments").attr("href","#"+$(this)[0].Id).text( $(this)[0].NumComments+" Comments" );
        $(ideas).find(".status").text( $(this)[0].Status );
        $(ideas).find(".submit_date").text( the_date );
        $(ideas).find(".num_votes").text( $(this)[0].VoteTotal );
        if( $(this)[0].Votes != null ){
            $(ideas).find(".btn-block").addClass("active");
        }
        $(ideas).find(".btn-block").attr("idea-id", $(this)[0].Id);
        $(root_element).append(ideas);

    });

    $('.btn-like:not(.active)').click(function(){
        promoteIdea($(this).attr("idea-id"));
    });

    if (("standalone" in window.navigator) && window.navigator.standalone) {

        // For iOS Apps 
        $(root_element).find("a").on('click', function(e){
            $(".hon-loader").show();
            e.preventDefault();
            openNewTabForDetails( $(this).attr("href").replace("#","") );
        });

    } else {

        $(root_element).find("a").click(function(){
            openNewTabForDetails( $(this).attr("href").replace("#","") );
        });

    }
    
};
function populateIdea(idea, root_element) {
    var abstractLimit = 400;
    var idea_temp;
    var ideas;
    var post_comment_temp;
    console.log(idea.Votes);
    tmp_date = new Date(idea.CreatedDate);
    the_date = (tmp_date.getMonth()+1)+"/"+tmp_date.getDate()+" at "+tmp_date.getHours()+":"+tmp_date.getMinutes();

    if('content' in document.createElement('template') ) {
        idea_temp = document.querySelector('#row_idea');
        ideas = document.importNode(idea_temp.content, true);
        post_comment_temp = document.querySelector('#post_comment');
        post_comment = document.importNode(post_comment_temp.content, true);
    } else {
        idea_temp = document.querySelector('#row_idea>div');
        ideas = $(idea_temp).clone(true);
        post_comment_temp = document.querySelector('#post_comment>div');
        post_comment = $(post_comment_temp).clone(true);
    }

    $(ideas).find("a").attr("href", "#"+idea.Id);
    $(ideas).find("h3 a").text( idea.Title );
    $(ideas).find("p").html( idea.Body );
    $(ideas).find(".posted_by").text( idea.CreatorName );
    $(ideas).find(".posted_to").text( idea.Categories );
    $(ideas).find(".num_comments").text( idea.NumComments+" Comments" );
    $(ideas).find(".status").text( idea.Status );
    $(ideas).find(".submit_date").text( the_date );

    $(ideas).find(".num_votes").text( idea.VoteTotal );
    if( idea.Votes != null ){
        $(ideas).find(".btn-block").addClass("active");
    }
    $(ideas).find(".btn-block").attr("idea-id", idea.Id);

    /* Set Comment Form */
    $(post_comment).find(".btn-block").attr("idea-id", idea.Id);

    $(root_element).empty();
    $(root_element).append(ideas);
    $(root_element).append(post_comment);

    /* Check for Comments */
    if(idea.Comments != null) {

        $.each(idea.Comments,function(index){
            
            var all_comments_temp;
            var all_comments;

            if('content' in document.createElement('template') ) {
                all_comments_temp = document.querySelector('#all_comments');
                all_comments = document.importNode(all_comments_temp.content, true);
            } else {
                all_comments_temp = document.querySelector('#all_comments>div');
                all_comments = $(all_comments_temp).clone(true);
            }
            
            $(all_comments).find("p").text( $(this)[0].CommentBody );
            $(all_comments).find("h4").text( $(this)[0].CreatorName );
            
            cmmnt_date = new Date($(this)[0].CreatedDate);
            $(all_comments).find("span.label").text( (cmmnt_date.getMonth()+1)+"/"+cmmnt_date.getDate()+" at "+cmmnt_date.getHours()+":"+cmmnt_date.getMinutes() );

            $(root_element).append(all_comments);

        }); 
    }

    $(root_element).find('.btn-like:not(.active)').click(function(){
        promoteIdea($(this).attr("idea-id"));
    });

    $(root_element).find('.btn-post').click(function(){
        $(this).button('loading');
        $(".hon-loader").show();
        submitComments($(this).attr("idea-id"));
    });

    if (("standalone" in window.navigator) && window.navigator.standalone) {

        // For iOS Apps 
        $(root_element).find("a").on('click', function(e){
            e.preventDefault();
        });

    }

};
/* Display Idea Details */
function openNewTabForDetails(ideaId) {
    $("#idea-Details-Tab").removeClass('hidden');
    $("#idea-Details-Tab a").tab('show');
    IdeaExchIdeas_Cntrl.getIdea(ideaId,function(result, event){
        if(event.status){
            if(result != ''){
                populateIdea(result, $('#idea-Details'));
                $(".hon-loader").hide();
            }
        }
    });
};
/* Promote an Idea */
function promoteIdea(ideaId) {
    var $btn = $(".btn-like[idea-id="+ideaId+"]").button('loading');
    IdeaExchIdeas_Cntrl.promoteIdea(ideaId,function(result, event){
        if(event.status){
            console.log('result-->' + result);
            if(result != ''){
                if(result != null && result != ''){
                    $btn.button('reset');
                    $btn.addClass('active');
                    $btn.find(".num_votes").text( result.VoteTotal );
                }
            }
        }
    });
};
/* Post Comments */
function submitComments(ideaId) {
    var comments = $("#idea_desc").val();       
    if(comments == "") {
        alert('Please enter comments.');
        $('.btn-post').button('reset');
    } else {
        $("#idea_desc").text("");
        IdeaExchIdeas_Cntrl.addcomments(ideaId,comments ,function(result, event){ 
            if(event.status){
                if(result != ''){
                   window.top.location.reload(true);
                }
            }
        });
    }           
}

$(document).ready(function(){

    $('.nav-tabs a').click(function (e) {
        e.preventDefault();
        $(this).tab('show');
    });

    // Onload checking
    var hashtab = window.location.hash;
    if( $(".tab-pane"+hashtab).length == 0){
        openNewTabForDetails(hashtab.replace("#",""));// Hash is not a Tab ID, try to open an Idea ID
    } else {
        $('.nav-tabs a[href="'+hashtab+'"]').tab('show');// Hash is a Tab ID
    }

    // Get Ideas
    var LimitSize=10;
    var OffsetSize =0;
    /*$('.prev').hide();*/

    // Latest Ideas
    IdeaExchIdeas_Cntrl.getIdeas(LimitSize,OffsetSize ,function(result, event){
        if(event.status) {
            if(result != null){ 
                latest_ideasCount = result.length;
                populateIdeas(result, $('#latest .ideas'));
            }
        }
    });
    // Popular Ideas
    IdeaExchIdeas_Cntrl.getPopularIdeas(LimitSize,OffsetSize ,function(result, event){
        if(event.status) {
            if(result != null){
                popularIdeasCount = result.length;
                populateIdeas(result, $('#pop .ideas'));
            }
        }
    });
    // My Ideas
    IdeaExchIdeas_Cntrl.getMyIdeas(LimitSize,OffsetSize ,function(result, event){
        if(event.status) {
            if(result != null){
                myIdeasCount = result.length; 
                populateIdeas(result, $('#my .ideas'));
                if(myIdeasCount <= 10){
                    $('#my .btn-load').hide();
                }              
            }
        }
    });
    IdeaExchIdeas_Cntrl.getIdeasCount(function(result, event){
        if(event.status) {
            if(result != null){ 
                totalRecs = result;             
            }
        }
    });

    /* Load More */

    var totalRecs = 0;
    var OffsetSizePopular = 0;
    var OffsetSizeRecent = 0;
    var OffsetSizeMyIdeas = 0;
    var myIdeasCount = 0;
    var popularIdeasCount = 0;
    var latest_ideasCount = 0;
    var LimitSize= 10;

    $("#latest .btn-load").click(function(){

        $(this).button('loading');
        OffsetSizeRecent = OffsetSizeRecent + LimitSize;
        IdeaExchIdeas_Cntrl.getIdeas(LimitSize,OffsetSizeRecent,function(result, event){  
            if(event.status) {
                if(result != null){
                    populateIdeas(result, $('#latest .ideas'));
                    $("#latest .btn-load").button('reset');
                }
            }
        });
        if(totalRecs - OffsetSizeRecent <= 10){
            $(this).hide();
        }

    });

    $("#pop .btn-load").click(function(){

        $(this).button('loading');
        OffsetSizePopular = OffsetSizePopular + LimitSize;
        IdeaExchIdeas_Cntrl.getPopularIdeas(LimitSize,OffsetSizePopular ,function(result, event){                       
            if(event.status) {
                if(result != null){
                    populateIdeas(result, $('#pop .ideas'));
                    $("#pop .btn-load").button('reset');
                }
            }
        });
        if(totalRecs - OffsetSizeRecent <= 10){
            $(this).hide();
        }

    });

    $("#my .btn-load").click(function(){

        $(this).button('loading');
        var countMyIdeas = 0;
        OffsetSizeMyIdeas = OffsetSizeMyIdeas + LimitSize;
        IdeaExchIdeas_Cntrl.getMyIdeas(LimitSize,OffsetSizeMyIdeas ,function(result, event){                       
            if(event.status) {
                if(result != null){                                
                    countMyIdeas = result.length;
                    populateIdeas(result, $('#my .ideas'));
                    $("#my .btn-load").button('reset');
                }
            }
        });
        if(totalRecs - OffsetSizeRecent <= 10){
            $(this).hide();
        }

    });

});
</script>
</body>
</html>
</apex:page>