<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Create_New_Account</fullName>
    <availability>online</availability>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>Create New Account</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>{!REQUIRESCRIPT(&quot;/soap/ajax/40.0/connection.js&quot;)}

var isValidRec = true;
var alertMessageArray =new Array();
var caseDescArray =new Array();

var query = &quot;select Id,Account_creation_Case__c from Lead where Id=&apos;{!Lead.Id}&apos; limit 1&quot;; 
        
var leadResult = sforce.connection.query(query); 
var records = leadResult.getArray(&quot;records&quot;); 
var myObj = records[0];

//Query for owner name
var ownerNameQuery = &quot;select Name from User where Id=&apos;{!Lead.OwnerId}&apos; limit 1&quot;; 

var ownerNameResult = sforce.connection.query(ownerNameQuery); 
var ownerNameRecords = ownerNameResult .getArray(&quot;records&quot;); 
var ownerObject = ownerNameRecords[0];

if(myObj.Account_Creation_Case__c == null || myObj.Account_Creation_Case__c ==&apos;&apos;){
if(&apos;{!Lead.Company}&apos; == null || &apos;{!Lead.Company}&apos;==&apos;&apos;){
    alertMessageArray[alertMessageArray.length]=&quot;Company&quot;;
    isValidRec = false;
}else{
  caseDescArray[caseDescArray.length] = &apos;Company - &apos;+&apos;{!Lead.Company}&apos;;
}

if(&apos;{!Lead.SBU__c}&apos; == null || &apos;{!Lead.SBU__c}&apos; == &apos;&apos;){ 
alertMessageArray[alertMessageArray.length]=&quot;SBU&quot;; 
isValidRec = false; 
}else{ 
caseDescArray[caseDescArray.length] = &apos;SBU - &apos;+&apos;{!Lead.SBU__c}&apos;; 
} 

if(&apos;{!Lead.CBT__c}&apos; == null || &apos;{!Lead.CBT__c}&apos; == &apos;&apos;){ 
alertMessageArray[alertMessageArray.length]=&quot;CBT&quot;; 
isValidRec = false; 
}else{ 
caseDescArray[caseDescArray.length] = &apos;CBT - &apos;+&apos;{!Lead.CBT__c}&apos;; 
}

if(&apos;{!Lead.CBT_Team__c}&apos; == null || &apos;{!Lead.CBT_Team__c}&apos; == &apos;&apos;){ 
alertMessageArray[alertMessageArray.length]=&quot;CBT Team&quot;; 
isValidRec = false; 
}else{ 
caseDescArray[caseDescArray.length] = &apos;CBT Team - &apos;+&apos;{!Lead.CBT_Team__c}&apos;; 
} 

if(&apos;{!Lead.Account_New_Market__c}&apos; == null || &apos;{!Lead.Account_New_Market__c}&apos; == &apos;&apos;){ 
alertMessageArray[alertMessageArray.length]=&quot;Account Market&quot;; 
isValidRec = false; 
}else{ 
caseDescArray[caseDescArray.length] = &apos;Account Market - &apos;+&apos;{!Lead.Account_New_Market__c}&apos;; 
} 
 

if(&apos;{!Lead.Account_Address_line_1__c}&apos; == null || &apos;{!Lead.Account_Address_line_1__c}&apos; == &apos;&apos;){
    alertMessageArray[alertMessageArray.length]=&quot;Account Address&quot;;
    isValidRec = false;
}else{
  caseDescArray[caseDescArray.length] = &apos;Account Address Line 1 - &apos;+&apos;{!Lead.Account_Address_line_1__c}&apos;;
}

if(&apos;{!Lead.Account_City__c}&apos; == null || &apos;{!Lead.Account_City__c}&apos; == &apos;&apos;){
    alertMessageArray[alertMessageArray.length]=&quot;City Name&quot;;
    isValidRec = false;
}else{
  caseDescArray[caseDescArray.length] = &apos;City Name - &apos;+&apos;{!Lead.Account_City__c}&apos;;
}

if(&apos;{!Lead.Account_State__c}&apos; == null || &apos;{!Lead.Account_State__c}&apos; == &apos;&apos;){
    alertMessageArray[alertMessageArray.length]=&quot;State code&quot;;
    isValidRec = false;
}else{
  caseDescArray[caseDescArray.length] = &apos;Account State Code - &apos;+&apos;{!Lead.Account_State__c}&apos;;
}

if(&apos;{!Lead.Account_Postal_Code__c}&apos; == null || &apos;{!Lead.Account_Postal_Code__c}&apos; == &apos;&apos;){
    alertMessageArray[alertMessageArray.length]=&quot;Account Postal code&quot;;
    isValidRec = false;
}else{
  caseDescArray[caseDescArray.length] = &apos;Account Postal Code - &apos;+&apos;{!Lead.Account_Postal_Code__c}&apos;;
}

if(&apos;{!Lead.Account_Country__c}&apos; == null || &apos;{!Lead.Account_Country__c}&apos; == &apos;&apos;){ 
alertMessageArray[alertMessageArray.length]=&quot;Country Name&quot;; 
isValidRec = false; 
}else{ 
caseDescArray[caseDescArray.length] = &apos;Country Name - &apos;+&apos;{!Lead.Account_Country__c}&apos;; 
} 

if(&apos;{!Lead.Account_Phone__c}&apos; == null || &apos;{!Lead.Account_Phone__c}&apos; == &apos;&apos;){ 
alertMessageArray[alertMessageArray.length]=&quot;Account Phone Number&quot;; 
isValidRec = false; 
}else{ 
caseDescArray[caseDescArray.length] = &apos;Account Phone Number - &apos;+&apos;{!Lead.Account_Phone__c}&apos;; 
} 

if(&apos;{!Lead.Account_New_Type__c}&apos; == null || &apos;{!Lead.Account_New_Type__c}&apos; == &apos;&apos;){ 
alertMessageArray[alertMessageArray.length]=&quot;Account Type&quot;; 
isValidRec = false; 
}else{ 
caseDescArray[caseDescArray.length] = &apos;Account Type - &apos;+&apos;{!Lead.Account_New_Type__c}&apos;; 
} 

caseDescArray[caseDescArray.length] = &apos;Lead Owner - &apos;+ownerObject.Name; 



if(!isValidRec){  
  alert(&apos;In the “New Account or Contact Information” section, the following fields are required to continue:&apos;+&quot;\n&quot;+alertMessageArray.join(&quot;\n&quot;));
}
if(isValidRec){
   var caseRec = new sforce.SObject(&apos;Case&apos;);
   caseRec.Subject = &apos;New Account from Lead&apos;;
   caseRec.Origin = &apos;In Person&apos;;
   caseRec.RecordTypeID = &apos;01230000000b3UZ&apos;;
   caseRec.Description = caseDescArray.join(&quot;\n&quot;);
   caseRec.OwnerId = &apos;00G30000002Z4FM&apos;;
   result = sforce.connection.create([caseRec]);
 
   if(result[0].success == &apos;true&apos;){
    
    
     myObj.Account_Creation_Case__c = result[0].id;

     var results = sforce.connection.update([myObj]);
     alert(&apos;A New Case with ID - &apos; + result[0].id + &apos; was Created Successfully.&apos;);
     document.location.reload(true)
    }
}
}else{
  alert(&apos;Case record is already created&apos;);
}</url>
</WebLink>
