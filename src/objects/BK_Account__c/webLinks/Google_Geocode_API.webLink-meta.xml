<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Google_Geocode_API</fullName>
    <availability>online</availability>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>Google Geocode API</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>{!REQUIRESCRIPT(&quot;https://maps-api-ssl.google.com/maps/api/js?v=3&amp;sensor=false&quot;)}
{!REQUIRESCRIPT(&quot;https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js&quot;)}
{!REQUIRESCRIPT(&quot;../../soap/ajax/26.0/connection.js&quot;)}

var address = &apos;{!BK_Account__c.Dealer_Location_Address__c}&apos;;

//alert(address);
var address_goog = address.replace(/(.*?)Hangar.*?[#0-9]+?([\d\sa-zA-Z]*)/i,&quot;$1 $2&quot;);
//alert(address_goog); 


sforce.connection.sessionId = &apos;{!$Api.Session_ID}&apos;;

var geocoder = new google.maps.Geocoder();
var geocoderRequest = {address: address_goog};

geocoder.geocode(geocoderRequest, function(results, status){
    if(status == google.maps.GeocoderStatus.OK) {
        var googleAddress = results[0].formatted_address;
        var lat = results[0].geometry.location.lat();
        var lng = results[0].geometry.location.lng();
        alert(&quot;Google Dealer Geocode:\n&quot; + lat + &quot; : &quot; + lng);        
//console.log(&apos;googleAddress=&gt;&apos; + googleAddress + &apos; latitude=&gt;&apos; + lat + &apos; longitude=&gt;&apos; + lng);
        
        var account = new sforce.SObject(&quot;BK_Account__c&quot;);
        account.id = &quot;{!BK_Account__c.Id}&quot;;
 
        account.Dealer_Geocode__Latitude__s = lat;
        account.Dealer_Geocode__Longitude__s = lng;

        sforce.connection.update([account]);

        window.parent.location = &quot;/&quot;+account.id;//to reload the window and show the updated values
        window.location.reload();
        }
    else if(status = google.maps.GeocoderStatus.ZERO_RESULTS) {
        alert(&quot;Google returned Zero results&quot;);
        }
    else if(status = google.maps.GeocoderStatus.OVER_QUERY_LIMIT) {
        alert(&quot;Google returned Query Limit&quot;);
        }
    else if(status = google.maps.GeocoderStatus.INVALID_REQUEST) {
        alert(&quot;Google reported invalid request&quot;);
        }
});</url>
</WebLink>
