<?xml version="1.0" encoding="UTF-8"?>
<ValidationRule xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>ATR_opportunities_stage_change_Restrict</fullName>
    <active>false</active>
    <description>For ATR opportunities user should be allowed to change Stage value only after associating an opportunity product and scheduling that product revenue.</description>
    <errorConditionFormula>AND( 
 not CONTAINS( $Profile.Name, &quot;API&quot; ), 
 not CONTAINS( $Profile.Name, &quot;Admin&quot; ),
(Record_Type_Name__c=&apos;AM Catalog&apos; || Record_Type_Name__c=&apos;AM Complex&apos; || 
Record_Type_Name__c=&apos;AM Standard&apos;) &amp;&amp; NOT( ISCHANGED(Has_Schedule__c) ) &amp;&amp; Is_Product_Created__c = false
&amp;&amp; Has_Schedule__c=0 &amp;&amp; ISPICKVAL(SBU__c, &quot;ATR&quot;) &amp;&amp; 
(NOT(ISPICKVAL (StageName, &apos;Closed Cancelled&apos;)) &amp;&amp; 
NOT(ISPICKVAL (StageName, &apos;Cultivate&apos;)) &amp;&amp; NOT(ISPICKVAL (StageName, &apos;Prospecting&apos;)))
)</errorConditionFormula>
    <errorDisplayField>Products__c</errorDisplayField>
    <errorMessage>Please add an Opportunity Product and Schedule prior to proceeding past the Cultivate Stage</errorMessage>
</ValidationRule>
