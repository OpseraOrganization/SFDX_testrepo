<?xml version="1.0" encoding="UTF-8"?>
<Workflow xmlns="http://soap.sforce.com/2006/04/metadata">
    <alerts>
        <fullName>Warning_Email</fullName>
        <description>A warning email to the owner, when the amount spent has reached 100% of the request.</description>
        <protected>false</protected>
        <recipients>
            <type>owner</type>
        </recipients>
        <senderType>CurrentUser</senderType>
        <template>D_S_Email_Templates/Spend_Amount_Percentage_Warning</template>
    </alerts>
    <fieldUpdates>
        <fullName>Belongs_to_Discretionary_100K_Tick</fullName>
        <field>Belongs_to_100K_budget__c</field>
        <literalValue>1</literalValue>
        <name>Belongs to Discretionary 100K - Tick</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Literal</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>DR_Approval_Status_Closed</fullName>
        <description>This is to update the discretionary request status to closed if all line items are closed</description>
        <field>Approval_Status__c</field>
        <literalValue>Closed</literalValue>
        <name>DR Approval Status=Closed</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Literal</operation>
        <protected>false</protected>
        <reevaluateOnChange>true</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>DR_Populate_Unique_ID</fullName>
        <field>Unique_ID__c</field>
        <formula>&quot;Opp: &quot;+Opportunity__r.Id +&quot; Cmp: &quot; + Campaign__r.Name + &quot; Year: &quot; + text( Fiscal_Year__c ) + &quot; Type: &quot; + text( Type__c )</formula>
        <name>DR Populate Unique ID</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>true</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>DR_Status_Approved</fullName>
        <field>Approval_Status__c</field>
        <literalValue>Approved</literalValue>
        <name>DR Status Approved</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Literal</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>DR_Status_New</fullName>
        <field>Approval_Status__c</field>
        <literalValue>New</literalValue>
        <name>DR Status New</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Literal</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>DR_Status_Open</fullName>
        <field>Approval_Status__c</field>
        <literalValue>Open</literalValue>
        <name>DR Status Open</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Literal</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>Set_SBU_for_GTO</fullName>
        <field>SBU__c</field>
        <literalValue>GTO</literalValue>
        <name>Set SBU for GTO</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Literal</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>UpdateEscalateDelegate</fullName>
        <field>Escalate_To_Delegate__c</field>
        <literalValue>1</literalValue>
        <name>UpdateEscalateDelegate</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Literal</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>Update_CC_Email</fullName>
        <field>CC_Email_id_from_Disc__c</field>
        <formula>CC_List__r.Email</formula>
        <name>Update CC Email</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>Update_Lead_Engineering_Contact_Email</fullName>
        <field>Engineering_lead_Contact_email_id__c</field>
        <formula>Engineering_lead_Contact__r.Email</formula>
        <name>Update Lead Engineering Contact Email</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>Update_Program_Field_in_Discretionary</fullName>
        <field>Program__c</field>
        <formula>Opportunity__r.Program__c</formula>
        <name>Update Program Field in Discretionary</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <rules>
        <fullName>%28Bad%29 Discretionary Budget %28Belongs%29</fullName>
        <actions>
            <name>Belongs_to_Discretionary_100K_Tick</name>
            <type>FieldUpdate</type>
        </actions>
        <active>false</active>
        <description>This ticks &quot;belongs to 100K Budget&quot; check box when discretionary associated to 100K Budget</description>
        <formula>NOT(ISBLANK( Discretionary_100k_Budget__c))</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>Check Approval Wait Time</fullName>
        <active>true</active>
        <criteriaItems>
            <field>Discretionary__c.Approval_Status__c</field>
            <operation>equals</operation>
            <value>Pending Approval</value>
        </criteriaItems>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
        <workflowTimeTriggers>
            <actions>
                <name>UpdateEscalateDelegate</name>
                <type>FieldUpdate</type>
            </actions>
            <offsetFromField>Discretionary__c.CreatedDate</offsetFromField>
            <timeLength>24</timeLength>
            <workflowTimeTriggerUnit>Hours</workflowTimeTriggerUnit>
        </workflowTimeTriggers>
    </rules>
    <rules>
        <fullName>DR Populate Unique ID</fullName>
        <actions>
            <name>DR_Populate_Unique_ID</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <formula>and(
 text( SBU__c ) = &quot;D&amp;S&quot;,
 text( CBT__c ) &lt;&gt; &quot;HTSI&quot;,
 text( CBT__c ) &lt;&gt; &quot;Sales Ops Adj&quot;,
 or(
  ISCHANGED( Opportunity__c ),
  ISCHANGED( Campaign__c ),
  ISCHANGED( Fiscal_Year__c ),
  ISCHANGED( Type__c ),
  ISNEW(),
  ISBLANK(  Unique_ID__c ) 
 )
)</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>DR Status %28Closed%29</fullName>
        <actions>
            <name>DR_Approval_Status_Closed</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <description>This workflow is to close the status of the discretionary request if all the line items are closed</description>
        <formula>AND(
 No_of_closed_line_items__c == No_of_Line_Items__c,  No_of_Line_Items__c&gt;0
)</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>DR Status %28New%29</fullName>
        <actions>
            <name>DR_Status_New</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <formula>AND( No_of_new_line_items__c &gt; 0, Text( Approval_Status__c ) &lt;&gt; &quot;Pending Approval&quot;)</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>DR Status %28Open%29</fullName>
        <actions>
            <name>DR_Status_Open</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <description>This workflow is to change the status of the discretionary request back to Approved from New</description>
        <formula>AND(
No_of_open_line_items__c &gt; 0,
No_of_new_line_items__c = 0,
text(  Approval_Status__c ) &lt;&gt; &quot;Pending Approval&quot;
)</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>DR Update CC Email</fullName>
        <actions>
            <name>Update_CC_Email</name>
            <type>FieldUpdate</type>
        </actions>
        <actions>
            <name>Update_Lead_Engineering_Contact_Email</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <criteriaItems>
            <field>Discretionary__c.CreatedDate</field>
            <operation>notEqual</operation>
        </criteriaItems>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>DR Update Program</fullName>
        <actions>
            <name>Update_Program_Field_in_Discretionary</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <criteriaItems>
            <field>Discretionary__c.Program__c</field>
            <operation>equals</operation>
        </criteriaItems>
        <criteriaItems>
            <field>Discretionary__c.OpportunityOwner__c</field>
            <operation>notEqual</operation>
        </criteriaItems>
        <description>This work flow is to update the Program field in Discretionary from Opportunity if user has not entered Program field and Opportunity is populated</description>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>Set SBU for GTO</fullName>
        <actions>
            <name>Set_SBU_for_GTO</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <criteriaItems>
            <field>Discretionary__c.SR_Number__c</field>
            <operation>notEqual</operation>
        </criteriaItems>
        <triggerType>onCreateOnly</triggerType>
    </rules>
</Workflow>
